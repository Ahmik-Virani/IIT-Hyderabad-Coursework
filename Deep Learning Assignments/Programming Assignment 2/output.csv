rorinline:"<<instruction_no+1<<endl<,0
f_access[index];queue<int>dummy_q;intoffse,2
8+3);registers[temporary_register_no]=this,1
);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<e,0
fintegerintstart_location=imm+register_values[rs1];if(inst=="lb"){int8_tbyte=read,2
i++){byte[i]=binary_to_decimal(binary_,1
egister_values[rd]=register_values[rd]&mask;register_values[rd]&=mask;}}elseif(ins,3
sh({offset_to_label[PC],-1});stringe,3
rands();initialize();ifstreaminstruction_file;vector<vector<string>>assembly_code;stri,4
ck_size));//Thesemanyareforindexinttag_size=20-offset_size-index_size;//Andthe,0
ociativity*block_size));//Thesemanyareforindexinttag_size=20-offset_size-index_size;//Andthes,0
mal(bin_instr);imm=decimal;}else{imm=stoi(instruction[2]);}imm=imm<<,4
(0);}elseif(registers.find(assembly_code[instruction_no][1])==regis,4
n_no][0]];stringrd=registers[assembly_code[instruction_no][1]];stringrs1=registers[assembly_code[i,4
PC=binary_to_hex(bin_PC);hex_PC="0x"+h,1
ct7["and"]="0000000";funct7["or"]="0000000";funct7["xor"]="0000000";funct7,3
youmustenter4operands"<<endl;exit(0);}elseif(registers.find(assembly_code,1
end_storage=(mem_loc/block_size)*block_size+(block_size-1);cache_block[0]=1;//Th,3
Codeforthe,0
;}elseif(r=="a0"||r=="x10"){r="x10";}elseif(r=="a1"||r=="x11"){r="x11";}elseif(r=="a2"||r=="x1,4
"x6";}elseif(r=="t2"||r=="x7"){r="x7";}elseif(r,2
re_value;byte[1]=store_value>>8;memory[mem_l,1
ecifiedbytheuserstrings_addr="";//store,0
hatareoccupiedbythedatasection,andsubtractthembreak_lines.inse,0
mbly_code,instruction_no);}elsei,0
stics:Accesses="<<hits+misses<<",Hit="<<hits<<",Miss="<<,0
instruction_no][1])==registers.end()){cout<<"Errorinline:"<<,2
;//Makesthepositionsofindexbitsandoffsetbits,0
ngtop_of_stack=stack_of_functions.,0
stringrs1=registers[assembly_code[instruction_no][2]];stringrs2=registers[assembly_code[instruction,3
s[this_register];stringvalue_of_r,1
0is0regist,0
embly_code[instruction_no][0]=="srli"||assembly_code[instruction_no][0]=,4
herequiredfieldsinitialize_registers();ini,1
size();j++){for(intk=0;k<cac,1
)'){cur.pop_back();}cur_instruction.push_back(cur);cur="";}}if(cur!=""){if(cur[cur.size()-1,5
out<<"BlockSize:"<<block_size<<endl;cout<<"Associativity:"<<associativity<<endl;cout<<"Replacement,0
d_set<string>load_operands;unordered_map<string,int>labels;unordered_map<string,int6,2
instruction_n,0
youmustenter4operands",0
;top_line=PC/4+1;stack_of_functions.p,0
edwithfindingtherealdata,0
_block[2]=tag;for(intj=sta,1
orlocationspecifiedbythemem_locfor(inti=1;i<instruction.size();i++){uint64_tstore_valu,1
stringfirst_word=executed_instruction.substr(0,pos);if(first_word.back()==':'){executed_instruc,3
sk=temp_mask-1;index_mask=index_mask^temp_mask;//Makestheposition,0
efollowingensurethat64bitscanbehandledbyourcode#definestoistoll#defineintlon,0
];cache[index][i]=new_data;break;}}//Nowcheckiftheremoveddatahasadirtybitset,andifso,,2
seif(inst=="lw"){vector<int3,1
ines.insert(break_,0
PC/4];intpos=executed_in,0
e(index,tag,true,mem_loc,"read",true,false);returnval;}}}else{returnmemory[m,1
dword"){data_base_addre,0
alueofrs1";exit(0);}elseif(stoi(assembly_code[instruction_no][3])<-pow(2,11)||s,5
hex["1110"]='e';bin_to_hex["1111"]='f';stringhe,2
ation+i,accessed_once);accessed_once=true;}uint32_tres=byte[3]<<24|byte[2]<<16|byte[1]<<8|,3
ffsetbitsintoffset,0
="x9";}elseif(r=="a0"||r=="x10"){r="x10";}elseif(r=="a1"||r=="x11"),3
dex_mask<<(index_size+offset_size);index_mask=index_mask-1;t,1
d('');stringfirst_word=executed_instruction.substr(0,pos);if(first_word.back()==':'){execu,4
hichisreplacedq.push(tag);//Pushthenewtagvaluevector<int>removed_,2
){byte[i]=read_access(start_location+i,acc,1
tructionsvoidstep_U(vector<string>instruction),2
alues[rd]=PC+4;PC=new_pc;}//Updatethestackoffunctionsandtheirlastexecutedlineaccordinglystr,1
e[index][i][1]=1;//Settingittodirtyif(write_back_policy=="WT"){memory[mem_l,4
ize();//Iterateoverthebinarystr,1
tenter4operands"<<endl;exit(0);}elseif(registers.find(assemb,1
first_word.back()==':'){exe,1
byprogramintindex=index_mask&mem_loc;index>>=(off,0
ds(){load_operands.insert("lb");load_operands.insert("lh");load_operan,3
t=="ld"){vect,0
3();initialize_funct7();initialize_format();initialize_load_operands();initi,4
truction=all_instructions[PC/4];intpos=executed_instruction.,1
toconvertdecimaltobinarystringdecimal_to_binary(intdecimal,intno_of_bits,bool,0
esemanyareforindexinttag_size=20-offset_size-index_size;//Andtheseman,0
][0]];stringrd=registers[assembly_code[in,1
or<string>instruction,intmem_loc){//Gothroughallthevaluesthatth,1
);}else{assembly_code[instruction_no][3]=to_string(labels[assembly_c,2
ound=true;val=cache_block[3+offset];//Sincethisahit,weneedtoupdatetheo,1
houtbotheringtoddoanythinginthecacheif(write_back_policy=="WT"){memory[mem_loc]=val;//Incaseo,2
ly_code.clear();assembly_code.ass,1
x][i];cache[ind,1
ity==0){//Thismeansthatthereisonly1ind,0
k[0]=1;//The,1
st;inttop_line=stack_of_functions,0
ssembly_code[instruction_no][3])==labels.end()){cout<<"Errorinline:"<<instruction_no+1<<end,3
=temp_mask<<offset_size;temp_mask=temp_mask-1;index_mask=index_,0
bin['1']="0001";hex_to_bin['2'],2
nt=register_values[rs2];if(shifting_amount!=0){register_values[rd]=register,3
ddress);}elseif(to_store[0]==".word"){data_base_address=store_word(to_store,data_base_ad,2
e=(mem_loc/block_size)*block_size+(block_size-1);ne,2
}elseif(inst=="lw"){vector<int32_t>byte(4);boolaccessed_once=false;for(in,3
dlingerrorif(assembly_code[instruction_no].size()!,2
tofrange";exit(0);}//Notingthevaiouspartsoftheinstrction,1
ecuted_instruction.substr(pos+1);}stringbin_PC=decimal,1
truction.substr(,0
ine:"<<instruction_no+1<<endl<,0
Inthecaseofmisses,ifit,0
e);registers[register_no]=this_re,1
r(0,pos);if(first,1
bitszero//Letusdothe,0
eak_point-count_how_many_to_skip);cout<<"Deletedbreakpointatline:"<<break_point,0
//characters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruct,0
reonly,sinceupdate_queuewillneverbereached}else{//Firstcheckifwehaveaninvalidframe,andifwedo,the,0
int64_tres=(byte[7]<<56)|(byte[6]<<48)|(byte[5],3
cout<<"Errorinline:"<<instruction_no+1<<e,0
t_location+i,accessed_once);accessed_once=true;}int64_tres=(byte[7]<<56)|(byte[6]<<48)|(byte[,2
dl;//Ensuretoremovethecalledfunctionfromt,0
ize();i++){for(intj=0;j<cache[i].size();j++){if(cach,3
k_size);//Thesemanybitsareforoffsetintindex_size=log2(cache_s,0
op();//Popthevaluewhichisreplacedq.push(tag);//Pushthenewtagvaluevector<int>removed_data(cache[0][,4
{register_values[rd]=register_values[rs1]^register_values[rs2];}elseif,4
tracttherd,rs1,immvaluesrd=aliasRemover(inst,0
meticaspertheinstructionif(inst=="add,0
_mask;//Makesthepositionsofoffseybitszero//Weneedtodothisfortheoffsetaswell,because,ultimat,0
thmeticacc,0
nstruction=binary_to_hex(instr);vec,1
leintoaqueueofstrings,suchthatafterexecutionofeachrun,wecandequeuetheto,0
torcout<<"Exitedthesimulator";break;}els,0
reak_lines.e,0
6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=bin,2
struction_file,instruction)){//Iftheinstructionisdata,thenensurethatuntil,0
al_to_binary(mem_loc,20,0);stringhex_address="0x"+binar,1
;getline(cin,command);if(!command.find("load")){//Firstresetalltheregisters/memory/PCbeforeloading,3
_no][1])==r,1
x_to_bin['b']=,1
placement_policy,write_back_policy;boolcache_enabled=false;vector<vector<vector<int>>>cache;//Va,3
te_back_policy;//Iftheassociativity=0,thenweneedtomakeitfullyassociativeif(associativity==,0
de<sstream>#include<stack>#include<queue>#include<random>#,4
ind('');stringfirst_word=executed_instruction.substr(0,p,1
cout<<"Erroronline:"<<instructi,0
i]=byte[i];}}//CodeforUformatinstructionsvoidexecute_U,1
op();}for(inti=dummy_stack.size()-1;i>=0;i--){//,3
();PC=0;while(getline(instruction_file,instruction)){//Iftheinstructionisda,3
<instruction.size();i++){uint64_tstore_v,1
{r="x22";}elseif(r=="s7"||r=="x23"){r="x23";}elseif(r=="s8"||r=="x24"){r="x24";}elseif(r=="s9",5
storedinthemapcout<<"Registers:\n";for(inti=0;i<32;i++){stringthis,0
,data_base_address);}}continue;,0
lbreak")){/,0
alueofimmediateisoutofrange";exit(0);}//Notingthevar,1
ediateisoutofrange";exit(0);}//Notingthevariou,1
o_decimal(binary_bytes[i]);//characters67ofhex_,2
seif(break_lines.find(PC/4+1)!=break_lines.end()){cout<<"Executionstoppedatbreakpoint\n";}else,3
);hex_PC="0x"+,0
ngalooptoprintthelabelsinstack,bottomtotopcout<<dummy_stack[i].first<<":"<,1
d_access(start_location,false);uint16_tby,1
nisdata,thenensurethatunt,0
ctionsvoidexecute_B(vector<vector,0
booltrim=false,intlength=8){unordered_map<string,char>bin_to_hex;bin_to_,1
truction=all_instructions[PC/4];intpos=executed_instruction.find('');stringfirst_word=executed_in,2
"jalr"){//Extracttherd,rs1andimmediatevaluerd=aliasRemove,0
orrectvalueofrs1";exit(0),1
|(byte[0]);register_values[rd]=res;}elseif(inst=="ld"){vector<int64,4
bin[i]='1';break;}bin[i]='0';}returnbin;}//Functiontoconvertbinarystringtodecimalintbina,2
st_word.back()==',1
nge";exit(0);}imm=decimal_to_binary(stoi(assembly_co,1
]=byte[i];}mem_loc+,1
[2],20,0);stringhex_tag="0x"+binary_to_hex(bin_tag,true,5),2
labels.find(assembly_code[instruction_no][2])==label,3
][3]]-instruction_no*4);}if(registers.find(assembly_code[instruction_no][1])==registers.end(,4
mask=1;temp_mask=temp_mask<<(index_size+offset_size);temp_mask=t,1
;format["xor"]='R';forma,1
hex_to_bin['5']="0101",1
n_no][2])==registers.,1
_line;stack<pai,0
estinationaddressandvalueofPCaccordinglyregister_values[rd]=PC+,1
ister_no="a";argument_register_no+=to_string(i-10);,1
registers[assembly_code[instruction_no][1]];stringrs2=registers[assembly_code[instruction_no][2]];,6
1]];stringimm=decimal_to_binary(stoi(assembly_code[instruction_no][2]),3
b"]="000";funct3["and"]="111";funct3["or"]="110";funct3["xor"]="100";funct3["sll"]="001";funct3[,4
ster_hex<<endl;}}elseif(command=="exit"){//Exitthesimulatorcout<<"Exi,1
j<cache[i].size();j++){if(cache[i][j][0]==1&&cache[i][j][1]==1){intoffset_size=log2(block,9
ck_of_functions.pop();stack_of_functions.push({top_of_stack,top_line});stringexecuted_instruct,3
<hex_PC<<endl;//UpdatethePCvalu,0
ory["<<mem_loc_hex<<"]"<<"="<<h,0
"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrd";exit(0);}elseif(stoi(assembl,1
useadummystacktopo,0
=="lbu"||inst=="lhu"||inst=="lwu"){//Extract,0
inline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_to_bina,1
ize/(associativity*block_size));//Thesemanyareforindexinttag_size=20-offset_size-index_s,1
ode="0010011";}//Notingthevaiourspartsoftheinstru,0
h"||inst=="lw"||inst=="ld"||inst=="lbu"||inst=="lhu"||inst=="lwu"){//Extractrd,rs1,andimmedia,0
yte[i];}}//CodeforIformatinstructionsvoidexecute,1
temp_mask;//Makesthepositionsofindexbitsandoffsetbitszero//Letusdothesameforinde,0
inary(PC,32,0);stringhex_PC=binary_to,1
acktothecorrectpositioninthematrixif(load_operands.find,0
voidstep_S(vector<string>instruction){//Extractthers1,rs2andimmediatevaluesstringr,2
tvalueofrs2";exit(0);}elseif(registers.find(as,1
ers[assembly_code[instruction_no][1]];stringimm=d,3
ord.back()==':,1
lues[rs1]!=register_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="blt"){if(register_valu,5
eif(!command.find("delbreak")){//Thisblockdeletesabeakpoi,2
no]=this_register;}elseif(i==8){registers["s0"]=this_register;regis,2
nwritetonextreturnmem_loc;}//Functiontostorehalfwordintstore_ha,0
se;stringdata_type;intdata_base_address=0x10000;//Loadthenextfileintoaqueueo,0
(command=="exit"){//Exitthes,1
n.substr(0,pos);if(first_word.back()==':'){executed_in,3
struction_no+1<<endl<<"Incorrectvalueofrs1";exit,0
"a4"||r=="x14"){r="x14";}els,1
thatafterexecutionofeachrun,wecande,0
t";temporary_register_no+=to_string(i-5);registers[temporary_regist,1
to_binary(stoi(assembly_code[instruction_no][2]),21,true);//Concatinatingtheinstructionstringinstr,4
gthenextfileinitialize();hits=0;misses=0;//memory.c,1
gisters.find(assembly_code[instruction_no][2])==registers.end()){cout<<"Errorinline:"<<in,4
]==".half"){dat,0
aliasRemover(instruction[1]);intold_PC=PC;stringi,2
.push(tag);//Pushthene,1
es;}elseif(inst=="lw"){vector<int32_t>byte(4);boolaccessed_once=false;for(inti=0;i<4,3
ntcur=q.front();q.pop();dummy_q.push(cur);if(cur==tag){is_present=true;}}while(!dummy_q.empty(,5
=tag_mask-1;//Thismakesthemask20onesinttemp_mas,0
sembly_code[instruction_no][2]];stringrs2=registers[assembly_code[instruction_no][1]];stringi,5
byte[1]=store_value>>8;memory[mem_loc]=byte[0];memory[mem_loc+1]=byte[1];mem_loc+=2;}//Returnthene,5
mp_mask=temp_mask-1;index_mask=index_mask^temp_mask;//Makesthepositionso,0
sRemover(instruction[2],1
_bytes[i]);//characters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=,2
";funct3["xor"]="100";funct3["sll"]="001";funct3["srl"]="101";funct3["sra"]="101";funct3["ad,4
ningallfunct3valuesvoidinitialize_funct3(){funct3["add"]="000";funct3["sub"]="000,3
i<associativity;i++){vector<int>,1
moryaddressaredivided.intoffset_size=log2(block_size,0
=executed_,0
e_block(block_,0
yte(2);byte[0]=store_value;byte[1]=store_value>>8;memory[m,3
']="0100";hex_to_bin['5']="0101,1
ction_no+1<<,0
estinationaddressandvalueofPCa,0
only1byteintoffset_mask=1;offset_mask=offset_mask<<(offset_size);offset_m,1
(cur_instr);}elseif(format[,1
ters[argument_register_no]=this_regist,1
hestackoffu,0
th*4>binary.size()){stringzeros="",fs="";for(inti=length*4;i<binary.,1
1,true);int16_tres=byte1<<8|byte0;regis,0
tringhex_addr,0
srequestingtoreadinttag=tag_mask&mem_loc;tag>>=,0
t<<"Memory["<<mem_loc_hex<<"]"<<"="<<hex_mem_val<<endl;}}elseif(command=="show-stack"){//Herewee,1
igningtheimmediatealongwithcheckingifitiswithinrangeif(assembly_code[i,0
uction.substr(6-2*i,2,0
rethememory//intmemory[0x,0
ing>instruction){//Extractthers1,rs2andimmediatevaluesstringrs1,rs2,0
ne});stringexecuted_instruction=all_instructions[PC/4];intpos=executed_instruction.find('');string,2
;i++){binary_bytes[i]=hex_t,1
ruction_no][0]];stringrd=regist,1
tag);}else{i,0
="0111";hex_to_bin['8']="1000";hex_to_bin['9']="1001";hex_to_bin['a']="1010";hex_to_bin['b']=",4
luestringrd=aliasRemover(instruction[1]);int,2
_binary(mem_loc,20,0);stringhex_address="0x"+binary_to_hex(bin_address,false,5);stringbin_set=dec,2
sses);}stack_of_functions.pop();}}}elseif(command=="step"){//Gostepbystepint,2
}}if(cur!=""){if(cur[cur.siz,1
20,0);stringmem_loc_hex="0x"+binary_to_hex(mem_loc_bin,false,5);cout<<"Memory["<<mem_lo,1
functions.pop();}stack_of_f,1
rd+opcode;stringhex_instruction=binary_to_hex(instr);vector<string,1
}//Notingthev,0
op_line=PC/4+1;stack_of_fu,0
ode[instruction_no][0]]=='J'){execute_J(assembly_code,instruction_no);}elseif(format[assembly_cod,4
k_of_functions.push({top_of_stack,top_line});stringexecuted_instruction=all_instructions[PC/4];,3
)){//Weparsethestringtogetthelinenumberwherewehavetoinsertabreakpointintbreak_point=stoi(co,0
ssociativity=0,thenweneedtomakeitfullyassociativeif(associativity==0){//Thi,1
alse;//Letusfirstfigureouthowour20bitsofmemor,0
t3();initialize,1
x"+binary_to_hex(bin_mem_val,true,2);intmem_loc=i;stringmem_l,1
sembly_code[i,0
ionofeachrun,wecandequeuethetopstringinstruction;instruction_file.open(command.substr(5));c,2
,instruction_no);}elseif,0
ction}for(inti=0;i<4;i++){memory[instru,0
isters(){for(i,1
exes=cache_size/(associativity*block_size);cache.clear();//Notethatthesizeifb,2
assembly_code[instruction_no][0]=="jalr"){opcode="110,2
ing,string>r,0
=0){for(inti=0;i<=63;i++){mask+=pow(2,i);}}register_values[rd]=r,3
d_once){if(cache_enabled){//Letusfirstfigureouthowour20bitsofmemoryaddressaredivided.intoffset_size=,1
PC/4+1;stack_of_fun,0
+i]=removed_data[3+i];}}}}if(cache_en,1
){bin.push_back('0');}reverse(bin.begi,2
_instruction.find('');stringfirst_word=executed_instruction.substr(0,pos);if(first,2
0].size());vector<int>new_data(cache[0][0].size());intstart_storage=(mem_loc,6
er_values[rs1]|register_values[rs2];}elseif(inst=="xor"){register_values[rd]=register_values[rs1]^r,5
"010";funct3["sd"]="011";funct3["beq"]="000";func,2
_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<execut,2
eforindexmakintindex_mask=1;index_mask=index_mask<<(index_s,0
string,char>format;unordered_se,0
to_break){cout<<"Executionstoppedatbreakpoint\n";break;}}//Iflastlineex,0
convertdecimaltobinarystringdecimal_to_binary(intdecimal,intno_of_bits,boolisSigned){bool,1
sub"]="0100000";funct7["and"]="0000000";funct7["or"]="0000000";fun,2
<<offset_size);for(inti=0;i<block_size;i++){memory[to_store_mem_loc+i]=removed_data[3+i],2
ory[mem_loc]=byte;}if(inst=="sh"){vector<uin,2
sters(){for(inti=0;i<=31;i+,1
lidframe,andifwed,0
_mask=offse,0
l_to_binary(old_PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed,2
.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrd";exit(0);}intdec_imm;//We,2
_to_hex(bin_set,true,5);stringbin_tag=decimal_to_binary(cache[i][j][2],20,0);stringhex_tag,5
push({top_of_stack,top_line});string,2
;stringf3=funct3[assembly_code[instruction_no][0]];stringrs1=registers[assembly_co,3
"<<instruction_no+1<<endl<<"Incorrectvalueofrd";exit(0);}elseif(regi,1
,20,true);//Concatinatingtheinstr,0
mbly_code[instruction_no][,1
ne=stack_of_,0
tes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_,3
hearithmetica,0
_loc=0;to_store_mem_loc,0
}elseif(registers.find(assemb,0
;}}//CodeforIformatinstructionsvoidexecute_I(vector<vector<st,0
register_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="bne"){if(register_values[,4
ngtoreadinttag=tag_mask&mem_loc;tag>>=(index_size+offset_size);//Gettingthevalueofindexbitsofmemory,1
yfor(inti=0;i<cache.size();i++){for(intj=0;j<cache[i].size();j++){cache[i][j][0]=0;//Makethevalidb,6
1";exit(0);}elseif(registers.find(assembly_code[instruction_,1
2]);intmem_loc=imm+register_values[rs1];uint64_tstore_value=register_values[rs2];//Performstore,2
em_loc,"read",true,true);}returnval;//Thedatastartsfromindex3a,0
][2]]-instruction_no*4);}if(registers.find(assembly_cod,1
push({top_of_stack,top_line});stringexecuted_instru,2
;to_store_mem_loc|=(index<<offset_size);for(inti=0;i<block_size;i++){memory[to_store_mem_,0
_nostringhex_instruction=bina,0
thememoryif(remove,0
ed_once=true;}}if(inst==,0
["sra"]="101";funct3["addi"]="000";funct3["xori"]="100";f,3
"){new_data[3+offset]=val;new_data[1]=1;//Setthebittodirty}for(inti=0;i<associativi,3
00;//Loadthenextfileintoaqueueofstrings,suchthatafterexecuti,0
matinstructionsvoidexecute_I(vector<vector<string>>&assembly_code,intinstruction_no){//Handlingerror,3
op_back();labels[cur]=PC;offset_to_label[PC]=,3
p_I(cur_instr);},1
lystringtop_of_stack=stack_of_functions.top().first;intto,1
k&mem_loc;tag>>=(index_size+offset_size);//Gettingthevalueofindexbitsofmemorylocationbeingr,1
3]),6,true);imm="010000"+imm;}else{if(stoi(assembly_code[instruction_no][3])<-p,3
nstructionstringopcode="1100011";stringf3=funct3[assembly_cod,0
ruction_no].size()!=4){cout<<"Errorinlin,1
(assembly_,0
t3["sd"]="011";funct3["beq"]="000";funct3["bne"]="001";funct3["blt"]="100";f,4
elseif(r==,0
dinglystringtop_of_stack=stack_of_functions.top().first;inttop_line=stack_of_functions.top,1
on[0])!=load_operands.end()||format[cur_instruction[0]]=='S'||cur_i,4
";}//Notin,0
ge"){if(reg,0
//Usingalooptopr,0
//Hereweareonlydealingwithcacheandnotqueueif(!to_replace){//Donothing,1
e,weneedtolookinthememoryif(!found){if(!accessed_once){misses++;},3
pow(2,11)){cout<<"Errorinline:"<<instr,1
instr[0]]=='R'){step_R(cur_instr);}elseif(format[cur_instr[0]]==,5
ound=false;for(inti=0;i<associativity;i++){vector<int>cache_block(block_size+3);cache,2
hestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_sta,0
Thebitisnowvalidcache_block[1]=0;//Initiallynotdirtycache_block[2]=tag;for(intj=start_storage,k,2
str(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);,5
geu"]="111";}//Definingallfunct7valuesvoidinitialize_funct7(){funct7["add"]="0000,2
vector<vector<string>>&assembly_code,intinstructi,2
0);stringhex_tag="0x"+binary_to_hex(bin_tag,true,0
seif(!command.find("cache_simdump")){stringmyfile_out_name=command.substr(15);ofs,3
sk20onesinttemp_mask=1;temp_mask=temp_ma,0
values[rd]&mask;register_values[rd]&=mask;}}elseif(inst=="srai"){register_values[rd]=regist,4
mory[mem_loc];update_queue(index,tag,true,mem_loc,"read",true,false,1
inti=1;i<instruction.size();i++){uint64_tstore_value=stoi(instruction[i]);vector<ui,3
format[cur_instr[0]]=='I'){step_I(cur_instr);}elseif(format[cur_instr[,4
cimalrepresenttion,viab,0
];intpos=executed_instruction.find('');stringfirst_word=executed_instruction.s,1
"x0"){r="x0";}elseif(r=="ra"||r,1
ze);//Let'sgetthevalueofoffsetbitsintoffset=offset_mask&mem_loc;//Wenowhavetheindexan,0
<"CallStack:\n";//Weuseadummy,0
o][3]),12,,1
size()!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<<,1
fiedasperthegiveninstructionif(inst=="beq"){if(register_values[rs1]==re,2
9";}elseif(r=="t5"||r=="x30"){r="x30";}elseif(r=="t6"||r=="x31"){r="x31";},4
ize_funct3();initialize_funct7();initialize_format();initialize_load_operands();initialize(,4
eif(format[cur_instr[0]]=='I'){step_I(cur_instr);}elseif(format[cu,5
tructions[PC/4];intpos=executed_instruction.find('');stringfirst_word=exec,2
ntoffset=offset_mask&mem_loc;//Wenowhavetheindexandtagwewant.Wecanproceedwithfindingth,0
Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//UpdatePCvalu,0
astexecutedlinea,0
+){binary_bytes[i]=hex_to_binary(he,1
cache_block[3+offset]=val;cache_block[0],2
n=all_instructions[PC/4];intpos=executed_instruction.find('');stringfirst_word=executed_instr,2
i]=new_data;break;}}//Now,0
gisters();initialize_funct3();initialize_funct7();initialize_format,3
heneveranewfileisloaded,thiswil,0
iostream>#include<string>#include<fstream>#include<unordered_map>#include<unordered_set,3
gister_values[rs1]&register_values[rs2];}elseif(inst=="or"){register_v,3
_rs1=register_values[rs1],val_rs2=register_values[rs2];if(va,2
+){byte[i]=binary_to_decimal(binary_bytes[i]);//characters67ofhex_instruction}for(int,4
stringhex_instruction=binary_to_hex(instr);vecto,1
iss="<<misses<<",HitRate="<<fixed<<setprecision(3)<<(double)(hits)/(hits+miss,3
ex.push_back(bin_to_hex[b]);}if(length*4>binary.size()){str,4
ress="0x"+bina,0
xitedthesimulator";break;,0
r(inti=0;i<cache.size();i++){f,1
=1;//Settingittodirtyif(write_back_policy=="WT"){memory[mem_loc]=val;cac,2
0000"]='0';bin_to_hex["0001"]='1',1
ex["0111"]='7';bin_to_hex["1000"]='8';bin_to_hex["1001",2
ue,5);cache_o,0
ctions.push({top_of_stack,top_line});stringexecuted_instruction,2
(0);}elseif(registers.find(assembly_cod,1
Deletedbreakpointatline:"<<break_point<<endl;}else{cout<<"Nobreakpointspresent\n";}}elseif(,0
<pair<string,int>>dummy_stack;stack<pair<string,int>>dummy_stack_function=stack_of_,4
emoryaddressaredivided.intoffset_size=log2(block_size);//Thesemany,1
]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++){cache_block[k]=memory[j];}fo,3
imaltobinarystringhex_to_binary(stringhex){unordered_,1
.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,3,1
n==".data"){data=true;count_how_many_to_skip++;continue;}if(data||(instruction==".text"),2
01";funct3["sw"]="010";funct3["sd"]="0,2
on_no+1<<endl<<"Incorrectsynt,0
_PC<<endl;//UpdatethePCaccordinglyPC+=4;}elseif(in,0
e();i++){uint64_tstore_va,1
nstringopcode=,0
or<int>new_data(cache[0][0].size());intstart_storage=(mem_loc/block_s,5
"Errorinline:"<<instruction_no+1<<en,0
ction.substr(0,pos);if(first_word.back()==':'){executed_instruction=executed_instruction.sub,3
elseif(!com,0
ativity*block_size));//T,0
ode[instruction_no][3])<,2
first_word=executed_instruction.substr(0,pos);if,1
ueofindexbitsofmemorylocationbeingrequestedbyprogramintind,0
ringhex_set="0x"+binary_to_hex(bin_set,true,5);stringbin_t,1
7ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//,3
binary(tag,20,0);stringh,1
nct3["sra"]="101";funct3["addi"]="000";funct3["xori"]="100";funct3["ori"]="110";funct3["andi"]="1,5
size)*block_size;intend_storage=(mem_loc/block_size)*block_size+(block_size-1);new_da,2
="110";funct3["xor"]="100";funct3["sll"]="001";funct3["srl"]="101";funct3[",3
al_to_binary(index,20,0);stringhex_set="0x"+binary_to_hex(bin_set,true,5);stringbin_,2
_code[PC/4];if(format[cur_instr[0]]=='R'){step_R(cur_instr,4
er_values[rs2];}elseif(inst=="xor,1
al_rs2){PC=new_pc;}else{PC,1
;tag_mask=tag_mask<<20;tag_mask=tag_mask-1;//Thismakesthemask20onesinttemp,0
ct3["srl"]="101";funct3["sra"]="101";funct3["addi"]="000";funct3["xori"]="100";func,4
olis_dirty=false;if(replacement_policy=="FIFO"){if(!to_replace),2
yrepresentati,0
assembly_co,0
Incorrectvalueofrs1";exit(0);}elseif(registers.f,1
ngbinary_to_hex(,0
{if(!to_replace){while(!q.empty()){intcur=q.front();q.pop();if(cur!=tag){dummy_q.push(cur);}},9
rtheinstructionif(inst=="lb"||inst=="l,0
g_mask=tag_mask^temp_mask;//Makesthepositionsofindexbitsandoffsetbi,0
_binary(dec_imm,20,true);//Concatinatingtheinstructionstringinstr=imm+rd+opcode;string,1
']="1001";hex_to_bin['a']="1010";hex_to_bin['b']="1011";hex_to,2
cache[i][j][k]=0;}}}as,3
tack_of_functions.top().first;inttop_line=stack,1
13"){r="x13";}elseif(r=="a4"||r=="x14"){r="x14";}elseif(r=="a5"||r=="x15"){r="x15";}elseif(r=="a6"|,5
ster_values[rd]=res;}elseif(inst=="lbu"){uint8_tbyte=re,2
I';format["lbu"]='I';format["lhu"]='I';format["lwu"]='I';format["jalr"]='I';//Sformatformat["sb"]='S,5
ffset_size);for(inti=0;i<block_size;i++){memory[to,0
s[i]);//characters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];},4
nt>new_data(cache[0][0].size());intstart_storage=(,4
fig_file.open(cache,0
;stringmem_loc_hex="0x"+binary_to_hex(mem_loc_bin,false,5);cout<<"Memor,1
;format["lb"]='I';format["lbu"]='I';format["lhu,2
cache;//Valid,dirty,tag,datainthits=0,misses=0;stringcurrent_opened_file="";vector,0
=(offset_size);//Let'sgetthevalueofoffsetbitsintoffset=offset_mask&mem_loc;/,1
bstr(pos+1);}stringbin_PC=decimal,1
acedq.push(,0
k+=pow(2,i);}}register_values[rd]=register_values[rd]&mask;register_v,3
);}else{if(cur[cur.size()-1]==':'){cur.pop_back();labels[cur]=PC;o,5
gister_values[rd]=register_values[rs1]^imm;}elseif(inst=="ori"){register_values[rd]=register_v,4
"]="001";fun,0
binarystringhex_to_binary(stringhex){unordered_map<char,string>,2
1];}//Ensurethatx0va,0
intdummyi=i;charnum1=dummyi%10+'0';du,0
_to_hex["1001"]='9';bin_to_hex["1010"]='a';bin_to_hex[,2
struction_file.open(command.substr(5));current_opened_file=command.subst,2
["add"]="0000000";funct7["sub"]="0100000",2
s_register;}e,0
_string(labels[assembly_c,0
<<"Incorrectvalueofrd";exit(0);}else,1
)'){cur.pop_back();,1
tructionisdata,thenensurethatuntilwesee.text,wekeepstoringdataif(instruction==".data"){data,1
ithcacheandnotqueueif,0
binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_in,2
yi%10+'0';dummyi/=10;charnum2=dummyi%10+'0';this_registe,0
ly_code.size();if(PC/4==no_of_instruction){co,2
,false,false,val);cache[index][i]=cache_block;retur,2
theirlastexecutedlineaccordingly,0
Codetoconvertbinarytohexadecimalstringbinary_to_hex(stringbinary,booltrim=false,intlength=8),1
_no*4+i]=byte[i];}}//CodeforUformatinstructionsvoidexecute_U(vector<vector<string>>&assembly_code,3
thisfunctionhastoreturnonly1byteintoffset_mask=1;offset_mask=offset_mas,0
ruction_no){//Handlingerrorif(assembly_code[instruction_no].size()!,2
che_output.close();}elseif(command=="cache_siminvalidate"){if(cache_enabled){for(inti=0;i<ca,3
==3){registers["g,0
||r=="x18"){r="x18";}elseif(r=="s3"||r=="x19"){r="x19";}elseif(r=="s4"||r=="x20"){r=,4
ocation+i,accessed_once);accessed_once=true;}int32_tres=(byte,0
xtreturnmem_loc;}//Functiontostorehalfwordintstore_half,0
(instr);vector<string>binary_bytes(4);for(inti=0;i<4;,3
x10000;//Loadthenextfileintoaqueueofstrings,suchthatafterexecutionofeachrun,wecandequeuethetopstrin,0
ainthits=0,misses=0;stringcurrent,0
to_hex["1111"]='f';stringhex="";for(inti=0;i<binary.size();i+=4){stringb=binar,2
tr[0]]=='U'),1
structionsv,0
.top().first;,1
//Thismeansthatthereisonly1index,everyoneisfightingforthisoneindexassoc,0
thememoryif(!found){if(!accessed_once){misses++;if(write_back_policy=="WT"){stringbi,3
i]=binary_to_decimal(binary,0
tetonextretur,0
0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//,0
g>registers;unordered_map<string,string>funct3;unordered_ma,1
t_name;//In,0
instruction<<";PC="<<hex_PC<<endl;//UpdatethePCvalueandensurethatx0willalwaysremainatvalueof0PC,0
em_loc,byte[0],false);write_access(mem_loc+1,by,1
for(inti=0;i<instru,0
//Ifwewerenotabletofindanyinvalidblock,weneedto,0
ry_to_hex(bin_tag,true,5);myfile_out<<"Set:"<<hex_,1
nstruction_file.open(command.substr(5));current_,2
ut<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//Ensurethatthex0val,0
astexecutedl,0
cessed_once=true;}int32_tres=(byte[3]<<24)|(byte[2]<<16)|(byte[1]<<8)|(byt,3
|r=="x23"){r="x23";}elseif(r=="s8"||r=="x24"){r="x24";}elseif,3
r(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC=",3
rli"){//Extracttherd,0
ectvalueofrs2";exit(0);}//Notingthevaiourspartsoftheinstrution,1
2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++){cache_block[k]=memory[j];}f,3
equeue"<<endl;}order_of_access[index]=q;}voidwrite_access(intmem_loc,intval,boolaccessed_once){if(ca,2
ystringtop_of_stack=stack_of_func,0
"+binary_to_he,0
totheinstructionsif(inst=="add"){reg,1
<iomanip>#include<cstring>//Thefollowingensurethat64bitscanbehandledbyourcod,2
[0]=1;//Thebitisnowvalidnew_data[1]=0;//Initiallynotdirtynew_data[2]=tag;for(intj=start_storage,k=3,3
i++){memory[instruction_no*4+i]=byte[i];}}//CodeforIformatinstructionsvoidexecu,3
tor<string>instruction){//Extractrd,rs1,rs2,1
t=="lh"||in,0
i++){byte[i]=binary_to_decimal(binary_bytes[i]);//characters67o,3
0,0);stringhex_set="0x"+binary_to_hex(bin_set,true,5),1
uretopopmainfromthestackif(PC/4==no_of_instructio,0
redinthemapcout<<"Registers:\n";for(inti=0;i<32;i++){stringthis_register="x";if(i<,0
fordirtythenblocksizeforthenumberofbytesinthecachedatacache.assign(no_of_indexes,vector<vector<int>>,2
che[index][i]=new_data;break;}}//Nowcheckiftheremoveddatahasadirtybits,2
ster_values[rs1]|register_values[rs2];}elseif(inst=="xor"){register_values[rd]=register_values,4
eak_lines.end()){br,1
te1=read_access(start_location+1,true);uint16_tres=byte1<<8|byte0,1
<"Errorinline:"<<,0
truction_no][2,0
ector<string>cur_instr=assembly_co,1
i=0;i<4;i++){byte[i]=read_access(start_locati,1
grs2=registers[assembly_code[ins,0
if(is_hit){hit_or_miss="H,1
fhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//CodeforIformatin,3
tion_no+1<<endl<<"Incorrectvalueofrd",0
=this_register;},0
ecuted_instruction.find('');stringfirst_word=executed_instruction.substr(0,pos);if(first_word.back,2
';bin_to_hex["1000"]='8';bin_to_hex["1001"]='9';bin_to_hex["1010"]='a';bi,3
[5]<<40)|(byte[4]<<32)|(byte[3]<<24)|(b,3
ly_code[instruction_no][2])>=pow(2,20)-1){cout,3
ocationspeci,0
haveaninvalidframe,andifwedo,thenwecandirectlyaddourvaluetoitboolfound_invalid=false;for(inti,0
_no+1<<endl<<"Incorrectvalueofrd";exit(0);}elseif(registers.find(assembly_code[instructio,1
de[instruction_no][1])==registers.end,2
er;}elseif(i==2){registers["sp"]=this_register;}elseif(i==3){registers,4
";}}elseif(command=="cache_simdisable"){cache_enabled=false;cache_output.close(,1
//Returnthenewmem_locwhereyoucanwritetonextret,0
bitsareforoffsetintindex_size=log2(cache_size/(associativity*block_size));//Thesemanyar,2
;i++){zeros.push_back('0');fs.push_back('f');}if(hex[0]<'8'&&hex[0]>=,6
mm+register_values[rs1];uint64_tstore_value=register_values[rs2];//Performstore,2
step_I(vector<string>instruction){stringrd,rs1,inst;inst,2
struction_no+1<<endl<<",0
ion_no+1<<endl<<"Incorrectsy,0
heckifwehaveaninvalidframe,andifwedo,thenwecandirectlyaddourvaluetoitboolfound_invalid=false,0
xecuted_instruction.find('');stringfirst_word=executed_instruction.substr(0,pos,1
p().first;inttop_line=stack_of_functions.top().second;top_l,2
todecimalrepresenttion,viabinaryrepresentationstringbin_,0
ters[assembly_code[instruction_no][1]];stringrs1=registers[assembly_code[instruction_no][,4
harc:instruction){if(c==''||c==','){if(cur!=""){to_sto,2
dl<<"Wrongsyntax,forUtypeformat,youmustenter3operands"<<endl;exit(0);}elseif(registers.find(ass,1
_tres=byte;register_values[rd]=res;}elseif(inst=="lhu"){uint16_tbyte0=rea,2
binary(s_addr);intaddr=binary_to_decimal(bin_s_addr);intcount=stoi(s_count);//Printingthelocationso,3
;funct7["and"]="0000000";funct7[",1
andindexshouldbeoftheremoveddatano?to_store_mem,0
"lhu"]='I';format["lwu"]='I';format["jalr"]='I';//Sformatformat["sb"]='S';format["sh"]='S';forma,4
isters[temporary_register_no]=this_register;}elseif(i==8){registers,2
moved_data=cache[index][i];cache[index][i]=new_data;break;}}//Nowcheckiftheremoved,4
re_byte(vector<string>instruction,intmem_loc){//Gothro,2
4"||r=="x14"){r="x14";}elseif(r=="a5"||r=="x15"){r="x15";}elseif(r=="a6"||r=="x16"){r="x16";}el,5
e/block_size;}intno_of_indexes=cache_siz,0
cters67ofhex_instruction}for(inti=0;i<4;i++){m,0
18";}elseif(r=="s3"||r=="x19"){r="x19";}elseif(r=="s4"||r=="x20"){r=,3
ngalooopfor(inti=addr;i<addr+count;i++){intmem_val=m,0
llblocksize//break;}}//Ifwedidnotfindthevalue,weneedtolookinthememoryif(,0
ingtop_of_stack=stack_of_functions.top().first;inttop_line=stack_of_functi,1
e[instruction_no][0]]=='J'){execute_J(assembly_co,2
log2(block_size);//Thesemanybitsareforoffsetintindex_size=log2(cache_size/(associativity,1
_values.clear();all_instructions.clear();offs,2
ngtostep\n";}elseif(break_lines.find(PC/4+1)!=break_lines.end()),3
d:"<<executed_i,0
d(assembly_code[instruction_no][3,1
//Checkiftheuserisspecifyingthe.dataor.textfieldbooldata=false;string,0
=read_access(start_location+1,true);uint16_tres=byte1<<8|byte0;registe,1
ction.substr(0,pos);if(first_word.back()==':'){execu,3
nd(assembly_code[instruction_no][1])==r,3
]<<16|byte[1]<<8|byte[0];register_values[rd]=res;}//Updatethestackoffu,3
ethestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=stack_,0
);boolaccessed_once=false;for(inti=0;i<4;i++){byte[,0
ry[mem_loc];update_queue(index,tag,true,mem_loc,"read",true,false);retur,2
ound_invalid){update_queue(index,tag,0
gisters.find(assembly_code[instruction_no][,1
all_instructions[old_PC/4];intpos=executed_inst,1
ositionsofoffseybitszero//Weneedtodothisforth,0
r=="gp"||r=="x3"){r="x3";}elseif(r=="tp"||r=="x4"){r="x4";}elseif(r=="t0"||r=="x5"){r="x5";}els,5
th.h>#include<sstream>#include<stack>#include<queue,2
rgument_register_no+=to_string(i-10);registers[argum,1
ct3["ld"]="011";funct3["lbu"]="10,2
//Gettingtheva,0
=executed_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(old_PC,32,0);st,2
uction_no][0]=="slli"){if(stoi(assembly_code[instruction_no][3])<0||stoi(assembly,4
assign(0,vector<st,0
stcheckifwehaveaninvalidframe,andifwedo,thenwecandirectlyaddo,0
ackofthenewpcvalueandextractthers1andrs2valuesintnew_pc=PC+stoi(instruction[3]);stringrs1=aliasRem,2
es[rd]=register_values[rs1]-register_values[rs2];}elseif(inst=,3
or<int>cache_block(block_size+3);cache_block=cache[index][i];//Valid,Dirty,tag,d,4
ingtop_of_stack=stack_of_functions.top().first;inttop_line=stack_of_functions.top().seco,2
.find("delbreak")){//Thisblockdeletesabea,1
('0');fs.push_back('f');}if(hex[0]<'8'&&hex[0]>='0'){hex=zeros+hex;}else{hex=fs+hex;}}if(lengt,8
o_hex[b]);}if(length*4>binary.size()){string,3
oveddatano?,0
1;tag_mask=tag_mask^temp_mask;//Makesthepositionsofindexbitsandoffsetbi,0
e());vector<int>new_data(cache[0][0].size());intstart_storage=(mem_loc/block_size)*block_size,7
".byte"){data_base_address=store_byte(to_store,da,0
cheintcache_size,b,0
:"<<instruction_no+1<<endl<<"Wrongsyntax,forJtypeformat,youmustenter3,0
i<=7){stringtemporary_register_no="t";temporary_register_no+=to_string(i-5),1
ur_instr);}elseif(format[cur_instr[0]]=='U'){step_U(cur_instr);}else{exit(0);,6
_instruction.push_back(cur);cur="";}},1
gister_no="t";temporary_register_no+=to_string(i-28+3);registers[temporary_register_no]=t,2
-1){cout<<"Errorinline:"<<instruction_no+1<<e,0
=="s4"||r=="x20"){r="x20";}elseif(r=="s5"||r=="x21"){r="x21";}elseif(r==,3
ct7["and"]="0000000";funct7["or"]="0000000";funct7["xor"]="0000000";funct7,3
truction=all_instructions[PC/4];intpos,1
sh(tag);}else{inttop_tag=q.front();//Ge,2
to_hex["1110"]='e';bin_to_hex["1111"]='f';stringhex="";for(inti=0;i<binary.size();i+=4){stringb=bina,3
(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC=",3
he[i][j][0,2
_values[rd]=res;}elseif(inst=="lw"){vector<int3,2
tionstringopcode="0100011";st,0
00011";}elseif(assembly_code[instruction_no][0]=="jalr"){opcode=,3
umberofmemorylocationswehavetodisplayboolcheck_space=false;//Wenowextrac,0
rmat["beq"]='B';format["bge"]='B';format,2
rmat["sh"]='S';format["sw"]='S';format["sd"]='S';//Bformatformat["beq"]='B';forma,4
mem_loc/block_,0
y,write_back_policy;boolcache_enabled=false;vector<vector<vector<int>>>,3
lues[rs1];if(inst=="lb"){int8_tbyte=read_access(start_location,false);in,3
e-1);cache_block[0]=1;//Thebitisnowvalidcache_block[1]=0;//Initiallynotdirtycache_block[2],3
pened_file.pop_back();current_opened_file.pop_back();PC=0;while(getline(instructi,2
i]);//characters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];,2
lueandthenstoretheremainingw,0
tionif(inst=="lb"||inst=="lh"||inst=="lw"|,0
nstruction_no][1]];stringimm=decimal_to_binary(stoi(asse,1
dcout<<"CallStack:\n";//Weuseadummystacktopopthelabelsfromthemainstackandprintthefort,0
ction_no][0]=="slli",1
;stringhex_address="0x"+binary_to_hex(bin_address,false,5);stringbin_set=decimal_to_binary(ind,1
";PC="<<hex_PC<<endl;//UpdatethePCandensurethatx0remainsatva,0
erands.insert("lw");load_operands.insert("ld");load_operands.insert(,2
_dirty=true;intto_store,0
struction=binary_to_h,0
/block_size)*block_size,0
roceedwithfindingtherealdatainthatloca,0
nitializealltherequiredfieldsinitialize_registers();initialize_funct3();initialize_funct7();initia,3
i++){for(intj=0;j<cache[i].size();j++){cache[i][j][0]=0;//Makethevalidbitasz,5
=="srai"){if(stoi(assembly_code[ins,0
='7';bin_to_hex["1000"]='8';bin_to_hex["1001"]='9,2
(inti=bin.size()-1;i>=0;i--){if(bin[i]=='0'){bin[i]='1';brea,5
uction.find('');stringfirst_word=executed_instruction.substr(0,pos);if(first_word.back()==':'){e,4
ialize_funct7();initialize_format();initiali,2
=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cou,1
in_tag,true,5);myfile_out<<"Set:"<<hex_set<<",Tag:"<<hex_tag<<","<<is_clean<<endl;}}}m,0
d("cache_simdump")){stringmyfile_out_name=command.substr(1,1
texecutedlineaccordinglystringtop_of_stack=stack_of_functions.top().fir,1
isters.find(assembly_code,0
ofvariousinstructionsvoidinitialize_format(){//Rformatformat["add"]='R';format["sub"]='R';format[",3
PC="<<hex_PC<<endl;//UpdatethePCaccordinglyPC+=4;}elsei,0
load_operands.end(),1
tion.pop();}for(inti=dummy_stack.size()-,2
edestinationaddressandvalueofPCaccordinglyregister_value,0
ctions.top().first;inttop_line=stack_of_functions.top().sec,2
offsetbitszero//Letusdothesameforindexmakintindex_mask=1;index_mask=,0
ons.top().first;inttop_line=stack_of_functions.top().second;top_lin,2
bin[i]=='0'){bin[i]='1';break;}bin[i]='0';}returnbin;}//Functiontoconvertb,4
uspartsofth,0
[i]=binary_to_decimal(binary_bytes[i]);//characters67ofhex_instruction}for(inti=0;i<4;i++){memor,3
mbly_code.assign(0,vector<,0
;registers[saved_register_no]=t,1
ldbeoftheremoveddatano?to_store_mem_loc|=(removed_data[2]<<(offset,1
no?to_store_mem_loc|=(removed_data[2]<<,1
illhandleinitializinganyusedvariablesthatthepreviousfi,0
<<endl;cout<<"CacheSize:"<<cache_size<<endl;cout<<"BlockSize:"<<block_size<<endl;cout<<"Associa,0
[rd]=register_values[rs1]&register_values[rs2];}elseif,3
uction.find('');stringfirst_word=ex,1
i=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);//cha,3
/Declarethevariousmapswhichwillstorethenecessaryinformationunordered_map,0
inghex_instruction=binary_to_h,0
tethebranchifconditionsatisfiedasperthegiveninstructionif(inst=="beq"){if(reg,1
=0;j<cache[i].size();j++){for(intk=0;k<cache[i][j].size();k++){c,5
er;}elseif(i==3){registers["gp"]=this_regis,2
:\n";for(inti=0;i<32;i++){stringthis_register=,0
ctions.pop();//UpdatethedestinationaddressandvalueofPCaccordingl,1
e;register_values[rd]=res;}elseif(inst=="lhu"){uint16_tbyte0=read_access(start_location,false);uint,3
_mask&mem_loc;//Wenowhavetheindexandtagwewant.Wecanproceedwithfinding,0
ssociativity,vector<int>(block_size+3,0)));//Initiallyeveryt,2
"]="110";funct3["xor"]="100";funct3["sll"]="001";funct3["srl"]="101";funct3,3
de[instruction_no][0]];stringrd=r,2
nary_to_hex(ins,0
s.insert("lw");load_operands.insert("ld");load_operands.insert,2
cache[index][i][2]==top_tag){removed_data=cache[index][i];cache[inde,5
ntdec_imm;//Weacceptbothdecimalandhexadecimalvaluesif(ass,0
truction[2]);//Extracttherdvaluestringrd=aliasRemover(instruction[1]);intold_PC=PC;stringinst=ins,3
"0100000";funct7["and"]="0000000";,1
uction=executed_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=b,2
er_values[rd]=register_values[rs1]|register_values[rs2];}elseif(inst=="xor"){regis,4
push({offset_to_label[PC],-1});stringexecuted_instruction=all_instructions[old_PC/4];intpo,4
;i<length;i++){//Ifthecurrentcharacteris'1',addthecorrespondingpowerof2,0
lock_size,associativity;stringreplacement_policy,w,0
<value_of_register_hex<<endl;}}elseif(command=="exit"){//Exitthesimulatorcout<<"Exitedthesimu,1
ndingtherealdatainthatlocation//Ifwefindthisblockinthecache,wereadonlythisparticularmemo,0
set<<","<<hit,0
oupdatethememoryif(removed_data[1]==1){is_dirty=true;intto_store_mem_loc=0;to_store_mem_loc|=(tag<<o,2
store_mem_loc=0;//Hereth\etagandi,0
ngimm=decimal_to_,0
_storage=(mem_loc/block_size)*block_size;intend_storage=(mem_loc/block_size)*bl,2
es[rs1]^register_values[rs2];}elseif(inst=="sll"){register_values[rd]=register_va,4
q.push(tag);}}else{inttop_tag=q.front();//Getthetagwhichweneed,2
register_values[rs2];}elseif(inst=="sll"){register_values[rd]=register_values[rs1]<<re,4
nabled){//Letusfirstfigureouthowour20bitsofmemoryaddressaredivide,0
no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Notingthevariouspa,1
n<<";PC="<<hex_PC<<endl;//UpdatethePCvalueandensurethatx0willalwaysremaina,0
(assembly_code[instruction_no][2])>=pow(2,20)-1){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Va,4
uetoitboolfound_invalid=false;for(inti=0;i<associativity;i++){vector<int>cache,1
4_tstore_value=stoi(instruction[i]);vector<uint8_t>byte(,3
e){while(!q.empty()){intcur=q.front();q.p,3
;vector<queue<i,0
{//Gothroughallthevaluesthattheuserhasspecifiedandstor,0
ly_code[instruction_no][3])<0||stoi(assembly_code,2
_PC=decimal_to_binary(PC,32,0);stringhex_PC=bina,1
ted_instruction.substr(pos+1);}string,1
te[1]<<8)|(byte[0]);reg,3
011";stringf3=funct3[assembly_code[instruction_no][0]];stringrs1=registers[assembly_code,3
:"<<executed_instruction<<";PC="<<hex_PC<<endl;//UpdatethePCandkeepx0valueat0PC=PC,0
01";funct3["lw"]="010";funct3["ld"]="01,2
nter3operands"<<endl;exit(0);}if(labels.find(assembly_cod,1
olaccessed_once=false;for(int,0
tr);imm=decimal;}else{imm=stoi(,0
(inti=0;i<associativity;i++){if(cache[index][i][2]==top_,3
st=="sub"){register_values[rd]=register_values[rs1]-register_values[rs2,2
leblockfromthememoryboolfound=,0
)|(byte[6]<<48)|(,1
<hex.size();i++){bin+=hex_to_b,1
eplacement_policy=="FIFO"){if(!to_replace){boolis_present=false;while(!q.empt,1
instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instru,3
r=imm.substr(0,1)+imm.substr(2,6)+rs2+rs1+f3+imm.substr(8,4)+imm.substr(1,1)+opcode;stringhex,4
struction){//Extracttherdandimmediateval,0
e{while(PC/4<no_of_instruction){if(break_,0
hex(bin_PC);hex_PC="0x"+hex_PC;cou,1
0011";}elseif(assembly_code[instruction_no][0]=="jalr"){opcode="1100111";}else{opcode="001,4
_no+1<<endl<<"Labelnotdefined";exit(0);}else{assembly,1
mat["lh"]='I';format[,1
ter_values[rd]=PC+4;PC=imm+register_values[rs1];}//En,2
!=0){bin.push_back(decimal%2+'0');decimal/=2;}while(bin.size()<no_of_bits){bin.push_back(',3
>>cache_size>>block_size>>associativity>>replacement_policy>>write_back,0
lementfor(inti=0;i<bin.size();i++){if(bin[i]=='0,2
;memory[mem_loc]=byte;mem_lo,1
abletofindanyinvalidblock,weneedtoapplyreplacementpolicyif(!found_invalid){update_queue(index,,1
;}elseif(format[cur_instr[0]]=='B'){step_B(cur_instr);}elseif(format[cu,5
o){//Handlingerrorif(as,0
.top().first;inttop_,1
ndl<<"Labelnotdefined";exit(0);}else{assembly_code[instruction_no][3]=to_string(labels[,3
llynotdirtynew_data[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++){new_data[k]=memory,2
ccountthelinesthatareoccupiedbythedatasection,andsubtractthembreak_l,0
voidstep_J(vector<string>instruction){//Storethenewpcvaluetojumptointnew_pc,2
rd+opcode;stringhex_instruction=binary_to_hex(instr);vector<string>bina,2
ctions;unordered_,0
atethestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=st,0
tring,string>funct3;unorde,0
rd";exit(0);}intdec_imm;//Weacceptbothdecimalandhexadecimalvaluesif(assembly_code[instruction_no],2
on=assembly_code.size();boolto_break=,1
atistics:Accesses="<<hits+misses<<",Hit="<<hits<<",Miss="<<misses<<",,0
}elseif(r=="tp"||r=="x4"){r="x4";}elseif(r=="t0"||r=="x5"){r="x5";}else,4
f_functions.pop();stack_of_functions.push({top_of_stack,top_line},2
nd"]="0000,0
ruction){//Keeptrackofthen,0
e,intlength=8){unordered_map<string,char>bi,1
d+opcode;stringhex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4);for(int,3
]==1){stringis_clean="Clean";if(c,0
("load")){//Firstreseta,1
c;index>>=(offset_size);//Let'sgetthevalueofoffsetbitsintoffset=offset_mask&m,1
;//Declarethememory//intmemory[0x50001];vec,1
t16_tbyte1=read_access(sta,0
dl<<"Incorrectvalueofrs2";exit(0);}elseif(stoi(assembly_code[instruction_,1
ly_code[instruction_no][2]],2
inst=="ld"||inst=="lbu"||inst=="lhu"||inst=="lwu"){,0
'){executed_instruction=executed_instructio,0
ed_instruction.find('');stringfirst_word=executed_instruction.substr(0,pos);if(first_word.ba,2
{byte[3-i]=store_value>>,1
al_to_binary(i,20,0);stringhex_set="0,1
];}//Updatethestackoffunctionsandtheirlas,0
at,youmustenter4operands"<<endl;exit(0);}elseif(registers.find(assembly_code[instruction_no],2
"x4";}elseif(r=="t0"||r=="x5"){r="x5";}elseif(,2
substr(0,pos);if(first_word.back(,1
eeptrackofh,0
hifting_amount))-1;if(shifting_amount==0){for(inti=0;i<=63;i++){mask+=pow(2,i);}}regi,3
+){cache[i][j][k,2
lizealltherequiredfieldsin,0
assembly_code[instruction_no][3])<-pow(2,12)||stoi(assem,3
'6';bin_to_hex[",0
blocksizeforthenumberofbytesinthecachedatacache.assign(no_of_indexes,vect,0
o_store_mem_loc+i]=remov,0
cuted_instruction<<";PC="<<he,0
d_file.pop_back();current_opened_file.pop_back();PC=0;while(getline(instruction_file,i,2
ingrs2=registers[assembly_code[instruction_no][3]];//Concatinatingtheinstructionst,3
ecuted_instruction.find('');stringfirst_word=ex,1
count;i++){intmem_val=memory,0
de="1101111";stringrd=registers[assembly_code[instruction_no][,1
ialize_funct7(){funct7["ad,1
immed_hex=hex.substr(i);returntrimmed_hex;}}return"0";}returnhex;}//Codetoconverthexa,1
his_register;}elseif(i>=5&&i<=7){stringtemporary_register_no="t";temporary_register_,0
tag=tag_mask&mem_loc;tag>>=(index_size+offset_size);//Gettingthevalueofindexbitsofmemorylocationbe,1
em_val=decimal_to_binary(mem_val,8,0);stringhex_mem_val="0x"+binary_to_hex(bin_mem_val,true,2);i,2
block[0]==0){val=memory[mem_loc];//Getthevalueandthenstoretheremainingwords,critical,2
ctvalueofrs1";exit(0);}elseif(registers.find(assemb,1
ion_no][2]];stringimm=decimal_to_binary(stoi(assembly_code[instruction_no][3]),1,4
bin_to_hex["1011"]='b';bin_to_hex["1100"]='c';bin_to_hex["1101"]='d';bin_to_hex,3
lue,weneedtolookinthememoryif(!found){if(!accessed_once){misses++;}//Fi,3
{//Extracttherd,rs1andimmediatevaluerd=aliasRemover(instruction[1]);rs1=aliasRemover(instruction[2]),4
=executed_instruction.substr(0,pos);if(first_word.back()==':'){execut,3
ister_values[rs2];if(val_rs1<val_rs,1
<<"Registers:\n";for(inti=0;i<32;i++){stringthis_register="x,0
he[i].size();j++){if(cache[i][j][0]==1&&cache[i][j][1]==1){intoffset_s,9
d=false;for(inti=0;i<associativity;i++){vector<int>cache_block(block_size+3);cache_bl,2
che[index][i]=new_data;break;}}//Nowchecki,2
;i++){memory[instruction_no*4+i]=byte[i];}}//CodeforUformatinstructionsvoidexecute_U(v,3
dirtybitset,andifso,weneedtoupdatethememoryif(remove,0
[rs1];uint64_tstore_value=register_values[rs2];//Performstoreasperthe,2
2]<<16)|(byte[1]<<8)|byte[0];register_values[rd]=res;}elseif(inst=="lbu"){uint8,4
code[instruction_no][3])>=pow(2,6)){cout<<"Errorinline:"<<instruction_no+1<,3
map<string,int>labels;unordered_map<string,int64_t>register_values;unordered_map<string,string>regis,3
olfound=false;intval=0;for(inti=0;i<associativity;i++){vector<i,0
alues[rd]=res;}elseif(inst=="lhu"){uint16_tbyte0=read_access(start_locati,2
|r=="x23"){r="x23";}elseif(r=="s8"||r=,1
ag,false,mem_loc,"write",false,true,va,0
=stack_of_functions.top().second;top_line=P,1
unctions.push({top_of_stack,top_line});stringexecuted_instruction=all_instructions[PC/4];intp,3
em_loc+=8;}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_loc;}//Functiontostorew,0
top_line});stack_of_functions.push({offset_to_label[PC],-1});stringexe,3
e[3]<<24)|(byte[2]<<16)|(byte[1]<<8)|byte[0];register_values[rd]=res;}else,5
u"||inst=="lhu"||inst=="lwu"){//Extractrd,rs1,andimmediaterd=aliasRemover(i,0
t_mask<<(offset_size);offset_mask=offset_mask-1;//Wecannowgettheactualvalueoftagbitsinthememor,1
);}}register_values[rd]=register_values[rd]&mask;regi,2
onsofindexbitsandoffsetbitszero//Letusdothesameforindexmakintindex_mask=1;in,0
e[instruction_no][3])>=pow(2,11)){cout<<"Errorinline:"<<,3
"Incorrectvalueofrs2";exit(0);}//Notingth,1
eweareonly,0
ush_back(instruction[i]);}}instruction=trimmed_instr;//Gothroughthecurrentinstructionand,2
seif(inst=="bge"){if(register_values[rs1]>=register_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(in,7
for(intj=start_storage,k=3;j<=end,0
n){//Extracttherdandimmediatevaluesstr,0
=memory[i];stringbin_mem_v,1
if(i==4){re,1
(),bin.end());if(!isSigned||!isNegative){returnbin;}//Take1'scomplementfor(inti=0;i<bin.size(,4
ister_values[rd]=register_values[rd]&mask;register_values[rd]&=mask;}}elseif(ins,3
offset_mask&mem_loc;//Wenowhavetheindexandtagwewant.Wecanproce,0
][0]]=='J'){execute_J(as,1
struction[i]==''){continue;}else{trim=false;trimmed_instr.push_ba,2
memorywithoutbotheringtoddoanythinginthecacheif(write_back_policy=="WT"){memory,1
ze+3);cache_block=cache[index][i];//Valid,Dirty,2
_loc+i]=byte[i];}mem_loc+=8;}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_loc;}//Fu,1
);cout<<"Insertedbreakpointatline:"<<break_point<<endl;}elseif(!command.find(,0
ivity;stringreplacement_policy,write_back_policy;boolcach,0
_hit=true;fo,0
extreturnmem_loc;}//Functiontostorehalfwordintstore_half(vector<string>instruction,intmem_loc){/,2
cimal(bin_s_addr);intcount=st,1
ngth-1-igivesthepositionfromtheright}}returndecimal;}//Definingallregistersvoidinitialize_r,0
r=="t0"||r=="x5"){r,0
koffunctionsandtheirlastexecutedlineacco,0
opfor(inti=addr;i<addr+count;i++){intmem_val,0
aif(cache_block[0]==0){//memory[mem_loc]=val;//Getthevalueandthenstoretherem,3
eneedtolookint,0
ary(index,20,0);stringhex_set="0x"+binar,1
nds.insert("lhu");load_operands.insert("lwu");}//Wheneveranewfileisload,2
true;}}//Updatethestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=sta,0
no][3]]-instruction_no*4);}if(registers.find(assembly_code[instruction_no][,2
_output_name.c_str(),"a")!=NULL){cache_outpu,1
imal_to_binary(ind,0
ifting_amount==0){for(inti=0;i<=63;i++){mask+=pow(2,i);}}re,2
ex="0x"+binary_to_hex(mem_loc_bin,false,5);cout<<"Memory["<<mem_loc_hex<<"]"<<"="<<hex_mem_val<,1
k_size+(block_size-1);new_data[,1
oc,stringoperation,boolis_read,boolis,0
n=all_instructio,0
ck<pair<string,int>>dummy_stack_function=stack_of_functions;while(!dummy_stack,2
efortheRformatstepinstructionsvoidstep_R(vector<string>,1
ze);index_mask,0
k=(1U<<(64-shifting_amount))-1;if(shifting_amount==0){,2
tructions.push_back(instructi,0
0;register_values[rd]=res;}elseif(inst=="lw"){v,2
myfile_out.open(myfile_out_name);//Gothr,1
}returnr;}voidupdate_queue(intinde,0
i"]='I';format["srli"]='I';format["srai"]='I';f,2
avetheinstructionnumberinthevariableinstruction_nostringhex_inst,0
egister_values[rs1]^register_values[rs2],2
ffset_to_label.clear();while(!stack_of_functions.empty()){stack_,3
data[k]=memory[j];}if(operation=="write"){new_dat,3
ind(assembly_code[instr,0
,20,true);//Concatinatingtheinstructionstringinstr=imm+rd+opcode;stringh,0
line=old_PC/4+1;stack_of_funct,0
inesthatareoccupiedbythedatasection,andsubtractthembreak_lines.insert(break_point-co,0
_stack,top_line});stringexecuted_instruction=all_instructions,0
x,everyoneisfightingforthisoneindexassociativi,0
*4);}if(registers.find(assembly_cod,0
r_values[rs2];}elseif(inst=="or"){reg,2
eedtoapplyreplacementpolicyif(!found_invalid){val=memory[mem_loc];update_queue(index,t,2
tructionsvoidex,0
][0]]=='S'){execute_S(assem,1
=="WT"){memory[mem_loc]=val;//Incaseofwritethroughandmiss,wedonotcontactthecac,1
tringexecuted_instruction=al,0
truction.substr(6-2*i,2,0
;i<4;i++){byte[i]=bin,1
ex["1000"]='8';bin_to_hex["1001"]='9';bin_to_hex,2
nstruction=executed_instruction.substr(pos+1);}stringbin_P,1
oldata=false;strin,0
lf"){data_base_address=store_half(to_store,data_base_address);}elseif(to_store[0]==".w,3
ze();hits=0;misses=,1
offset_size);for(inti=0;i<block_size;i++){memory[to_store_,0
nstruction_no*4+,0
"||r=="x22"){r="x22";}elseif(r=="s7"||r=="x23,1
out<<"Errorinline:"<<instruction_no+1<<endl,0
ster_values[rd]=register_values[rs1]&register_values[rs2];}elseif(inst=="or"){regi,4
code[instruction_no][3])>=pow(2,11)){,3
[instruction_no][2])<-1*pow(2,20)||stoi(assembly_code[instruction_no][2])>=p,7
{r="x26";}elseif(r=="s11"||r=="x27"){r="x27";}elseif(r=="t3"||r=,3
ring(i-10);registers[argument_register_no]=this_register;}elsei,2
fordirtythenblocksizeforthenumberofbytesinthecachedatacache.,0
ak_point<<endl;}elseif(!command.find("cache_s,0
i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byt,1
]='B';//Jformatformat["jal"]='J';//Uformatformat["lui"]='U';}//Keepingtrackofalll,2
tillthebreakpointintno_of_instruction=assembl,0
<instruction_no+1<<endl<<"Wrongsyntax,forUtypeformat,youmustenter3operands"<<endl;exit(0);},1
_enabled){cout<<"CacheEnabled"<<e,0
dthisblockinthecache,weloadthewholeblockfromtheme,0
ister_values[rs2];if(s,1
embly_code[instruction_no][3])<-pow(2,11)||stoi(assembl,3
nst=="slli"||inst=="srli"){//Extracttherd,rs1,immvaluesrd=aliasRemover(instruction[1]);rs1=aliasRem,2
tsinthememorylo,0
_address<<",Set:"<<hex_set<<","<<"Miss"<<",Tag:"<<hex_tag<<","<<"Clean",0
store_value>>(7-i)*8;,1
uiredtofindoutthetagbitslaterinttag_mask=1;tag_mask=tag_mask<<20;,0
ved_data[2]<<(offset_size+index_size));to_store_mem_loc|=(index<<offset_size,2
cessed_once){if(cache_enabled){//Letusfirstfigureouthowour20bitsofmemoryaddressaredivide,1
substr(pos+1);}stringbin_PC=decimal_to,1
ocationthatourprogramisreque,0
"Fromwriteaccess"<<endl;}}//Inthecaseofmisses,ifitiswritethorugh,wejustwritetomemorywithoutb,0
ructionstringopcode="1100011";stringf3=f,0
inttop_tag=q.front();//Getthetagwhichweneedtore,1
ringrs1=registers[assembly_code[instruction_no][2]];stringimm;//Assigningthei,3
tion==".text"){data=false;}else{//Storetherequireddword/word/byte/halfwordvector<string>to_s,2
4;}elseif(inst=="addi"||inst=="xori"||inst=="ori"||inst=="andi"||ins,0
while(!stack_of_functions.empty()){stack_of_functions.pop();}stack_of_functions.push({"main",0}),6
imal_to_binary(tag,20,0);stringhex_tag="0x"+binar,1
r="";for(inti=0;i<instruction.size();i++){if(trim&&instruction[i]==''){continue;}else{trim=f,4
nclude<math.h>#include<sstream>#i,2
abels.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Labelnotdefined";exit(0);}else{assembly,2
inary(tag,20,0);stringhex_tag="0x"+binar,1
abled){cout<<"D-cachestatistics:Accesses="<<hits+misses<<",Hit="<<hits<<",Miss="<<misses<<",HitRate,0
datainthits=0,misses=0;stringcurrent_opened_file="";vector<qu,0
loc){//Gothroughallthevaluesthattheuserh,0
;exit(0);}stringopcode;//Givingthecorrectopcodetothecorrespondinginstructionif(l,1
"]='b';bin_to_hex["1100"]='c';bin_to_hex["1101"]='d';bin_to_h,2
stringtemporary_register_no="t";tempora,0
tionbeingrequestedbyprogramintindex=index_mask&mem_loc;ind,0
=decimal_to_binary(tag,20,0);stringhex_tag="0x"+binary_to_hex(bin_tag,true,,1
unordered_set<string>load_operands;unordered_map<string,int>label,2
ter_values.clear();all_ins,1
h({top_of_st,0
rs[assembly_code[instruction_no][2]];stringrs2=registers[assembly_code[i,3
(getline(instruction_file,instruction)){//Iftheinstructionisdata,thenensurethatuntilwesee.tex,2
2];//Ourmaskisshifting_amount0'sfollowedby64-shifting_amount1'suint,0
sk=offset_mask<<(offset_size);offset_mask=offset_mask-,1
(inst=="lb"){int8_tbyte=read_access(start_location,false);int8_tres,2
<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction.sub,3
;intimm;inst=instruction[0];rs2=aliasRemover(instruction[1]);imm=stoi(,3
me,andifwedo,thenwecandirectlyaddourvaluetoitboolfound_invalid=false;for(inti=0;i<associativity,0
=2){registers["sp"]=this_register;}elseif(i==3){registers["g,3
tringrs1=registers[assembly_code[instruction_no][1]];stringrs2=registers[assembly_code[instructio,3
dr+count;i++){intmem_val,0
2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);//characters67,4
shifting_amount!=0){register_values[rd]=register_values[rs1]>>im,2
;}elseif(i==4){registers["tp"]=t,2
definestoistoll#defineintlonglongusingnamespacestd;//Declarethememory//intmemory[0x50001];vector,1
|r=="x7"){r="x7",0
oc++;}//Returnthenewmem_locwhereyoucanwrit,0
registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs1";exit(0);}elsei,2
ze();i++){if(inst,1
egister_bin=decimal_to_binary(value_of_register_int,64,1);stringvalu,1
"read",true,false);returnval;}}}els,0
ck=stack_of_functions.top().first;inttop_line=stack_of_functions.top().second;top,2
mat["srli"]='I';format["srai",1
nstr[0]]=='J'){step_J(cur_instr);}elseif(format[cur_instr[0]]=='U'){step_U(cur_instr);}else{exit(0),9
yif(!found_invalid){val=memory[mem_loc];update_queue(index,tag,true,mem_loc,"read",true,fal,2
no][1])==registers.end(),2
decimaltobinarystringdecimal_to_binary(intdecimal,intno_of_bits,boolisSigned){boolisNegative,1
_to_hex(stringbinary,booltrim=false,intlength=8){unor,1
Definingallfunct7valuesvoidinitialize_funct7(,0
wextractthevalueofaddrandcountbyparsingthe,0
st;inst=instruction[0];intimm;//Performloa,1
001";hex_to_bin['2']="0010";hex_to_bin[,1
alues[rd]=register_values[rs1]&register_values[rs2];}elseif(inst,3
ionhastoreturnonly1byteintoffset_mask=1;offset_mask,0
nsvoidexecute_R(vector<vector<string>>&assembly_code,in,2
hexadecimalvaluesif(instruction[2][1]=='x'){stringbin_instr=hex_to_bin,3
f(inst=="lb"){int8_tbyte=read_access(start_location,false);int8_tres=byte;register_values[,2
ze());vector<int>new_data(cache[0][0].size());intstart_s,6
eif(r=="t6"||r=="x31"){r="x31";}returnr;}voidupdate_queue(intindex,inttag,boolto_r,2
orindexmakinti,0
rd]=PC+4;PC=imm+register_values[rs1];},1
ze)*block_size+(block_size-1);new_data[0]=1;//Thebitisnowvalidnew_data[1]=0;//Initiallynotdirtynew_d,3
thebittodirty}for(inti=0;i<associativity;i++){if(cache[index][i][2]==top_tag){removed_data=cache,4
updatequeue"<<endl;}order_of_,0
"Incorrectvalueofrs2";exit(0);}elseif(stoi(a,1
{PC=new_pc;}else{PC+=4;}}elseif(inst=="bne"){if(re,3
f(!isSigned||!isNegative){returnbin;}//Take1'scomplementfo,2
}}//Hereweneedtoensurethatallthebocksarewrittenifdirtyfor(inti=0;i<cache.si,0
torage,k=3;j<=end_storage;j++,k++){new_data[k]=memory[j];}removed_data=cache[index][random_number];c,5
le_out.open(myfile_out_name);//GothroughallthevaluesintheD-cacheandwriteonlytheonceswh,1
r(inti=0;i<associativity;i++){vector<int>,1
g_mask=tag_mas,0
]='I';format["slli"]='I';format["srli"]='I';fo,2
de;stringhex_instruction=binary_to_hex(instr);v,1
uction_no][2]]-instruction_no*4);}if(registers.find(assembly_cod,1
intindex=index_mask&mem,0
end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorre,1
ine:"<<instruction_no+1<<endl<<"Incorrectvalueofrs1";exit(0);}elseif(registers,1
,true,2);intmem_loc=i;stringmem_l,0
ddress,false,5);string,0
ex][i];//Valid,Dirty,tag,dataif(cache_bl,1
cess(mem_loc+1,byte[1],true);}if(inst=="sw"){boolaccessed_,3
letesabeakpointintheprogramintbreak_point=,0
=4){registers["tp"]=this_register;}elseif(i>=5&&i<=7){stringtemporary_register_no="t";temporary_regi,2
itsandoffsetbitszero//Letusdothesameforindexmakintindex_mask=1;inde,0
=0){val=memory[mem_loc];//Getthevalueandthenstoretheremainingwords,criticalwordf,1
toi(instruction[3]);//Performtheari,2
utput_name.c_str(),"a")!=NULL){cache_output.close();}cache_output_name=current_opened_fil,3
_no][2]];stringimm=decimal_to_binary(stoi(assembly_code,1
ened_file+",0
id=true;update_queue(index,tag,false,mem_loc,"read",true,,0
stack=stack_of_functions.top().first;inttop_line=stack_of_functions.top().second;top_line,2
oad_operands.insert("lwu");}//Wheneveranewfileisloaded,thiswillhandleinitializinganyusedvariab,1
//characters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//Functio,3
rue;stringtrimmed_instr="";for(inti=0;i<instruction.size();i++),1
=executed_instruction.find('');stringfi,1
);//Pushthenewtagvaluevector<int>removed_data(ca,1
to_store_mem_loc|=(index<<offset_size);for(inti=0;i<block_size;i++){memory[to_store_mem_loc+i]=remo,1
PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<execut,1
size());intstart_storage=(mem_loc/block_size)*block_size;intend_,2
de,instruction_no);}else{cout<<"Erroronline:"<<instruction_no+1<<endl<<"Incorrects,0
ringrs2=aliasRemover(instruction[2]);stringinst=instruction[0,2
//Notingthevariouspartsoftheinstrcutionstringopcode="1101111";stringrd=registers[assembly_code[,0
[2]<<16)|(byte[,1
[0]>='0'){hex=zeros+hex;}else{hex=fs+hex;}}if(length*4<binary.siz,3
eak_point<<endl;}elseif(!command.find("cache_simenab,0
x,tag,false,mem_loc,,0
0000000";funct7["sll"]="0000000";fun,1
tion+1,true);int1,0
r]=new_data;//Nowcheckift,0
rsvoidinitialize_registers(){for(inti=0;i<=31;i++){stringregister_no="x";register,1
;stringexecuted_instruction=all_instructions[PC/4];intpos=executed_instruction.find('');stringfirst_,2
ion[i]);uint8_tbyte=store_value;memor,1
_count);//Printingthelocationsofthememoryasspecifiedusingalooopfo,0
he_block[0]==0){//Thisisaninvalidframe,ig,1
_registers(),1
executed_instruction=all_instructions[PC/4];intpos=executed_i,1
1;tag_mask=tag_mask^temp_mask;//Makesthepositionsofi,0
tivity=0,thenweneedtomakeitfullyassociativeif,0
:"<<instruction_no+1<<endl<<"Incorrectvalueofrd";exit(0);}intdec_im,1
"0000000";funct7["sra"]="0100000";}//Definingtheformatofvariou,1
ize-1);new_data[0]=1;//Thebitisnowvalidnew_data[1]=0;//Initiallynotdirtynew_dat,2
nt8_tbyte=store_value;wri,0
val<<endl;,0
store_mem_loc|=(removed_data[2]<<(offset_size+index_size));to_store_mem_loc|=(inde,2
rdered_map<int,string>offset_to_label;unordered_map<string,int>last_exected_line;stack<pair,2
labels.find(assembly_code[instruction_no][3])==labels.end()){cout<<"Errorinline:"<<i,4
intinstruction_no){//Handlingerrorif(assembly_code[i,0
0";hex_to_bin['9']="1001",1
thememorystrings_count="";//Countofthenumber,0
embly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wro,2
red_map<string,int>last_exected_l,1
_code[instruction_no][3])<-pow(2,11)||stoi(assembly_code[instruction_no][3])>=,7
truction_no+1<<endl<<"Incorrectvalueofrd";exit(0);},1
_values[rs1]+register_values[rs2];}elseif(inst=="sub"){register_values[rd]=register_values[rs1]-r,5
for(inti=0;i<bin,0
_mem_loc|=(removed_data[2]<<(offset_size+index_size));to_sto,2
lhu"]='I';format["lwu"]='I';format["jalr"]='I';//Sfo,2
red_map<string,string>registers;unordered_map<string,string>funct3;unordered_map<string,string,2
intno_of_indexes=cache_size/(associativ,0
s.top().second;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_o,2
ring>binary_bytes(4);fo,1
n_no].size()!=3){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forUt,1
+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=bin,1
store.push_back(cur);}if(to_store[0]==".dword"){data_base_address=store_dword(to_store,data_base_ad,3
ur);if(cur==tag){is_present=true;}}while(!dummy_q.empty(),3
csif(cache_enabled){cout<<"D-cachestatistics:Accesses="<<hits+misses<<",,1
ize));//Thesemanyareforindexinttag_size=20-off,0
l<<"Incorrectvalueofrd";exit(0),1
ess(start_location+1,true);int16_tres=byte1,1
m_loc+i]=byte[i];}mem_loc+=4;}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_l,1
mmy_stack_func,0
"){if(!to_replace){boolis_present=false;while(!q.emp,1
Sformatformat["sb"]='S';format["sh"]='S';format["sw"]='S';format["sd"]='S';//Bformat,4
]]=='J'){execute_J(assembly_code,instruction_,0
e[instruction_no][1]];stringrs1=regis,2
sembly_code[instruction_no].size()!=3){cout<<"Errorin,2
[i]==''){continue;},2
;intstart_storage=(mem_loc/block_s,0
t,64,1);stringvalue_of_register_hex=binary_to_hex(value_of_re,0
<endl<<"Incorrectvalueofrs1";exit(0);}elseif(stoi(assembly_code[instruction_no][3,2
ion==".text")){//Keeptrackofhowmany,0
f(r=="s9"||r=="x25"){r="x25";}elseif(r==,2
["fp"]=this_register;}elseif(i==9){registers["s1"]=this_register;}elseif,4
ite_back_policy;boolcache_enabled=false;vector<vector<vector<int>>>cache,3
13"){r="x13";}elseif(r=="a4"||r=="x14"){r="x,2
c+i]=removed_data[3+i];}}}}}//Hereweneedtoensurethatallthebocksarew,1
ceupdate_queuewillneverber,0
tack_of_functions.pop();stack_of_functions.push({top_of_stack,top_line});stringexecuted_instructio,3
_S(assembly_code,,0
mmed_hex="";for(inti=0;i<hex.size();i++){if(hex[i]=='0'){continue;}else{trimmed_h,4
oc/block_size)*block_size+(block_size-1);new_data[0]=1;//Thebitisnowvalidnew_data[1],3
ruction.find('');stringfirst_word=executed_instructio,1
lue_of_register_hex<<endl;}}elseif(command=="exit"){//Exitthesimulatorcout<<"Exitedthesimulator";br,1
ssembly_code[instruction_no][0]]==',2
xit(0);}el,1
_mask&mem_loc;,0
isters.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueof,1
);//Let'sgetthevalueofoffsetbitsintoffset=offset_mask&mem_loc;//Wenowhavetheindexandtagwewant.,0
start_location=imm+register_values[rs1];if(inst=="lb"){int8_tbyte=read_access(start_location,2
register_values[rs1]>>register_values[rs2];}//Updatethestacko,2
+){if(bin[i]=='0'){bin[i]='1';}else,4
lseif(r==",0
for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//CodeforSformatinstructionsvoidexecu,3
nabled=true;stringcache_config_file_n,0
ctor<int>removed_data(cache[0][0].size());v,5
aif(cache_block[0]==0){val=memory[mem_loc];//Getthevalue,3
=0;//Initiallynotdirtynew_data[2]=tag;for(intj=st,1
c+i]=byte[i];}mem_l,1
t(0);}imm=decimal_to_binary(stoi(as,1
r="x6";}elseif(r=="t2"||r=="x7"){r="x7";}elsei,2
in_set=decimal_to_bina,0
ction_no][3])<0||stoi(assembly_code[instruction_no][3])>=pow(2,6)){cout<<"Errorinline:"<<instruction,6
y_code.clear();assembly_code.assign(0,vector<string>(0));//Checkiftheuserisspecifyingthe.dataor.text,4
h>#include<sstream>#include<stack>#inclu,2
instruction=all_ins,0
"]='S';format["sh"]='S';format["sw"]='S';f,2
it(0);}//Notingthevariouspartsoftheinstrcutio,1
"){new_data[3+offset]=val;new_data[1]=1;//Setthebittodirty}for(inti=0;i<associativity;i,3
lis_hit=false;//Letusfirstfigureouthowour20bitso,0
boolis_dirty=false;i,0
|byte[0];r,1
loc/block_size)*block_size;intend_storage=(mem_loc/block_size)*block_size+(block_size-1);cache_b,2
dirty=false;if(replacement_policy=="FIFO"){if(!to_replace){boolis_present=false;while,2
eSformatstepinstructionsvoidstep_S(vector<string>instruction){//Extractthers1,rs2andim,2
e_size/(associativity*block_size));//Th,1
es[rd]=imm;//Updatethestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=sta,1
(assembly_code[instruction_no][2].substr(2));intdecima,4
n[2]);imm=stoi(instruction[3]);//Updatethestackof,3
_access(mem_loc,byte,false);//memory[mem_loc]=b,2
if(stoi(assembly_code[instruction_no][3])<-pow(2,11)||stoi(assembly_c,4
dthevalue,weneedtolookinthememoryif(!found){if(!accessed_once){misses++;if(write_bac,2
);cout<<"Insertedbreakpointatline:"<<break_point,0
[cur.size()-1]==')'){cur.pop_back,2
<sstream>#include<stack>#include<queue>#include<random>#include<iomanip>#include<cstring>//Thefollo,6
o"]=this_register;}elseif(i==1),1
ti=0;i<associativity;i++){vector<in,0
(0);}//Iflastlineis,1
erisspecifyingthe.dataor.textfieldb,0
e);accessed_once=true;}}//Updatethestackoffunctionsandtheirlastexecutedlineaccordinglystringto,0
_write<<":Address:"<<hex_address<<",Set:"<<hex_set<<","<<hit_or_miss<<",Tag:"<<hex_tag<<","<,0
for(inti=0;i<4;i++){binary_bytes[i]=h,1
ormat["lbu"]='I';format["lhu"]='I';format["lwu"]='I';format["j,3
/characters67ofhex_instruction}for(inti=0;i<,0
if(hex[i]=='0'){continue;}else{trimmed_hex=hex.substr(,3
my_stack.push_back(dummy_stack_f,0
=read_access(start_location+1,true);int16_tres=byte1<<8|byte0;register_val,1
ache,weloadthewholeblockfromthememoryboolfound=false;for(inti=0;i<associativity;i++){vector<int,0
ctiontostorewordintstore_word(vector<string>instruction,intmem_loc){//Gothrougha,2
["x0"]=0;}//C,1
ghex_PC=binary,0
execute_R(vector<vector<string>>&assembly_code,intinstruction_no){//Handlingerrorsif(asse,3
thestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=stack_of_functions.to,0
="x14";}elseif(r=="a5"||r=="x1,0
tinatingthepartstoformtheinstructionstringinstr=im,0
<queue<int>>order_of_access;ofstreamcache_output;//Declar,2
n_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Notingtheva,1
ue;}if(cache_block[2]==tag){is_hit=true;found=true;val=cache_bloc,2
rmat,youmustenter3operands,0
ack();PC=0;while(getline(instruction_file,instruction)){//Iftheinstructionisd,3
hex.substr(binary.,0
f_stack=stack_of_functions.top().,1
oc/block_size)*block_size+(block_s,0
tu"]="110";funct3["bgeu"]="111";}//,1
rs();initialize_funct3();ini,2
etodisplaythememor,0
instruction=executed_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);st,2
ep"){//Gostepbystepintno_of_instruction=assembly_code.size();if(P,1
ninvalidframe,ignorecontinue;}if(cache_block,0
g>registers_alis;vector<string>all_instructions;unorde,1
stfigureouthowour20bitsofmemoryaddressaredivided.int,0
ata[0]=1;//Th,1
_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=b,4
;stringhex_tag="0x"+binary_to_hex(bin_tag,true,5);cache_output<<",1
=register_values[rs1]^register_values[rs2];}elseif(inst=="sll"){register_values[rd]=register_values,4
//UpdatethePCandensurethatx0remainsatvalue0PC=PC+4;register_values["x0"]=0;}//CodefortheUforma,1
(mem_loc/block_size)*b,1
nstruction_file.close();//EnsurethatthePCvalueis0PC=0;if(cache_enabled){if(fopen,2
resize(no_of_indexes);cache_config_file.close();hits=0;misses=0;}elseif(comma,2
ngforlocationspecifiedbythemem_locfor(inti=1;i<instruction.size();i++){uint64_tstore_v,1
ecimalstringbinary_to_hex(stringbinary,booltrim=false,intlength=8){unordered_map<string,char,1
is_dirty){clean_or_dirty="Dirty";}if(is_read){read_or_write="R";}strin,3
byte[0]);register_values[rd]=res;}elseif(inst=="ld"){vector<i,3
seif(command=="regs"){//Pri,1
semanyaretagbits//Letusnowcalculatethemaskrequi,0
hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4,2
;for(inti=length*4;i<binary.size();i++){zeros.push_back('0');fs.push_back('f'),3
uction_no<assembly_code.size();instruction_no+,1
Wehavetheinstructionnumberinthevariableinstruction_n,0
ions.top().first;inttop_line=stack_of_,1
{hex=hex.substr(bina,0
elseif(inst,0
ers[assembly_code[instruction_no][2]];s,3
sociativity;i++){vector<int>cache_block(block_size+3);cache_block=cache[index][i];//Valid,Dirty,t,4
struction.size();i++){uint64_,1
ds"<<endl;exit(0);}elseif(registers.find(a,1
sembly_code[instruction_no].size()!=4){cout<<"Errorinlin,2
Gothroughallthevaluesthattheuserhasspecifiedandstorethemstar,0
ffset_size+index_size));to_store_mem_loc|=(index<<offset_size);for(inti=0;,0
sstringinstr=imm+rs1+f3+rd+opcode;stringhex_instruction=binary_to_hex(instr);vector<string>bin,2
[instruction_no][2]];stringimm;//Assigningtheimmediatealongwithcheckingifitiswith,2
l=0;for(inti=0;i<associativity;i++){vector<int>cache_block(block_size+3);cache,2
ybytesstartingfrommemorylocationspecifiedbytheuserstrings_addr="";//storethestartaddressfrom,0
eisonly1index,everyoneisfightingforthisoneindexassociativity=cache_size/bloc,0
ary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instr,2
r;}elseif(i==4){registers["tp"]=th,2
cuted_instruction<<";PC="<<hex_PC<<end,0
ctvalueofrd";exit(0);}elsei,1
i=0;i<8;i++){write_access(mem,0
){cout<<"Executionstop,0
n_no][2]]-instruction_no*4);}if(register,1
le(getline(instruction_file,instruction)),2
eplacement_policy=="RANDOM"){//Hereweareonlydealingwithcacheand,0
ackif(PC/4==no_of_instruction){stack_of,1
theinstructionstringopcode="0100011";stringf3=funct3[assembly,0
ound=false;intval=0;for(inti=0;i<associativity;i++){vector<int>cache_blo,1
_bytes[i]);//characters67ofhex_instruction}for(inti=0;i<4;i,1
bstr(10,10)+imm.substr(9,1)+imm.substr(1,8)+rd+opcode;stringhex_instruction=bina,3
_of_functions.push({offset_to_label[PC],-1});stringexecuted_instruction,3
[j][0]==1&&cache[i][j][1]==1){intoff,5
_code[instruc,0
<(offset_size+index_size),1
67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte,1
che_block=cache,0
[index][random_number];cache[index][random_number]=new_data;//Nowcheckiftheremoveddatahasadirtybit,4
=funct3[assembly_code[instruction_no][0]];strin,3
ame);//GothroughallthevaluesintheD-cacheandwriteonlytheonceswhicharevalidfor(inti=0;i<cache.size();i,1
validframe,andifwedo,thenwecandirectlyaddourvaluetoitboolfo,0
dmain(){//Initializealltherequ,1
no+1<<endl<<"Wrongsyntax,forStypeformat,youmustenter4operands"<<endl;exit(0);}els,1
eif(command=="cache_siminvali,0
ation.//Ifwedonotfindthisblockinthecache,weloadthewholeblockfromthememoryboolfound=f,0
uted_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binar,2
orethemstartingforlocationspecifiedbythemem_locfor(inti=1;i<i,0
binary_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4,4
r_miss<<",Tag:"<<hex_tag<<","<<clean_or_dirty<<"fromupdatequeue"<<endl;}order_o,0
owgettheactualvalueoftagbitsinthememorylocati,0
lock_size)*block_size+(block_size-1,0
=val;//Incaseofwritethroughandmiss,wedonotcontactthecacheatall.So,0
ruction[0];stringrd=aliasRemover(i,1
re_byte(vector<string>instruction,intmem_loc){//Gothroughallthevaluestha,2
[assembly_code[instruction_no][0]]=='J'){execute_J(assembly_code,instruction_no);}el,5
defortheIformatstepinstructionsvoidstep_I(vector<stri,0
out<<"Errorinline:"<<inst,0
f(r=="s11"||r=="x27"){r="x27";}elseif(r=="t3"||r=="x28"){r="x,3
e_block;return;}}//Ifwewerenotabletofi,0
eakpointatline:"<<break_point<<endl;,0
ecuted_instruction.substr(pos+1);}stringbin_PC=decimal_to_binar,1
32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x,1
emorystrings_count="";//Countofthenumber,0
ndl;//UpdatethePCaccordinglyPC+=4;}elseif(inst=="addi"||inst=="xori"||inst==,0
nstruction_nostringhex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4),3
tion_no+1<<endl<<"Incorrectvalueofrs1";exit(0);}elseif(registers.find(a,1
liasRemover(instruction[2]);stringrs2=aliasRemover(instruction[3]);//Dothearithmeticaccordingtothe,4
r=="x3"){r="x,0
reak_lines.insert(break_point-count_how_many_to_skip);cout,1
[b]);}if(length,1
ffset_mask=1;offset_mask=offset_mask<<(offset_size);offset_mask=offset_mask-1;//Weca,1
e[i];}mem_loc+=4;}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_loc;,1
tiontostorewordintstore_word(vector<string>instructio,1
inti=0;i<hex,0
instruction=all_instructions[PC/4];intpos=executed_instruction.find('');stringf,2
_once){misses++;}//Firstcheckifwehaveaninvalidframe,andifwedo,thenwecandirectlyaddourvaluetoitboo,1
101";funct3["srai"]="101";funct3["lb"]="000";funct3["lh"]="001";funct3,3
e"){if(cache_enabled){for(inti=0;i<cache.size();i++){for(intj=0;j<cache[i].size();j++){if(c,4
_function=stack_of_functions;while(!dummy_stack_function.empt,0
nlythisparticularmemorylocation.//Ifwedonotfindthisblockinthecache,weloadthewholebl,0
"<<executed_instruction<<";PC="<<hex_PC<<endl;//UpdatethePCandkeepx0valueat0PC=PC+4;re,0
tinue;}if(cur[cur.si,0
include<cstring>//Thefollowingensurethat64bitscanbehandledbyourcode#definestois,1
cethisahit,we,0
end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrd";exit(0);}elseif(stoi(,2
}elseif(format[cur_instr[0]]=='S'){step_S(cur_instr);}elseif(forma,5
ingrs1=aliasRemover(instruction[2]);,2
er(instruction[1]);in,2
"x11";}elseif(r=="a2"||r=="x12"){r="x12";}elsei,2
byte[0];memory[mem_loc+1]=byte[1],3
0){//Thisisaninvalidframe,ignoreco,0
d[i]==''){check_space=true;}else{s_add,2
ndex_mask=1;index_mask=index_mask<<(index_size+offset_size);index_ma,1
fixed<<setprecision(3)<<(double)(hits)/,3
ex_mem_val<<endl;}}elseif(command=="show-stack"){//Hereweexecutethe,1
registers[argument_register_no]=this_register;},1
no][3])<0||stoi(assembly_code[,1
ster_no+=to_string(i-5);regi,1
and;getline(cin,command);if(!command.find("load")){,3
;accessed_once=true;}int64_tres=(byte[7]<<56)|(byt,1
opcode="0010011";}//Notingthevaioursp,0
f"){data_base_address=store_half(to_store,data_base_address);}elseif(to_store[0]==".wo,3
rinttheregistervalues,0
r<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_ins,3
rs1];}//Ensurethatx,0
e,k=3;j<=end_storage;j++,k++){new_data[k]=memory[j];}removed_dat,3
r_values[rs1]!=register_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="bl,4
rroronline:"<<instruction_no+1<<endl<<"Incorrectsyntax";exit(0);},1
r(0,pos);if(first_word.back,1
/Letusdothesam,0
de="1100111";}else{opcode="0010011";}//Notingthevaiourspartsoftheinstrutionstringf3=funct,1
binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_ins,2
ary_bytes[i]);//characters67ofhex_instruction}for(inti=0;i<4,1
veddatano?to_store_mem_loc|=(removed_data[,0
=='J'){step_J(cur_instr);}elsei,2
(2,12)-1){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimm,1
ter_no+=to_string(i-5);regi,1
cout<<"Executionstoppedatbreakpoint\n";break;}}//Iflastlineexecute,0
]='I';//Sformatformat["sb"]='S';format["sh"]='S';format["sw"]='S';format["sd"],4
n=="write"){new_data[3+offset]=val;new_data[1]=1;//Setthebittodirty}for(i,3
){dummy_stack.push_back(dummy_stack_function.top());dummy_stack_fu,2
_size);offset_mask=offset_mask-1;//Wecannowgettheac,0
_functions.pop();stack_of_functions.push({top_of_stack,top,1
q.front();//Getthetagwhi,1
;format["sh"]='S';f,1
f(command==,0
henewtagvaluevector<int>removed,1
ead",true,false);cache[index][i]=cache_block;returnval;}}//Ifwewerenotabletof,2
che_size>>block_size>>associativity,0
ax,forItypeformat,youmustenter4opera,0
_tag=decimal_to_binary(tag,20,0),1
enintold_PC=PC;//Executethebranchifconditionsatisfiedasperthegivenins,0
ring>>&assembly_code,intinstruction_no){//Handlingerrorif(assembly_code[instruction_n,0
orlocationspecifiedbythemem_locfor(inti=1;i<instruction.size();i++){uint64_tstore_value=stoi(instru,1
random>#include<iomanip>#inc,1
(cur_instr);}else{exit(0);}//Iflastlineisexecuted,thene,3
,bottomtotopcout<<dummy_stack[i].first<<":"<<dummy_stack[i].second+count_how_many_to_skip<,2
,12)-1){cout<<"Errorinli,0
0);}elseif(stoi(assembly_code[instr,0
"Clean"<<"Fromwriteaccess"<<endl;}}//Inthecas,0
({top_of_stack,top_line});stri,2
cannowgettheactualvalueoftagbitsinthememorylocat,0
ngimm=decimal_to_binary(dec_imm,20,true);//Concatinatingtheinstructionstringinstr=imm+rd+op,1
orinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs1";exit(0);}elseif(register,1
eros+hex;}else{,0
3])<0||stoi(assem,0
1);new_data[0]=1;//Thebitisnowvalidnew_data[1]=0;//,2
ngaliasRemover(stringr){if(r=="zero"||r=="x0,1
ionthatourprogramisrequestingtoreadinttag=tag_mask&mem_loc;tag>>=(index_size+offse,0
ichwillstorethenecessaryinformationunordered_map<string,strin,0
k_space){if(command[i]==''){check_space=true;}else{s_addr.push_back(command[i]);}}else{s_c,7
embly_code[instruction_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Inc,3
characters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i],2
set=decimal_to_bina,0
etusdothesameforindexmakintinde,0
t4"||r=="x29"){r,0
lues[rs2];}elseif(inst=="sll"){register_values[rd]=register_values[rs1]<<reg,4
;PC="<<hex_PC<<endl;//Ensuretoremovethecalledfunctionfromthestackoffunction,0
dex][i];//Valid,Dirty,tag,dataif(cache_block[0]==0){val=memory[mem_loc];//Getthevaluean,4
mat["bge"]='B';format["blt"]='B';format["bne"]='B';format["bltu"]='B';format[",4
ction_no][3])>=pow(2,11)){cout<<"Errorinline:"<<instruction_no+1<<,2
pecifyingthe.dataor.textfie,0
emoryfor(intinstruction_no=0;instruction_no<assembly_code.size();instruction_no++){if(format[ass,1
o_string(i-5);registers[temporary_register_no]=this_register;}e,2
r(5));current_opened_file=command.substr(5);//Th,2
p)!=break_lines.end()){break_lines.erase(break_point-count_how_many_to_skip);cout<<"Deletedbreakpo,2
edbythemem_locfor(inti=1;i<instruction.size();i++){uint64_tstore_value=stoi(instr,1
}else{PC+=4;}}elseif(inst=="blt"){if(register_values[rs1]<register_values[rs2]){PC=new_pc;}e,5
{executed_instruction=executed_instruction.substr(pos+1);}stringbin_PC=dec,2
cationswehavetodisplayboolcheck_space=false;//Wenowextractthevalueofaddrandc,0
size)*block_,0
ebreakpointif(break_lines.find(break_point-count_how_many_to_skip)!=break_lines.end,1
nsvoidstep_B(vector<string>instruction){//Keeptrackofthenewpcvalueand,2
f(stoi(assembly_code[instruction_no][3])<-pow(2,11)||stoi(as,4
ng,int>>dummy_stack_function=stack_of_functions;while(!dummy_stack_function,0
n_no);}elseif(format[assembly_code[instruction_no][0]]=='S'){execute_S(assembly_c,4
1<<endl<<"Wrongsyntax,forStypeformat,youmustenter4o,0
ck_policy=="WT"){memory[mem_loc]=val;cache[index][i][1]=0;//S,4
ex_to_bin['0']="0000";hex_to_bin['1']="0,2
(inst=="sll"){register_values[rd]=register_v,2
write_access(mem_loc+i,byte[i],accessed_once);accesse,2
o][2])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<,2
fimmediateisoutofrange";exit(0);}//Notingthevaiou,1
in_mem_val,true,2);intmem_loc=i;stringmem_loc_bin=decimal_to_binary(i,20,0);stringmem_l,1
";hex_to_bin['f']="1111";stringbin="";for(inti=0;i<hex.size();i++){bin+=hex_to_bin,2
r<string>instruction){stringrd,rs1,inst;inst=instru,1
";//Weuseadumm,0
ctions[PC/4];intpos=executed_instruction.find('');stringfirst_word=,2
format,youmustenter3operands"<<endl;exit(0);}if(labels.find(assembly_co,1
size();i+=4){st,1
in_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";,0
on_no*4+i]=byte[i];}}//CodeforUformatinstructionsvoidexecu,1
ereadonlythisparticularmemorylocation.//Ifwedonotfindthisbl,0
its)/(hits+misses);}stack_of_functions.pop();}}}elseif(command=="step"){//G,3
kandprintthefortheuservector<pair<string,int>>dummy_sta,2
unctionsandtheirlastexecutedlineaccord,0
ddatano?to_store_mem_loc|=(rem,0
lock_size+3,0)));//Initiallyeverythingisinvalid,,0
{for(inti=0;i<32;i++){stringreg="x"+to_string(i);register_values[reg]=0;}i,3
stack_of_functions.pop();stack_of_functions.push({top_of_stack,top_line});string,3
ue;byte[1]=store_value>>8;memory[mem_loc]=byte[0];mem,3
themem_locfor(,0
J';//Uformatformat["lui"]='U';}//Keeping,1
cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs2";exit(0);}elseif,1
<instruction.size();i++){uint64_tstore_value=stoi,1
[1]=1;//Setthebittodirty}for(inti=0;i<a,1
e<unordered_map>#include<unordered_set>#include<vector>#include<ar,3
p"]=this_register;}elseif(i==9){registers["s1"]=this_register;}elseif(i>=10&&i<=17,3
m=false;trimmed_instr.push_back(instruction[i],1
nsofthememoryasspecifiedusingalooopfor(inti=addr;i<addr+count;i++){intmem_v,0
ack_of_functions.push({top_of_stack,top_line});stringexecuted_instruction=all_instructions[old_P,2
first_word.back()==':,1
esthepositionsofindexbitsandoffsetbitszero//Letusdothesam,0
nd=="cache_siminvalidate"){if(cache_enabled){for(inti=0;i,1
f(inst=="sub"){register_values[rd]=register_values[rs1]-register_values[rs2];}elseif(inst=="and"){,6
gisters(){for(inti=0;i<=31;i++){stringregister_no="x";register_no+=to_string(i);strin,2
ter_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="bge"){if(,4
ers["zero"]=this_register;}els,1
ccessed_once=false;for(inti=0;i<8;i++){byt,0
ngbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_P,1
ntthelinesthatareoccupiedbythedatasection,andsubtractthembreak_lines.insert(break_point-count_ho,0
his_register];stringvalue_of_register_bin=decimal_to_binary(value_of_regis,0
register_values[rd]=register_va,1
ti=0;i<=63;,0
i%10+'0';dummyi/=10;charnum2=dummyi%10+'0';this_register+=num2;this_register+=num1;}intvalue,0
ileintoaqueueofstrings,suchthatafterexecutionofeachrun,wecandequ,0
][1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"In,2
executed_instruct,0
ta_base_address);}elseif(to_store[0]==".byte"){data_base,2
at["lwu"]='I';format["jalr"]='I';//Sformatformat["sb"]='S';format["sh"]='S';format["sw"]='S';format,5
f(vector<string>instruction,intmem_loc){//Gothroughallthevaluesthattheus,2
t<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs2";exit(0);}elseif(regis,1
false);returnval;}}}else{returnmemory[mem_loc];}//Thiswillneverreachreturn-1;}//,2
I';format["lhu"]='I';format["lwu"]='I';format["jalr"]='I';//Sformatformat["sb"]='S';format["sh"],5
ted_instruction=all_instructions[PC/4];in,1
bitisnowval,0
;if(first_word.back()==':'){executed_ins,2
epartstoformtheinstructionstringinstr=imm.substr(0,1)+imm.substr(2,6)+rs2+rs1+f3+imm,2
bin.begin(),bin.end());if(!isSigned|,2
()){intcur=q.front(,1
ruction_no][0]]=='S'){execute_S(assem,1
e-index_size;//Andthesemanyaretagbitsvec,0
"||r=="x29"){r="x29";}elseif(r=="t5"||r=="x30"){r="x30";}elseif(r=="t6"||r,3
tag>>=(index_size+offset_size),1
ude<algorithm>#inc,1
tion[0];stringrd=aliasRemover(instruction[1]),3
k_policy=="WT"){memory[mem_loc]=val;cache[index][i][1],4
-i)*8;}for(inti=0;i<8;i++){write_access(mem_l,0
hedatasection,andsubtractthembreak_lines.insert(break_point-count_how_many_to_skip);cout<<"Inserted,1
block_size);//Thesemanybitsareforoffsetintindex_size=log,0
iswritethorugh,wejustwritetomemorywithoutbotheringto,0
=2){registers["sp"]=this_registe,1
ion<<";PC="<<hex_PC<<endl;//Ensurethatthevalueofx0is0register_value,0
_clean="Clean";if(cach,0
mem_loc];}//Thisw,0
'B'){execute_B(assembly_code,instruction_no);}elseif(format[assembly_code[instruc,2
<string,int>labels;unordered_map<string,int64_t>register_values;uno,2
.first;inttop_line=stack_of_functions.top().second;top_line=old_PC/4+1;stack_of,1
lseif(r=="s7"||r=="x23"){r="x23";}elseif(r=="s8"||r=="x24"){r="x,3
s(start_location,false);int8_tres=byte;register_values[rd,1
c,"write",false,false,va,0
er_no+=to_string(i-5);registers[,1
ss(start_location+i,accessed_once);accessed_once=true;}uint32,1
tion_no][1])==registers.end()){cou,2
de[instruc,0
=new_pc;}//Updatethestackoffunctionsandtheirlastexecutedlineaccordingly,0
a[0]=1;//Thebitisnowv,1
ytes[i]);//characters67ofhex_instruction}for(in,1
s.find(assembly_code[instruction_no][1])==register,3
to_hex(bin_PC);h,1
ormat,youmuste,0
on.size();i++){uint64_tstore_value=stoi(instruction[i]);vector<uint8_t>by,4
_t>byte(2);byte[0]=store_value;byte[1]=,3
ffset_size);for(inti=0;i<block_size;i++){memory[to_store_mem_loc+i]=removed_data[3+i,1
=':'){executed_instruction=executed_instruction.substr(pos+1);}stringbin,2
values[rd]=PC+4;PC=imm+register_values[rs1];}//En,2
instruction[2].substr(2));intdecimal=binary_to_decimal,2
}elseif(inst=="bne"){if(register_values[rs1]!=reg,2
ush({top_of_stack,top_line});stack_of_functions.push({offset_to_label[,2
I';format["ori"]='I';format["andi"]='I';format["slli"]='I';format["srli"]='I';format["srai,4
to_bin['c']="1100";hex_to_bin['d']="1101";hex,2
on_no+1<<end,0
;}elseif(i>=10&&i<=17){stringargument_regis,0
t["bne"]='B';format["bltu"]='B';format["bgeu"]='B';//Jformatformat["jal"],4
nline:"<<instruction_no+1<<endl<<"Incorrectvalueofrd";exit(0);}elseif(registers.find(assembl,1
<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forBtypeformat,youmustenter4operands",0
xori"){register_values[rd]=register_values[rs1]^imm;}else,3
n}for(inti=0;i<4;i++){memory[instructio,0
[j][0]==1){str,2
format["slli"]='I';f,1
irty<<"fromupdatequeue"<<endl;}order_of_access[index]=q;}voidwrite_access(intmem_lo,1
="100";funct3["sll"]=",1
x24"){r="x24";}elseif(r=="s9"||r=="x25"){r="x25";}elseif(r=="s10"||r=="x26"){r="x26";}elseif(r=="s,5
_size)*block_size+(block_size-1);new_dat,1
intj=start_storage,k=3;j<=end_storage;j++,k++){new_data[k]=memory[j];}if(operation==,3
racters67ofhex_instruction}for(inti=0;i<4;i++){,0
lock_size));//Thesemanyareforin,0
r();register_values.clear();all_instructi,2
tthetagwhichweneedtoreplaceq.pop();//Popthevaluew,1
egister_no+=to_st,0
nst=="lhu"||inst=="lwu"){//Extr,0
gisters[assembly_code[instruction_no][1]];stringimm=decimal_to_binary(stoi(assembly_c,3
instruction.substr(0,pos);if(first_word.back()==':'){executed_instruction=exe,3
ister_values[rs2];if(shifting_amount!=0,1
;vector<uint8_t>byte(2);byte[0]=store_value;byte,3
ingexecuted_instruction=all_instructions[PC/4];intpos=execut,1
uction_no*4+i]=byte[i];}}//CodeforJformatinstructionsvoidexecute_J(vector<vector<,1
;//Concatinatingtheinstruc,0
ingaliasRemover(stringr){if(r=="zero"||r=="x0"){r="x0";}elseif(r=="ra"||r==,3
ativity;i++){if(cache[index][i][2]==top_tag){removed_dat,4
ngthepartstoformtheinstructionstringinstr=imm.substr(0,1)+imm,1
ng_amount=register_values[rs2];if(shifting_amount!=0){,2
egister_values[rd]=regi,1
rd.back()==':'){executed_ins,1
(cur);}cur="";}else{cur.push_back(c);}}if(cur!=""){to_store.push_back(cur);}if(to_store[0]==",7
de[PC/4];if(format[cur_instr[0]]=='R'){step_R(cur_instr);}e,6
_block[k]=memory[j];}cache_block[3+offset]=val;,3
code,intinstruction,0
lines.find(break_point-count_how_many_to_skip)!=brea,1
intoffset_size=log2(block_size);//Thesemanybitsareforoffsetintindex_,1
}instruction=trimmed_instr;//Gothroughthecurrentinstru,0
uction[2]);//Extracttherdvaluestringrd=aliasRemover(instruction[1]);intold_PC=PC;str,3
f_access;ofstreamcache_output;//Declarethevariousmapswhichwillstorethenecessaryinformationunordered_,0
";hex_to_bin['a']="1010";hex_to_bin['b']="1011";hex_to_bin['c']="11,3
frs1";exit(0);}elseif(registers.find(assembly_code[instruction_no][3])==regist,4
sters.find(assembly_code[instruction_no][2])==,3
helinenumberwherewehavetoinsertabreakpointintbreak_point=stoi(comma,0
nct3["sra"]="101";funct3["addi"]="000,2
instruction_no);}elseif(format[assembly_code[instruction_no][0]]=='S'){execute_S(assembly_c,4
ze();i++){if(,1
ultimatelythisfunctionhastoreturnonly1byteintoffset_mas,0
tions.push_ba,0
+2);registers[saved_register_no]=this_register;}elseif(i>=,1
uction_no+1<<e,0
000000";funct7["sra"]="0100000";}//Definingtheformatofvariousinstruct,1
ectorupdate_queue(index,tag,false,mem_loc,"write",false,true,val);break;,1
yte[4];for(inti=0;i<4;i,1
ister_valu,0
hatourprogramisrequestingtoreadinttag=tag_mask&mem_loc;tag>>=(index_size+offset_s,0
argument_register_no]=thi,0
ns.push({top_of_stack,top_line});stringexecuted_instruction=all_instr,2
k=stack_of_functions.top().first;inttop_line=stack_of_functions.top().second;,2
loc/block_size)*block_size;intend_storage=(mem_loc/block_siz,0
stack_of_functions.t,0
tag);}else{inttop_tag=q.front();//Getthe,1
ed_data[3+i];}}}}}//Hereweneedtoensurethatallthebocksarewrit,1
ecuted_instruction=executed_instruction.substr(pos+1);}stringbin_P,1
entfor(inti=bin.size()-1;i>=0;i--){if(bin[i]=='0'){bin[i]='1';break;}bin[i]='0';}re,8
m_loc/block_size)*block_size+(block_s,0
=0;i<4;i++){memory[mem_loc+i]=byte[i];}mem_loc+=4;}//Returnthenewmem_locwhereyoucanwritetonextreturn,3
out<<"ReplacementPoli,0
nstr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i,2
functions.top().first;inttop_line=stack_of_functions.top().second;top_line=PC/4+1;stack_of_func,2
urnonly1bytei,0
et_to_label[PC],-1});stringexecute,1
ne:"<<instruction_no+1<<endl<<"Valueofimmediateisou,0
ndex][random_number];cache[index][random_number]=new_data;//Nowcheckiftheremoveddatahasadirtybitset,,3
r_values["x0"]=0;}//CodefortheSformatstepinstruc,1
ack,top_line});stack_of_functions.push({offset_to_label[PC],-1});stringexecuted_instruction,3
etprecision(3)<<(double)(hits)/(hits+misses);}stack_of_f,4
s,criticalwordfirstploicyintstart_sto,0
ctionstringopcode="0100011";stringf3=funct3[assembly_code[instruction_no][0]];st,3
seif(command=="cache_simstats"){if(cache_enabled,1
//Thesemanybitsareforoffsetintindex_size=log2(cache_size/(associa,0
unctions.push({top_of_stack,top_line});stringexecuted_instruction=all_in,2
x>>=(offset_size);//Let'sgetthevalueofoffsetbitsintof,1
;temporary_register_no+=to_string(i-28+3);registers[temporary_register,1
n_set=decimal_to_binary(index,20,0);stringhex_set="0x",1
ion_no+1<<endl<<"Wrongsyntax,forStypeformat,youmustenter4operands",0
out_name);//GothroughallthevaluesintheD-cacheandwriteonlytheonceswhicharevalidfor(inti=0;i,0
bstr(2);//Weremovetheleading0xinthestring//Wenowwanttoconvertittodecimalrepresenttion,,1
led){stringhit_or_miss="Miss";stringclean_or_dirty="Clean";stringread_or_write="W";if(i,0
sembly_code[instruction_no][0]];stringrd=registers[assembly_co,2
o_hex(bin_set,true,5);stringbin_tag=decimal_to_binary(tag,20,0);stringhex_tag="0x"+binary_to_hex(b,2
formtheinstructionstri,0
);}else{inttop_tag=q.front();//Getthetagwhichweneedtoreplaceq.,1
orStypeformat,youmustenter4operands"<<endl;exit(0);}elseif(registers.find(,1
or<string>instruction,intmem_loc){//Gothroughallthevaluesthattheuserhasspecifiedands,1
;}elseif(inst=="lbu"){uint8_tbyte=read_access(start_location,false);uint8,2
ead_access(start_location,false);uint8_tres=byte;register_values[rd]=res;},2
clude<iomanip>#include<cstring>//Thefollowingensurethat64bitscanbehandledbyourcode#defin,2
substr(0,1)+imm.substr(2,6)+rs2,2
_functions.top().first;inttop_line=stack_of_functi,1
g(i-28+3);registers[temporary_register_no]=this_register;}}}//Definingallfunct3valuesvoidinitialize_,2
intoffset_size=log2(block_size);//Thesemanybitsareforoffsetintindex_size=log2(cache_size/(a,1
rmat["sh"]='S';format["sw"]='S';format["sd"]='S';//Bformatformat["beq"]='B';format["bge,4
]]-instruction_no*4);}if(registers.find(ass,0
alid,Dirty,tag,dataif(cache_block[0]==0){//Thisisaninvalidframe,ignoreconti,2
hisreplacedq.push(tag);//Pushthenewtagvaluevector<int>removed_data(cache[0][0],4
endl;}elseif,0
+1;stack_of_functions.pop();s,1
ur_instruction.push_back(cur);cur="";}}if(cur!=,1
]=='x'){stringbin_instr=hex_to_binary(as,0
no);}elseif(format[,0
et<string>load_operands;unordered_map<string,int>labels;unordered_,2
tion,intmem_loc){//Gothroughallthevaluesthattheuserhasspec,0
_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,top_line,1
.size();j++){for(intk=0;k<cache[i][j].size();k++){cache[i][j],6
riteaccess"<<endl;}}//Inthecaseofmisses,ifitiswritethorugh,wejustwritetomemorywitho,0
utofrange";exit(0);}imm=decimal_to_binary(stoi(a,1
s.push({top_of_stack,top_li,0
C=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<exec,1
immvaluesrd=aliasRemover(instruction[1]);rs1=aliasRemover(instruction[2]);imm=stoi(instruction[3],5
]='S';format["sd"]='S';//Bformatformat["beq"]='B';format["b,2
().second;top_line=old_PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,to,2
ecutionstoppedatbreakpoint\n";break;}},0
gisters.find(assembly_code[instruction_no][1])==registers.end()){cout<<"Errori,4
;}uint8_tbyte[4];for(inti=0;i<4;i++){byt,1
{if(command[i]=,1
+4;PC=new_pc;}//Updatethestackoffunctionsandtheirlastexecutedlineacco,0
c;}//Updatethestackoffunctionsandtheirlastexe,0
if(inst=="lwu"){vector<uint32_t>byte(4);boolacces,3
stringf3=funct3[asse,0
;inttop_line,0
s1<val_rs2){PC=new_pc;}else{PC+=4,1
nst=instruction[,0
byte(2);byte[0]=store_value;byte[1]=store_val,3
if(decimal<0){isNegative=true;}decimal=abs(decimal);stringb,2
ster_values[rs1]<register_values[rs2]){PC=new_pc;}else{PC+=4;}}e,4
ntmem_loc){//Gothroughallthevaluesthatth,0
"){r="x12",0
r(instruction[1]);rs1=aliasRemover(instruction[,2
ubstr(17);ifstreamcache_config_file;cache_config_file.open(cache_config_file_n,1
_stack,top_line});stringexecuted_instruction=all_instructions[PC/4];intpos=executed_instru,1
_hex="0x"+binary_to_hex(mem_loc_bin,false,5);cout<<"Memory["<<m,1
yoneisfightingforthisoneindexassociativity=cach,0
out<<"Replacement,0
ory[mem_loc]=val;cache[index][i][1]=0;//Setittonon-dirty}//Sincethisahit,weneedtoupdatetheorderofa,4
queue(index,tag,false,mem_loc,"read",true,false);cache[index][i]=cache_block,3
eif(i>=18&&i<=27){stringsaved_register_no=,0
);intdecimal=binary_to_decimal(bin_instr);imm=decimal;}else{imm=stoi(instruction[2]);}imm=,4
[2]];stringrs2=registers[assembly_code[instruction_no][3]];//Concatinatingtheinstructionstring,4
xtfileintoaqueueofstrings,suchthatafterexecutionofeachrun,wecandequeuethetopstringinstruction;instr,0
ckofalllaodoperandsvoidinitialize_load_operands(){load_operands.ins,1
][j][k]=0;}}}assembly_code.clear();,3
nstruction_no][1])==registers.end()){cout<<"Errorinline,2
itetomemorywithoutbotheringtoddoanythinginthecacheif(write_back_policy=="WT"){memory[mem_loc,1
<offset_size);for(inti=0;i<block_size;i++){memory[to_store_mem_loc+i]=removed_data[3+i,1
o_bin['a']="1010";hex_to_bin['b']="1011";hex_to_bin['c',2
>cache_block(block_size+3);ca,1
memoryif(removed,0
++){memory[to_store_mem_loc+i]=removed_data[3+i];}}}}if(cache_enabled){stringhit,4
0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//CodeforBforma,3
=byte[1];mem_loc+=2;}//Returnthenewmem_locwhereyou,1
out<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//Ensurethatthe,0
s="Miss";stringclean_or_dirty="Clean";str,0
otingthevaiourspartsoftheinstrutionstringf3=funct3[assem,0
ize);//Thesemanybitsareforoffsetintindex_siz,0
nd("cache_simenable")){cache_enabled=true;stringcache_config_fi,1
}elseif(command=="exit,0
iativity;i++){vector<int>cache_block(block_size+3);cache_block=cache[,2
ffset_mask&mem_loc;//Wenowhavetheindexandtagwewant.Wecanproceedwithfindingtherealdatainthatloc,0
;//Nowletuswriteintothetextsegmentofthememory://Wehavetheinstructionnumberinthevariab,0
_values[rs2,0
/Setittonon-dirty}//Sincethisahit,weneedtoupdatetheorderofacc,0
uction.size();i++){uint64_tstore_value=stoi(instruction[i]);vector<uint8_t>byte(8);,5
inttop_line=stack_of_functions.top().second;top_line=PC/4+1;stack_of_functions.pop();sta,2
[rs2];}elseif(inst=="xor"){register_values[rd]=register_v,3
andextractthers1andrs2valuesintne,0
"sra"){register_values[rd]=register_values[rs1]>>register_values[rs2];}//Updatethestacko,4
{intcur=q.front();q.pop();dummy_q.push(cur);if(cur=,3
oc+i]=byte[i];}mem_loc+=4;}//Returnthenewmem_locwhereyoucanwrite,1
]==1){intoffset_size=log2(block_size,0
fieldsinitialize_registers();initialize_funct3();initialize_funct7();initialize_format(,3
diaterd=alia,0
askisshifting_amount0'sfollowedby64-shifting_amount1'sui,0
=="x17"){r="x17",0
tion=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4,3
aliasRemover(instruction[2,0
'){continue;}else{trim=false;trimmed_instr.push_ba,1
d.substr(17);ifstreamcache_config_file;cache_config,1
f(inst=="and"){register_values[rd]=register_values[rs1]&register_val,3
riouspartsofthei,0
values[rd]=register_values[rd]&mask;register_values[rd]&=mask;}}elseif(inst,3
"]=this_register;registers["fp"]=this_register;}elseif(i==,1
=f7+rs2+rs1+f3+rd+opcode;//Nowletuswriteintothetext,0
ted:"<<executed_instruction<<";PC="<<hex_PC<<e,0
helinenumberwherewehavetoinsertabreakpointintbreak_point=stoi(command.substr(6));//Wetakeint,2
r=="t1"||r=="x6"){r="x6";}elseif(r=="t2"|,1
++;}//Returnthenewmem_locwhereyoucanwri,0
tion[0]]=='S,1
3["lw"]="010";funct3["ld"]="011";funct3["lbu"]="100";funct3["lhu"]="101";funct3["lwu"]="110";fu,5
thesemanyaretagbits//Letusnowcalculatethemaskrequiredtofindou,0
acheandwriteonlytheonceswhicharevalidfor(inti=0;i<cache.size();i++){,1
nstruction[i]!='('){cur.push_,2
e();i++){for(,1
rmaskisshifting_a,0
rs2andimmediatevaluesstringrs1,rs2,inst;intimm;inst=instruc,0
sub"){register_values[rd]=register_values[rs1]-,2
][i];//Valid,Dirty,tag,d,1
/Makesthepo,0
[2])>=pow(2,20)-1){cout<<"Errorinline:"<<ins,2
-1-igivesthepositionfromtheright}}returndecimal;}//Definingallregistersvoidinitializ,0
seif(r=="s8"||r=="x24"){r="x24";}elseif(r=="s9"||r=="x25"){r="x25";}elseif(r=="s10"||r=="x26"){,5
1){is_dirty=true;intto_,0
ine:"<<instruction_no+1<<endl<<"Labelnotdefined";exit(0);}else{assembly_code[instruction_no][3]=to_s,3
ex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruc,1
0000"]='0';bin_to_hex["0001"]='1';bin_to_hex["0010"]='2';bin_to_hex["0011"]='3';bin_to_hex["01,3
nary(assembly_code[instruction_no][2].substr(2));intdecimal=binary_to_de,4
kpointintno_of_instruction=assembly_code.size();boolto,1
string,string>registers;unordered_map<string,string>,1
nce);accessed_once=true;}uint32_tres=byte[3],1
int8_tbyte[4];for(inti=0;i<,1
to_string(i);stringthis_register=deci,1
cy:"<<replacement_policy<<endl;cout<<"WriteBackPolicy:"<<write_back_pol,0
givesthepositionfromtheright}}returndecimal;}//Defininga,0
tivity*bloc,0
=read_access(start_location,false);int16_tbyte1=read_access(,1
tinstruction_no=0;instruction_no<,0
ckoffunctionsandthe,0
tomemorywith,0
e_block(block_size+3);cache_block=cache[index][i];//Va,3
_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//UpdatethePCacco,0
stringdata_type;intdata_base_a,0
variablesthatthepreviou,0
ss="0x"+binary_to_hex(bin_address,false,5);stringbin_set=decimal_to_binary(,1
em_loc++;}//Returnthenewmem_loc,0
r_no="t";temporary_register_no+=to_string(i-28+3);regi,1
3){registers["gp"]=this_reg,1
ector<int>>>cache;//Valid,dirty,tag,datainthits=0,misses=0;string,1
/Gothroughallthevaluesthattheuserhasspecifiedandstorethemstartingforloc,0
;new_data[0]=1;//,1
m_loc|=(i<<,0
e.clear();//Notethatthesizeifblocksize+3bec,1
re_value;write_access(mem_loc,byte,false);//memory[mem_loc]=byte;}if(inst=="sh"){ve,3
kinthecache,wereadonlythisparticularmemorylocation.//Ifwedonotfindthisblockinth,0
e[0]==".half"){data_base_address=store_half(to_store,data_base_address,1
eak_lines.find(bre,0
(0,pos);if(first_word.b,1
find(cur_instruction[0])!=load_operands.end()||format[cur_instruction[0]]=='S,5
dex,everyoneisfightingforthisoneindexa,0
once){hits++;}found=true;cache[inde,1
c|=(tag<<offset_size+index_size);to_store_mem_loc|=(in,0
egisters.find(assembly_code[instruction_no][1])==registers.end()){c,4
dexinttag_size=20-offse,0
cur_instr);}els,0
nyaretagbits//Letusnowcalculatethemaskrequiredtofindoutthetagbitslaterintta,0
//Thefollowingensurethat64bitscanbehandledbyourcode#definestoistoll#defineintlonglongu,0
)-1]==')'){cur.pop_b,0
ssembly_code[instruction_no][2])==registers.end()){cout<<"Errorinline:"<<inst,3
tstepinstructionsvoidstep_B(vector<string>instruction){//Keeptrackofthenewpcvalueandextractthers1,2
nt1'suint64_tmask=(1U<<(64-shifting_amount))-1;if(shifting_amount==0,1
detomachinecodehexadecimalandstoreintextmemoryfor(intinstruction_no=0;instruction_no<assembly_co,0
store_mem_loc|=(removed_data[2]<<(offset_size+index_size));to_stor,2
ector<uint8_t>byte(2);byte[0]=stor,3
<<"Wrongsynta,0
<instruction_no+1<<endl<<"Incorrectvalueofrd";exit(0);}elseif(registers.find(assembly_c,1
mask-1;//Thismakesthe,0
{register_values[rd]=register_values,1
r<string,int>>dummy_stack;stack<pair<string,1
or(inti=0x0;i<0x50001;i++){memory[i]=0x00;}lab,2
ed_once);accessed_once=true;}}if(inst=="sd"){boolaccessed_once=false;vect,1
){registers["tp"]=this_register;}elseif(i>=5&&i<=7){stringtemporary_re,2
ringopcode="0100011";stringf3=funct3[assembly_code[instruction_no][0]];stringrs,3
t3["sub"]="000";funct3["and"]="111";funct3["or"]="110";f,3
tructions[old_PC/4];intpos=executed_instruction.find('');stringfirst_word=executed_instruction,2
"0000000";funct7["sll"]="00000,1
r_values[rd]=PC+4;PC=imm+register_va,1
;break;}}//Nowcheckiftheremoveddatahasadirtybits,0
cimal(binary_bytes[i]);//characters67ofhex_instruc,2
uction){if(,0
_dirty){clean_or_dirty="Di,0
,k=3;j<=end_storage;j++,k++){new_data[k]=memory[j];}removed_data=cache[index],4
struction[i]);,1
szero//Letusdothesam,0
;stringhex_tag="0x"+binary_to,0
inary(old_PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Exec,2
en(command.substr(5));current_opened,2
ity;i++){if(cache[index][i][2]==top_tag){removed_data=cac,4
alse);int1,0
re_value;byte[1]=store_value>>8;write_access(mem_loc,byte[0],false);write_access(mem_loc+1,byte,3
ringvalue_o,0
d_instruction.subs,0
";funct3["bltu"]="110";funct3["bgeu"]="111";}//Definingallfunct7valuesvoidinitialize,2
/Uformatformat["lui"]='U';}//Keepingtrackofalllao,1
).first;inttop_line=,0
svector<string>cur_instruction;all_instructions,1
2,6)){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Va,0
er_values[rs1]>=register_values[rs2]){PC=n,2
sfirstfigureouthowour20bitsofmemoryaddressaredivided.intoffset_size=log2(b,0
thisfunctionhastoreturnonly1byteintoffset_mask=1;off,0
uction_no][2])<-1*pow(2,20)||stoi(assembly_code[instruction_no][2])>=po,6
ction==".text"){dat,0
or<string>(0));/,2
tring,int>>dummy_stack;stack<pair<string,int>>dummy_stack_function=stack_of_functions,2
offsetaswell,because,ultimatelythisfunctionhastoreturnonly1byteintof,0
]="100";funct3["ori"]="110";funct3["andi"]="111";funct3["slli"]="00,3
<<instruction_no+1<<endl<<"Incorrectsyntax";exit(0);}},1
e,k=3;j<=end_storage;j++,k++){cache_block[k]=memory[j];}found_i,3
(instruction[1]);stringrs1=al,2
uction_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrect,2
egister_values[rd]=register_values[rd]&mask;register_values[rd]&=mask;},3
tion);stringcur="";for(inti=0;i<instruction.size();i++){if(,1
ind('');stringfirst_word=exe,1
tart_storage,0
ex];queue<int>dummy_q;intoffset_size=log2(block_s,1
l"]="0000000,0
edeclareallvariab,0
();//Iterateoverthebinarystringfor(inti=0;i<len,1
<",Set:"<<hex_set<<","<<"Miss"<<",Tag:"<<hex,0
ask=1;tag_mask=tag_mask<<20;tag,0
or<int64_t>byte(8);boolaccessed_once=false;for(inti=0;i<8;i++){byte[i]=read_access(st,3
endl;//UpdatePCvaluePC+=4;}elseif(inst=="jalr"){//Extracttherd,rs1andim,1
nd('');stringfirst_word=executed_instructio,1
if(load_operands.find(cur_instruction[0])!=,2
);}imm=decimal_to_binary(stoi(assembly_code[instruction_no][3]),6,true);imm="010000"+imm;}else{if(st,4
funct3;unordered_map<string,string>funct7;unordered_map<string,char>format;unordered_set,2
{intdummyi=i;charnum1=dummyi%10+'0';dummyi/=1,0
rmationunordered_map<string,string>registers;unordered_map<string,string>funct3;unordered_ma,2
truction[3]);//Weassumethatrs1alwaysstoresaddressesinformofintegerintstart_location=imm,1
tion_no].size()!=4){cout<<"Errorinlin,1
or_miss="Hit";}if(is_dirty){clean_o,1
essed_once=false;for(inti=0;i<8;i++){byte[i]=read_access(start_location+i,accessed_once);accessed,2
ubstr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);he,3
&i<=31){string,0
ed_map<string,int>labels;unordered_map<string,int64_t>register_val,2
nwecandirectlyadd,0
}mem_loc+=4;}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_loc;}//Functiontostorehalfw,0
d(assembly_code[instruction_no][1])==registers.end()){cout<<"Error,4
().first;inttop,1
t];//Sincethisahit,weneedtoupdatetheorderofaccessve,0
ister;registers["fp"]=this_register;}elseif(i==9){registers["s1"]=this_register;},4
"]=0;}//CodeforRformatinstructionsvoidexecute_R(vector<vector<string>>&assembly_co,2
edby64-shifting_amount1'suint64_tmask=(1U<<(64-shifting_amou,0
remove.scurrent_opened_file.pop_back();current,1
art_location,fal,0
6"){r="x6";}elseif(r=="t2"||r=,1
block_size-1);for(intj=start_storage,k=3;j<=end_storage;j++,k++){cache_block[k]=memory[j];}ca,3
ge=(mem_loc/block_size)*block_size,1
){r="x9";}elseif(r,1
uction_no+1<<endl<<"Incorrectvalueofrs2";exit(0);}//Not,1
lear();//cache.clear();for(inti=0;i<memory.size();i++){memory[,3
3["jalr"]="000";funct3["sb,1
tructionif,0
cheintcache_size,block_size,associativity;stringreplacement_policy,write_back_policy;boolcache_e,0
_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl,0
idinitialize_load_operands(){load_operands.insert("lb");load_operands.i,2
bytes(4);for(inti=0;i<4;i++){binary_bytes[,1
(index,tag,false,mem_loc,"w,0
ush_back(bin_to_hex[b]);}if(length*4>binary.size()){stringzeros="",fs="";for(inti=length*4;i<,4
h*4<binary.size()){hex=hex.substr(binary.size()-length*4);}if(trim){,5
gcommand;getline(cin,command);if(!command.find("load")){//Fi,3
rst;inttop_line=stack_of_functions.top().second;top_line=PC/4+1;stack_of_func,1
liasRemover(instructi,0
ubstr(10,10)+imm.substr(9,1)+imm.substr(1,8)+rd+opcode;stringhex_instruction=b,3
notfindthevalue,weneedtolookinthememoryif(!found){if(!accessed_o,1
_replace,intmem_loc,stringopera,0
lseif(registers.find(assembly_code[instruction_no][2])==registers.end()){cout<<"Er,5
bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<en,0
"1001";hex_to_bin['a']="1010";hex_to_bin['b']="1011";hex_to_bin['c']="1100";hex_to_bi,3
ctionif(inst=="beq"){if(register_values[rs1]==regist,2
truction_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrec,2
alue>>8;memory[mem_loc]=byt,1
cess(intmem_,0
rorinline:"<<instruction_no,0
}elseif(format[cur_instr[0]]=='U'){step_U(cur_i,3
ptrackofthenewpcvalueandextractthers1andrs2valuesintnew_pc=PC+stoi(instruction[3,0
oc|=(removed_data[2]<<(offset_size+index_size),2
esinttemp_mask=1;temp_mask=temp_mask<<(index_size+,0
immediateisoutofrange";exit(0);}//Notingthevaiouspartsoftheinstrctionstri,1
ty}for(inti=0;i<associativity;i++){if(cache[index][i][2]==top_tag){removed_data=c,4
lib>#include<math.h>#include<sstream>#include<stack>#include<queue>#include<random>#include<io,5
torage=(mem_loc/block_size)*block_size+(block_size-1);cache_block[0]=1;//Thebitisnowvalidcache_blo,3
{read_or_write="R";}stri,1
CacheDisabled";}}elseif(command=="c,0
1";stringf3=funct3[assembly_code[instruction_no][0]];stringrs1,3
f(bin[i]=='1'){decimal+=pow(2,length-1-i),3
ter_values[rd]=register_values[rs1]<<register_va,2
storage,k=3;j<=end_storage;j++,k++,0
ond;top_line=old_PC/4+1;stack_of_functions.pop();st,1
p<<endl;}if(stack_of_functions.empty()){cout<<"EmptyCallStack:Executioncomplete\n";}}elseif(!co,2
ing>to_store;stringcur="";for(char,0
clude<queue>#include<random>,2
o][1])==registers.end()){cout<<"Errorinline:"<<instructi,2
0);}//Notingthevariouspartsoftheinstructionstringopcode="11,0
ta[2]=tag;for(intj=start_storage,k=3;j<=end_storag,1
nclude<cstdlib>#include<math.h>#include<sstream>#include<stack>#inclu,4
a3"||r=="x13"){r="x13";}elseif(r=="a4"||r=="x14"){r="x14";}elseif(r=="a5"||r==,3
,pos);if(first_word.back()==':'){executed_instruction=e,2
ister_no="t";temporary_register_no+=to_string(i-28+3);registers[temporary_register_no]=this_registe,2
stringinst=instruction[0];stringrd=aliasRemover(instruction[1]);stringr,3
ctor<vector<string>>&assembly_code,intinstruction_no){//Handlinge,2
ize,block_size,associativity;stringreplacement_policy,write_back_policy;boolcache_enabled=false;ve,0
];}if(operation=="write"){new_data[3+offset]=val;new_data[1]=1;//Setthebittodirty}for(inti=0;i<a,4
n_no][2])==registers.end()){cout<<,2
srai"||inst=="slli"||inst=="srli"){//Extractthe,0
labelsfromthemainstackandprint,0
_register;if(i==0){registers["zero"]=this_register;}elseif(i==1){registers["ra"]=t,5
_code[instruction_no][3])<-pow(2,12)||stoi(assembly_code[instruction_no][3])>=pow(2,12)-,8
//Returnthenewmem_locwhereyoucanwritetonextreturnmem_loc;}//Functiontostorebytwi,0
ableinstruction_nostringhex_instruction=binary_to_hex(instr);vector<st,1
es,ifitiswritethorugh,wejustwritetomemorywithoutbotheringtoddoanyt,0
0});last_exected_line.c,0
;}else{if(cur,0
PC=decimal_to_binary(old_PC,32,0);stringhex_PC=binary,1
onsofindex,0
{boolisNegative=false;if(decimal<0){is,0
(0);}//Noting,1
10";funct3["ld"]="011";funct3["lbu"]="100";funct3["lhu"]="101";funct3["lwu"],4
ndingtherealdatainthatlocation//Ifwefindthisblockinthecache,wereadonlythis,0
uction=executed_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary,1
re,data_base_a,0
idinitialize_funct3(){funct3["add"]="000";funct3["sub"]="000";funct3["and"]="111";fu,4
cur.size()-1]==','||cur[cur.size()-1]==')'){cur.pop_back();}cur_instruction.push_back(cur),6
>dummy_q;intoffset_size=log2(block_size);//Thesemanybitsarefor,1
ction.size();i++){if(instruction[i]!=''&&instruction[i]!='('){cur.push_back(instruction[i]);}els,7
i]);vector<uint8_t>byte(8);for(inti=0;i<8;i++){byte[7-i]=store_value>>(7-i)*8;}for(inti=0;i,5
sign(no_of_indexes,vector<vector<int>>(associativity,vector<int>(block_size+3,3
){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forRtypeformat,youmustente,0
_stack,top_line});s,0
ter_values[rs2];}elseif(inst=="or"){register_values[rd]=register_values[rs1]|register,4
bly_code.size();instruction_no++){if(format[assembly_code[instruction_no,1
tevaluesstringrs1,rs2,0
etheorderofaccessvectorif(!accessed_once){hits++;update_queue(,1
']="0101";hex_to_bin['6']="0110";hex_,1
rectvalueofrd";exit(0);}elseif(stoi(assembly_code[instruction_no][2])<-1*p,4
0]];stringrs1=registers[assembly_code[instruction_no][1]];s,3
cuted_instruction<<";PC="<<hex_PC<<endl;//UpdatePCvaluePC+=4;}elseif(inst=="jalr"){//Extract,1
se;vector<uint8_t>byte(4);for(inti=0;i<4;i++){byt,2
isoutofrange";e,0
0,0);stringhex_set="0x"+binary_to_hex(bin_set,true,5);stringbin_tag=decimal_to_bina,1
ngzeros="",fs="";for(inti=length*4;i<binary.size(),1
uted_instruction=all_instructions[,0
end_storage;j++,k+,0
ssembly_code.push_back(cur_instruction);PC+=4;}instruction_f,1
ecountnumberofmemoryb,0
=executed_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(old_PC,32,0);stri,2
tdecimal=binary_to_deci,0
ad_operands.ins,0
first_word=executed_instruction.substr(0,pos);if(first_word.back()==':'){exe,3
t=stoi(comm,0
byte[4];for(,1
tion[3]);rs1=aliasRemover(instruction[2]);intmem_loc=imm+r,3
es[rd]=register_values[rd]&mask;register_values[rd]&=mask;}}else,3
et:"<<hex_set<<","<<"Miss"<<",Tag:"<<hex_tag<<","<<"Clean"<<"Fromwriteaccess"<<endl;}}/,0
pow(2,length-1-,0
i<length;i++){//Ifthecurrentcharacteris'1',a,0
elseif(r==",0
uction[2]);imm=stoi(instruction[3]);//Wea,3
e_out_name);//GothroughallthevaluesintheD-cacheandwriteonlytheonceswhichareval,0
tructionif(loa,0
_to_bin['c']="1100";hex_to_bin['d']="1101";hex_to_bin['e']="1110";hex_to_bin['f']="1111";stringbin=,4
8";}elseif(r=="s1"||r=="x9"){r="x9";}elseif(r=="a0"||r==",2
at,youmustenter4operands"<<endl;exit(0);}if(labels.find(assembly_code[instruction_no,1
ed_instruction<<";PC="<<hex_PC<<endl;,0
pdate_queue(index,tag,false,mem_loc,"write",false,true,val);break;}}//Ifwedidnotfindthe,1
at[cur_instr[0]]=='I',2
lthevaluesintheD-cache,0
PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<,0
[i]=hex_to_bi,1
(PC/4+1)!=break_lines.end()){cout<<"Ex,2
ess=0x10000;//Loadthenextfileintoaqueueofstrings,suchthatafterexecutionofeachrun,we,0
ringinstr=imm+rs1+f3+rd+opcode;stringhex_instruction=binary_to_hex(ins,0
//Iterateoverthebinarystringfor(inti=0,0
y[mem_loc]=val;//Incaseofwritethroughandmiss,wedonotcontactthecacheatall.So,weneedtoprin,1
dothesameforindexma,0
sspecifiedandstorethemstartingforlocationspecifiedbythemem_locfor(inti=1;i,0
ved_data[3+i];}}}}}//Hereweneedtoensurethatallthebocksarewritten,1
xori"]="100";funct3["ori"]="110";fu,1
]=0;//Initiallynotdirtynew_data[2]=tag;for(intj=start_sto,1
;i++){bin+=hex_to_bin[hex[i],1
_back(command[i]);}}s_addr=s_addr.substr(2);//Weremovetheleading0,3
cache[0][0].size());vector<int>,4
out<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Not,1
greplacement_policy,write_back_policy;boolcache_enabled=false;vector<vector<vector<int,0
);for(inti=0;i<4;i++){byte[3-i]=store_value>>(3-i)*8;}for(inti=0;i<4;i++){write_access(mem_loc+i,b,3
ro}}}elseif(!command.find("cache_simdump")){s,2
)){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}/,1
_values[rs1]>>register_values[rs2];}//Updatethestackoffunctionsandtheirlastexe,2
uction_no+1<<endl<<"Valueofimmediateisoutofrang,0
struction[i]);vector<uint8_t>byte(8);for(int,3
onsofindexb,0
anyaretagbits//Letusnowcalculatethem,0
ck(cur);}cur="";}else{cur.push_back(c);}}if(cur!=",3
ore_byte(vector<strin,0
ister_values[rs1]>=regist,1
g_mask^temp_mask;//Makesthepositionsofindexbitsandoffsetbitszero//Letusdothesameforindexmakintindex_,0
_map<string,string>funct3;unordered_map<string,string>funct7;unordered_map<string,char>format;unorde,3
s2=registers[assembly_code[instruction_no][2]];stringimm=decimal_to_binary(stoi(a,3
(hits)/(hits+misses);}stack_of_functions.pop();}}}elsei,3
f_register_int,64,1);stringvalue_of_register,0
ock_size)*block_size;intend_storage=(mem_loc/block_size)*bloc,1
ion_no+1<<,0
,booltrim=false,intlength=8){unor,0
ge=(mem_loc/block_,0
uted_instruction.substr(pos+1);}strin,1
lueofPCaccordinglyregister_values[rd]=PC+4;PC=imm+regi,1
shthenewtagv,0
oint-count_h,0
erexecutionofeachrun,wecandequeuethetopstringinstruction;instruction_file.open(command.substr(5,0
taif(cache_block[0]==0){//Thisisaninvalidfr,2
onesinttemp_mask=1;temp_mask=temp_mask<<(index_size+offset_size);,1
mem_loc|=(removed_data[2]<<(offset_size+index_size));to_store_mem_loc|=(,2
s67ofhex_instruction}for(int,0
"ld"){vector<int64_t>byte(8);boolaccessed_once=false;for(inti=0;i<8;i++){byte[i]=re,3
ck=cache[inde,0
_half(to_store,data_base_address);}elseif(to_store[,1
pswhichwillstorethenecessaryinformationunordered_map<string,st,0
pen(cache_output_name);}//Conv,1
"slli"]="001";fu,0
lregistersvoidinitialize_registers(){for(int,1
code[instruction_no][0]=="srai"){if(stoi(assembly_code[instruction_no][,3
+){memory[instruction_no*4+i]=byte[i];}}//CodeforUformatinstructionsvoidexecute_U(vector<,3
ues["x0"]=0;},1
d){update_queue(index,tag,true,mem_loc,"write",false,false,val,offset);}}}}else{mem,2
elseif(i==1){registers["ra"]=this_registe,2
atlocation//Ifwefindthisblockinthecache,,0
r=="x0"){r="x0";}elseif(r=="ra"||r=="x1"){r="x1";}elseif(r=="sp"||r=="x2"){r="x2";}elseif(r=="gp"||r,5
tions.push({top_of_stack,top_line},1
stringtop_of_stack=stack_of_functions.top().first;inttop_line=stack_of_functions.top().second;top_li,2
hetagbitslaterinttag_mask=1;tag_mask=tag_mask<<20;tag_mask=tag_mask-1;//,0
einstrutionstringopcode="0110011";stringf3=funct3[assembly_code[in,0
e_block[0]==0){//memory[mem_loc]=val;//Getthevalueandthenstoretheremainingwords,c,2
einstructionisdata,thenensurethatuntilwesee.text,wekeepstoringdataif(i,0
ask=index_mask-1;temp_mask=1;temp_mas,0
ginstr=imm+rd+opcode;stringhex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4),3
_instruction<<,0
(cin,command);if(!command.find("load")){//Firstresetallthereg,3
sd"){boolaccessed_once=false;vector<uint8_t>byte(8);for(inti=0;i<8;i++){byte[7-i]=,3
inttag_size=20-offset_size-index_size;//Andthesemanyaretagbitsboolis_dirty=false;if(replacement_pol,0
ock[1]=0;//Initiallynotdirtycache_block[2]=tag;for(intj=start,2
;}//Take1'scomplementfor(inti=0;i<bin.size,0
ememoryif(!found){if(!accessed_once){misses++;if(write_back_policy=="WT"){stringbi,3
toretheremainingwords,criticalwordfirstploicyintstart_storage=(mem_loc/block_size)*bl,1
x["0101"]='5';bin_to_hex["0110"]='6';bin_to_hex[",2
eif(command=="cache_simstats"){if(cache_enabled){cout,2
mand.find("cache_simdump")){stringmyfile_out_name=command.s,1
otdefined";exit(0);},1
address,fals,0
itiswithinrangeif(assembly_code[instruction_no],1
opopthelabelsfromthemainstackandprin,0
g_size=20-of,0
oi(assembly_code[inst,0
gvaluevector<int>removed_data(cache[0][0].size());vector<int>ne,6
4;i++){memory[i,0
valuesthattheu,0
isnowvalidcache_block[1]=1;/,1
e);for(inti=0;i<block_size;i++){memory[to_store_mem_loc+i]=removed_data[3+i];}}}}if,3
+1<<endl<<"Incorrectvalueofrs2";exit(0,0
ttop_line=stack_of_functions.top().second,1
ion_no][2])==registers.end()){cout<<"Errori,2
locfor(inti=1;i<instruction.size();i++){uint64_tstore_,1
uchthatafterexecutionofeachrun,wecandequeuethetopstringinstruction;,0
aretagbits//Letusnowcalculatethemask,0
]="101";funct3["lb"]="000";funct3["lh"]="001";funct3["lw"]="0,3
ruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//Codefor,3
ocation,false);uint8_tres=byte;register_values[rd]=res;}e,1
ary_regist,0
datano?to_store_mem_loc|=(removed_data[2]<<(offset_size+index_size));to_store_mem_loc|=(index,2
n[1]);stringrs1=aliasRem,1
ister_values;unordered_,0
word(vector<string>instruction,intmem_loc){//Gothrougha,2
e{inttop_tag=q.front();//Getth,1
size+offset_size);index_mask=index_mask-1;temp_mask=1;temp_mask=temp_mask<<offset_size;temp_ma,0
mm=stoi(instruction[2]);}imm=imm<<12;register_values[rd]=imm;//Updatethestackoffun,3
t>register_values;unordered_map<string,string>registers_alis;vector<string>all_ins,2
ion_no][2]);}if(dec_imm,1
seif(i==2){registers["sp"]=this_register;}elseif,3
ormatstepinstructionsvoidstep_B(vector<s,0
er_bin=decimal_to_binary(value_of_register_int,64,1);stringvalue_,1
or<uint8_t>byte(4);for(inti=0;i<4;i++){byte[3-i]=store_value>>(3-i)*8;}for(inti=0;i<4;i+,5
t(0);}elseif(stoi(assembly_code[instruction_,1
]=byte;}if(inst=="sh"){vector<ui,1
ringrs2=aliasRemover(instruction[3]);//Dothearithmeticacc,2
ns.clear();offset_to_label.clear();while(!stac,2
er_values[rd]=register_values[rs1]-register_values[rs2];}elseif(inst=="and"){register_values[rd]=,5
natingthevariouspartsstringinstr=imm.substr(0,7)+rs2+rs1+f3,1
thesemanyaretagbitsboolis_dirty=false;if(repla,0
embly_code[instruction_no][0]==,2
instruction_no+1<<endl<<"Valueofimmediateisoutofr,0
o_store,data_base_address);}elseif(to_store[0]==".half"){data_base_address=store_hal,2
="";}else{cur.push_back(c);}}if(cur!=""){to_store.push_back(cur);}if(to_store[0]==".dword"){data_,7
Incorrectvalueofrs1";exit(0);}elseif(stoi(assembly_code[ins,1
f(r=="tp"||r=="x4"){r="x4";}elseif(r=="t0"||r=="x5"){r="x5";}elseif(r=="t1"||r=="x6"){r="x6",5
ue_of_register_bin=decimal_to_binary(value_of_register_int,64,1,0
C=new_pc;}else{PC+=4;}}elseif(inst=="blt"){if(register_,2
1;//Thismakesthemask20onesintte,0
ryaddressaredivided.intoffset_size=log2(block_size);//Thesemanybit,1
e(2);byte[0]=store_value;byte[1]=store_value>>8;memory[mem_loc]=byte[0];memory[mem_loc,5
="x";register_no+=to_string(i);stringthis_register=decimal_to_binar,1
code[instruction_no][0]]=='S'){execute_S(a,2
();j++){for,1
][3])==labels.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<,2
memory[j];}if(operation=="write"){new_data[3+offset]=val;new_data[1]=1;//Setthebittodirty}for(int,5
i(assembly_code[instruction_no][3]),12,true);}//Concatinatingthevaluesstringinstr=imm+rs1+f,3
3]),12,true);}//Concatinatingthevaluesstringinstr=im,0
stringrs2=registers[assembly_code[instruction_no][2]];stringimm=decimal_to,3
amisreques,0
inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_inst,1
intstart_location=imm+register_values[rs1];if,1
]==1){is_dirty=true;intto_store_mem_loc=0;//Hereth\etagandindexshouldbeoftheremoveddatano?to_sto,0
{stack_of_functions.pop();}stack_of_functions.push({"main",0});las,4
}//Updatethestackoffunctionsandtheirlastexecutedlineaccordingly,0
+imm;}elseif(assembl,0
greplacement_policy,write_back_policy;bool,0
3["jalr"]="000";funct3["sb"]="000";funct3["sh"]="00,3
_instruction.f,0
nthecaseofmisses,ifitiswri,0
gister_values[rd]=register_values[rs1]+r,2
es(4);for(inti=0;i<4;i++){,1
truction_no*4+i]=byte[i];}}//CodeforBformatinstructionsvoidexecute_,1
tractthembreak_lines.insert(break_point-count_how_many_to_skip);cout<<"Insertedbreakpointatline:",1
block[0]==0){val=memory[mem_loc];//Getthevalueandthenstore,2
ormat["or"]='R';format["and"]='R';format["sll"]='R';form,3
queue<int>q=order_of_access[index];queue<int>dummy_q;intoffset_size=log2(block_size);//Thesema,4
//Weremovetheleading0xinthestring//Wenow,0
oringdataif(instruction==".data"){data=true;count_how_many_to_skip++;continue;}if(data||(instru,2
[3]<<24)|(byte,1
Remover(instruction[2]);imm=stoi(instruction[3]);,4
eandwriteonlytheonceswhicharevalidfor(inti=0;i<cache.size(,0
tructionsvoidstep_R(vector<string>instruction){//Extractrd,rs1,rs,2
-1;//Thismakesthemask20onesint,0
block;returnval;}}//Ifwewerenotabletofindanyinvalidblock,w,0
^temp_mask;//Makesthepositionsofindexbitsandoffsetbitszero//Letusdothesameforindexmakin,0
ue;update_queue(index,tag,false,mem_loc,"read",true,false);cache[index][,2
){PC=new_pc;}else{PC+=4;}}elseif(inst=="bltu"){uint64_tval_rs1=register_values[rs1],val_rs2,4
ntax,forRtypeformat,yo,0
intinstruction_no){//Handlingerrorif(ass,0
ter=decimal_to_binary(i,5,false);registers[register_no]=this_registe,2
es++;if(write_back_policy=="WT"){stringbin_address=decimal_to_binary(mem_loc,20,0);s,2
uction_no][3]];//Conca,1
tax,forUtypeformat,youmustenter3operands"<,0
ache[0][0].size());vector<int>new_data(cache[0][0],6
yntax,forStypeformat,youmustenter4operands"<<endl;exit(0);}elseif(reg,1
}}if(cur!=""){if(cu,1
o_decimal(bin_instr);dec_imm=decimal;}else{dec_,1
_no][1])==registers.end()),2
p().first;inttop_line=stack_of_functions.top().second;top_line=P,2
ction){//Keeptrackofthenewpcvalueandextractthers1an,0
ramisrequestingtoreadinttag=tag_mask&mem_loc;tag>>=(index_size+,0
f(inst=="lh"){int,1
ng>registers;unordered_map<string,string>funct3;unordered_map<string,string>funct7;unordered_,2
roughallthevaluesthattheuserhasspec,0
trd,rs1,rs2stringinst=instruction[0];stringrd=aliasRemover(instruction[1]);str,3
nd;top_line=PC/4+1;stack_of_functions.pop();stack_of_function,1
<instruction_no+1<<endl<<"Incorrectvalu,0
embly_code.size();boolto_break=false;intbreak_point_line_to_remove;i,1
fp"]=this_register;}elseif(i==9){register,1
ecimal);stringbin="";while(decimal!=0){bin.push_back(de,1
tsofmemorylocationbeingrequestedbyprogramintindex=index_mask&mem_loc;index>>=(offset_siz,0
ncatinatingtheinstructionstringinstr=imm.substr(0,1)+imm.substr(1,1
_size-index_size;//Andthesemanyaretagbits//Letusnowcalculatethemaskrequiredtofindoutthetagbitslater,0
]=byte[i];}}//CodeforBformatinstructionsvoidexecu,1
_U(vector<vector<string>>&assembly_code,intinstru,2
inst=instruction[0];r,1
;offset_to_label[PC]=cur;cur="";continue;}if(cur[cur.size()-1]==','||cur[cur.size()-1]==')'){cur.pop,6
;cache[index][i]=new_data;break;}}//Nowcheckiftheremoveddatahasadirtybitset,andifso,weneedtoup,2
theinstructionisdata,thenensurethatuntilwesee.text,wekeepstoringdataif(instruction,0
='B'){step_B(cur_instr);}elseif(f,2
eindexassociativity=cache_,0
s2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="blt"){if(register_values[rs1]<register_values[rs2]){PC,5
erethetagandindexshouldbeoftheremoveddatano?to_store_m,0
bin_s_addr);intcoun,0
e_address=store_half(to_store,data_base_address);}elseif(to_store[0]=,2
outofrange";exit(0);}imm=decimal_to_binary(stoi(assembly_cod,1
ex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){b,3
ex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte,3
||inst=="lhu"||inst=="lwu"){//Extractrd,rs1,andimm,0
ordered_map<string,char>format;unordered_set<string>load_operands;unordered_map,2
f(r=="s9"||r=="x25"){r="x25";}elseif(r,2
if(command=="exit"){//Exitthesimulatorcout<<"Exitedthesimu,1
erethetagandindexshouldbeoftheremoveddatano?to_store_mem_loc|=(removed_da,0
y_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti,4
"0010011";}//Notingthevaiourspartsoftheinstrutionstringf3=funct3[assembly_code[instruction_,0
){r="x1";}elseif(r=="sp"||r=="x2"){r="x2";}elseif(r=="gp"||r=="x3"){r=",4
_no][1])==registers.end()){cout<<"Errorinline:"<,2
ache_simdump")){stringmyfile_out_name=command.substr(15);ofs,1
e:"<<instruction_no+1<<endl<<"Incorrectsyntax";exit(0);}}}elseif(command,1
start_loca,0
tofrange";exit(0);}//Notingthevarious,1
es.end()){cout<<"Executionstopped,1
ion_no);}elseif(format[assembly_code[instruction,0
er_values["x0"]=0;}//CodefortheUformatstepinstructionsvoid,1
newtagvaluevector<int>r,1
";}elseif(r=="s11"||r=="x27"){r="x27";,1
to_bin['2']="0010";hex_to_bi,1
tion=all_instructions[PC,0
=="lwu"){//Extractrd,rs1,andimmediaterd=alias,0
>&assembly_code,intinstruction_no){//Handlingerrorsif(assembly_code[inst,0
x_to_bin['3']="0011";hex_to_bin['4']="0100";hex_to_bin['5,2
ryif(!found){if(!accessed_once){misses++;if(write_back_policy=="W,2
ecanproceedwithfindingtherealdataintha,0
<"Wrongsyntax,forItypeformat,youmustenter4operands"<<endl;e,0
//memory[mem_loc]=byte;}if(inst=="sh"){vector<uint,2
[i]);//characters67ofhex_instruction}for(inti=0;i<4;i++){memory[i,1
_to_hex["1,0
thing}else{intrandom_number=rand()%associativity;vector<int>removed_data(cache[0][0].siz,4
cur.size()-1]==')'){cur.pop_back();}cur_,3
'||cur[cur.,0
cur=dummy_q.front();dummy_q.pop();q.p,2
0;i<hex.size();i++){bin+=hex_to_bi,1
_mask=temp_mask-1;index_mask=index_mask^temp_mask;//Makesth,0
ructions[old_PC/4];intpos=executed_instruction.find('');stringfirst_word=execut,2
["0110"]='6';bin_to_hex["0,1
sters["sp"]=this_registe,1
nd.substr(15);ofstreammyfile_out;myfile_out,1
alueofrs2";exit(0);}elseif(,1
,true,5);stringbin_tag=deci,0
f(format[cur_instr[0]]=='B'){step_B(cur_instr);}elseif(format[cur_instr[0]]=='J'){step_J(cur_ins,8
}}//Ifwedidnotfindthev,0
ormat,youmustenter4operands"<<endl;e,0
ck_of_functions.pop();}}}elseif(command=="regs"){//Printtheregistervalueswhicharestoredinthe,2
01111";stringrd=registers[a,0
a[2]=tag;for(intj=,1
[i];//Valid,Dirty,tag,,1
);}//Concatinatingthevaluesstrin,0
){dummy_stack.push_ba,0
er_values[rs1],,1
(4);boolaccessed_once=false;for(i,1
){boolisNegative=false;if(decimal<0){isNegative=true;}decimal=abs(decimal);string,2
stack_of_functions.top,0
register=decimal_to_binary(i,5,false);registers[register_no]=this_register;if(i==0){registers["zero",3
y_code[instruction_no].size()!=3){cout<<"Errorinline:"<<instruction_no+1<<endl,2
{//Exitthesimulatorcout<<"Exited,0
nary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<,1
lse{trim=false;trimmed_instr.push_back(instruction[i]);}}instruction=trimmed_instr;//Gothroughthecu,3
rent_opened_file=command.substr(5);//Thisistoremove.scurrent_opened_file.pop_back();curren,2
ction[i]!='('){cur.push_back(instruction[i]);}else{if(cur[cur.size()-1]==':'){cur.pop_back,8
;bin_to_hex["1110"]='e';bin_to_hex["1111"]='f';stringhex="";for(inti=0;i<binary.size();i+=4){stringb,3
ction.find('');stringfirst_word=executed_instr,1
nitialize_funct7(){funct7["add"]="0000000";funct7["sub"],3
r();for(inti=0;i<memory.size(,1
b=binary.substr(i,4);hex.push_back(bin_to_hex[b]);}if(,3
y_code[instruction_no][2]);}if(dec_imm<0||d,2
_replace,intmem_loc,stringoperation,boolis_read,boolis_hit,intval=-1,int,0
instruction_no][2]);}if(dec_imm<0||dec_imm>429,2
"add"]='R';format["sub"]='R';format["xor"]='R';format["or"]='R';format["and"]='R';form,4
(format[assembly_code[instruction_no][0]]=='S'){execute_S(assembly,4
orif(assembly,0
k]=memory[,0
//Functiontosto,0
2]];stringimm=decimal_to_binary(stoi(assembly_code[instruction_no][3]),13,true);//Conca,4
"cache_simdisable"){cache_enabled=false;cache_out,0
mstartingforlocationspecifiedbythemem_locfor(inti=1;i<instruction.size();i++),1
k.size()-1;i>=0;i--){//Usingal,1
/=10;charnum2=dummyi%10+'0';this_register+=num2;this_register+=num1;}intvalue_of_register_int=re,0
d_instruction<<";PC="<<hex_PC<<endl;//UpdatePCvaluePC+=4;}elseif(inst=="jalr"){//Extracttherd,rs1,1
s2=register_values[rs2];if(val_rs1<val_rs2){PC=new_pc;}else{P,2
++){if(trim&&instruction[i]==''){continue;}else{trim=false;trimmed_instr.push_back(inst,3
ly_code,intinstruction_no){//Handlingerrorif(assembly_code[instruction_no],1
truction_no][3])>=pow(2,11)){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediat,2
ight}}returndecimal;}/,0
t32_tres=byte[3]<<24|byte[2]<,2
myi=i;charn,0
ingerrorif(assembly_code[instruction_no].size()!=3){cout<<"Errorinline:"<<instruc,3
).first;inttop_line=stack_of_functions.top().second;top_line=old_PC/4+1;stack_of_functions.pop();sta,2
ring(i-18+2);registers[saved_reg,1
ory/PCbeforeloadingthenextfileinitialize();hits,1
o){//Handlingerrorif(assembly_co,0
or"]="110";funct3["xor"]="100";funct3["sll"]="00,2
dl;}elseif(!command,0
ion.substr(,0
nst=="lw"||inst=="ld"||inst=="lbu"||inst=="lhu"||inst=="lwu"){//Extr,0
();j++){cache[,1
ister_values[rs1]&imm;}elseif(inst=="slli"){register_values[rd]=r,3
ion_no][1]];stringimm=decimal_to_binary(stoi(as,1
nsat0register_values["x0"]=0;}//CodefortheSformatstepinstruct,1
_tag,true,5);cache_output<<read_or_write<<":Addr,0
egister_values[rd]=register_values[rs1]&imm;}elseif(inst=="slli"){register_values,3
{bin.push_back(decimal%2+'0',0
<queue<int>>order_of_access;ofstreamcache_output;//Declarethevariousmapswhichwillstorethene,2
('');stringfirst_word=executed_instruction.substr(0,pos);if(first_word.back()==,3
(inst=="lhu"){uint16_,1
y(old_PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_i,2
{data_base_address=sto,0
_to_bin['4']="0100";hex_to_bin['5']="0101";hex_to_bin['6']="0110";hex_to,3
inst=="beq"){if(register_values[rs1]==register_values[rs2],2
);intdecimal=binary_to_decimal(bin_instr);dec_imm=decima,1
"0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<h,0
(break_point-count_how_many_to_skip)!=break_lines.end()){break_lines.erase(break_point-count_,2
st_word.back()==':'){executed_instruction=e,1
heremoveddatano?to_store_mem_loc|=(removed_data[2]<<(offset_size+index_size));to_store_mem_,2
"+imm;}elseif(assembly_code[instruction_no][0]=="srai"){i,3
])==registers.end()){cout,1
<<(offset_size+index_size));to_store_mem_loc|=(i<<offset_size);for,1
_values[rs2];}elseif(inst=="or"){register_values[rd]=register_values[rs1]|regist,4
e[instruction_no][3]),13,true);//Concatinatingthepartstoformtheinstructionstrin,2
once){misses++;if(write_back_po,0
p_J(cur_instr);}e,1
alues[rs2];//Performstoreaspertheinstructionif(inst=="sb"){uint,2
hicharevalidfor(inti=0;i<cache.size();i++){for(intj=0;j<cache[i].,2
se(bin.begin(),bin.end());if(!isSigned||!isNegative){returnbin;}//Take1'scomplementfor,5
'1',addthecorrespondingpowerof2if(bin[i]=='1'){decimal+=pow(2,length-1-i);/,3
all_instructions[old_PC/4];intpos=executed_instruction.find('');stringfirst_word=,2
(stack_of_functions.empty()){cout<<"EmptyCallStack:Executioncomplete\n";}}els,2
storeturnonly1byteintoffset_ma,0
uction_no+1<<endl<<"Valueofimmediateis,0
lue_of_register_int,64,1);stringvalue_of_register_hex=binary_to_hex(value_of_register_bin,0
_tbyte0=read_access(start_location,false);uint16_tbyt,1
tvalueofrs2";exit(0);}elseif(stoi(assembly_code[in,1
;}}//Updatethestackoffunctionsandtheirlastexecute,0
econtinue;}if(cache_block[2]==tag){is_hit=true;found=true;val=cache_block[3+offset];//Sincethisa,3
llowedby64-shifting_amount1'suint64_tmask=(1U<<(64-shift,0
ngthevaiouspartsoftheinstrctionstringopc,0
intlonglongusingnamespacestd;//Declarethememory//intm,0
ruction_no][3])<0||stoi(ass,1
"<<executed_instruction<<";PC="<<hex_,0
cur_instruction[2],cur_instruction[3]);}assembly_code.push_b,2
nstruction_no][2][1]=='x'){stringbin_instr=hex_to_binary(assembly_code[,2
ion=all_instructions[PC/4];intpos=executed_instruction.find('');,2
[k]=memory[j];}cache_blo,2
smakesthemask20onesinttemp_mask=1;temp_mask=temp_mask<<(index_size+offset_size);tem,1
k(dummy_stack_function.top());dummy_stack_function.pop();}for(inti=dummy_st,3
oc+1]=byte[1];mem_loc+=2;}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_loc,1
lidcache_block[1]=1;//Thecacheblockisnowdirtycache_block,1
tackif(PC/4==no_of_instruction){//Alsoensuretoprintthecachestatisticsif(cache_enabled){co,2
memory.size();i++){memory[i,1
lis_present=false;while(!q.empty()){int,2
n=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_bin,4
lock=cache[index][i];//Valid,Dirty,t,2
atethePCvalueandensurethatx0willalwaysremainatvalueof0PC+=4;register_values["x0"]=0;}//CodefortheIfo,1
g_mask-1;//Thismakesthemask20onesinttemp_mask=1;temp_mask=temp_mask<<(index_size+offs,0
replacement_policy>>write_ba,0
clude<string>#include<fstream>#include<unordered_map>#include<unordered,3
ingthis_register="x,0
l_to_binary(PC,32,0);stringhex_PC=bina,1
t7valuesvoi,0
(2);byte[0]=store_value;byte[1]=sto,3
_values[rs1]>>imm;//Ourmaskisshifting_amount0'sfollowedby64-shifting_amount1'suint64_tmask=(1U,1
{top_of_stack,top_line});stack_of_functions.push({offset_,1
=(byte[7]<<56)|(byte,1
de,intinstruction_no,0
[instruction_no*4+i]=byte[i];}}//CodeforJformatinstructionsvoidexecute_,2
<<20;tag_mask=tag_mask-1;//Thismakesthem,0
ache[i].size();j++){if(cache[i][j][0]==1&&cache[i][j][1]==1){intoffset_si,9
akesthepositionsofoffseybitszero//Weneedtod,0
);initialize_funct7();initialize_format();initialize_load_operands();initiali,3
imdisable"){c,0
}elseif(r=="s3"||r,0
r_values[rd]=regi,1
"||inst=="xori"||inst=="ori"||inst=="andi"||inst=="srai"||inst=="sll,0
;}elseif(inst=="sll"){register_values[rd]=register_values[rs,2
d_instruction<<";PC="<<he,0
3]);//Performthearithmeticaspertheinstructionif(inst=="addi"){register_values[rd]=register_value,2
struction_no][3])>=pow(2,11)){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Va,2
he_simstatus"){if(cache_enabled){cout<<"CacheEnabled"<<endl;cout<<"Cac,1
registers["s1"]=this_register;}elseif(i>=10&&i<=17){stringargument_register_no="a";arg,1
ruction.size();i++){uint64_tstore_value=stoi(instruction[i,1
x0"]=0;}//Cod,0
){while(!q.empty()){intcur=q.front();q.,3
(!command.find("delbreak")){//Thisblockdeletesabeakpointintheprogramintbreak_poi,2
or<uint8_t>byte(8);for(inti=0;i<8;i++){b,2
_map<string,int64_t>register_values;unordered_ma,1
elseif(registers.find(assembly_code[instruction_no][1])==registers.end()){cout<<"Errorin,5
hex_PC;cout<<"Executed:"<<executed_instr,0
edonotfindthisblockin,0
no+1<<endl<<"Wrongsyntax,forStypeformat,youmustenter4operands"<,0
thememoryif(removed_data[1]==1){is_dirty=tr,2
}if(cur!=""){to_st,1
if(cur[cur.size()-1]==','||cur[cur.size()-1]==')'){cur.pop_back();}cur_instruction.push_back,7
ore_value;byte[1]=store_value,1
();i++){uint64_tstore_value=stoi(i,1
/Assigningtheimmediatealongwithcheckingifitiswithinrangeif(assembly_code[instruction_no][0]=,2
nline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0,0
rs1]^register_values[rs2];}elseif(inst=="sll"){register_,2
lse;cache_output.close();}elseif(command=="cache_siminvalidate"){if(cache_enabled){for(in,3
ty*block_size));//Thesemanyareforindexinttag_size,0
se,mem_loc,"write",false,false,val);cache[index][i]=cache,2
HitRate="<<fixed<<setprecision(3)<<(double)(hits)/(,3
es[rs2]){PC=,1
ons.pop();stack_of_functions.push({t,1
e_access(intmem_loc,intval,boolaccessed_once){if(cache_enabled){//Letusfirstfigureouthowour20b,2
i]);vector<uint8_t>byte(8);for(inti=0;i<8;,2
+){if(cache[index][i][2]==top_tag){removed_data=cache,4
ter_values[rd]=res;}elseif(inst=="lwu"){vector<uint32_,2
;}signedmain(){//Initializealltherequiredfieldsinitialize_registers();initialize_funct3();ini,3
cache_block;returnval;}}//Ifwewerenotabletofindanyinvalidblock,weneedtoapplyrep,0
{intcur=dummy_q.front();dummy_q.pop();q.push(cur);}//Notethatheretagwillalway,4
ze+index_size));to_store_mem_loc|=(index<<offset_size);for(inti=0;i<block_size;i,0
nsvoidstep_I(vector<string>instruction){stringrd,rs1,inst;inst=,2
>#include<cstring>//Thefollowingensurethat64bitsc,1
ciativity*block_size);cache.clear();//Notethatthesizeifblock,1
hile(!stack_of_functions.empty()){stack_of_functions.pop();}stack_of_functions.p,4
.top().first;inttop_line=stack_of_functions.top().s,2
ssembly_code,instruction_no);}elseif(format[assembly_code[instruction_no][0]],3
evalidbitaszero}}}elseif(!command.find("cache_simdump")){st,2
struction.substr(pos+1);}stringbin_PC=decimal_to_,1
;if(!isSigned||!isNegative){returnbin;}//Take1'sc,2
ction=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binar,3
>#include<algorithm>#include<cstdlib>#include<math.h>#include<sstream>#i,4
cters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//C,3
ut<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";ex,0
=="s2"||r=="x18"){r="x18";}elseif(r=="s3"||r=="x19"){r="x19";}elseif(r=="s4"||,3
tusdothesam,0
cond;top_line=,0
0";hex_to_bin['9']="1001";hex_to_bin['a']="1010";hex_to_bin['b']="101,3
)||format[cur_instruction[0]]=='S'||cur_instr,2
he.size();i++){for(intj=0;j<cache[i].size();,3
str="";for(inti=0;i<instruction.size();i++){if(trim&&instruct,1
uction_no+1<,0
o][0]]=='I'){execute_I(assembly_code,instruction_no);}elseif(format[assembly_code[instructi,3
ver(instruction[1]);intimm;//Weacceptbothdecimalandhexadecim,2
o_string(labels[assembly_cod,0
vity==0){//Thismeansthatthereisonly1index,everyoneisfighting,0
ticalwordfirst,0
{//Thisisanin,0
nitialize_load_operands(){load_operands.insert("lb");load_operands,2
instruction_no);}else{cout<<"Erroronline:"<<instru,0
gfirst_word=executed_i,0
if(r=="s4"||r=="x20"){r="x20";}elseif(r=="s5"|,2
ex_size=log2(cache_,0
bly_code[instruction_no][2]),21,tru,2
<<instruction_no+1<<endl<<"Valueofimmediateiso,0
_read){read_or_write="R";}stringbin_address=decimal_to_binary(mem_loc,20,0);stringhex_,2
01";funct3["addi"]="000";funct3["xori"]="100";funct3["ori"]="110";funct3["an,3
ory//intmemory[0x50001];vector<i,1
entcharacteris'1,0
][3]]-instruction_no*4);}if(registers.find(assembly,1
0100000";funct7["and"]="0000000";funct7["or",1
unctions.push({offset_to_label[PC],-1});stringexecuted_instruction=all_in,3
2,0);stringhex_PC=binary_to_hex(b,0
d.back()==':'){executed_instruction=executed_instruction.substr(pos,1
storage=(mem_loc/block_size)*block_siz,1
_binary(stoi(assembly_code[instruction_no][3]),6,true);imm="000000"+imm;}elseif(assembly_code,4
tion<<";PC="<<hex_PC<<endl;//Ensurethatthex0valueremainsat0register_v,0
tion==".data"){data=true;count_how_many_to_skip++;continue;}if(data,1
exes,vector<vector<int>>(associativity,vector<int>(block_size+3,0)));//Initiallyeverythi,5
[0]];stringrd=registers[assembly_code[instruct,1
e));to_store_mem_loc|=(i<<offset_size);for(inti=0;i<block_size;i++){memor,0
<cstdlib>#include<math.h>#include<sstream>#include<stack>#include<queue,4
hisistoremove.scu,0
etakeintoaccountthelinesthatareoccupiedbythedatasection,andsubtractthembr,0
=0x00000;for(,0
hexadecimalvaluesif(instruction[2][1]=='x'){stringbin_instr=hex_to_binary(instruction[2].substr(2));,6
ep_I(cur_instr);}elseif(format[,1
onotcontactthecacheatall.So,weneedtoprintinthecache_outputfilefromhereonly,sinceupdate_q,0
tion=all_instructions[PC/4];intpos=execu,1
'0';}}//Add1tofind2,0
edestinationaddressandvalueofPCaccordinglyregister_values[rd]=PC+4;,1
{cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrd";exit(,0
,thenensuretopopmainfromthestackif(PC/4==no_of_instruction){stack_of_functions,1
h"]='S';format["sw"]='S';format["sd"]='S';//Bformatformat["beq"]='B';format["bg,3
rite_access(mem_loc,byte,false);//memory[mem_loc]=byte;}if(inst=="sh"){vector<uint8_t>byt,4
0remainsatvalue0PC=PC+4;register_values["x0"]=0;}//CodefortheUformatstepinstructionsvoidstep,1
x6"){r="x6";}elseif(r=="t2"||r=="x7"){r="x7";}elsei,3
ng>instruction){//Storethenewpcvaluetojumptointnew_pc=PC+stoi(instruction[2]);//Extractt,2
egister_val,0
=1){is_dirty=true;intto_store_mem_loc=0;//herethetagandinde,0
thattheuserhasspecifiedand,0
rary_register_no+=to_string(i-28+3);registers[temporary_register_no]=this_reg,2
toffset_size=log2(block_size);//Thesemanybitsaref,1
os=executed_instruction.find('');stringfirst_word=execute,1
ind(assembly_code[instruction_no][2])==labels.end(,3
bstr(5);//Thisistoremove.scurrent_opened_file.pop_back();,2
ode[instruction_no][1]];stringrs2=registers[assembly_code[instruction_no][,3
sters.end()){cout<<"Errorinline:",1
<<(64-shifting_amo,0
;if(val_rs1<val_rs2){PC=new_pc;}else{PC+=4;}}//Updatethestackoffunctionsandthe,2
wu");}//Wheneveranewfileisloaded,thiswillhandleinitializinganyusedvariablesthatthepr,0
a[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++){new_data[k]=memor,2
s.find(assembly_code[instruction_no][1])==registers.end()){cout<<"Errorinline:"<<instru,4
uction[0]=="jalr"){swap(cur_instruction[2],cur_instruc,2
=binary_to_dec,0
ackif(PC/4==no_of_instruction){/,1
ep_B(cur_instr);}elseif(format[cur_instr[0]]=='J'){step_J(cur_instr);}elseif(format[cur_instr[0]]==',8
sters.find(assembly_code,0
lock_size-1);cache_block[0]=1;//Thebitisn,1
step_R(cur_instr);}elseif(format[cur_instr[0]]=='I'){step_I(cur_instr);}elseif(format[cur_ins,6
oprintthecachestatisticsif(cache_enabled){cout<<"D-cachestatistics:Ac,1
empty()){intcur=q.front();q.pop();dummy_q.push(cur);if(cur==tag){is_,5
sembly_code[instruction_no].size()!=4){,2
edatacache.assign(no_of_indexes,vector<vect,0
lues[rs2];}elseif(inst=="srl"){uint64_tshifting_amount=register_values[rs2];if(shifting_amount!=0){r,4
hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i],4
||stoi(assembly_code[instruction_no][3])>=pow(2,6)){cout<<"Er,4
uction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal,3
inline:"<<instruction_no+1<<endl<<"Valueofimmediateis,0
+1<<endl<<"Incorrectvalueofrd";exit(0);}intdec_imm;//Weacceptbothdecima,1
ze+index_size));t,0
s/memory/PCbeforelo,0
tions.push({top_of_stack,top_line});stringexecuted_instruction=all_instructions[PC/4];in,3
morywithoutbotheringtoddoan,0
i=0;i<4;i+,0
if(r=="t0"||r=="x5"){r="x5";}elseif(r=="t1"||r=="x6"){r="x6";}elseif(r=="t2"||r==,4
ionsvoidexecute_J(vector<vector<string>>&assembly_code,2
ctopcodetothecorrespondinginstructionif(load_operands.find(assembly_code[instruction_no][0])!=load_,3
"Insertedbreakpointatline:"<<break_point<<endl;}elseif(!command.find("cache,0
>>=(index_size+offset_size);//Gettingthevalueofindexbitsofmemorylocationbeingrequ,1
r_hex<<endl;}}elseif(command=="exit"){//Exitthesimulatorcout<<"Exite,1
seif(inst=="ori"){register_values[rd]=register_values[rs1]|imm;}elseif(inst=="andi"){r,5
hetextsegmentofthememory://Wehavetheinstruct,0
].size();j++){,1
(r=="a3"||r=="x13"){r="x13";},2
Makesthepositionsofind,0
themem_locfor(inti=1;i<instruct,0
tion_no][3])<0||stoi(assembly_code[i,1
=memory[j];}if(operation=="write"){new_data,2
_block[0]==0){/,1
e[instruction_no][3])<-pow(2,11)||stoi(assembly_code[instruction_no][3])>=po,7
k(command[i]);}}s_addr=s_addr.substr(2);//Weremovetheleading0xinthestring//Wenowwanttoconver,3
string>instruction){//Storethenewpc,0
instruction[i]);vector<uint8_t>byte(4);for(inti=0;i<4;i++),3
embly_code[instruction_no][3])==labels.end()){cout<<"Errorinline:"<<instruction_no+1<<e,3
mat["sd"]='S';//Bformatformat["beq"]='B';format["bge"]='B';format["blt"]='B';format["bne"]='B';fo,5
top_of_stack,top_line});stringexecuted_instruction=all_instructions[PC/4];intpos=exe,1
on.size();i++){uint64_tstore_value=stoi(instruction[i]);vector<uin,3
.data"){da,0
fting_amount1'suint,0
ing(i-18+2);regist,1
inatingthepartstoformtheinstructionstringinstr=imm.substr(0,1),1
uction){//Keeptrackofthenewpcvalueandextractthers1andrs2valu,0
mp_mask<<offset_size;temp_mask=temp_mask-1;index_mask=index_mask^temp_mask;//Ma,0
{cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs1";exit(0);}e,1
Tag:"<<hex_tag<<","<<"Clean"<<"Fro,0
pdate_queue(index,tag,true,mem_loc,"read",true,false);returnval;}}}else{returnmemo,1
;stringrd=register,0
out<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Notingthe,1
="lh"){int16_tbyte,0
oi(instruction[3]);rs1=aliasRemo,2
che[i][j][k,2
";PC="<<hex_PC<<endl;//Ensuretoremovethecalledfunctionfromthe,0
i"]="000";funct3["xori"]="100";funct3["ori"],2
f(format[cur_instr[0]]=='S'){step_S(cur_instr,3
string(i-18+2);registers[saved_register_no]=this_register;}elseif(i>=28&&,2
e,intinstruction_no){//Handlingerrorif(assembly_code[inst,0
[0]];stringf7=funct7[assembly_code[instruction_no][0]];stringrd=,4
dummy_q.empty()){intcur=dummy_q.front();dummy_q.pop();q.push(cur);}if(!is_present){,6
cimalandstoreintextmemoryfor(intinstruction_no=0;,0
mmed_instr;//Gothroughthecurrentinstr,0
tetonextreturnmem_loc;}signedmain(){//Initia,1
ndi"){register_values[rd]=regist,1
(assembly_code[instruction_no][0]=="jalr"){opcode="1100111";}else{opcode="0010011";}//,5
format["lh"]='I';format["lb"]='I';format["lbu"]='I';format["lhu"]='I';format["lwu"]='I';fo,5
ofbytesinthecachedatacache.assign(no_,0
ata[1]==1){is_dirty=true;intto_store_mem_loc=0;//Hereth\etagandindexshouldbeoftherem,1
_string(i-18+2);registers[saved_register_no]=this_register;}elseif(i>=28&&i<=31){stri,2
(format[cur_instr[0]]=='R'){step_R(cur_instr);}elseif(format[cur_instr[0]]=='I'){st,8
irst;inttop_line=stack_of_functions.top().second;top_line=PC/4+1;stac,1
irty}for(inti=0;i<associativity;i++){if(cache[index][i][2]==top_ta,3
3["sd"]="011";funct3["beq"]="000";funct3["bne"]="001";fu,3
ti=0;i<8;i++){byte[i]=read_a,1
ectlyaddourvaluetoitboolfound_invalid=false;for(inti=0;i<assoc,0
d_instructio,0
inthatlocation//Ifwefindthisblockinthecache,wereadonlythisparticular,0
;i<4;i++){binary_bytes[i]=hex_to_binar,1
_register+=num;}else{intdummyi=i;charnum1=dummyi%10+'0';dummyi/=10;charnum2=dummyi%1,0
abled){cout<<"D-cachestatistics:Accesses="<<hits+misses<<",Hit="<<hits<<",Miss="<<misse,0
rd]=register_values[rs1]&register_valu,1
hroughallthevaluesthattheuserhasspecifie,0
etusnowcalculatethemaskrequiredtofindoutthetagbitslaterin,0
.pop_back();}cur_instruction.push_back(cur);cur="";}}if(cur!=""){if(cur[,3
="x8"){r="x8";}elseif(r=="s1"||r=="x9"){r="x9";}elseif(r=="a0"||r=="x10"){r="x10";}else,5
seif(format[cur_instr[0],1
intold_PC=PC;,0
n_no][2].substr(2));intdecimal=binary_to_decimal(bin_instr,2
funct3["xori"]="100";funct3["ori"]="110";,2
irlastexecutedlineaccord,0
ngrs1=registers[assembly_code[instruction_no][2,1
irty}for(inti=0;i<associativity;i++){if(cache[index][i][2]==top_t,3
pdatethememoryif(removed_data[1]==1){is_dirty=true;,2
cache_output_name.c_str(),"a")!=NULL){cache_output.close();}cache_output_n,3
peformat,youmustenter4operands"<<endl;exit(0);}if(labels.find(assembly_code[instruction_no][3])==l,4
ringhex_tag="0x"+binary_to_hex(bin_tag,true,5);cache_output<<read_or_write<<":Address,1
e>>block_size>>as,0
<string>>&,1
{imm=stoi(instruction[2]);}i,3
ize);index_mask=index_mask-1;te,0
reak_point-count_how_many_to_skip);cout<<"Inser,0
to_store_mem_loc=0;//herethetagandindexshouldbeof,0
g2(block_size);//Thesemanybitsareforoffsetintindex_size=l,1
(tag,20,0);s,1
ationthatourprogramisrequestingtoreadinttag=tag_mask&mem_loc;tag>>=(index,0
rtbinarytohexadecimalstringbinary_to_hex(stri,0
alse;vector<uint8_t>byte(8);for(int,2
i].size();j++){if(,1
fset_size-index_size,0
)||stoi(assembly_code[instruction_no][3])>=pow(2,12)-1){,4
eplace){//Donothing}else{intrandom_number=rand(),2
inary(i,5,false);registers[register_no]=this_register;if(,2
onsofoffseybitszero//Weneedtodothisfo,0
ndex,20,0);st,0
='R';format["or"]='R';format["and"]='R';format["sll"]='R';format["s,3
aterinttag_mask=1;tag_mask=tag_mask<<20;tag_mask=tag_mask-1;//Thismakesthemask20onesinttemp,0
ofoffsetbitsintoffset=of,0
];stringimm=decimal_to_binary(sto,0
]]=='R'){step_R(cur_instr);}elseif(,2
no_of_instruction){//Alsoensureto,0
eak")){//Thisblockdeletesabeakpointinthe,0
structionif(inst=="lb"||inst=="lh"||inst=="lw"||inst=="ld"||inst=="lbu"||inst=="lhu",0
mask=1;index_mask=index_mask<<(index_size+offset_size);index_mask=index_mask-1;temp_mask=1;temp_m,1
conststring&bin){intdecimal=0;intlength=,0
]='2';bin_to_he,0
=binary_to_decimal(bin_s_add,0
=="andi"){register_values[rd]=,1
splayboolche,0
c){//Gothroug,0
ativity*block_size));//Thesemanyareforindexinttag,0
}elseif(inst=="andi"){register_values[rd]=register_values[rs1]&imm;}elsei,4
ter;}elseif(i>=28&&i<=31){stringtemporary_register_no="t";temporary_register_no+=to_string(i-28,0
f(inst=="sd"){boolaccessed_once=false;vector<uint8_t>,2
functions.push({top_of_stack,top_line});stringexecuted_instruction=all_instructions[PC,2
m;//Ourmaskisshifting_amount0'sf,0
";}returnhex;}//Codetoconverthexadecimaltobinarystringhex_to_binary,0
urprogramisrequestingtoreadinttag=tag_mask&mem_loc;tag>>=(index_size+offset_size);//Gettingt,1
ster;}elseif(i>=10&&i<=17){string,0
d_instr="";for(inti=0;i<instruction.size();i++){if(trim&&instruction[i]==''){conti,3
==tag){is_present=true;}}while(!dummy_q.empty()){intcur=,3
vity*block_size));//Thesema,0
lean="Dirty";}stringbin_set=de,0
;format["lb"]='I';format["lbu"]='I';format["lh,2
landstoreintextmemoryfor(intinstruction_no,0
to_binary(stoi(assembly_code[instruction_no][3]),13,true);//Concatinatingthepartsto,4
gister_values[rd]=register_values[rs1]&imm;}elseif(inst=="slli"){register_values[rd]=regi,4
,tag,dataif(cache_block[0]==0){//Thisisaninvalidframe,ignorecontinue;}i,3
_size-1);new_data[0]=1;//Thebitisnowvalidnew_data[1]=0;//Ini,2
ing>registers_alis,0
break;}}//Nowcheckiftheremoveddatahasadirtybit,0
on_no][3])<0||stoi(assembly_code[instruction_no][3])>=pow(2,6)){cout<<"Errorinline:"<<instruc,6
makesthemask20onesinttemp_mask=1;temp_mask=temp_mask<<(index_size+offset_size);temp_mask=temp_mask-,1
le,instruction)){//I,0
ns.pop();stack_of_functions.push({top_of_stack,top_,1
ock[0]==0){//Thisisaninvalidfram,1
ssociativi,0
r="x12";}elseif(r=="a3"||r=="x13",0
cceptbothdecimalandh,0
sembly_code,instruction_no);}elseif(format[assembly_code[instr,0
hex_tag<<","<<is_clean<<endl;}}}myfile_out.close();}elseif(command=="cache_s,1
r_values[rs2];if(val_rs1<val_rs,1
str[0]]=='J'){step_J(cur_instr);}elseif(format[cur_instr[0]]=='U'){step_U(cur_instr);}else{exi,8
ly_code[instruction_n,0
valueofaddrandc,0
ary_to_decimal(binary_bytes[i]);//character,2
];//Sincethisahit,weneedtoupdatetheorder,0
s1=aliasRemover(instruction[2]);imm=stoi(in,2
,vector<vector<int>>(associativity,v,2
amount!=0){re,0
lseif(r=="a7"||r=="x17"){r="x17";}elseif,2
emory[instruction_no*4+i]=byte[i];}}//CodeforJformatinstructionsvoidexecu,2
[i]=='0'){bin[i]='1';}else{bin[i]='0';}}//Add1tofin,5
);}else{exit(0);}//If,2
koffunctionsandtheirlastexecutedlineaccordinglystringtop_of_s,0
t=="lw"||inst=="ld"||inst=="l,0
r<uint8_t>byte(4);for(inti=0;i<4;i++,2
findthisblockinthecache,weloadthewholeblockfromthememoryboolfound=false;intval=0;for(inti=0,0
ommand.find("load")){//Firstresetalltheregisters/memory/PCbeforeloadingthenextfileinitializ,1
_functions.push({top,0
x_instruction=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0,3
heorderofaccessvector,0
size)*block_size+(block_size-1);new_data[0]=1;//Thebitis,2
=tag;for(intj=s,0
//Extractthers1,rs2andimmediatevaluesstringrs1,rs2,inst;intimm;inst=instruct,0
s[i]=hex_to_binary(hex_instructio,1
"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//UpdatethePCvalue,0
nstr);}elseif(format[cur_instr[0]]=='U'){step_U(cur_in,3
ranewfileisloaded,thiswillhandleinitializinganyusedvariablesthatthepreviousfilemigh,0
t_location,false);int16_tbyte1=read_access(start_locat,0
owour20bitsofmemoryaddressaredivided.intoffset_size=log2(block_size);//Thesemanybi,1
:"<<instruction_no,0
'R';format["and"]='R';,1
C,32,0);stringhex_PC=binary_to_hex(bin_,0
et<int>break_lines;intcount_how_many_to_skip;//Codetoconvertbina,1
detomachinecodehexadecimalandstoreintextmemoryfor(intinstruction_no=0;instruc,0
no);}elseif(format[assembly_code[instru,0
_enabled){for(inti=,0
//Concatinatingtheinstr,0
_of_stack=st,0
nd('');stringfirst_word=executed_instruction.substr(0,pos);,2
;for(charc:instruction){if(c==''||c==','){if(cur!=""){to_store.push_back(cur);}cur="";}else{cur.pu,6
e=command.substr(15);o,1
"||r=="x11"){r="x11";}elseif(r=="a2"||r=="x12"){r="x12";}elseif(r=="a3"||r=="x13"){r="x13";},5
an"<<"Fromwriteaccess"<<endl;}}//Inthecaseofmisses,ifitiswritethorugh,wejustwriteto,0
if(inst=="bgeu"){uint64_tval_rs1=register_values[rs1],val_rs2=register_values[rs2];if(val_rs,3
001";funct3["blt"]="100";funct3["bge"]="101";funct3["bltu"]="110";funct3["bgeu"]="111";}//Definingal,4
_mask=temp_mask-1;tag_mask=tag_mask^temp_mask;//Makesthepositionsofindexbitsandoffsetbitszero//L,0
,false);int16_tbyte1=read_access(start_location+1,true);,1
3])<-pow(2,12)||stoi(assembly_code[instruction_no][3])>=pow(2,12)-1){cout<<"Errorinli,6
="x22"){r="x22";}elseif(r=="s7"||r=="x23"){r="x23";}elseif(r=="s8"||r=="x24"){r=,4
te;register_values[rd]=res,1
l;}}elseif(command=="show-stack"){//Hereweexecut,1
tostep\n";}else{vector<string>cu,1
/4+1;stack_o,0
nti=0x0;i<0x50001;i++){memory[i]=0x00;}labels.clear();register_values.clear();all_instr,4
emoved_data[3+i];}}}}}//Here,1
tringrs1=aliasRemover(inst,0
if(cache_block[0]==0){//This,2
in="";for(inti=0;i<hex.size();i++){bin+=hex_to,1
cout<<"Errorinline:"<<instruction_no+1<<endl,0
ringinst,rd;ins,0
hex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_b,3
tj=0;j<cache[i].size();j++){for(intk=0;k<cache[i][j].size();k++){cache[i][j][k]=0;}}}assembly_code.,9
()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs2";exit(0);}elseif(stoi(ass,2
ory[i]=0x00;}labels.clear();register_values.clear();all_instructions.clear();offset_to_label.c,4
harestoredi,0
ndex3andextendstillblocksize//break;}}//Ifwedidnotfindthevalue,weneedt,0
r=="x15"){r="x15";}elseif(r=="a,1
wewerenotabletofindanyinvalidblock,weneedtoapplyreplacementpolicyif(!found,0
asadirtybitset,andifso,weneedtoupdatethememoryif(removed_data[1]==1){is_dirty=tr,2
.size();j++){if(cache[i][j][0]==1){stringis_clean="Clean";if(cache[i][j][1],8
();dummy_q.push(cur),2
p();stack_of_f,1
p());dummy_stack_function.pop();}for(inti=dummy_stack.size()-1;i>=0;,3
0011";}//Notingthevaiourspartsoftheinstrutionstringf3=funct3,0
e[instruct,0
alues[rs1]>>imm;//Ourmaskisshif,1
ction=binary_to_hex(instr);vector<string>binary_bytes(4);for(int,3
tput<<read_or_write<<":Address:"<<hex_address<<",Set:"<<hex_set<<","<<hit_or_miss<<",,0
_data[k]=memory[j];}if(operation==,2
tinatingthevaluesstringinstr=imm+rs1+f3+rd+opcode,0
()){cout<<"Errorinline:"<<instru,1
();all_instructions.clear();offset_to_label.clear();while(!stack_of_functions.empty()){stack_of,5
ector<string>instruction){//Extractrd,rs1,rs2stringinst=instruction[0];str,2
="";for(charc:instruction){if(c==,1
+offset];//Sincethisahit,weneedtoupdatetheorderofaccessvectorif(!accessed_once){,1
pop_back();labels[cur]=PC;offset_to_label[PC]=cur;,3
s_addr.substr(2);//Weremovetheleading0xinthestring//Wenowwanttoconvertittodeci,1
oc){//Gothroughallthevaluesthatt,0
o_string(i-18+2);registers[saved_register_no]=th,2
:"<<dummy_stack[i].second,1
i=0;i<memor,0
ack_of_functions.pop();stack_of_functions.push({t,1
ction_no*4+i]=byte[i];}}//Functiont,1
tdecimal=binary_to_decimal(bin_instr);imm=decimal;}else{imm=stoi(,1
tion[3]);}assembly_code.push_back(cur_instruction);PC+=4;}instruction_file.close();//Ensurethat,3
}if(to_break){cout<<"Executionstoppedatbreakpoint\n";break;,1
inttheregistervalueswhicharestoredinthemapcou,0
dexshouldbeoftheremoveddatano?to_st,0
&&hex[0]>='0'){hex=zeros+hex;}else{hex=f,2
=store_value>>8;memory[mem_loc]=byte[0];memory[mem_loc+1]=byte[1];mem_loc+=2;}//Returnthenew,4
r<uint8_t>byte(2);byte[0]=store_value;byte[1]=store_value>>8;write_acces,4
ecimal_to_binary(stoi(assemb,0
tions.push({top_of_stack,top_line});stringexecuted_instructi,2
code[instruction_no][0]]=='R'){execute_R(assembly_code,instruction_n,2
hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++,2
seif(r=="t5"||r==,0
word.back()==':'){executed_instruction=exec,1
et_size);//Gettingthevalueofindexbitsofmemorylocationbeingrequestedbyprogramin,0
cktopopthelabelsfromthemainstackandprinttheforthe,0
on[2].substr(2));intdecimal=binary_to_decimal(bin,2
ccordinglyregister_values[rd]=PC+4;PC=imm+register_values[rs1];}//Ens,2
c]=byte;}if(inst=="sh"){vector<uint8_t>byte(2);byte[0]=store_value;byte[1]=store_valu,5
+opcode;stringhex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++,3
truction[1]);stringrs1=aliasRemover(instruction[2]);strin,3
mbly_code[instruction_no][2]=to_string(labels[assembly_code[ins,2
Valueofimmediateisoutofrange";exit(0);}//Notingthevariouspartsoftheinstrcutionstringopcod,1
ct3["xor"]="100",1
fset_size=log2(block_size);//Th,1
ack,top_line});stringexecuted_instruction=all_instructions[PC/4];intpos=executed_instruction.find('',1
f0PC+=4;register_values["x0"]=0;,1
k=stack_of_functions.top().first;inttop_line=stack_of_functions.top().second;top_line=,2
th*4;i<binary.size();i++){zeros.push_back('0');fs.push,2
reouthowour20bitsofmemoryaddressaredivided.intoffset_size=log2(block_size);//T,1
ytohexadecimalstringbinary_to_hex(stringbinary,b,0
beq"]="000";funct3["bne"]="001",1
yreplacementpolicyif(!,0
eturnbin;}//Functiontoconvertbinarystringtodecimalint,0
s_read,boolis_hit,intval=-1,intoffset=-1){queue<int>q=order_of_access[index];queue<int>dumm,3
vity;i++){if,0
zero//Letusdothesameforindexmakin,0
oved_data[3+i];}}}}}//Hereweneedtoensurethatallthebocksarewrittenifdirtyf,1
ur[cur.size()-1]==','||cur[cur.size(),3
;if(first_word.back()==':'){executed_instruction=e,2
"x0"){r="x0";}elseif(r=="ra"||r,1
o_hex(bin_mem_val,true,2);intmem_l,1
any_to_skip++;if,0
alues[rs2]){PC=,1
i]=='0'){bin[i]='1';}else{bin[i]='0';}}//Add1tofind2'scomplementfor(inti=bin.si,4
tack>#include<,0
o_hex["1111"]='f';stringhex="";for(inti=0;i<binary.size();i+=4){stringb=binary.substr(i,4);hex.pu,3
ecutionofeachrun,wecandequeuethetopstringinstruction;instructi,0
syntax";exit(0);}}}elseif(,1
ruction.find('');stringfirst_word=execu,1
es;}elseif(inst=="lh"){int16_tbyte0=r,1
<=27){stringsaved_register_no="s";saved_register_no+=to_string(i-18+2);registers[saved_reg,1
eoftagbits,0
memory[instruction_no*4+i]=byte[i];}}//CodeforJformati,2
cutionstringopcode="1101111";stringrd=registers[assembly_code[instruct,0
he_enabled){stringhit_or_miss="Miss";stringclean_or_dirty="Clean";stringread_or_write="W",0
d_instruction.find(,0
();//Notethatthesizeifblocksize+3because,1forvalid,1fortag,1fordirtythenblocks,1
n=assembly_code.size();boolto_break=false;intbreak_point_line_to_remove;i,1
ask=1;temp_mask=temp_mask<<(index_,0
uction_no++){if(format[assembly_code[instruction_no][0]]=='R'){execute_R(assembl,4
ctions.top().second;top_line=PC/4+1;stack_of_functions.pop();stack_of_functio,2
cheif(write_back_policy=="WT"){memory[mem_loc]=val;//Incaseofwritethroughandmiss,wedonotcon,2
++){for(intj=0;j<cache[i].size();j++){for(intk=0;k<cache[i][j].size();k+,5
cimal(bin_s_addr);intcount=stoi(s_count);//Printingthelocationsofthememoryasspecifiedusing,2
_instr);}elseif(format[cur_instr[0]]=='J'){step_J(cur_instr);}elseif(for,5
tore_value>>(7-i,0
irst;inttop_line=stack_of_functions.,0
p"]=this_register;}elsei,0
cache_output.close();}elseif(command=="cache_siminvalidate"){if(cache_enabled){for(inti=0;i<cache.,3
ructionstringopcode="110001,0
heckifwehaveaninvalidframe,andifwedo,thenwecandirectlyaddourvaluetoitbool,0
no][3]),12,true);}//Concatina,1
//Iftheinstructionisdata,thenensurethatuntilwesee.text,wekeepstor,0
d()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectval,1
s[rd]=register_values[rs,1
';//Bformatformat["beq"]='B';format["bge"]='B';format["blt"]=',3
){data_base_address=stor,0
eranewfileisloaded,thiswillhandleinitializing,0
_mem_loc|=(removed_data[2]<<(offset_size+index_size));to_store_mem_loc|=(i<<offset_size);,2
ache[index][i][2]==top_tag){removed_data=cache[index][i];cache[in,5
.front();//Getthetagwhichweneedtoreplaceq.pop();//Popthevaluewhichisreplacedq.push,2
toi(instruction[3]);//Updatethestack,2
cute_I(vector<vector<string>>&assembly_code,intinstruction_no){//Hand,3
n['6']="0110";hex_to_bin['7']="0111";hex_to_bin['8']="1000";hex_to_bin['9']="1001";,4
();}stack_of_functions.push({"main",0});last_exected_line.cl,3
ode[instruction_no][3])>=pow(2,6)){cout<<"Errorinline:"<<instru,3
ctor<string>instruction){//Keeptrackofthenewpcvalueandextractthers1andrs2values,1
oidwrite_access(intmem_loc,intval,boolaccess,0
xtractrd,rs1,andimmediaterd=aliasRemover(instruction[1]);rs1=aliasRemover(instruction[2]);imm=stoi(,4
instruction_n,0
ings,suchthatafter,0
r=="x2"){r="x2";}elseif(r=="g,1
rrent_opened_file.pop_back();current_opened,1
s[assembly_code[i,0
nary(stoi(assembly_code[instruction_no][2]),21,,3
iatevaluesstringinst,rd;inst=instruction[0];rd=aliasRem,1
et=decimal_to_binary(i,20,0);stringhex_set="0x"+,1
uction)){//Iftheinstruct,0
truction_no+1<<endl<<"Labelnotdefined";exit(0);}else{assembly_code[instruction_no][2]=to_string(la,3
anchifconditionsatisfiedasperthegiveninstructionif(inst=="beq"){if(register_values[rs,1
k_function.top());dummy_stack_function.pop();}for(inti=dummy_stack.size()-1;i>=0;,3
its=0,misses=0;stringcurrent_opened_file="";vector<queue<int>>order_of_access;o,2
ss<<",Set:"<<hex_set<<","<<"Miss"<<",Tag:"<<hex_tag<<","<<"Clean"<<"Fromwriteaccess"<<en,0
,boolis_hit,intval=-1,intoffs,0
;}//CodefortheRformatstepinstructionsvoidstep_R(vector<string>instruction){//Extract,2
t_to_label;unordered_map<string,int>la,1
vector<int>new_data(cache[0][0].size());intstart_storage=(mem_loc/block_size)*block_,6
",false,true,val);break;}}//Ifwedidnotfindthevalue,weneedtolookinthememoryi,0
l;}}elseif(command=="show-stack"){//Her,1
se{memory[mem_loc]=val;}}intread_a,2
nue;}if(cache_block[2]==tag){if(!accessed_,2
=to_string(i-10);registers[argument_register_no]=this_register;}elseif(i>=18&&i,2
[index][i];//Valid,Dirty,tag,datai,2
tag_mask<<20;tag_mask=tag_mask-1;//Thismakesthemask20onesinttemp_mask=1,0
ortheoffsetaswell,because,ultimatelythisfunctionhastoreturnonly1byteintoffset_mas,0
etalltheregisters/memory/PCbeforeloadingthenextfileinitialize();hits=0;m,1
_I(cur_instr);}elseif(format[cur_instr[0]]=='S'){step_S(cu,4
(inst=="jalr"){//Extracttherd,rs1andimmediatevaluerd=aliasRemover(i,1
size();j++){if(cache[i][j][0]==1&&cache[i][j][1]==1){intoffset_size=log2(block_size);/,9
ock_size<<endl;cout<<"Associativity:"<<associativity<<endl;cout<<"Replaceme,0
tr);}elseif(format[cur_instr[0]]=='S'){step_S(cur_instr);}el,5
PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,1
n.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=bi,2
s;unordered_map<string,int>labels;,1
s[assembly_code[instruction_no][1]];stringimm=decimal_to_binary(stoi(assembly_,3
p"||r=="x8"){r="x8";}elseif(r=="s1"||r=="x9"){r="x9";}elseif(r=="a0"||r=="x10"){r="x10";},5
ntspresent\n";}}elseif(!command.find("break")){//Weparsethestringtogetthelinenumberwhereweha,2
"<<endl;cout<<"CacheSize:"<<cache_size<<endl;c,0
.push_back(decima,0
taif(cache_block[0]==0){val=memory[mem_loc];//Getthev,3
theleading0xinthestring//Wenowwanttoconvertitto,0
rue);//Concatinatingtheinstruct,0
r<int>(block_size+3,0)));//Initiallyeverythingisinvalid,and,2
yntax,forStypeformat,youmustenter4operands"<<endl;exit(0);}elsei,1
t=true;found=true,0
ffset);}}}}else{memory[mem_loc]=val;}}intread_access(intmem_loc,boolaccessed_once){if(c,3
ginthecacheif(write_back_policy=="WT"){memory[mem_loc]=,2
"Incorrectvalueofrd";exit(0);}elseif(registers.find(assembly_code[instruction_no][2])==registers.,4
""){if(cur[cur.size()-1]==','||cur[cur.size()-1]==')'){cur.pop_back();}cur_instruction.push_b,7
stringopcode="1100011";stringf,0
irtyif(write_back_policy=="WT",0
r_instr[0]]=='B'){step_B(,1
eremainingwords,criticalwordfirstploicyintst,0
cur);if(cur==tag){is_present=true;}}while(!dummy_q.empty()){intcur=dummy_q.front,4
_hex(bin_PC);hex_PC="0x"+hex_PC;cout,1
/Thebitisnowvalidcache_block[1]=0;//Initiallynotdirtycache_block[2]=,2
].size());intstart_,1
){for(inti=0;i<=63;i++){mask+=pow(2,i);}}register_values[r,2
ize));//Thesemanya,0
funct7valuesvoidinitialize_funct7(){fu,1
vethecalledfunctionfromthestackoffunctionsstack_of_functions.pop();//U,1
uctionsvoidexecute_B(vector,0
intindex_size=log2(cache_size/(associativity*block_size));//Th,2
data;break;}}//Nowcheckiftheremoveddatahasadirtybitset,andifso,weneedtoupdatethememoryi,0
ixed<<setprecision(3)<<(double)(hits)/(hits+misses);}stack_of_functions.pop();}}}elseif(command,5
e_block[2]=tag;found_invalid=true;update_queue(index,tag,false,mem_loc,"w,1
inst=="slli"){register_values,0
ed_instruction=executed_instruction.substr(pos+1);}s,1
="000";funct3["lh"]="001";funct3["lw"]="010";funct3["ld"]="011";funct3["lbu"]="100";funct3["lh,4
/characters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=by,1
struction.substr(6-2*i,2,0
to_bin;hex_to_bi,0
morylocationthatourprogramisrequestingtoreadinttag=tag_mask&mem_loc;tag>>=(in,0
e{while(PC/4<no_of_instruction){if(break_lines.find(PC/4+1)!=break_lines.end(,1
leinitialize();hits=0;misses=0;//memory.clear();/,2
[1]);intold_PC=PC;stringinst=instruction[0];if(inst=="jal"){register_value,3
{PC+=4;}}elseif(inst=="bge"){if(register_values[rs1],3
ge=(mem_loc/block_size)*block_size;intend_storage=(mem_loc/block_size)*block_size+(block_si,2
["add"]="00,1
mofintegerintstart_location=imm+register_values[rs1];if(inst=="lb"){int8_tbyte=read_access,2
ntdecimal=binary_to_decimal(bin_instr);dec_imm=decimal;}else{dec_imm,1
(to_break){cout<<"Executionstoppedatbreakpoint\n";break;}}//Iflastlineexecuted,1
,"<<clean_or_dirty<<"fromupdatequeue"<<endl;}order_of_acce,0
_access(start_locati,0
_tbyte=read_access(start_location,false);uint8_tres=byte;register_values[rd]=res;}elseif(inst=,2
nst=="lw"){vector<int32_t>byte(4);boolacce,2
ionsofthememoryasspecifiedusingalooopfor(inti=addr;i<addr+count;,0
th\etagandindexshouldbeoftheremoveddatano?to_store_mem_loc|=(removed_data[2]<<(offset_siz,1
assembly_code[instruction_no][3])<0||stoi(assembly_code[instruction_no][3])>=pow(2,6),7
str(0,pos);if(first_word.back()==':'){executed_instruction=executed_instru,3
ofimmediateisoutofrange";exi,0
).second;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.pu,1
ureouthowour20bitsofmemoryaddre,0
"){to_store.p,0
][j][0]==1&&cache[i][j][1]==1){intoffset_size=log2(,5
_to_binary(assembly_code[instru,0
er_values[rd]=register_values[rs1]>>register_v,2
i<4;i++){write_access(mem_loc+i,byte[i],accessed_once);accessed_once=true;}}if(inst=="sd"){,4
binary(PC,32,0);stringhex_PC=binary_to_hex(,1
oc];//Getthevalueandthenstoretheremainingwords,criticalwordfirstploicyintstart_storage=(,0
ethatx0remainsatvalue0,0
;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2,1
}//Iflastlineisexecuted,thenensuretopopmainfromthestackif(PC/4==no_of_instruction){stack_o,1
bytes[i]);//characters67ofhex_instruction,1
0;i<4;i++){memory[instruction_no*4+i]=byte[i];},3
/Thisistoremove.scurrent_opened_file.pop_back();current_opened_file.pop_back();PC=0;while,2
ofx0is0register_values["x0"]=0;}//CodeforRformatinstructionsvoidexecu,1
]==0){//Thisisaninvalidframe,ignorecontinue;}if(c,1
ress);}elseif(to_store[0]==".byte"){data_base_addres,2
-1;}//CodefortheRformatstepinstr,0
d_instruction=executed_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(old_PC,32,0);str,2
piedbythedatasection,andsubtractthembreak_lines.insert(break_point-count,0
ter_values[rd]=register_values[rs1]|imm;}elseif(inst=="a,2
set>#include<vector>#include<array>#include<algori,2
o);}elseif(format[asse,0
t:"<<hex_set,0
ened_file="";vector<queue<int>>order_of_access;ofstreamcache_output;//Declarethev,2
=register_values[rs2]){PC=new_pc;}else{PC+=4;}}else,3
on_no][1])==registers.end()){cout<<"Errorinline:"<<instruct,2
struction_no*4);}if(registers.find(assembly_code[instruction_no][1])==re,3
;offset_mask=offset_mask<<(offset_size);offset_mask=offset_mask-1;//Wecannowgettheactualvalueoftag,1
"<<"Clean"<<"Fromwriteaccess"<<endl;}}//Inthecaseofmisses,ifitiswritethorugh,wejustwritetomemo,0
location.//Ifwedonotfindthisblockinthecache,weloadthewholeblockfromt,0
){executed_instruction=executed_instruction.substr(pos,0
3=funct3[assembly_code[instruction_no][0]];stringf7,3
no][3])<0||sto,1
alse;//Letusfirstfigureouthowour20bitsofmemoryaddressaredivided.intoffset_size=log,0
egisters[assembly_code[instruction_no][,1
ze()-1;i>=0;i--){//Usingalooptoprintthe,1
bels[assembly_code[instruction_no][2],2
toconvertde,0
_bin['4']="0100";hex_to_bin['5']="0101";hex_to_bin['6']="0110";hex_to_bin['7',3
te=store_value;memory[mem_loc]=byte;mem_loc++;}//Returnth,1
'0'){continue;}else{trimmed_hex=hex.substr(i);r,2
;to_store_mem_loc|=(i<<offset_size);for(inti=0;i<block_size;i++){memory[to_store_mem_loc+i]=removed,1
embly_code,0
e()-1;i>=0;i--){if(bin[i]=='0'){bin[i]='1';break;}bin[i]='0';}returnbin;}/,7
no][0]];stringrs1=registers[assembly_code[instruction_no][2]];stringrs2=,4
cache[index][i][2]==top_tag){removed_data=cache[index][i];cache[index][i]=new_,7
bstr(5);//Thisistoremove.s,1
teisoutofrange";exit(0);},1
alues[rs2];}elseif(inst=="or"){register_values[rd]=register_values[rs1]|regis,4
he_block[1]=1;//Thecacheblockisnowdirtycache_block[2]=tag;found_invalid=true;u,2
;load_operands.insert("lbu");load_operands.insert("lhu");load_operands.insert("lwu");}//,3
egister_values[rs2];}elseif(inst=="or"){register_values[rd]=register_values[rs1]|register_values[rs,4
mp")){stringmyfile_out_name=command.substr(15);ofstr,1
(3-i)*8;}for(inti=0;i<4;i++){memory[mem_loc+i]=byte[i];}mem_,4
PC="<<hex_PC<<endl;//UpdatetheP,0
<4;i++){memory[instruction,0
st=="andi"){register_values[rd]=register_values[rs1]&imm;}elseif(inst=="slli"){register_values[r,4
{//Letusfirstfigureouth,0
f_functions.push({offset_to_label[PC],-1});stringexecuted_instr,3
e);//Concatina,0
{swap(cur_instruction[2],cur_instruction[3]);}assembly_code.push_back(cur_instruction);PC+=4;}inst,5
ush_back('f');}if(hex[0]<',2
offset_size);for(inti=0;i<block_size;i++){memory[,0
dl<<"Incorrect,0
number=rand()%associativity;vector<int>removed_data(cache[0][0].size());vector<int>,7
7"){r="x17";}elseif(r=="s2"||r=="x18"){r="x18";}elseif(r=="s3"||r=="x19"){r="x19",4
kpointintheprogramintbreak_,0
(true){//Now,1
nstruction){cout<<"Nothin,0
=register_values[rs2];if(shifti,1
_instructio,0
ry[i]=0;}for(inti=0;i<cache.size,1
al_rs1<val_rs2){PC=new_pc;}else{PC+=4;}}//Updatethestackoffunctionsandtheirlastex,2
ind(assembly_code[instruction_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_no+,4
ion[2],cur_instruction[3]);}assembly_,2
command.find("cache_simenable"),1
nttemp_mask=1;temp_mask=temp_mask<<(index_size+offse,0
ues[rd]&mask;regi,1
temp_mask=temp_mask-1;index_mask=index_mask^temp_mask;//Makesthepositions,0
ta[1]==1){is_dirty=true;intto_store_mem_loc=0;to_store_mem_loc|=(tag<<offset_size+index_size);to_sto,1
mal_to_binary(stoi(assembly_code[instruc,0
e<<endl;cout<<"BlockSize:"<<block_,0
mloadasperth,0
op().second;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,top_lin,2
n=="write"){new_data[3+offset]=val;new_data[1]=1;//Setthebittodirty}for(inti=0;i<associativity;i++,3
;register_values[reg]=0,1
d]&mask;}}elseif(inst=="sra"){register_values[rd]=re,2
if(first_word.back()==':'){executed_instruction=executed_instruction.substr(pos+1);}string,4
hatx0remainsatvalue0PC=PC+4;regist,0
push_back(instruction[i]);}else{if(cur,2
);}uint8_tbyte[4];for(inti=0;i<4;i++){by,1
ryspacefromthebeginningofanylinebooltrim=true;stringtrimmed_instr=,0
l_instructions[PC/4],1
ds"<<endl;exit(0);}elseif(registers,1
ache,wereadonlythisparticularme,0
".text"){data=false;}else{//Storetherequireddword/word/,1
format,youmustenter4op,0
w-stackcommandcout<<"CallStack:\n";//Weuseadummystacktopopthelabelsfromthemainstackandprinttheforthe,0
="x9"){r="x9";}elseif(r=="a0"||r==",1
elseif(format[cur_instr[0]]=='U'){step_U(cur_instr);}else{exit(0);}if(to_br,7
index_size;//Andthe,0
tr(pos+1);}stringbin_PC=decimal_to_binary(old_PC,,1
ction[3]);stringrs1=aliasRemover(instruction[1]);stringrs2=alias,3
k+=pow(2,i);}}register_values[rd]=register_values[r,2
k(block_size+3);cache_block=cache[ind,1
){register_values[rd]=register_values[rs1]<<imm;}elseif(inst=="srli"){uin,3
reisonly1index,everyoneisfightingforthisoneindexassociativity=cache_size/block_size;}intno_of,0
ghandmiss,wedonotcontactthecache,0
his_register;}elseif(i>=10&&i<=17){stringargument_register_no="a";argument_regi,0
"||r=="x6"){r="x6";}elseif(r=,1
truction.substr(0,pos);if(first_word.back()==':'){executed_instruction=executed_instruction,3
owcalculatethemaskrequiredtofindoutt,0
struction_no*4+i]=byte[i];}}//CodeforBformatinstructionsvoidexec,1
dex,tag,false,mem_loc,"read",true,false);cache[index][i]=cache_bloc,2
ze=20-offset_size-index_size;//Andthesemanyaretagbitsboolis_d,0
_once){if(cache_enabled){//Letu,1
inst=="sd"){boolaccessed_once=false;vector<uint8_t>byte(8);for(inti=0;i<8;i++){b,2
indexmakintindex_mask,0
="x30"){r="x30";}elseif(r=="t6"||r=="x31"){r="x31";}returnr;}voidupdate_queue(intinde,3
thelabelsfromthemainstac,0
"<<instruction_no+1<<endl<<"Incorrectvalueofrs1",0
(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<e,1
t_size-index_size;//Andthesemanyaretagbi,0
.push_back(cur);cur="";}}if(cur!=""){if(cur[cur.size()-1]==','||cur[cur.size()-1]==')'){cur.pop_back,7
)|(byte[3]<<24)|(byte[2]<<16)|(byte[1]<<8),3
r_values[rd]=res;}elseif(inst=="lhu"){uint16_tbyte0=read_access(start_location,fa,2
ubstr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_t,3
Executionstoppedatbreakpoint\n";break;}}//Iflas,0
nds.end()||format[cur_instruction[0]]=='S'||cur_instruction[0]=="jalr"){swap(cur_instru,4
){cache_output,0
_hex["1101"],1
ng>binary_bytes(4);for,1
nghex="";for(inti=0;i<binary.size();i+=4){stringb=binary.substr(i,4);hex.push_back(bi,2
=memory[mem_loc];update_queue(index,tag,true,mem_loc,"read",true,false,1
on_no+1<<endl<<"Incorrectvalueofrs2";exit(0);}elseif(stoi(assembly_code[instruction_no][3])<-,4
=memory[j];}removed_data=cache[index][random_number];cache[index][random_number]=new,5
clean="Clean,0
toi(assembly_code[instructio,0
");load_operands.insert("lw");load_operands.insert("ld");load_operands.insert("lbu");,3
ckoffunctio,0
ringbin_PC=decimal_to_binary(old_PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC,2
ted_instruction=all_instructions[ol,0
ion.size();i,1
al_rs1=register_values[rs1],val_rs2,1
);//Initiallyeverythingisinvalid,,0
.substr(pos+1),1
[rd]=register_values[rs1]+register_values[rs2];}elseif(inst=="sub"){register,4
ered_map<string,int>last_exected_line;stack<pair<string,int>>stack_of,3
ndl<<"Incorrectvalueofrs1";exit(,0
e();}elseif(command=="cache_simstats"){if(cache_enabled){cout<<"D-cachestatistics:Accesses="<<hits,3
etthevalueandthenstoretheremainingwords,criticalwordfirstploicyintstart_storage=(mem_loc/block_si,0
euserhasspecifiedandstorethemstartingforlocationspecifiedbythem,0
values[rd]=register_values[rs1]|register_values[rs2];}elseif(inst=="xor"){register,4
_value;byte[1]=store_value>>8;write_access(mem_loc,byte[0],2
ex_set="0x"+bin,0
inghex_set="0x"+binary_to_hex(bin_set,true,5);stringbin_tag=decimal_to_b,1
gisters.end()){cout<<"Errorin,1
ntno_of_instruction=assembly_code.siz,0
_code[instr,0
tringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<,1
register<<"=0x"<<value_of_register_hex<<e,0
ctionif(inst=="addi"){register_values[rd]=register_va,2
malandhexadecimalvaluesif(instruction[2][1]=='x'){stringbin_instr=hex_to_,3
sociativity;i++){vector<int>cache_block(block_size+3);cache_block=cache[index][i];//Valid,Dirt,4
,thenweneedtomakeitfullyassociativeif(associativity==0){//Thismeansthatthereisonly1index,everyonei,1
,false);returnval;}}}else{returnmemory[mem_loc];}//Thiswillneverrea,2
therd,rs1andim,0
f_functions.top().fir,1
00"]='8';bin_to_hex["1001"]='9';bin_to_hex["1010,1
(cache[0][0].size());intstart_,4
or(inti=0;i<binary.size();i+=4){stringb,1
ction){cout<<"Nothingtostep\n";}else{vector<s,0
orystrings_count=",0
);to_store_mem_loc|=(index<<offset_size);for(inti=0;i<block_size;i++){,0
thelabelsfromthemainstackandprintthefortheuservector<pair<string,int>>dummy_stack;stack<pair,2
line.clear();break_lines.clear();count_how_many_to_skip=0;}stringaliasRemover(stringr){i,3
ary(stoi(as,0
alueandthenstoretheremainingwords,criticalwordfirstploicyintstar,0
ndthevalue,weneedtolookinthememoryif(!found){if(!accessed_once){misses++;if(wr,2
s[assembly_code[instruction_no][2]];stringimm=decimal_to_binary(stoi(assembly_code[instructio,3
!command.find("cache_simenable")){cache_enabled=true;,1
ster_values[rs1]>>register_values[rs2];}//Update,2
nary_to_decimal(binary_bytes[i]);//characters67ofhex_instructio,2
]=removed_data[3+i];}}}}}//Hereweneedtoensurethatallthebocksarewrit,1
totheinstr,0
p_J(cur_instr);}elseif(format[cur_instr[0]]=='U'){step_U(cur_ins,4
,Dirty,tag,,0
lingerrorif(assembly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<instruction_no+1<<,3
ngbin_PC=d,0
ck_size));//The,0
on<<";PC="<<hex_PC<<endl;//UpdatethePCaccordi,0
xecutedlineaccordinglystringtop_of_stack=stack_of_functions.top().first;inttop_line=stack_of_f,1
ndex_size=log2(cache_size/(associativity*block_size));//Thesemanyareforindexinttag_si,2
pdatethememoryif(removed_data[1]==1){is_dirty=true;intto_store_mem,2
){vector<int32_t>byte(4);boolaccessed_onc,2
nst=="ori"){register_values[rd]=register_val,1
bin_tag=decimal_to_binary(cache[,0
){//Extractrd,rs1,andimmediaterd=aliasRemover(instruction[1]);rs1=al,2
bly_code,intins,0
+){vector<int>cache_block(block_size+3);cache_block=cache[index,2
once){misses++;}//Firstcheckifwehaveaninvalidframe,andifwedo,thenwec,1
nstr[0]]=='J'){step_J(cur_instr);}elseif(format[cur_instr[0]]=='U'){,6
er_values[rd]=register_values[rs1]<<imm;}elseif(inst=="srli"){uint32_tshifting_amount=imm;if(,3
_size+offset_size);//Gettingthevalueofindexbitsofmemorylocationbeingrequestedbyprogram,0
==".text"){data=false;}else{//St,1
moved_data[3+i];}}}}if(cache_enabled){stringhit_or_miss="Miss";string,2
e>>associativity>>replacement_policy>>write_back_pol,0
f(labels.find(,0
r=="t3"||r=="x28"){r="x28";,0
";}elseif(r=="s0"||r=="fp"||r=="x8"){r="x8";}elseif(r=,2
ly_code[instruction_no][3])<0||stoi(assembly_code[instruct,2
s2];}elseif(inst=="and"){,1
tthefortheuservector<pair<string,int>>dummy_stack;stack<pair<string,int>>dummy_stack_fun,4
x30";}elseif(r=="t6"||r=="x31"){r="x31";}returnr;}voidupdate_queue(,2
y_code[instruction_no][0]];stringf7=funct7[assembly_code[instruction_no][0]];stringrd=registe,5
immed_instr;//Gothroughthecurrentinstructionandstoreitina2dm,0
s(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_b,2
nnecessaryspacefromth,0
w_data(cache[0][0].size());intstart_storage=(mem_loc/block_size)*block_size;intend_storage=(mem_lo,5
e[index][i][1]=1;//Settingittodirtyif(write_back_policy=="WT"){memory[mem,4
sembly_code[instruction_no][3])>=pow(2,11)){cout<<"Errorinline:"<<,3
d()){cout<<"Errorinline:"<<instruction_no+1,1
cur);if(cur==tag){is_present=true,1
[i]);}}else{s_count.push_back(command[i]);,3
ateisoutofrange";exit(0,0
ex;bin_to_hex["0000"]=,1
ginstr=imm+rd+opcode;stringhex_instruction=binar,0
resaddresse,0
g_mask-1;//Thismakesthemask20onesinttemp_mask=1;temp_mask=temp_mask<<(,0
);}elseif(format[cur_instr[0]]==,2
hex_to_binary(assembly_code[instruction_no][2].substr(2));intdecimal=binary_to_de,4
ative=true;}decimal=abs,0
rnonly1byteintoffset_mask=1;offset_mask=offset_mask<<(offset_size);offset_mask=of,1
){memory[instruction_no*4+i]=byte[i];}}//CodeforBformatins,3
et_size+index_size));to_s,0
cimalintbinary_to_decimal(conststr,0
ckoffunction,0
"<<endl;exit(0);}elseif(regist,1
l<<"Wrongsyntax,forJtypeformat,youmustenter3operands"<<endl;exit(0);}if(labels.find,1
p_mask=1;temp_mask=temp_mask<<(index_size+,0
}elseif(format[cur_instr[0]]=='B',2
se);int16_tbyte1=read_access(start_location+1,true);int16_tres=byte1<<8|byte0;register_value,1
address=decimal_to_binary(mem_loc,20,0);stringhex_address="0x"+binary_to_hex(bin_address,,1
(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_,3
"x0"){r="x0";}elseif(r=="ra"||r=="x1"){r="x1";}elseif(r,3
oi(instruction[i]);uint8_tbyte=store_value;memory[mem_loc]=byte;mem_loc++;}//Returnth,3
t=stoi(s_count);//Printingthelocationsofthememoryasspecifiedusinga,1
.size()-length*4);}if(trim){stringtrimmed_hex="";for(inti=0;i<hex.size();i,3
he[i][j][2],20,0);stringhex_tag="0x"+binary_to,3
;registers[register_no]=this_register;if(i==0){regis,2
ecimal_to_binary(index,20,0);stringhex_set="0x"+binary_to_hex(,1
inary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<,1
te[7-i]=store_value>>(7-i)*8;}for(int,2
"x0"]=0;}//CodefortheIfor,0
nt="";//Cou,0
y_to_decimal(binary_bytes[i]);//characters67ofhex_instruction}for(inti=0;i,2
_register;if(i==0){registers["zero"]=this_register;}elseif(i=,3
Rate="<<fixed<<setprecision(3)<<(double)(hits)/(hits+misses);}stack_,4
end_storage;j++,k++){new_data[k]=memory[,1
t["lwu"]='I';format["jalr"]='I';//Sformatformat["sb"]='S';format["sh"]='S';format["sw",4
s"){//Printtheregistervalueswhicharestoredinthemapcout<<"R,0
torebytwintstore_byte(vector<string>instruction,intmem_loc){//Gothroughallthevaluesthattheus,2
ringbin_instr=hex_to_binary(assembly_code[instruction_no][2].substr(2));intdecimal=binary_to_decima,4
formatinstructionsvoidexecute_S(vector<vector<string>>&ass,2
segmentofthememory://Wehavetheinstructionnumberin,0
e="0000011";}elseif(assem,0
1;stack_of_func,0
));vector<int>new_data(cache[0][0].size());intstart_storage=(mem_loc/,5
art_storage=(mem_loc/block_size)*block_size;intend_storage=(mem_loc/block_s,1
.second;top_lin,0
or<string>>&assembly_code,intinstruction_no){//Handlingerrorif(assembly_code[instruction_no],2
/Concatinatingtheinstructionstringinstr=imm.substr(0,1)+imm.s,1
g>>&assembly_code,intinstruction_no){//Handlingerrorif(assembly_code[instr,0
struction);PC+=4;}instruction_file.close();//EnsurethatthePCvalueis0PC=0;i,1
ow(2,i);}}register_values[rd]=register_values[rd]&mask;register_valu,3
gerrorif(assembly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<instruction_n,3
ize()-1]==','||cur[cur.size()-1]==')'){cur.pop_back();}cur_instruction.,5
store[0]==".dw,1
=='B'){step_B(cur_instr);}elseif(format[cur_instr[0]]=='J,4
set]=val;new_data[1]=1;//Setthebittodirty}for(inti=0;i<associativity;i++){if(cache[index][i][,3
bitsandoffsetbitszer,0
on.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=,3
tringbin="";while(decimal!=0){bin.push_back(decimal%2+'0');deci,2
gisters["sp"]=this_register;}elseif(i==3){regis,2
][0].size());vector<int>new_data(cache[0][0,4
]=0;//Makethevalidbitaszero}}}elseif(!command.find("cache_simdump")){stringmyfile_out_name,2
sandtheirlastexecutedlineaccordinglystringtop,0
:"<<executed_instruction<<";PC="<<hex_PC<<endl;/,0
_tbyte[4];for(inti=0;i<4;i++),1
characters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruct,0
mmand.substr(5));current_opened_file=command.substr(5);//Thisistoremove.scur,2
nds(){load_operands.insert("lb");load_operands.insert("lh");load_operands.insert("lw");load_o,4
e,ignorecontinue;}if(cache_block[2]==tag){if(!acc,2
iontostorebytwin,0
2][1]=='x'){stringbin,1
r_write<<":Address:"<<hex_address<<",Set:"<<hex_set<<","<<hit_or_miss<<",Tag,0
exinttag_size=20-offset_size-index_size;//Andthesemanyaretagbitsboolis_dirty=false;if(replacem,0
a[2]<<(offset_size+index_size));to,2
=(i<<offset_size);for(inti=,0
alse);int8_tres=byte;register_val,0
lseif(command=="run"){//Runtheentirecodet,1
for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte,1
rdintstore_half(vector<string>instruction,intmem_loc){//Gothroughallthevaluesthattheuserhasspec,2
i,2));}uint8_tbyte[4];for(inti=0;i<4,1
if(registers.fin,0
dress=store_half(to_store,,0
}else{PC+=4;}}elseif(inst=="bgeu"){uint64_t,2
=0){for(inti=0;i<=63;i++){mask+=pow(2,i);}}register_values[rd]=register_values[r,3
t,weneedtoupdatetheord,0
nt();q.pop();dummy_q.push(cur);,3
ta_base_address);}elseif(to_store[0]==".byte"){data_base_address=store,2
fsetaswell,becaus,0
1],val_rs2=registe,0
imalvaluesif(instruction[2][1]=='x'){stringbin_instr=hex_to_binary(instruction,3
ringr){if(r=="zer,0
.insert("lbu");load_operands.i,1
"]='B';for,0
struction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Notingt,1
1"]='3';bin_to_hex["0100"]='4';bin_to_hex["0101"]='5',2
ormat["bne"]='B';format["bltu"]='B';for,2
earithmeticaccordingtotheins,0
lseif(r=="a6"||r=="x16"){r="x16";}elseif(r=="a7"||r=="x17"){r="x17";}el,4
ary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_t,4
yeverythin,0
ongsyntax,forUtypeformat,youm,0
ntdecimal=0;intlength=bin.size();//Iterateoverthebinarystringfor(inti=0;i<length;i++){/,1
=""){to_store.push_back(cur);}cur="";}else{cur.push_ba,2
hevariouspartsoftheinstructionstringopcode="0100011";stringf3=funct3[asse,0
torage=(mem_loc/block_size)*block_size+(block_size-1);cache_block[0]=1;//Thebitisnowvalidcach,3
treammyfile_out;myfile_o,0
e.c_str(),"a")!=NULL){cache_output.close();}cache,3
rehalfwordintstore_half(vector<string>instruction,intmem_loc){//Gothroughallthevaluesth,2
in_to_hex["1001"]='9';bin_to_,1
]="101";funct3["sra"]="101";funct3["addi"]="000";fun,2
ordered_map<string,char>bin_to_hex;bin_to_h,1
>register_values[rs2];}//Updatethestackoffunctionsandtheirlastexecutedlineaccording,1
ethememory//intmemory[0x50001];vector<int>memory,2
ster_values[rs1];if(inst=="lb"){int8_tbyte=re,2
>#include<string>#include<fstream>#include<unordered_map>#include<unordered_s,3
0]=1;//Theb,0
);q.pop();dummy_q.push(cur);if(cur==tag){is_present=true;},4
read_access(start_location,false);int16_tbyte1=read_access(start_locat,1
"){to_store.push_back(cur);}if(to_store[0]==".dword"){data_base_address=store,4
i=0x0;i<0x50001;i,0
c_imm<0||dec_imm>4294963200){cout<<"Errorinline:"<<in,1
or(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));,3
galooopfor(inti=a,0
ion_no][3]]-instruction_no*4);}if(registers.find(assembly_code[instruction_no][1])==registe,4
ylocationbein,0
ity:"<<associativity<<endl;cout<<"ReplacementPolicy:"<<replacement_policy<<endl;cout<<"Wri,0
red_map<string,char>bin,1
mask=offset_mask<<(offset_size);offset_mask=offset_mask-1;//Wecan,1
string,string>funct3;unordered_map<string,string>funct7;unordered_,1
+1<<endl<<"Incorrectvalueofrs1";exit(0);}elseif(stoi(assembly_code[instruction_no][3])<-pow(2,11)|,5
]=0;//Initiallynotdirtycache_block[2]=tag;for(intj=start_storage,k=3;j<=end,1
ectvalueofrd";exit(0),1
lse{hex=fs+hex;}}if(length*4<binary.size()){hex=hex.substr(binary.size()-length*4,3
erexecutionofeachrun,wecandequeuethetop,0
instrctionstringopcode="0110111";string,0
mand=="cache_simstatus"){if(cache_enabled){cout<<"CacheEnabled,1
orylocation.//Ifwedonotfindthisblockinthecache,weloadthewholebloc,0
_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(,1
bels[assembly_code[instruction_no][2]]-instr,3
<<misses<<",HitRate="<<fixed<<setprecision(3)<<,1
n_to_hex["1000"]='8';bin_to_hex["1001"]='9';bin_to_hex["1010"]=',3
){cache[i][j][0]=0;//Makethevalidbitaszero}}}elseif(!command.find("cache_simdump"),5
[rd]=register_values[rd]&mask;}}elseif(inst=="sra"){register_values[rd]=register_values[rs1]>>reg,5
inti=0;i<=63;i++){mask+=pow(2,i);}}register_value,2
hex_to_bin['3']="0011";hex_to_bin['4']=,2
=0){//memory[mem_loc]=val;//Getthevalueandthenstoretheremainingwords,criticalwordfirstploicyintstar,1
ack_policy;}else{cout<<"CacheDisab,0
"a3"||r=="x13"){r="x13";}elseif(r=="a4"||r=="x14"){r="x14";}elseif(r=="a5,3
r(instruction[2]);stringrs2=aliasRemover(instruction[3]);//Dothearithmeticac,4
em_loc;index>>=(offset_size);//Let'sgetthevalueofoffsetbitsintoffset=offset_mask&mem_,1
="x0";}elseif(r=="ra"||r==",0
f3+rd+opcode;//Nowletuswriteintothetextsegmen,0
instructionstringopcode="1100011";stringf3=funct3[assem,0
temp_mask=temp_mask<<offset_size;tem,0
x,forBtypeformat,youmustenter4operands"<<endl;exit(0),1
nst=="srai"||inst=="slli"||inst=="srli"){//Extracttherd,rs1,immvaluesrd=aliasRemover(instruc,0
{memory[mem_loc]=val;cache[index][i][1]=0;//Set,4
moved_data[1]==1){is_dirty=true;intto_store_me,1
uction_no][0]=="jalr"){opcode="110011,1
ntoffset_size=log2(block_size);//Thesemanybitsareforoffsetintindex_size=log2,1
["sw"]='S';format["sd"]='S,2
ns.push({top_of_stack,top_line});stack_of_functions.push({offset_to_label[P,2
ntoffset_mask=1;offset_mask=offset_mask<<(offset_size);offset_mask=of,1
_out_name=,0
i++){memory[to_st,0
_register];stringvalue_of_register_bin=decimal_to_binary(value_of_register_,0
i"){uint32_tshifting_amount=imm;if(shifting_amount!=0){register_va,1
byte[i];}mem_loc+=8,1
dummy_stack;stack<pair<string,int>>dummy_stack_function=sta,2
ster="x";if(i<10){charnum='0'+i;this_register+=num;}else,1
gfirst_word=executed_instruction.substr(0,pos);if(first_word.back()=,2
no+1<<endl<<"Wrongsyntax,forJtypeformat,y,0
n[2][1]=='x'){stri,2
byte"){data_base_,0
bltu"]="110";funct3["bgeu"]="111";}//Definingallfunct7val,1
_size;//Andthesemanyaretagbits//Letusnowcalculatethemaskrequiredtofindoutthetagbitslate,0
assign(0,vector<string>(,1
d,rs1andim,0
ssvectorupdate_queue(index,tag,false,mem_loc,"write",fa,0
[rs1]>>register_values[rs2];//Ourmaskisshifting_amount0'sfollowedby64-shifting_amo,2
ryboolfound=false;intval=0;for(inti=0;i<associativity;i++){vector<int>ca,1
dinglystringtop_of_stack=stack_of_fun,0
])!=load_operan,0
if(data||(instruction==".text")){//Keeptrackofhowmanylineswereusedfordatase,2
mand=="cache_siminvalidate"){if(cache_enabled){for(inti=0;i<ca,1
if(!command.find("cache_simdump")){st,2
=0;i<4;i++){write_access(mem_loc+i,byte[i],accessed_once);accessed_once=true;}}if,3
ct3["sll"]="001";funct3["srl"]="101,2
xecuted_instruction=executed_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stri,2
ex["0101"]='5';bin_to_hex["0110"],2
ound=false;intval=0;for(inti=0;i<associativity;i++){vector<int>cache_bloc,1
"x26"){r="x26";}elseif(r=="s11"||r=="x27"){r="x27";}elseif(r,3
';dummyi/=10;charnum2=dummyi%10+'0',0
che[i][j][1]==1){intoffset_size=log2(block_size);//Thesemanybitsa,4
tr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(,3
_access(start_location,false);uint,1
+){byte[i]=read_access(start_location+i,acce,1
ex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary,3
vity;vector<int>removed_data(cach,1
values[rd]=register_values[rs1]^register_v,2
removed_data[,0
iningallfunct7valuesvoidinitialize_funct7(){funct7["add"]="0000000";funct7["sub"]="0100000";funct7[",3
o_hex(bin_set,true,5);stringbin_tag=decimal_to,1
nary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<,2
ers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrd";exit(0);}elseif(st,2
ock_size+(block_size-1);new_data[0]=1;/,2
sofmemorylocationbeingrequestedbyprogramintindex=index_mask&mem_loc;in,0
s();initialize_funct3();initialize_funct7();initializ,3
t>cache_block(bl,0
_S(cur_instr);}elseif(format[cur_instr[0]]=,3
etagbitsvector<int>removed_data=cache[i][j];intto_store_mem_loc=0;//Hereth\etagandinde,3
owcalculatethem,0
manyaretagbitsvector<int>removed_data=cache[i][j];intto_store_mem_loc=0,3
ndl<<"Valueofimmediateisoutofrange";exit(0);}/,1
_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<ex,0
associativity*block_,0
he[index][i];//Valid,Dirty,tag,dataif(cache_block[0]==0){val=memory[mem_loc];//Gett,5
Valueofimmediateisouto,0
lock_size-1);new_data[0,0
endl<<"Val,0
tainthatlocation//Ifwefindthisblockinthecache,wereadonlythisparticularme,0
;register_values["x0"]=0;}//CodefortheBformatstepinstructionsvoidstep_B(vector<string>instruction),3
for(inti=0;i<4;i++){byte[i]=read_access(s,1
truction){stack_of_functions.pop();}}}elseif(command=="regs"){//Printtheregisterval,3
orderofaccessvectorupdate_queue(index,tag,false,m,0
101"]='d';bin_to_hex["1110"]='e';bin_to_hex["1111"]='f';stringhex="";for(inti=0;i<b,2
uction_no*4+i]=byte[i];}}//Cod,1
"){if(register_values[rs1]<register_values[rs2]){PC=new_pc;}else{PC+=4;}}els,4
(9,1)+imm.substr(1,8)+rd+opcode;stringhex_instruction=binary_to_hex(,2
lues[rs2];}elseif(inst=="sll"){register_values[rd]=register_values[rs1,3
}for(inti=0;i<8;i++){write_access(mem_loc+i,byte[i],accessed_once);accessed_once=tru,2
){hits++;update_queue(index,tag,false,mem_loc,"read",true,true);}returnval;//Thedatastarts,2
0];if(inst=="jal"){register_values[rd]=PC+4;PC=new_pc;}//Updatethestackoffunct,3
e0;register_values[rd]=res;}elseif,1
ontactthecacheatall.So,weneedtoprintinthecache_outputfilef,0
d_data=cache[index][i];cache[index][i]=new_data;break;}}//Nowcheckiftheremo,4
false;strin,0
uctions.push_bac,0
irty";}stringbin_set=decimal_to_binary(i,20,0);stringhex_set="0x"+binary_to_hex(bin,1
block[0]==0){val=memory[mem_loc];//Getthevalueandt,2
a"]=this_register;}elseif(i==2){registers,1
m;//Ourmaskisshifting_amount0'sfollowed,0
[rd]=register_values[rs1]<<imm;}elseif(inst=="srli"){uint32_tshifting_amount=imm;if,3
=="x21"){r="x21";}elseif(r=="s6"||r=="x22"){r="x22";}elseif(r=="s7",3
exit(0);}}}elseif(command=="run"){//Runtheentirecodetillthebreak,2
inwrongposition,bringtheoper,0
hex["0010"]='2';bin_to_he,1
tion,intmem_loc){//Gothroughallthev,0
i]=removed_data[,0
ct3["blt"]="100";funct3["bge"]="101";funct3["bltu"]="110";funct3["bgeu"]="111";}//Defining,4
}}if(length*4<binary.size()){hex=hex.substr(,1
1index,everyoneisfi,0
egisters[assembly_code[instruction_no][3]];//Concatinati,3
_to_decimal(binary_bytes[i]);//characters67,2
ingrs1=regist,0
ninstructionif,0
4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);//char,3
="1101";hex_to_bin['e']="1110";hex_to_bin['f']="1111";stringbin="";for(inti=0;,2
ue>>8;write_access(mem_loc,byte[0],false);write_access(mem_loc+1,byte[1,2
r=assembly_code[PC/4];if(format[cur_instr,1
uesintheD-cacheandwriteonlytheonceswhicharevalidfor(inti=0;i<cache.size();i++){for(intj=0;j<,1
.clear();order_of_access.resize(no_,1
of_access.clear();orde,1
natingthepartstoformtheinstructionstringinstr=imm.substr(0,,0
satvalue0PC=PC+4;register_values["x0"]=0;}//CodefortheUformatstepinstructionsvoidstep_U(,1
4;}}elseif(inst=="bne"){if(r,1
o][1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorre,2
le(PC/4<no_of_instruction){if(break_lines.find(PC/4+1)!=break,1
){int8_tbyte=read_access(sta,0
j++,k++){new_data[k]=memory[j];}removed,3
]='S';format["sh"]='S';format["sw"]='S';format["sd"]='S';//Bformatformat["beq,3
etintindex_size=log2(cache_size/(associativity*block_size));//Thesemanyareforindexinttag_size=20-,2
mem_loc;}signedmain(){//Initializealltherequiredfieldsinitialize_registers();initia,2
*block_size+(block_size,0
"<<write_back_policy;}els,0
exit(0);}imm=decimal_to_binary(s,1
ahit,weneedtoupdatetheorderofaccessvectorupdate_queue(index,tag,false,mem,0
ector<vector<int>>>cache;//Valid,dirty,tag,datai,2
){mask+=pow(2,i);}}regi,2
irstploicyintstart_storage=(mem_loc/b,0
if(instruction[2][1]=='x'){stringbin_instr=hex_to_,3
,top_line});,0
w_data[1]=0;//Initiallynotdirtynew_data[2]=tag;for(intj=start_storage,k=3;j<=end_stor,2
c/block_siz,0
n<<";PC="<<hex_PC<<endl;//Ensuretoremovethecalledfunctionfromthestackoffunctionsstack_,0
tring>instruction),0
ta_base_address=0,0
ided.intoffset,0
ack()==':'){executed_instruction=executed_instruc,1
rinttag_mask=1;tag_mask=tag_mask<<20;tag_mask=tag_,0
moved_data[3+i];}}}}if(cache_enabled){stringhit_or_mi,2
everse(bin.begin(),bin.end());,3
s=cache_size/(associativity*block_size);cache.clear();//Notethatthesizeifblocksize+3,2
i=0;i<associativity;i++){if(cache[index][i][2]==top_tag){removed_data=cache[index][i,5
Weacceptboth,0
]);stringrs1=aliasRemo,0
queue<int>dummy_q;intoffset_size=log2(block_size);//Thesemanybitsareforoffsetin,2
rrorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forUtypeformat,youmustenter3operan,0
nt>new_data(cache[0][0].size());intstart_storage=(mem_loc/block,4
ress=store_word(to_store,data_base_address);}elseif(to_store[0]==".byte"),3
r=="x26"){r="x26";}elseif(r=="s11"||r=="x27"){r="x27";}elseif(r=="t3"||r==,3
"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Notingthevariou,1
isNegative){returnbin;}//Take1'scomplementfor(inti=0;i<bin.size();i++,2
011";stringf3=funct3[assembly_code[instruction_no][0]];stringrs1=registers[assembly_code[instr,3
es[rs1]>>register_valu,1
n.substr(0,pos);if(first_word.back()==':'){executed_i,3
orecontinue;}if(cache_block[2]==tag){is_hit=true;found=true;val=ca,2
(inst=="bne"){if(register_values[rs1],2
{uint64_tval_rs1=register_values[rs1],val_rs2=register_values[rs2];if(val_rs1<va,2
_PC=decimal_to_binary(old_PC,32,0);stringhex_PC=binary_to_h,1
1]==1){is_dirty=true;intto_store_mem_loc=0;to_store_mem_loc|=(tag<<offset_size+index,0
=true;stringcache_config_file_name=comm,0
onfig_file;cache_config_file.o,0
stringimm=decimal_to_binary(st,0
+3);cache_block=cache[index][i];//Valid,Dirty,tag,dataif(cache_block[0]==0){val=memo,4
ize();hits=0;misses=0;//memory.clear();//cache.clear();for(inti=0;i<memory.,3
<assembly_code.size();instruction_no,1
cttherdandim,0
;}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);//char,4
se{PC+=4;}}elseif(in,1
_no][2]];stringimm=decimal_to_binary(stoi(assembly_code[instruction_no][3]),13,true,4
uctions[PC/4];intpos=executed_instruction.find('');stringfirst_word=exec,2
hdecimalandhexadecimalvaluesif(instructio,0
find(assembly_code[instruction_no,0
(r=="zero"||r=="x0"){r="x0";}elseif(r=="ra"||r=="x1"){r,3
ordintstore_half(vector<string>instruction,intmem_l,1
_code[instruction_no][3]]-instr,2
_operands;unordered_map<str,0
+){new_data[k]=memory[j];}removed_data=cac,3
alues[rs1]<<imm;}elseif(inst=="srli"){uint32_tshifting_amount=imm;if(shifti,2
o_hex["1101"]='d';bin_to_hex["1110"]='e';bin_to_hex["1111"]='f';stringhex="";f,3
]=='U'){step_U(cur_instr);}else{exit(0);}if(to_break){cout<<"Executionstoppedatbreakpoint\n";break;,5
tion+1,true);uint16_tres=byte1<<8|byte0;register_values[rd]=res;}elseif(,1
4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);//characters67ofhex,3
tdec_imm;//W,0
mand=="run"){//Runtheentirecodetillthebreakpoi,0
k()==':'){executed_instruction=executed_instruction.substr(pos+1);}stringbin_PC,3
eachrun,wecandequeuethetopstringinstruction;instruction_file.open(co,0
ack=stack_of_functions.top().first;inttop_line=stack_of_functions.top().second;top_line=old_PC/4+,2
acedq.push(,0
;exit(0);}//Notingthevariouspartsoftheinstrcutionstringopcod,1
st_word.back()==':'){executed_instruction=executed_instruction.substr(pos+1);}stringbin_,3
ng>binary_bytes(4);for(inti=0;,1
rmat["jal"]='J';//Uformatformat["lui"]='U';}//Keepi,2
ster_values[rs1]>=r,1
lastlineisexecuted,thenensuretopopmainfromthestackif(PC/4==no_of_instruction){stack_of,1
//Setittonon-dirty}//Sincethisahit,weneedtoupdatetheorderofaccessvectorupdate_queue(index,tag,,0
ut<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs1";exit(0);,1
elseif(i>=5&&i<=7){stringtemporary_register_no=,0
;}elseif(r=="tp"||r=="x4"){r="x4";}elseif(r=="t0"||r=="x5"){r="x5";}elseif(r=="t1"||r=="x6",4
ngbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<,2
tbreak_point=stoi(command.substr(10));//Wedeletethebreakpointif(break_,2
oadthewholeblockfromthememoryboolfound=false;intval=0;,0
y(stoi(assem,0
tringfirst_word=executed_instruction.substr(0,pos);if(first_word.back()==':'){executed_instruction=,3
on_no][2][1]=='x'){st,2
ck<pair<string,int>>dummy_stack_function=stack_of_functions;while(!,2
ntegerintstart_location=imm+register_values[rs1];if(inst=="lb"){int8_tbyte=read_a,2
r=="s4"||r=="x20"){r=",0
+hex_PC;cout<<"Executed:"<<,0
[i].size();j++){cache[i][j][0]=0;//Makethevalidbitaszero}}}elseif(!command.fi,6
ct7["srl"]="0000000";funct7["sra"]="0100000";}//Definingtheformatofvariousinstructi,2
ines.end()){break_lines.erase(break_point-count_how_many_to_skip);co,2
on_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrd";e,2
,write_back_policy;boolcache_enabled=false;vector,0
dtheirlastexecutedlineaccordinglystringtop_of_stack=stack_of_functions.top().first;inttop_line=st,1
BlockSize:"<<block_size<<endl;cout<<"Associativity,0
dbyourcode#definestoistoll#defineintlonglongusingname,0
dex_size;//Andthesemanyaretagbits//Letusnowcalc,0
tring>binary_bytes(4);for(inti=0;i<4;i++){,1
st_word=executed_instruction.substr(0,pos);if(first_word.back()==':'){executed_instruction=executed,3
=".byte"){data_base_address=,0
=memory[j];}removed_data=cache[index][random_number];cache[index][random_numb,4
e();i++){if(tri,1
_loc/block_size)*block_siz,0
irtycache_block[2]=tag;for(int,1
ctions[old_PC/4];intpo,1
thenextfileinitialize();hits=0;misses=0;//memory.clear();//ca,2
struction);stringcur="";for(inti=0,0
if(!found_invalid){val=memory[mem_loc];update_queue(index,2
reyoucanwritetonextreturnmem_loc;}//Functiontostorewordintstore_word(vector<,0
lock;returnval;}}//Ifwewerenotablet,0
,1fordirtythenblocksizeforthenumberofbytesinthecachedatacache.assign(no_of_indexes,vecto,0
else{//Firstcheckifwehaveaninvalidframe,andifwedo,thenwecandirectlyaddourvaluetoit,0
bin.end());if(!isSigned||!isNegative){retu,2
1]==1){is_dirty=true;intto_store,0
hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=he,4
acters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=,1
a[k]=memory[j];}if(operation=="write",2
abels.find(assembly_code[instruction_no][3])==labels.end()){cout<<"Errorinline:"<<i,4
=executed_instruction.substr(pos+1);}stringbin_PC=decima,1
dex_mask^temp_mask;//Makesthepositionsofoffseybitszero//Weneedtodothisfortheoffsetaswell,b,0
pty()){intcur=q.front();q.pop();du,3
stoformtheinstructio,0
"WriteBackPolicy:"<<write_back_policy;}else{cout<<"CacheDisabled";}}elseif(command=="cach,0
ask=index_mask^temp_,0
_name);cache_config_file>>cache_size>>block_size>>associativity>>replacement_,0
nglyregister_values[rd]=PC+4;PC=imm+register_values[rs1];}//Ens,2
uction=all_instructions[PC/4];intpos=executed_instruc,1
akpointif(break_lines.find(break_point-count_h,0
ize_funct7(){funct7[,1
ringhex_PC=binary_to_h,0
true;}int32_tre,0
;//Initiallynotdirtynew_data[2]=tag;for(intj=start_storage,k,1
functions.top().first;inttop_line=stack_of_functions.top().second;top_line=PC/4+1,2
struction[3]);}assembly_code.p,1
stringsvector<string>cur_instruction;all_instr,1
1=dummyi%10+'0';dummyi/=10;charnum,0
tart_storage=(mem_loc/block_size)*block_size;intend_storage=(mem_loc/block_size)*block_siz,2
eddatano?t,0
rinline:"<<instruction_no+1<<endl<<"I,0
che[index][i];cache[index][i]=new_data;bre,4
k,top_line});stringexecuted_instruction=all_instructions[old_PC/4];intpos=exe,1
indexes=cache_size/(associativity*bl,0
}found=true;cac,0
e+(block_size-1);new_data[0]=1;//Thebitisnowvalidnew_data[1]=0;//Initiallynotdirty,3
ctvalueofrs2";exit(0);}elseif(registers.find(assembly_code[instruction_no][2])==registers.end()){,6
++;}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_loc;}signedmain,0
;inttop_line=stack_of_functions,0
+imm;}else{if(stoi(assembly_code[instruction_no][3])<-pow(2,11)||stoi,4
lues[rd]=register_values[rs1]>>imm;//Ourmaskisshifting_amount0'sfollowedby64-shifting,2
t=="sub"){register_values[rd]=register_val,1
cache_enabled){for(inti=0;i<cache,0
ndl<<"Valueofimmediateisoutofrange";exit(0);}//Notingthevariouspartsoftheinstructionstr,1
ns;while(!dummy_stack_function.empty()){dummy_stack.push_back(dummy_stack_function.top());dummy_,4
it,weneedtoupdatetheorderofaccessvectorupdate_queue(index,tag,false,mem_loc,"write",false,true,0
ntax,forBtypeformat,youmustenter4operands"<<endl;ex,0
1]==1){is_dirty=true;intto_store_mem_loc,0
ex_PC="0x"+hex_PC;co,0
removed_data[1]==1){is_,1
4;i++){binary_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8,4
truction=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes,3
instruction_no][,0
bels[cur]=PC;offset_to_label[PC]=cur;cur="";continue;}if(c,2
index][i][2]==top_tag){removed_data=cache[index][i];cache[index][i]=new_data;break,6
swillhandleinitializinganyusedvariablesthat,0
oc+i]=removed_data[3+i];}}}}}//Hereweneedtoensureth,1
eue(intindex,inttag,boolto_replace,intmem_loc,stringoperation,bo,0
a[k]=memory[j];}removed_data=cache[index][random_number];cache[index][random_num,5
Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//UpdatePCvaluePC+=4;}elseif(inst=="jalr"){//,1
e();i++){uint64_tstore_value=stoi(instruction[i]);vector<,3
sed_once){hits++;update_queue(index,tag,false,mem_loc,"read",true,true);}returnval;//Thedat,2
++){memory[mem_loc+i]=byte[i];}mem_loc+=8;}//Returnt,3
oi(assembly_code[instruction_no][3])<-pow,3
f(r=="zero"||r=="x0"){r="x0";}elseif(r=="ra"||r=="x1"){r="x1";}elseif(r=="sp"||r=="x2"){r="x2";}els,6
^register_values[rs2];}elseif(inst=="sll"){register_values[r,2
isblockinthecache,weloadthewholeblockfromthememoryboolfound=false;intval=0;for(inti=0,0
he[i][j][k]=0;}}}assembly_co,3
f(inst=="srai"){register_values[rd]=register_values[rs1]>>imm;}//Update,4
_instruction=executed_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex,2
-1]==':'){cur.pop_,0
of_functions.pop();stack_of_functions.push({top_of_stack,,1
ta[k]=memory[j];}removed_data=cache[index][random_number];cache[,4
ormat["jal"]='J';//Uformatformat["lui"]='U';}//Keepingtrackofalllaodoperandsvoidinitial,2
eu"]='B';//Jformatformat["jal"]='J';//Uformatformat["lui"]='U';}//Keepingtrackofallla,2
oveddatano?to_store_mem_loc|=(removed_data[2]<<(offset_size,1
nt();dummy_q.pop();q.push(cur);}//Notethatheretagwillalwaysbeattheto,3
helinenumberwherewehavetoinsertabreakpointintbreak_point=stoi(command.substr(6));/,2
ion.substr(pos+1);}stringbin_PC=deci,1
;vector<queue<int>>order_of_access;ofstreamcache_output;//Dec,2
.text"){data=false;}else{//Storetherequireddword/word/byte/halfwordvector<string>to_store;str,2
ncatinatingtheinstructionstringinstr=f7+rs2+rs1+f3+rd+opcode;//Nowletus,0
tions.top().second;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.p,2
isters.find(assembly_code[instruction_no][1])==registers.end()){cout<<"Errorinl,4
_store;stringcur="";for(charc:instruction){if(c==''||,1
ct3["bge"]="101";,1
;i++){byte[i]=read_access(start_location+i,accessed_once);accessed_once=true;}in,3
_instruction[0,0
tor<string>binary_,1
sk=tag_mask^temp_mask;/,0
e)*block_size;intend_storage=(mem_loc/block_size)*block_size+(bloc,1
{is_dirty=true;intto_store_mem_loc=0;//herethetagandinde,0
);j++){if(cache[i][j][0]==1){stringis_clean="Cle,4
==':'){executed_instruc,0
(removed_data[2]<<(offset_size+index_size));to_store_mem_loc|=(index,2
eaccordinglystringtop_of_stack=stack_of_functions.top().firs,1
enotabletofindanyinvalidblock,weneedtoapplyreplace,0
1=registers[assembly_code[instruction_no][2]];strin,3
aysstoresaddressesinformofintegerintstart_location=imm+reg,0
fwedidnotfindthevalue,weneedtolookinthememoryif(!found){if(!accessed_once){misses++;if(write_ba,2
dirtycache_block[2]=tag;found_invalid=true;update_queue(index,tag,false,mem_loc,"write",fals,1
ue);}returnval;//Thedatastartsfromind,0
;vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex,3
]+register_values[rs2];}elseif(inst=="sub"){regis,2
ng>offset_to_label;unordered_map<string,int,0
//Initiallynotdirtycache_block[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++),1
tion_no+1<<endl<<"Wrongsyntax,forBtypeformat,yo,0
y_code[instruction_no][0]];stringrs1=re,2
inline:"<<in,0
sembly_code[instruction_no][3]),6,true);imm="010000"+imm;}else{if(stoi(ass,2
urmaskisshifting_amount0',0
binarystringtodecimalintbinary_to_decima,0
}elseif(inst=="lbu"){uint8_tbyte=read_access(start_location,false);uint8_tres=byte;register_valu,2
e);}if(inst=="sw"){boolaccessed_on,1
emem_locfor(inti=1;i<instruction.size();i++){,1
2));intdecimal=binary_to_decimal(bin_instr);dec_imm=decimal;},1
n_to_hex["1100"]='c,1
D-cachestatistics:Accesses=,0
_no]=this_register;}elseif(i=,0
ck_of_functions.pop();stack_of_functions.p,1
_tmask=(1U<<(64-shifting_amount))-1;if(shifting_amount==0){for,2
p_of_stack=stack_of_functions.top().first;,1
thelinesthatareoccupiedbythedatasectio,0
ss";stringclean_or_dirty="Clean";stringread_or_write="W";if(is_hit){hit_or_miss="Hit";}if(is_dir,2
=''){continue;}else{trim=false;trimmed_instr.push_back(instruction[i]);}}instruction=trimmed_ins,4
tructionsvoidstep_S(vector<string>instruction){//Extractthe,2
rs2];if(val_rs1>=val_rs2){PC=n,1
.top().first;inttop_line=,1
ask=temp_mask<<(index_size+offset_size);temp_mask=temp_mask-1;tag_mask=tag_mask^temp_mask;//Mak,1
"]="110";funct3["bgeu"]="111";}//Definingallfunct7valuesvoidinitialize_funct7(){funct7["add,2
;for(inti=0;i<memory.size();i++){m,1
==0){//Thisisaninvalidframe,ignorecontinue;}if(cache_block[2]==tag){if(!accessed_once){hits++;}f,5
on_no].size()!=4){cout<<"Errorinline:"<<instruction_no,1
and()%associativity;vector<int>r,2
rue;}}while(!dummy,0
false;intbreak_point_line_to_remove;if(PC/4==no_of_instruction){cout<<"Nothingtostep\n";}e,1
out<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forJtypeformat,youmustenter3operands"<<en,0
{val=memory[mem_loc];//Getthevalueandthensto,1
"){boolaccessed_once=false;vector<uint8_t>byte(4);for(inti=0;i<4,2
>(block_size+3,0)));//I,1
<<"CallStack:\n";//Weuseadummystacktopopthelabelsfromthemainstackand,0
rue;update_queue(index,tag,false,mem_loc,"write",false,false,val);c,1
ssed_once=true;}uint32_tres=byte[3]<<24|byte[2]<<16|byte[1]<<8|byte[0],4
().first;inttop_line=stack_of_functions.top().second,2
top_tag){removed_data=cache[index][i];cache[index][i]=new_data;break;}}//Now,5
n="Dirty";}stringbin_set=decimal_to_binary(i,20,0);stringhex_set="0x"+binary_,1
ting_amount))-1;if(shifting_amount==0){for(inti=0;i<=63;i++){mask+=pow,1
l<<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_to_binary(stoi(assembly_code[instruction_no],2
_policy>>write_back_policy;//Iftheassociativity=0,thenweneedtomake,0
";hex_to_bin['5']="0101",1
omtheright}}returndecimal;}//Definingallregistersvoidinitialize_registers(){for(int,1
_size+(block_size,0
e{cur.push_back(c);}}if(cur!=""){to_store.push_back(cur);}if(to,5
ttag=tag_mask&mem_loc;tag>>=(index_size+offset,0
rst;inttop_line=stack_of_functions.top().second;top,1
ck()==':'){executed_instruction=executed_instruction.substr(p,1
ister_values[rs2];}elseif(inst=="and"){reg,2
ction_no+1<<endl<<"Wrongsyntax,forRtypeformat,youm,0
tedlineaccordinglystringtop_of_stack=stack_of_funct,0
cuted_instruction.substr(0,pos);if(first_word.back()==':'){executed_instruction=e,3
bin;hex_to_bin['0']="0000";hex_to_bin['1']="0001";hex_to_bin['2']="0010";hex_to_bin['3',3
t=="slli"){register_values[rd]=register_values[rs1]<<imm;}elseif(inst=="srli"){uint32_ts,3
ngforlocationspecifiedbythemem_locfor(inti=1;i<instruction.size();i++){uint64_tstore_valu,1
rd(to_store,data_base_address);}elseif(to_store[0]==".half"){data_ba,3
esimulatorcout<<"Exitedthesimulator";break;}elseif(!command.find(",0
inghex_set="0x"+binary_to_hex(bin_set,true,5);stringbin_tag=decimal_to_binary(cache[i][j][2],4
ocwhereyoucanwritetonextreturnmem_loc;}//Functiontostorebyt,0
e();}elseif(command=="cache_siminvalidate"){if(cache_enabled){for(inti=0;i<cache.size();i++){for(int,4
val;new_data[1]=1;//Setthebittodirt,1
ndex][i];//Valid,Dirty,tag,dataif(cache_block[0]==0){val=memory[mem_loc,3
format["jalr"]='I';//Sformatformat["sb"]='S,2
truction=assembly_code.size();if(PC/4==no_of_instruction){cout<<"Nothingtost,2
}elseif(r=="a0"||r=="x10"){r="x10";}elseif(r=="a1"||r=="x11"){r="x11";}elseif(r=="a2,4
="andi"||inst=="srai"||inst==",0
string>cur_i,0
ction_no][1])==registers.end()){cout<<,2
m="000000"+imm;}elseif(assembly_code[instruction_no][0]=="srai"){if(stoi(ass,3
if(format[assembly_code[instructi,0
register_values[rd]=registe,1
valuevector,0
o][0]]=='I,1
!command.find("break")){//Weparsethestringtogetthelinenumberwher,1
executed_instruction<<";PC="<<hex_PC<<endl;//UpdatethePCandkeepx0valueat0PC=PC+4;register_va,0
];memory[mem_loc+1]=byte[1];mem_loc+=2;}//Returnthenewmem_locwhereyoucanwritet,2
string,string>registers_alis;vector<string>all_instructions;unordered_map<int,string>offset_to_la,2
orethemstartingforloca,0
nstruction_no][1])==registe,1
x_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC,1
);}if(inst=="sw"){boolaccessed_once=f,1
5);cache_output<<"W"<<":Address:"<<hex_ad,0
x"+binary_to_hex(bin_set,true,5);stringbin_tag=deci,1
reachreturn-1;}//CodefortheRformatstepinstructionsvoidstep_R(vector<string>instructio,1
,viabinaryrepresentationstringbin_s_addr=hex_to_binary(s_addr);intaddr=binary_to_decim,1
=false;vector<vector<vector<int>>>c,3
binary_to_hex(stringbinary,booltrim=fa,0
lude<queue>#include<random>#inc,2
truction.substr(pos+1);}stringbin_PC=decimal_to_binary(old,1
e=(mem_loc/block_size)*block_size+(block_size-1);cache_block[0]=1;//,3
x_PC<<endl;//UpdatethePCvalueandensurethatx0willalwaysremainatvalueof0PC+=4;reg,0
f(cache_enabled){for(inti=0;i<cache.size();i++){for(intj,2
dom_number];cache,0
ordinglystringtop_of_stack=stack_of_functions.top(,0
s.push({top_of_stack,top_line});stac,2
6_tbyte0=read_access(start_location,false);int16_tbyte1=read_access(start_location+1,true,1
ndex][i]=cache_block;returnval;}}//Ifwewerenotabletofind,1
_block[3+offset];,1
,Tag:"<<hex_tag<<","<<",0
;vector<uint8_t>byte(4),2
fstrings,suchthatafterexecutionofeachrun,wecandequeuethetopstringinstruction;instru,0
accessed_once=false;for(inti=0;i<8;i++){byte[i,0
instruction=executed_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_,2
on_no);}elseif(format[assembly_code[instruction_no][0]]=='U'){execute_U(assembly_code,in,4
nabled=tru,0
(!dummy_q.empty()){intcur=dummy_q.front();dummy_q.pop();q.push(cur);}if(!is_present){q.push(tag);}},9
ster_values[rs2];if(shifting_amount!=0){register_values[rd]=register_values[rs1]>>register_v,4
ultimatelythisfunctionhastoreturnonly1byteintoffset_mask,0
ut;myfile_out.open(myfile_out_name),1
malandhexadecimalvaluesif(instruction[2][1]=='x'){str,3
ound){if(!accessed_once){misses++;}//Firstcheckifwehaveaninvalidframe,andi,2
aryrepresentationstringbin_s_add,0
format["sra"]='R';//Iformatformat["addi"]=,2
}//Updatethestackoffunctionsandtheirlastexecutedlineaccordinglystring,0
t1'suint64_tmask=(1U<<(64-shifting_amount))-1;i,1
n_no);}elseif(format[assembly_code[instruct,0
nstruction_no][2]);}if(dec_imm<0||dec_imm>4294963200){cout<<"Errorinline:"<<instruction_no+1<<end,3
back(cur);}cur="";}else{cur.push_back(c);}}if(cur!=""){to_store.pu,4
/Iftheinstructionisdata,thenensurethatuntilwesee.text,wekeepstoringdataif(instruction==".data"){d,1
valueofrd";exit(0);}elsei,1
nsat0register_values["x0"]=0;}//CodefortheSformatstepinstructionsvoidstep_S(vector<string>in,2
(break_lines.find(break_point-count_how_many_to_skip)!=break_lines.end()){break_lines.erase(break_,3
c]=val;}}intread_access(intmem_loc,boolaccessed_once){if(cache_enabl,1
iveif(associativity==0){//Thismeansthatthereisonly1index,everyoneisfightingfo,1
instruction.size();i++){uint64_tstore_value=st,1
d_instruction.find('');stringfirst_word=executed_instruction.substr(0,pos);i,2
abels[assembly_code[instruction_no][3]]-instru,3
struction.find('');stringfirst_word=executed_instruction.substr(0,pos);if(first_word.back()==':'),4
cation,false);ui,0
an_or_dirty="Clea,0
uction){cou,0
-pow(2,12)||stoi(assembly_code[instruction_no][3])>=pow(2,12)-1){cout<<"Error,5
index_size;//Andthesemanyaretagbits//Letusnowcalculatethemaskrequiredt,0
xecutedlineaccordinglystringtop_of_stack=stack_of_f,0
{assembly_code[instruction_no][3]=to_string(labels[assembly_code[instruction_no,2
<endl;}}elseif(command=="ex,0
tyfor(inti=0;i<cache.size();i++){for(intj=0;j<cache[i].size();j++){cache[i][j][0]=,6
rl"]="101";funct3["sra"]="101";funct3["addi"]="000";funct3["xori"]="100";funct,3
laythememorystrings_co,0
//Gothroughallthevaluesth,0
hex["0110"]='6';bin_to_hex["0111"]='7';bin_to_hex["1000"]='8';bin_to_hex[",3
=false;intval=0;for(inti=0;i<associativity;i++){vector<int>cache_block(,1
ftext(.text)count_how_many_to_sk,1
=temp_mask<<(index_size+offset_size);temp_mask=temp_mask-1,1
ction_no+1<<endl<<"Valueofimmediateiso,0
Wehavetheinstructionnumberinthevariableinstruct,0
x'){stringbin_instr=hex_to_binary(instruction[2].substr(2));intdecimal=binary_to_decimal(bin_instr);,4
ormatstepinstructionsvoidstep_R(vector<string>instruction){//Extractrd,rs1,rs2stringinst=instruction,2
_file.close();,1
to_binary(hex_instr,0
fitiswritethorugh,wejustwritetomemorywithoutbotheringtoddoanythinginthecacheif(write_back_policy=="W,0
funct3["sb"]="000";funct3["sh"]="001";funct3["sw"]="010";funct3["sd"]="011";funct3["beq"]=,5
++){byte[3-i]=store_value>>(3-i)*8;}for(inti=0;i<4;i++){write_access(mem_loc+i,byte[i],accessed_onc,4
.second;top_line=old_PC/4+1;stack_of_fu,0
dcout<<"CallStack:\n";//Weuseadummystacktopopthelabelsfr,0
rixif(load_operands.find(cur_instruction[0])!=lo,2
his_register;}elseif(i>=28&&i<=31){stringtemporary_register,0
Storetherequireddword/word/byte/halfwordvector<string>to_store;str,1
eue<int>>order_of_access;ofstreamcache_output;//Declarethevariousmap,1
=memory[j];}if(operation=="wr,1
);j++){cache[i][j][0]=0;//Makethevalidbitaszero}}}elseif(!command.,4
[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);//characters67ofhex_inst,4
";}elseif(r=="t1"||r=="x6"){r="x6";}elseif(r=="t2",2
[instruction_no][3],2
kesthepositionsofoffseybitszero//Weneedtodothisfortheo,0
PC/4==no_of_instruction){stack_of_functions.pop();}}}elseif(command=="regs"){//Printtheregis,3
(){//Rformatformat["add"]='R';format["sub"]='R,3
bythemem_locfor(inti=1;i<instruction.size();i++){uint64_tstore_value=stoi(instruction[i]);,3
ffsetbitszero//Letusdothesam,0
=':'){executed_instruction=executed_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,,2
byte(to_st,0
nd;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,top,1
ag_size=20-offset_size-index_size;//Andthesemanyaretagbitsboolis_dirty=false;if(replacement_,0
GothroughallthevaluesintheD-cacheandwriteonlytheonceswhicharevali,0
,false,val,offset);}}}}else{memory[mem_loc]=val;}}intread_access(intmem_loc,bool,2
="s0"||r=="fp"||r=="x8"){,0
r=="t4"||r=="x29"){r="x29";}elseif(r=="t5"||r=,1
ary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<exe,1
untofthenumberofmemorylocationswehavetodisplayboolcheck_space=false;//Wenowextr,0
n,intmem_loc){//Goth,0
,youmustenter4operands"<<endl;exit(0);}if(labels.find(asse,1
n=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_b,3
ory[instruction_no*4+i]=byte[i];}}//Co,2
ction_no][1]];stringimm=decimal_to_binary(stoi(assembly_code[instruction_no][3]),12,4
"]="101";funct3["sra"]="101";funct3["addi"]="000";funct3["xori"]="100";funct3["ori"]="1,4
"x26"){r="x26";}elseif(r=="s11"||r=="x27"){r="x27";}elseif(r=="t3"||r=="x28"){r="x28";}elseif(r==",5
rstfigureouthowour20bitsofmemoryaddressaredivided.intoffset_siz,0
{opcode="0010011";}//Notin,1
e,false,val,offset);}}},0
sembly_code[inst,0
]]=='R'){execute_R(assembly_code,instruction_no);}elseif(format[assembly_code[instru,2
tructionstringopcode="1100011";stringf3=funct3[assembly_code[instruction_no][0]];stringrs1=registe,3
ap<char,string>hex_to_bi,1
r_values[rs2];if(val_rs1<val_r,1
g_size=20-offset_size-index_s,0
ntbyparsingthelinefor(inti=4;i<comman,0
;}voidupdate_queue(intindex,inttag,boolto_replace,intmem_loc,stringoperation,boolis_r,0
0;i<4;i++){byte[3-i]=store_value>>(3-i)*8;}for(inti=0;i<4;i++){memory[mem_loc+i]=byte[i];}mem_,6
ion_no);}elseif(format[assembly_code[instruction_no][0]]=='J'){execute_J(assembly_code,instruction_,4
x"+hex_PC;cout<<"Executed:"<<e,0
gsvector<string>cur_instruction;all_instructions.push_back(instruction);stringcur="";f,2
"andi"){register_values[rd]=register_values[rs1]&imm;}elseif(i,3
i==1){registers["ra"]=this_register;}elseif(i==2){registers["sp"]=this_register;,4
"){r="x20";}elseif(r=="s5"||r=="x21"){r="x21";}elseif(r=="s6"||r=="x22"){r="x22";,4
isable"){cache_enabled=false;cache_output.close();}elseif(command=="cache_siminvalidate"){if(cache_,3
uction=execu,0
mmyi/=10;charnum2=dummyi%10+'0';this_register+=num2;t,0
tionsvoidexecute_U(vector<v,0
essed_once){if(cache_enabled){boolis_hit=false;//Letusfirstfigureouthowour20bitsofmemoryaddressare,1
f(register_values[rs1]>=register_value,1
dexecute_S(vector<vector<string>>&assembly_code,int,2
);}if(inst=="sw"){boolaccessed_once=false;vector<uint8_t>byte(4);f,3
ing>offset_to_label;unordered_map<string,int>last_exected_line;stack<pair<string,int>,2
clear();all_ins,1
["x0"]=0;}//CodeforRformatinstructionsvoidexecute_R(vector<vector<string>>&assembly_code,intins,3
rt_location,false);int8_tres=byte;register_values[rd]=res;rd=r,1
liasRemover(instructi,0
to_binary(tag,20,,0
nstruction_no][3])<0||,1
ctor<string>instruction){//Storethenewpcvaluetojumptoin,1
nctiontoconvertbinarystringtodecimalintbinary_to_deci,0
|inst=="srai"||ins,0
loc){//Gothroughallthevaluesthattheuserhasspecifi,0
vector<string>instruction){//Storethenewpcvaluetojumptointnew_pc,1
ntoffset_mask=1;offset_mask=offset_mask<<(offset_size);offset_mask=offset_mask-1;//,1
t3["lbu"]="100";funct3["lhu"]="101";funct3["lw,2
har>format;unordered_set<string>load_operands;unordered_map<strin,1
r(inti=0;i<associativity;i++){if(cache[index][i][2]==top_tag),4
){registers["tp"]=this_register;}elseif(i>=5&&i<=7){stringtemporary_register_no="t";,2
ion[i]);vector<uint8_t>byte(4);for(inti=,3
x["0001"]='1';bin_to_hex,1
_once){misses++;if(write_back_policy=="WT"){stringbin_address=decimal_to_binary(m,1
ions[PC/4];intpos=executed_instr,1
='R'){step_R(cur_instr);}elseif(format[cur_instr[0]]=='I'){step_I(cur_ins,5
ster_values[rs1]>>register_values[rs2];//Ourmaskisshifting_amount0'sfollowed,2
_loc){//Gothroughallthevaluesthattheuserhasspecifiedandstorethemstartingforlocati,0
ers.end()){cout<<"Errorinline:"<<instru,1
in[i]='0';}returnbin;}//Functionto,1
setbitsintoffset=offset_mask&mem_loc;//Wenowhavetheindexandtagwewant.Wecanpro,0
ngfirst_word=executed_instruction.substr(0,pos);if(first_word.back()==':'){executed_instructi,3
;PC="<<hex_PC<<endl;//Ensur,0
positionsofoffseybitszero//Weneedtodothisforthe,0
instruction_no][2]]-instruction_no*4);}if(registers.find(assembly_code[instructio,1
=cache[index][i];//Valid,Dirty,tag,da,2
t<<read_or_write<<":Address:"<<hex_address<<",Set:"<<hex_set<<","<<hit_or_miss<<",Tag:"<<h,0
;stringexecuted_instruction=all_instructions[PC/4];intpos=executed_instruction.find('');str,2
ion[3]);}assembly_code.push_back(cur_instruction);PC+=,2
ryspacefromthebeginningofanylinebooltrim=true;s,0
te="R";}stringbin_address=decimal_to_binary(mem_loc,20,0);stringhex_address="0x"+bi,1
PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed,1
te_queue(intindex,inttag,boolto_replace,intmem_loc,stringoperation,boolis_read,boolis_hit,in,0
e=command.substr(15);ofstreammyf,1
fhowmanylineswereusedfordatasegmentandth,0
hex_instruction}for(inti=0;i<4;i++){mem,0
urn-1;}//Codef,0
lude<stack>#include<queue>#include<random>#include<iomanip>#inclu,4
(3)<<(doub,1
size-index_size;//Andthesema,0
format["sh"]='S';format["sw"]='S';format["sd"]='S';//Bformatformat["beq"]='B';f,4
gisters[argum,0
back(command[i]);}}s_addr=s_addr.substr(2);//W,3
;getline(cin,com,0
rorinline:"<<instru,0
erhasspecifiedandstorethemstartin,0
his_register;}elseif(i==9){registers["s1"]=this_register;}elseif(i>=10&&i<=1,3
li"]='I';format["srai"]='I';format["ld"]='I';format["lw"]='I';format["lh"]='I';,4
substr(0,pos);if(first_word.back()==':'){exec,3
7+rs2+rs1+f3+rd,0
tainthits=0,misse,0
<<endl;}else{cout<<"Nobreakpointspresent\n";}}elseif(!command.find("break")){//Weparsethestr,2
mediatevaluerd=aliasRemover(instruction[1]);rs1=aliasRemover(instru,2
0onesinttemp_mask=1;temp_mask=temp_mask<<(index_size+offset_size);temp,1
a[0]=1;//Thebitisnowvalidnew_data[1]=0;//Initiallynotdirtynew_data[2]=tag;for(intj,3
ythemem_locfor(inti=1;i<instruction.size();i++){uint64_tstore_value=s,1
register_values[rs1]&reg,1
{if(break_lines.find(PC/4+1)!=break_lines.end()){break;//to_break=true;}vector<string>cur_instr=,5
ringf3=funct3[as,0
sstringinstr=imm+rs1+f3+rd+opcode;stringhex_instruction=binary_to_hex(instr);vector<stri,1
_map<string,char>bin_to_hex;bin_t,1
x(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC=",1
hichweneedtoreplaceq.pop();//Popthevaluewhichisreplacedq.push(tag);//P,2
,true);imm="010000"+imm;}else{if(stoi,0
inary_to_hex(bin_mem_val,true,2);intmem_loc=i;stringme,1
x){unordered_map<char,string>hex_to_bin;hex_to_bin['0']="0000";hex,2
string>instruction,intmem_loc){//Gothroughallthevaluesthattheuserhasspecified,0
ion[3]);//Weassumet,1
valid=false;for(inti=0;i<associativity;i++),0
0,0);stringhex_set="0x"+binary_to_hex(bin_set,true,5);stringbin_,1
ackPolicy:"<<write_ba,0
rds,criticalwordfirstploicyintstart_storage=(mem_loc/block_size)*block_,1
formatstepinstructionsvoidstep_I(vector<string>instruction){stringrd,rs1,inst;inst,2
cuted_instruction=executed_in,0
chisreplacedq.push(tag);//Pushthenewtagvaluevector<int>re,2
1;offset_mask=offset_mask<<(offset_size);offset_mask=offset_mask-1;//W,1
="<<hex_PC<<endl;//UpdatePCvaluePC+=4;}elseif(i,0
dlineaccordinglystringtop_of_stack=sta,0
){r="x17";}elseif(r=="s2"||r=="x18"){r="x18";}e,3
_of_instructio,0
sk^temp_mask;//Makesthepositionsofindexbitsandoffsetbitszer,0
"001";funct3["sw"]="010";funct3["sd"]="011";fu,2
nd=="cache_siminvalidate"){if(cache_enabled){for(inti=0,1
(2,6)){cout<<"Errorinline:"<<instruct,1
"||inst=="s,0
instr);vector<string>binary_bytes(4);for(inti=0;i<4,2
substr(1,8)+rd+opcode;s,1
xinttag_size=20-offset_size-index_size;//Andthesemanyaretagbits//Letusnowcalculatethemaskr,0
ess[index];que,1
]=byte[i];}}//CodeforUformatinstructionsvoidexecute_U(,1
,string>offset_to_label;unordered_map<string,int>last_exected_line;stack<pair<string,int>>stack_,3
hit_or_miss<<",Tag:"<<hex_tag<<","<<c,0
cache_output_name;//Infiniteloopthatreadsuserin,0
ichwehavetodisplaythememoryst,0
e);int8_tres=byte;register_values[rd]=res;rd=res;}elseif(inst=="lh"){int16_tbyte0=read_,2
ing_amount==0){for(inti=0,0
y[mem_loc]=by,1
ememoryif(!found){if(!accessed_once){miss,2
inti=0;i<memory.size();i+,1
output_name;//Infiniteloopthatreadsuserinputswh,0
+hex_PC;cout<<"Executed:"<,0
stringcache_config_file_name=command.substr(17);ifstreamcac,1
;//Setthebittodirty}for(inti=0;i<associativity;i++){if(cache[index][i][2]==top_tag){removed_data=c,4
tpos=executed_instruction.find('');stringfirst_word=executed_instruction.substr(0,,1
]="0000000";funct7["srl"]="0000000,1
ll_instructions[old_PC/4];intpos=executed_instruction.find('');string,2
0;}stringaliasRemover(stringr){if(r=="zero"||r=="x0"){r="x0";}elseif(r=="ra",3
bereached}else{//Firstc,0
false;for(inti=0;i<,0
e.close();//EnsurethatthePCvalueis0PC=0;if(cache_enabled){if(fopen(cache_output_name.c_st,2
#definestoistoll#defineintlonglongusingnamespacestd,0
ecuted_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_,2
ter_values[rd]=register_values[rd]&mask;register_values[rd]&=mask;}}elseif(inst==,3
al;cache[index][i][1]=,3
etuswriteintothetextsegmentofthememory://Wehavetheinstruc,0
ude<cstdlib>#include<math.h>#include<sstream>#include<stac,3
(inst=="srli"){uint32_tshifting_amou,1
ep_S(vector<string>instruction){//Ex,2
nct3["sub"]="000";funct3["and"]="111",2
2"||r=="x12"){r="x12";}elseif(r=="a3"||r=,1
che_block[0]=1;//Thebitisnowvalidcache,1
struction_no][0]]=='U'){execute_U(assembly_code,instruction_no);}else{cout,3
assembly_code.size();boolto_break=false;intbreak_,1
/Thesemanybitsarefo,0
m,20,true);//Concatinatingtheinstructions,0
f(cur!=""){if(cur[cur.size()-1]==','||cur[cur.,3
ndstorethemstartingforlocationspecifiedbythemem_locfor(inti=1;i<instructio,0
0000";funct7[,0
al(binary_bytes[i]);//characters67ofhex,2
_stack=stack_of_f,0
inst=="beq"){if(regi,0
t(0);}elseif(registers.find(assembly_code[instru,1
1;//Thebitisnowvalidcache_block[1]=0;//Initiallynotdirtycache_block[2]=tag;for(intj=start,2
k-1;//Wecannowgettheactualvalueoftagbitsinth,0
ndl<<"Valueofimm,0
tag<<","<<"Clean",0
>=(offset_size);//Le,1
s_addr=s_addr.substr(2);//Weremovetheleading0xinthestring//Wenowwan,1
m_loc){//Gothroughallthevaluestha,0
rtheinstructionif(inst=="lb"||ins,0
}//Updatethestackoffunctionsandtheirlastexecutedlineaccordinglystrin,0
_mask=1;temp_mask=temp_mask<<offset_size;temp_mask=temp_mask-1;index_mask=index_mask^temp_mask;,0
acters67ofhex_instruction}for(inti,0
alooopfor(inti=addr;i<addr+count;i++){intmem_val=memory[i];stringbin_mem_val=de,1
byte(8);for(inti=0;i<8;i++){byte[7-i]=store_value>>(7,2
block[1]=1;//Thecacheblockisnowdirtycache_block[2]=tag;,2
11";hex_to_bin['8']="1000";hex_to_bin['9']="1001";hex_to_bin[,2
<executed_instruction<<";PC="<<hex_PC<<endl;//UpdatePCvaluePC+=4;}elseif(inst=="jalr"),1
r(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//Functiontosto,3
1";hex_to_bin['8'],1
ct7();initialize_format();initialize_load_operands();initialize();ifst,4
"0000000";funct7["sub"]="0100000";funct7["and"]="0000000";funct7["or"]="0000000";funct7["xor",3
sreplacedq.push(tag);//Pushthenewtagvaluevector<int>removed_d,2
]=res;}elseif(inst=="lw"){vector<int32_t>byte(4);b,3
rl"){uint64_tshifting_amount=register_values[rs2];if(shifting_amount!=0){register_values[rd]=reg,3
k[i].second+count_how_many_to_skip<<endl;}if(stack_of_functions.empty()){cout<<"Empt,3
=memory[i];stringbin_mem_val=decimal_,1
ed_instruction.find('');stringfirst_word=exec,1
ormloadaspertheinstructionif(inst=="lb"||inst=="lh"||inst=="lw"||in,0
e[i][j][0]=0;//Makethevalidbitaszero}}}elseif(!comma,3
".text"){data=false;}else{//Storeth,1
etheorderofacce,0
=="x2"){r="x2";}elseif,1
ed_data[2]<<(offset_size+index_size));to_store,2
="";for(inti=0;i<instruction.size();i++){if(instruction[i]!=''&&instructi,2
no+1<<endl<<"Incor,0
lis_present=false;while(!q.empty(),1
fset_size+index_size));to_store_mem_loc|=(index<<offset_size);for(inti=0;i<block_size;i++,0
_size;//Andthesemanyaretagbitsvector<int>removed_data=cache[i][j];intto_store_mem_loc=0,3
invalid=true;update_queue(,0
ntj=0;j<cache[i].size();j++){for(intk=0;k<cache[i][j].size,4
e-1);cache_block[0]=1;//Thebitisnowvalidcache_b,1
struction_no*4+i]=byte[i];}}//CodeforJformatinstructionsvoidexecute_J(vector<vector<string>>,3
aqueueofstrings,suchthat,0
tenter4operands"<<endl;exit(0);}e,1
bge"]="101";f,0
(index,tag,true,mem_loc,"write",false,0
s1";exit(0);}strin,1
ormat[cur_instr[0]]=='U'){s,2
lock_size+(block_size-1);new_data[0]=1;//The,2
7"){r="x17";}elseif(r=="s2"||r=="x18"){r="x18";}elseif(r=="s3"||r=="x19"){r="x19";}elseif(,5
llthebreakpointintno_of_instru,0
(assembly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wron,3
<<instruction_no+1<<endl<<"Valueofimmediateiso,0
"W";if(is_,0
string>binary_bytes(4);for(inti=0;i<4;i++){binary_,1
lycodetomachinecodehexadecimalandstoreintextmemoryfor(intinstruction_no=0;i,0
r(instruction[1]);imm=stoi(instruction[3]);rs1=aliasRemover(instr,4
);break_lines.clear();count_how_many_to_skip=0;}stringaliasR,1
=executed_instruction.substr(0,pos);if(first_word.back()==':'){executed_instruction=executed_ins,3
tstore_value=register_values[rs2];//Performstoreaspertheinstructionif(inst=="sb"){uint8_tbyt,2
thesemanyaretagbitsvector<int>removed_data=cache[i][j];intto_store_mem_loc=0;//Hereth\etagandin,3
et_size);//Let'sgetthevalueofoff,0
include<fstream>#include<unordered_map>#include<unordered_set>,3
hex_to_bin['d']="1101";hex_to_bin['e']="1110";hex_to_bin['f']="1111";stringbin="";fo,3
k=0;k<cache[i][j].size();k++){cache[i][,4
l_to_binary(old_PC,32,0);strin,1
_loc){//Gothroughallthevaluesthattheuserhasspecifiedandstorethemstartingforlocationspecifiedbyt,0
ister_no="a";arg,0
_operands(){load_operands.insert("lb");l,2
;}elseif(registers.find(assembly_code[instruction_no][2])==registers.end()),5
ing_amount=imm;if(shifting_amount!=0){register_values[rd]=register_valu,2
k;//Makesthepositionsofoffseybitszero//Weneedtodothisfortheoffsetaswell,be,0
mbly_code[instruction_no][3])>=pow(2,11)){cout<<"Errorinline:"<<instruction_no+1<<endl<<,3
ry["<<mem_loc_hex<<"]"<<"="<<hex_mem_,0
sh({offset_to_label[PC],-1});stringexecuted_inst,3
);stringhex_,0
=(mem_loc/block_size)*block_size;intend_storage=(mem_loc/block_size)*bloc,2
ctor<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruct,3
takenintold_PC=PC;//Executethebranchifconditionsatisfiedasperthegiv,0
grequestedbyprogramintindex=index_mask&mem_loc;index>>=(offset_size);//Let'sg,1
BlockSize:"<<block_size<<endl;cout<<"Associativity:"<<associativity<<endl;cout,0
datethestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=stack_of_functions,0
funct3["bge"]=,1
;for(inti=0;i<4;i++){byte[i]=read_access(sta,1
m_loc+i]=removed_data[3+i],1
laythememorystri,0
t[cur_instr[0]]=='U'){step_U,2
}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0,2
thowour20bitsofmemoryaddressaredivi,0
r=="x19"){r="x19";}elseif(r=="s4"||,1
ache_block[k]=memory[j];}cache_block[3+offset,2
romthestackoffunctionsstack_of_functions.pop();//Updatethedestin,1
lock_size;intend_storage=(mem_loc/block_size)*block_size+(b,1
_PC=decimal_to_binary(old_PC,32,0);stringhex_PC=binary_to_hex(bin_PC);,2
oryif(removed_data[1,0
[instruction_no][2]]-instruction_no*4);}if(registers.find(assembly_code[instruct,2
yte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i,2
nstruction_no][1]];stringrs1=registers[assembly_code[instruction_no][2]],4
placementpolicyif(!found_invalid){upd,1
ffset=offset_mask&mem_loc;//,0
egisters.find(assembly_code[instruction_no][3])==registers.end()){cout<<"Errorinline:"<<instruction_,4
<<instruction_no+1<<endl<<"Value,0
_enabled){for(inti=0;i<cache.size();i++){for(intj=0;j<cache[i].size();j++){if(cache[i][j][0]==1&,6
stringbin_mem_val=decimal_to_binary(mem_val,8,0);s,1
e<int>q=order_of,1
ag:"<<hex_tag<<","<<is,0
ion=stack_of_functions;while(!dummy_stack_function.empty()){dummy_sta,2
r[cur.size()-1]==')'){cur.po,2
file_name=command.su,0
cond;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,t,1
on,intmem_loc){//Gothroughallthevaluesthattheuserhasspecifiedandstorethemstartingforlocations,0
ter_no="a";argument_register_no+=to_string(i-10);registers[,1
f_stack=stack_of_functions.top().first;,1
espondingpowerof2if(bin[i]=='1'){decimal+=pow(2,length-1-i);//length-1-igivesthepositionfromther,3
){stringbin_instr=hex_to_bina,0
erands"<<endl;exit(0);}elsei,1
eckiftheremoveddatahasadirtybitset,andifso,weneedto,0
e;}intno_of_indexes=cache_size/(associativity*block_size);cache.clear();//Notethatthesizei,2
i=0;i<=31;i++){stringregister_no="x";register_no+=to_s,0
temp_mask-1;index_mask=index_mask^temp_mask;//Makesthepositionsofoffseybitszero//Weneedtodothisf,0
thecorrectpositioninthematrixif(load_operands.find(cur_instruction[0])!=load_ope,2
++;if(instruction==".text"){data=false;}else{//Storetherequireddword/word/byte/halfwordvecto,2
ne:"<<instruction_no+1<<endl<<"Wrongsyntax,forRtypeformat,youmustenter4operands"<<endl;e,0
nyareforindexinttag_si,0
,everyoneis,0
instructions[PC/4];,1
]);//Extra,0
ex(bin_tag,true,5);myfile_out<<"Set:"<<hex_set<<",Tag:"<<hex_tag<<","<<is_clean<<endl;}}}myfile_,1
ry[mem_loc+,0
n_no+1<<endl<<"In,0
(stringr){if(r=="zero"|,1
mem_loc+i,byte[i],accessed_o,1
s.top().second;top_line=PC/4+,1
<instruction_no+1<<endl<<"Incorrectvalueofrs2";exit(0);}elseif(registers.find(assembly_code[inst,1
bstr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[,3
)|(byte[4]<<32)|(byte[3]<<24)|(byte[2]<<16)|(byte[1]<<8)|byte,4
associativity;i++){vector<int>cache_block(block_size+3);cache_block=c,2
ction_no){//Handlingerrori,0
he[index][i]=cache_bloc,2
ert("lw");load_operands.insert("ld");load_operands.insert("lbu");load_operands.insert("l,3
_code[instruction_no][1]];stringimm=decimal_to_,2
{//Gothroughallthevaluesthattheuserhasspecifiedandstorethemst,0
bly_code.size();boolto_break=fals,1
ing>>assembly_code;stringcache_output_name;//Infiniteloopth,0
al_to_binary,0
e-index_size;//Andthesemanyare,0
tringr){if(r=="zero"||r=="x0"){r="x0";}elseif(r=="ra"||r=="x1"){r="x1";}elseif(r=="s,4
stics:Accesses="<<hits+misses<<",Hit="<<hits<<",Miss="<<misses<<",HitRate="<<fixed<<s,0
ess(start_location+i,accessed_once);accessed_once=,1
syntax,forStypeformat,youmustenter4operands"<<endl;exit(0);}elseif(registers.find(assembly_c,1
tynew_data[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++),1
er_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="bgeu"){uint64_tval_r,4
/Handlingerrorsif(assembly_code[instruction_no].size()!=4){cout<<"Errorin,3
//CodeforJformatinstructionsvoidexecute_J(vector<vector<string>>&assembly_code,intin,2
='R'){step_R(cur_instr);}elseif(format[cur_instr[0]]=='I'){step_I(cur_inst,5
ze();i++){if(hex[i]=='0'){continue;}else{trimmed_hex=hex.substr(i);returntrimmed_hex;}}retur,7
ueofaddrandcountbyparsingthelinefor(,0
es[rs2];}//Updatethestackoffunctionsandth,1
111";stringbin="";for(inti=0;i<hex.size();i++){bin+=hex_to_bin[hex[i]];}returnbin;}//,4
i(instruction[3]);//Updatethestackoffunctionsandtheirlastexecutedlineaccordi,2
"1001";hex_to_bin['a']="1010";he,1
_values["x0"]=0;}//CodefortheSformatstepinstructionsvoidstep_S(vector<string>instruction){//Extractt,3
_instruction=executed_i,0
abels.clear();register_values.clear();all_instructions.clear();offset_to,3
ues[rd]=res;rd=res;}elseif(inst=="lh"){int16_tbyte0=read_access(start_location,f,2
owgettheactualvalueoftagbitsinthe,0
estoistoll#defineintlonglongusingnamespacestd;//Declaret,0
+){for(intj=0;j<cache[,0
byte[i]=binary_to_de,1
ze();i++){if(!check_space){if(command[i]==''){check_space=true;}else{s_addr,5
ndextractthers1andrs2valuesintnew_pc=PC+stoi(instruction[3]);stringrs1=aliasRemover(instruction[1]),4
x_to_bin[hex[i]];}returnbin;}//Codetoconvertdeci,2
nstruction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=bi,2
uctionif(inst=,0
ringdecimal_to_,0
tor<vector<string>>&assembly_code,intinstruction_,2
roceedwithfin,0
nspecifiedbythemem_locfor(inti=1;i<instruction.size();i++){uint64_tstore_value=stoi(in,1
ndex_mask<<(index_size+offset_size);index_mask=i,1
geu"]="111";}//Definingallfunct7valuesvoidinitialize_funct7(){funct7["add"]="0000000";funct7,2
n=all_instructions[PC/4];intpos=executed_instruction.find('');stringfirst_word=executed_instruction,2
de[instruction_no][3])>=pow(2,12)-1){cout<<"Errorinline:"<<instruction_no+1<<,3
="x9"){r="x9";}elseif(r=="a0"||r=="x10"){r="x10";}elseif(r=="a1"||r=="x11"){r="x11";}elseif(r==,5
nd"){register_valu,0
Jformatinstructionsvoidexecute_J(vector<vector<string>>&asse,2
struction<<";PC="<,0
on_no*4);}if(registers.fin,0
1index,everyoneisfightingforthisoneindexassoc,0
store_dword(to_store,data_base_address);}elsei,1
PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<,0
on.size();i++){uint64_tstore_value=stoi(instr,1
cimal;}else{dec_imm=stoi(assembly_code[instruction_no][2]);}if(dec_im,4
;}if(cache_block[2]==tag){is_hit=true;found=true;val=cache_block[3+offset];//Sincethi,3
1";stringrd=registers[assembly_code[instruction_no][1]];stringimm=decimal,3
.pop();stack_of_functions.push({top_of_stack,top_line});stack_of_functions.push({offs,3
acheDisabled";}}elseif(command=="cache_simdisable"){cache_enabled=false;c,1
_dirty=true;intto_store_mem_loc=0;//her,0
size/(associativity*block_size);cache.clear();//,2
alues["x0"]=0;}//CodefortheUformatst,1
faccessvectorupdate_queue(index,tag,0
}elseif(inst=="ori"){register_values[r,1
write_access(int,0
oidstep_J(vector<string>instruction){//Storethenewpcvaluetojumptointne,2
tion_no].size()!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forItypef,1
ag_mask=tag_mask-1;//Thi,0
old_PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<execut,1
n_no][3])>=po,1
tack=stack_of_functions.top().first;inttop_,1
xecute_R(assembly_code,instru,0
struction[3]);//Dothearithmeticaccordingtotheinstructionsif(inst=="add"){register_values[rd]=registe,3
bin;}//Take1'scomplementfor(inti=0;i<bi,0
_tstore_value=stoi(instruction[i],1
bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i,4
lse;for(inti=0;i<4,0
mm.substr(2,6)+rs2+rs1+f3+imm.substr(8,4)+imm.substr(1,1)+opcode;stringhex_instr,3
b"]='S';format["sh"]='S';format["sw"]='S';format["sd"]='S';//Bformatformat["beq"]='B';,4
PC+4;register_values["x0"]=0;}//CodefortheUformatstepinstructionsvoidstep_U(vector<string>ins,2
"000";funct3["sb"]="000";funct3["sh"]="001";funct3["sw"]="010";funct3["sd"]=",4
nbin;}//Functiontoconvertbinarystringtodecimalintbinary_to_decimal(c,0
it=true;found=true;val=cache_block[3+offset];//Sincethisahit,weneedtoup,1
nt.Wecanproceedwithfindingtherealdatainthatlocatio,0
how_many_to_skip++;if(inst,0
dimmediaterd=aliasRemover(instruction[,0
seif(r=="s6"||r=="x22"){r="x22";}elseif(r=="s7"||r,2
s.pop();}stack_of_functions.push({"mai,1
lue>>(7-i)*8;}for(inti=0;i<8;i++){write_access,1
=4;}}elseif(inst=="bltu"){uint64_t,1
offset_size;temp_mask=temp_mask-1;index_mask=index_mask,0
str);}elseif(format,0
,'||cur[cur.size()-1]==')'){cur.pop_back();}cur_instruct,4
sameforindexmakintindex_mask=1;index_mask=index_mask<<(index,0
"write"){new_data[3+offset]=val;new_data[1]=1;//Setthebittodirty}f,3
[2])==registers.end,1
[instruction_no][0]=="jalr"){opcode="1100111";}else{opcode="0010011";}//Notingthevaiour,4
inst=="lb"){int8_tbyte=read_access(start_locati,0
or(inti=0;i<length;i++){//Ifthecurrentcha,0
henweneedtomakeitfullyassociativeif(associativity==0){//Thismean,1
C,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC,1
ct7["sra"]="0100000";}//Definingtheformatofvariousinstructionsvoidinitialize_format(),2
ts,boolisSigned){boolisNegative=false;if(de,0
eak_point-count_how_many,0
ersvoidinitialize_registers(),1
ion_no][3]),6,true);imm="010000"+imm;}else{if(st,1
nstruction[2]);imm=sto,1
ntinstruction_no){//Hand,0
0]=="slli"){if(stoi(assembly_code[instruction,0
bytes[i]=hex_to_bin,1
ction==".text"){data=false;,0
=="lhu"){uint16_tbyte0,0
inline:"<<instruction_no+1<<endl<<"Wrongsyntax,forBtypeformat,youmustenter4operands"<<endl;exi,0
eswhicharevalidfor(inti=0;i<cache.size();i++){for(intj=0;j<cache[i].size();j++){if(cache[i,3
bythedatasection,andsubtractthembreak_lines.ins,0
f(length*4<binary.size()){hex=hex.substr(binary.size()-length*4);}if(tri,4
instruction_no][0]=="srli"||assembly_code[instruction_no][0],3
ed||!isNegative){returnbin;}//Take1'scomple,1
block_size-1);new_data[0]=1;//Thebitisnowvalidnew_data[1]=0;//Initiallynotdirtynew_,2
hex["1011"]='b';bin_to_hex["1100"]='c';,2
my_q.front();dummy_q.pop();q.push(cur);}if(!is_pres,3
ction_no][2]),21,true);//Concatinatingtheinstructionstring,1
ssociativity;vector<int,0
>>=(offset_size);//Let'sgetthevalueofoffsetbitsintoffset=offset_mask&mem_lo,1
r_values[rd]=PC+4;PC=new_pc;}//Updatethestackoffunctionsandtheirlastexecutedlineaccordi,1
cache_size/block_size;}intno_of_indexes=,0
assembly_code[instruction_no][2]];stringrs2=registers[ass,2
ode="0010011";}//Notingthevaiourspartsoftheinstrutionstringf3=funct3[assembly_code[instruction_,0
4_tres=(byte[7]<<56)|(byt,1
<(double)(hits)/(hits+misses);}stack_of_functions,3
seif(stoi(assembly_code[instruction_no][3])<-pow(2,12)||,4
lculatethemaskrequiredtofindoutt,0
hestackif(PC/4==no_of_instruction){//Alsoensuretoprintthec,1
=='U'){step_U(cur_instr);}else{exit(0);}//Iflastlineisexecuted,thenensuretopo,4
<"Exitedthes,0
loc/block_,0
<cache.size(,0
r=="x19"){r="x19";}elseif(r=="s4"||r=="x20"){r="x20";}elseif(r=="s5"||r=="x21",3
nstr[0]]=='U'){step_U(cur_instr);}else{exit(0);}if(to,5
embly_code[instruction_no][1]];stringrs1=registers[ass,2
luesthattheuserhasspecifiedandstorethemstartingforlo,0
e:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_to_bi,1
nst=="srai"||inst=="slli"||inst=="srli"){//Extracttherd,rs1,i,0
str(5));current_opened_file=command.substr(5);//Thisistoremove.scurrent_opened_file.pop_back();curr,3
svoidstep_R(vector<string>instruction){//Extractrd,rs1,rs2s,2
(!found_invalid){va,1
ion_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Notingthe,1
n=all_instructions[old_PC/4];intpos=,1
,intmem_loc){//Gothroughallthevaluesthattheuserhasspecifiedandstoreth,0
tionif(load_operands.find(assembly_code[instruction_no][0]),3
.insert("lbu");load_operands.inser,1
"Labelnotdefined";exit(0);}else{,1
stringinstr=imm+rs1+f3+rd+opcode;stringhex_instruction=binary_to_hex(instr);vector<string>bi,2
et_mask<<(offset_size);offset_mask=offset_mask-1;//Wecannowgettheactualvalueoftagbitsinthem,1
_config_file;cache_config_file.open(cache_config_file_name);cache_config_file>>cache,1
(i==1){registers["ra"]=this_register;}elseif(i==2){registe,4
set,andifso,weneedtoupdatethememoryif(removed_data[1]==1){is_dirty=t,2
tion//Ifwefindthisblockinthecache,wereadonlythisparticular,0
n<<";PC="<<hex_PC<<endl;//Ensurethatthevalueofx0is0register_values["x0"]=0;}//C,1
}//CodefortheIformatstepinstructionsvoidstep_I(vector<string>instruc,1
ata_base_address);}elseif(to_store[0]==".half"){data_base_address=store_half(to_store,,2
substr(pos+1);}stri,1
00";hex_to_bin['9']="1001";hex_to_bin['a']="1010";hex_to_bin['b']="1011";hex_to_bin['c']="1100";hex_,4
r"){opcode="1100111";}else{op,1
tformat["sb"]='S';format["sh"]='S';fo,2
i<8;i++){byte[7-i]=store_value>>(7-,1
_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=bin,3
temp_mask=temp_mask<<(index_size+offset_size);temp_mask=temp_mask-1;tag_ma,1
o){//Handlingerrorif(assembly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<inst,3
(start_location+1,true);uint16_tres=byte1<<8|byte0;register_values[rd]=re,2
o="s";saved_register_no+=to_string(i-18+2);registers[saved,1
ubstr(6-2*i,2));}ui,1
eaccordinglystringtop_of_stack=stack_of_functions.top().first;inttop_line=stack_of_functions.top,1
ues[rd]=register_values[rs1]>>register_values[rs2];}//Updatethestacko,3
r(inti=0;i<4;i++){byte[3-i]=store_value>>(3-i)*8;}for(i,3
ccessed_once);accessed_once=true;}uint32,0
;funct3["srli,0
c,"write",false,tr,0
ile(true){//Nowsavethenextfilestringcommand,1
teonlytheonceswhicharevalidfor(inti=0;i<cache.size();i++){for(intj=0;j<,1
nsuretoprintthecachestatisticsif(cache_enabled){cout<<"D-c,1
occupiedbythedatasection,andsub,0
ecorrespondingpowerof2if(bin[i]=='1'){decimal+=pow(2,length-1-i);//len,3
ormat;unordered_set<str,0
intj=start_sto,0
="jalr"){//Extracttherd,rs1andimmediatevaluerd=a,0
_values[rd]=register_values[rs1]^imm;}elseif(inst=="ori"){register_values[rd,3
indexes,vector<vector<int>>(a,2
endl;}}//Inthecaseofmisses,ifitiswritethorugh,wejustwrite,0
0,pos);if(first_word.back()==':'){executed_instruc,2
xofstringsvector<string>cur_instruction;all_instructions.push_back(i,1
(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);//characters6,3
(bin[i]=='0'){bin[i]='1';break;}bin[i]='0';}returnbin;}//Functiontoconvertbinarystringtodecim,5
);ifstreamc,0
{executed_instruction=executed_instruction.substr(pos+1),1
r_of_access.clear();order_of_access.re,1
once){if(cache_enabled){//Letusfirstfigureouthowour20bitsofmemoryaddressaredivid,1
ringimm=decimal_to_binary(stoi(assembly_code[instruction_no][2]),21,true);//Conca,4
de,intinstruction_no){//Handlingerrorsif(ass,0
r);}if(!is_present){q.push(tag);}}else{inttop_tag=q.front();//Getthetagwhichwene,4
1;//Thebitisnowvalidnew_data[,0
{is_dirty=true;intto_store_mem_l,0
s.pop();stack_of_functions.push({top_of_stack,top_line});stack_of_functio,3
truction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<,2
[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="blt"){if(register_v,4
="lh"){int16_tbyte0=read_access(start_,0
t(0);}else{assembly_code[instruction_no][3]=to_string(labels[assembly_code[instruction,3
assembly_cod,0
C;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//Update,0
values[rs1]>>imm;//Ourm,1
truction=all_instructions[PC/4];intpos=executed_instruction.find('');stringfirst_word=executed_i,2
});stringexecuted_instruction=all_instructions[old_PC/4];intpos=e,1
][0]]=='R'){execute_R(assembly_code,instruction_no);}elseif(format[assembly_code[instruction_no][0],5
++){bin+=hex_to_bin[hex[i]];}returnbin;}//Codetoconvertdecimaltobinarystringdecimal_to_binary(i,3
lstorethenecessaryinformationunordered_map<string,string>registers;unor,1
k]=memory[j];}if,1
of_functions.push({"main",0});last_exected_line.clear();break_lines.clear();cou,4
_of_stack=stack_of_functions.top().first;inttop_line=stack_of_functions.top().second;to,2
lingerrorif(assembly_code[instruction_no].size()!=4){cout<<"Errorinline:,3
clear();offset_to_label.clear();while(!stack_of_functions.empty()){stack_of_func,4
lues[rd]=reg,1
<string>instruct,1
perands.find(assembly_code[instruction_no][0])!=load_operands.end()){opcode="0000011";}elseif(a,5
ream>#include<unordered_map>#include<,1
tring>offset_to_label;unordered_map<s,0
}imm=decimal_to_binary(stoi(assembly_code[instruction_no][,1
nd()){cout<<"Errorinl,1
str(5);//Thisistorem,1
_PC=decimal_to_binary(PC,32,0);str,1
xandtagwewant.Wecanproceedwithfindingtherealdat,0
che_simstats"){if(cache_enab,0
_no][0]];stringf7=funct7[assembly_code[instruction_no][0]],4
000";funct3["bne"]="001";funct3["blt"]="100";funct3["bge"]="101";funct3["blt,3
ry.size();i+=4){stringb=binary.substr(,1
]==1){stringis_,0
et'sgetthevalueofoffsetbitsintoffset=offset_mask&mem_loc;//,0
instruction=all_in,0
_values["x0"]=0;}//CodefortheJformatstepinstructionsvoidstep_J(,1
rt_location,false);uint8_tres=byte;register_values[rd]=res;}elseif(inst=="lhu"){uint16_tbyte0,2
et_size-index_size;//Andthesemanyaretagbits//Letusnowcalculatethemas,0
tack_of_functions.pop();stack_of_functions.push({t,1
'){step_U(cur_instr);}else{exit(0);}//Iflastlineisexecuted,thenensuretopopmainfrom,4
[0]]=='J'){execute_J(assembly_code,instruction_no);}elseif(format[assembly_code[instruction_no][0,4
d,rs1,andimmediaterd=aliasRe,0
y_code.clear();assembly_code.assign(0,ve,1
val;cache_block[0]=1;//Thebitisnowvalidc,1
surethatallthebocksarewrittenifdirtyfor(inti=0;i<cache.size();i++){for(,1
"]='S';//Bformatformat["beq"]='B';format[,1
dtheirlastexecutedlineaccordinglystringtop_of_stack=sta,0
|r=="x25"){r="x25";}e,1
_hex(bin_tag,true,5);myfile_out<<"Set:"<<hex_set<<",Tag:"<<hex,1
loc|=(removed_data[2]<<(offset_size+i,1
dcountbyparsingthelinefor(inti=4;i<command.size();i++){if(!check_space){if(comman,2
';dummyi/=10;charnum2=dummyi%10+'0';this_register+=num2;this_register+=num1;}intvalue_of_register_in,0
rs.find(assembly_code[instruction_no][1])==,3
assembly_code.assig,0
ction_no+1<<endl<<"Wrongsyntax,forStypeformat,youmustenter4operands"<<endl;exit(0);}elseif(register,1
(instruction[1]);stringrs1=aliasRemover(instruction[2]);stringrs2=aliasRemover(instructio,4
imm;if(shifting_amount!=0){register_values[rd]=register_values[rs1]>>imm;//Ourmaskissh,3
erthexadecimaltobinarystringhex_to_binary(stringhex){,1
thatthePCvalueis0PC=0;if(cache_enabled){if(f,1
ter_values[rd]=register_values[rs1]>>register_values[rs2];}//Updatet,3
";hex_to_bin['c']="1100";hex_to_bin['d']="1101";hex_to_bin['e']="1110";hex_to_bi,3
to_string(i-18+2);registers[saved_register_no]=this_regis,2
r_instr[0]]=='S'){step_S(cur_instr);}elseif(format[cur_instr[0]]=='B'){step_B(cur_instr);}elseif(f,8
cesses="<<hits+misses<<",Hit="<<hits<<",Miss="<<misses<<",HitRate="<,0
ore_byte(to_store,dat,0
bled){stringhit_or_miss="Miss";stringclean_or_dirty="Clean";stringread_or_write="W";if(is_hi,0
ruction}for(inti=0;i<4;i++){memory[instruction_,0
ingtrimmed_hex="";for(inti=0;i<hex.size();i++){if(hex[i]=='0'){continue;}else{trimmed_hex=hex,4
skip++;if(instruction==".text"){data=false;}else{//Storetherequireddword/wor,2
n_to_hex["1000"]='8';bin_to_hex["1001"]='9',2
hifting_amount))-1;if(shifting_amount==0){for(inti=0;i<=63;i++){,1
false);uint16,0
e=false;for(,0
herequireddword/word/byte/halfwordvector<string>to_store;stringcur=,1
(inst=="jal"){register_va,1
["andi"]="111";funct3["slli"]="001";funct3["srli"]="101";funct3["srai"]="101";f,4
_block[1]=0;//Initiallynotdirtycache_block[2]=tag;for(intj=start_storage,k=3;j<=end_stor,2
3){registers["gp"]=this_register;}elseif(i,2
ommand.substr(6));//Wetakeintoaccountthelinesthatareoccupiedbythedatasection,andsubtractthembre,1
h_back(cur);}cur="";}else{cur.push_back,1
+1<<endl<<"Wrongsyntax,forRtypeformat,youm,0
einstructionif(inst=="addi",0
sblockinthecache,,0
ctthecacheatall.So,weneedtoprintinthecache_outputfilefromhereonly,sinceupdate_queuewillneverbereach,0
(labels.find(assembly_code[instruction_no][3])==labels.end()){cout<<",5
boolaccessed_once=f,0
eif(!command.find("mem")){//Hereweshowt,2
ndimmediatevaluerd=aliasRemover(instruction[1]);rs1=aliasRemover(instruction[2]);imm,4
if(cache_block[0]==0){//Thisisaninvalidframe,ignorecontinue;}if(cache,3
ughallthevaluesthattheuserhasspecifiedandstorethemstartingforlocationspecifiedbyt,0
tusnowcalculatethemaskrequiredtofindoutthet,0
mber=rand()%associativity;vector<int>removed_data(cache,2
nctions.top().second;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.pus,2
uction_no][0])!=load_operands.end()){opcode="0000011";}elseif(assembly_code[instruction,3
=all_instructions[old_PC/4];intpos=executed_instruction.find('');stringfirst_wor,2
datethePCvalueandensuretha,0
,andifso,weneedtoupdatethememoryif(removed_data[1]==1){is_dirty=true;intt,2
_bin['1']="0001";hex_t,1
tringinstr=imm+rd+opcode;stringhex_instruction=binary_to_hex,0
_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary,4
once=false;for(inti=0;i<4;i++){byte[i]=read_access(start_locati,1
";}elseif(r=="t6"||r=="x31"){r="x31";}returnr;}voidupdate_queue(intindex,inttag,b,2
inghex_tag="0x"+binary_to_hex(bin_tag,true,5);cache_output<<"W"<<":Address:"<<h,1
emp_mask=temp_mask<<offset_size;temp_mask=temp_mask-1;in,0
1)+imm.substr(1,8)+rd+opcode;stringhex_instruction=binary_to_hex(instr);vec,2
int16_tbyte0=read_access(start_l,0
r_values[rd]=register_values[r,1
[j][0]==1){stringis_clean="Clean";if(cache[i][j,3
i=0;i<8;i++){byte[7-i]=store_value>>(7-i)*8;}for(inti=0;i<8;i++){memory[mem_loc+i]=byte[i];,5
ptrackofoldPCifbranchnottakenintold_PC=PC;//Executethebranchifconditionsatisfiedasperthegiveni,0
<"Wrongsyntax,forBtypeformat,youmustenter4operands"<<endl;exit(0);}if(labels.find(assembly,1
andtheirlastexecutedlineaccordinglystringtop_of_stack=,0
t=="jal"){regi,0
or<string>>&assembly_code,intinstruction_no){//Handlingerrorif(as,1
hex["0100"]='4';bin_to_hex["0,1
,andifso,weneedtoupdatethememoryif(removed_d,0
ializinganyusedvariablesthatthepreviousfilemighthaveusedvoidinitialize(){for(inti=0;i<32;i++){st,1
if(!check_space){if(command,1
outofrange";exit(0);}imm=decimal_to_binary(stoi(assembly_code[instruction_no][3]),6,4
=(tag<<offset_size+index_,0
on=executed_instru,0
setaswell,because,ultimatelythisfunctionhastoreturnonly1byteintoffset_mask=1;offset_mask=off,0
imal/=2;}while(bin.size()<n,1
"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueof,0
cedq.push(tag);,1
;format["xori"]='I',1
load_operands.insert("lwu");}//Wheneveranewfileislo,1
s1"||r=="x9"){r="x9";}elseif(r=="a0"||r=="x10"){r="x10";,2
Wrongsyntax,forBtypeformat,youmustenter4operands",0
ueuewillne,0
f(assembly_code[i,0
ze);for(inti=0;i<block_size;i++){memory[to_store_mem_l,0
k();labels,1
ess,false,5);stringbin_set=decimal_to_binary(index,20,0);stringhex_set="0x"+binary_to_hex(bin_set,t,1
removed_data[1]==,1
(vector<vector<string>>&assembly_code,intinstruction_no){//,3
tializethevalueofPCintPC;//Herewedeclareallvariablesrelatedtocacheintcache_size,block_size,associat,0
ize();ifstreaminstru,1
;}//Notingthevariouspartsoftheinstrcutionstringopcode="1101111";stringrd,0
lseif(r=="s7"||r=="x23"){r="x2,1
tsandoffsetbitszero//Letusdothesameforindexmak,0
k-1;tag_mask=tag_mask^temp_mask;//Makesthepositio,0
registers[temporary_register_no]=this_register;}elseif(i==8){registers["s0"]=this_register;re,3
line=old_PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,top_line});string,3
os=executed_instruction.find('');string,1
i=1;i<instruction.size();i++){uint64_tstore_value=stoi(instruction[i]);uint8_tbyte=store_value;m,3
//Handlingerrorif(assembly_code[instruction_no].size()!=4){cout<<"Errorin,3
wsavethenextfilestringcommand;getline(cin,command);if(!comm,1
ount_how_many_to_skip++;if(ins,0
ead_or_write="W";if(is_hit){hit_or_miss="Hit";}if(is_dirty){clean_or_dirty="Dirty";}if(is_read),5
einstrutionstringf3=funct3[assembly_code[instruction_no][0]];stringrd=registe,3
uction_no+1<<endl<<"Wrongsyntax,forStypefor,0
q.push(tag);//Pushthenewtagvaluevector<int>removed_data(cache[0][0].size());vector<int>new_data(cach,7
f3+imm.substr(8,,0
his_register;}}}//Definingallfunct3valuesvoidinitialize_funct3(,0
e:"<<instruction_no+1<<endl<<"Labelnotdefined";exit(0);}else{assembly_code[instruction_no][3]=to_s,3
ro//Letusdothesameforindexmakintindex_mask=1;index_mask=index_mask<<(index_s,0
(register_values[rs1]!=register_values[rs2]){PC=new_pc;}else,4
s1,rs2,inst;inti,0
seif(i==9){registers["s,1
_access(intmem_loc,boolaccessed_once){if(cache_enabled){boolis,2
ct7["sra"]="0100000";}//Definingtheformatofvariousinstructi,1
exinttag_size=20-offset_size-index_size;//Andthesemanyaretagbitsbooli,0
bel.clear();while(!stack_of_functions.emp,1
struction_no+1<<endl<<"Labelnotdefine,0
c|=(index<<offset_size);for(inti=0;i<bl,0
=0;i<instruction.size();i++){if(trim&,1
e[2]<<16)|(byte[1]<<8)|byte[0];,3
_bytes(4);for(inti=0;i<4;i++){binary_b,1
hevalue,weneedtolookinth,0
0-offset_size-ind,0
(cur);}cur="";}else{cur.push_back(c);}}if(cur!=""){to_store.push_back(cur);}if(to_store[0]==".d,7
datethePCvalueandensurethatx0willalwaysremainatvalueof0PC,0
bly_code[ins,0
ront();dummy_q.pop();q.push(cur);}//Notethatheretagwillalwaysbeatthetopq.push(tag);}else{in,4
=false;for(inti=0;i<associativity;i++){vector<int>cache_block(block_size+3);cache_block,2
orinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs2,0
and[i]);}}else{s_count.push_back(command[i]);}}s_addr=s_a,4
formthearithmeticaspertheinstructi,0
<<"Valueofimmediateisoutofrange";exit(0);}//Notingthevariouspartsoftheinstrcutionstringopcode="110,1
eimmediate,0
pos+1);}stringbin_PC=decimal_to_binary(old_PC,32,0);stringhex_PC=binary_to_hex(bin_,1
;vector<string>binary_bytes(4);for,2
olicy;//Iftheassociativity=0,thenweneedtomakeitfullyassociativei,0
he_block(block_size+3);cache_block=cache[index][i];//Valid,Dirty,tag,dataif(cache_block[,3
ruction_no){//Handlingerrorif(assembly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<,3
es[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];f,4
ster_values[rs1]>>register_values[rs2];//Ourmaskisshifting_amount0'sfollowedby64-shi,2
="lh"){int16_tbyte0=read_access(start_location,false);int16_tbyt,1
ing0xinthestring//Wenowwanttoconvertittodecimalrepresenttion,viabinaryrepresentationstringbin_s_addr,0
sk-1;tag_mask=tag_mask^temp_mask;//Makes,0
s=0;misses=0;}elseif(c,0
unt0'sfollowedby64-shifting_amount1'suint64_tmask=(1U<<(64-shifting_am,0
,true,5);cache_output<<"W"<<":Address:"<<he,0
on){if(break_lines.find(PC/4+1)!=break_lines.end()){break;//to_break=true;}vector<string>cur_in,5
cur="";continue;}if(cur[cur.si,0
e,weneedtolookinthememoryif(!found){if(!accessed_once){misses,2
tpolicyif(!found_invalid){val=,1
stringexecuted_instruction=all_instructions[PC/4];intpos=executed_instruction.find('');str,2
ze));//Thesemanyareforindexinttag_size=20-offset_size-index_size;//Andthesema,0
de<algorithm>#include<cstdlib>#include<mat,2
yte[i]=binary_to_decimal(binary_by,1
ngrequestedbyprogramintindex=index_mask&mem_loc;ind,0
ddi"]='I';format["xori"]='I';format["ori"]='I';format["andi"]='I';format["slli"]='I';for,4
atethemaskrequiredtofindoutthetagbitslaterinttag_mask=1;tag_ma,0
sk-1;//Thismakesthemask20onesinttemp_mask=1;temp_mask=temp_mask<<(index_s,0
instructions[PC/4];intpo,1
ndexinttag,0
mal_to_binary(i,20,0);stringmem_loc_h,1
ache_size/block_size;}intno_o,0
tringimm=decima,0
dlineaccordinglystringtop_of_stack=stack_of_functions.top().first;inttop_line=,1
acters67ofhex_instruction}for(inti=0;i<4;i++){memor,0
s(intmem_loc,boolaccessed_onc,0
/Definingtheformatofvariousinstructionsvoidinitialize_format(){//Rformatfo,1
gisters[assembly_co,0
struction,intmem_loc){//Gothroughallthevaluesthattheuserhasspecifiedandstorethemstart,0
Sincethisahit,,0
toretheremainingwords,criticalwordfirstp,0
0;i<cache.size();i++){for(intj=0;j<cache,1
;for(inti=0;i<8;i++){byte[7-i],1
tlyaddourvaluetoitboolfound_invali,0
(bin.size()<no_of_bits){bin.pus,1
decimalvaluesif(instruction[2][1]=='x,2
20-offset_size-index_size;//Andthesemanyaretagbitsboolis_dirty=false;if(repl,0
ctor<int>>>cache;//Valid,dirty,tag,datainthits=0,misses=,1
voidexecute_B(vector<vector<string>>&assembly_code,intinstruction_no){//Handlingerror,3
ndexmakintindex_mask=,0
string>instruction){//Keeptrackofthenewpcvalueandextract,0
inthemapcout<<"Registers:\n";for(inti=0;i<32;i++){stringthis_register="x";if(i<10){charnu,0
ck(block_size,0
=byte[i];}}/,1
lingerrorif(assembly_code[instruction_no].size()!=3){cout<<"Er,3
e_output_name=current_opened_file+".output";cach,0
i<length;i++){//Ifthecurrentcharacteris',0
Remover(instruction[2]);stringi,2
ct3["andi"]="111";funct3["slli"]="001";funct3["srli"]="101";func,3
==0){for(inti=0;i<=63;i++){mask+=pow(2,i);}}register_values[rd]=register_values[rd]&,4
on,intmem_loc),0
{byte[i]=binary_to_decimal(binary_bytes[i]);//characters67ofhex_instruction}f,4
d_instruction.substr(pos+1);}stri,1
n_tag,true,5);cache_output<<"W"<<":Address:"<<hex_address<<",Se,0
ase_address=store_dword(to_store,data_base_address,0
temporary_register_no+=to_string(i-5);regi,1
x_size;//Andthesemanyaretagbits//Letusnowcalculatethemaskrequiredtofindo,0
lues[rs1]^register_va,1
ingmem_loc_hex="0x"+binary_to_hex(mem_loc_bin,false,5);cout<<"Memory["<<mem_loc_hex<<"]"<<"="<<,1
rs["gp"]=this_register;}elseif(i==4){registers["tp"]=this_register;}elseif(i>=5&&i<=7){string,4
{unordered_map<string,char>bin_to_hex;bin_to_hex["0000"]='0';bin_to_hex[",2
ster_no="s";saved_register_no+=to_string(i-18+2);registers[saved_register_no]=,2
struction){stringrd,rs1,0
boolcheck_space=false;//Wenowe,0
ummy_q.empty()){intcur=dummy_q.front();dummy_q.pop();q.pu,3
ruction_no][0]=="srai"){if(stoi(assembly_code[instruction_no][3])<0||stoi(assembly_c,4
ack(cur);}//Ifinwrongposition,bringtheoperandsbacktothecorrectp,1
embly_code[instruction_no][3]),13,true);//Concatinatingthepartstoformt,2
d('');stringfirst_word=executed_instruction.substr(0,pos);if(first_word.back()==':',3
byte(4);for(inti=0;i<4;i++){byte[3-i]=store_value>>(3-i)*8;}for(inti=0,4
nary(hex_instruction.substr(6-2*i,2));},2
letethebreakpointif(break_lines.find(break_point-count_how_m,0
8)|(byte[5]<<40)|(byte[4]<<32)|(byte[3]<<24)|(byte[2]<<16)|(byte[1]<<8,5
rd(to_store,data_base_address);}elseif(to_store[0]==".byte"){data_base_address=store,3
na2dmatrixofstringsvector<,0
tivity*block_size));//Thesemanyareforindexinttag_size=20-of,0
only1byteintoffset_mask=1;offset_mask=offset_mask<<(offset_size);off,1
nstructions[PC/4];intpos=executed_instru,1
rtsoftheinstrcutionstringopcode="1101111";stringrd=registers[,0
ruction_no][2])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<en,2
atformat["add"]='R';format["sub"]='R';format["xor"]='R';format["or"]='R';format["and"]='R';f,5
removeddatahasadirtybitset,andifso,wene,0
ess.clear();order_of_access.resize(no_of_indexes);cach,2
or(intj=0;j<cache[i].size();j++){cache[i][j][0]=0;//Maketheva,5
tionsvoidstep_B(vector<string>instruction){//Ke,2
stoi(assembly_code[instruction_no][3]),6,true);imm="010000"+imm;}else{if(stoi(assemb,3
=store_value;byte[1]=store_value>>8;memory[mem_loc]=byte[0];memory[mem_loc+1]=byte[1];mem_loc+=2;}/,5
inghex_address="0x"+binary_to_hex(bin_,0
toreturnonly1byteintoffset_mask=1;offset_mask=o,0
"<<"="<<hex_mem_val<<endl;}}elseif(command=="show-stack"){//Hereweexecutetheshow-,1
y_code[PC/4];if(for,1
thetagwhichweneedtoreplaceq.pop();//Popthevaluewhichisreplacedq.push(tag);//Pus,2
Negative){returnbin;}//Take1'scomplementfor(inti=0;i<bin.si,1
<<executed_instruction<<";PC="<<h,0
str(6-2*i,2),1
Executed:"<<executed_instructio,0
cuted_instruction=executed_instruction.substr(pos+1);}stringbin_PC,1
ne=PC/4+1;stack_of_functions.,0
on_no][3]),12,true);//Concatinatingthevariouspartsstringinstr=imm.substr(0,7)+rs2+rs1+f3+i,2
<","<<hit_or_miss<<",Tag:"<<hex_tag<<","<<clean_or_dirty<<"fromupdatequeue"<<endl;}order_of_access[i,0
unordered_map<string,string>registers_alis;vector<string>all_instruct,2
set,true,5);stringbin_tag=decimal_to_binary(cache[i][j][2],20,0);stringhex_tag="0x,4
/Weuseadummystacktopopthelabelsfromthemainstackan,0
cessed_once);accessed_once=true;}uint32_tres=byte[3]<<24|byte[2]<<16|byte[1]<<8|byte[0];registe,4
no);}else{cout<<"Erroronline:"<<instruction_no+1<<endl<<"Incorrectsyntax";exit(0);}}}elseif(comm,1
f(r=="ra"||r=="x1"){r="x1";}elseif(r=="sp"||r=="x2"){r="x2";}elseif(r=="gp"||r=="x3"){r="x3";}elsei,6
r="x29";}elseif(r=="t5"||r=="x30"){r="x30";}elseif(r=="t6"||r=="x31"){r="x31";}returnr;}voidupdate,4
=to_string(i);stringthis_register=decimal_to_binary(i,5,fals,1
_address<<",Set:"<<hex_set<<","<<"Miss"<<",Tag:"<<hex_tag<<","<<"Clean"<<"Fromwri,0
vector<vector<string>>&assembly_code,2
command=="exit"){//Exitthesimulatorcout<<"Exitedthesimulator";break;}elseif(!command,0
if(inst=="lb"||inst=="lh"||inst=="lw"||inst=="ld"||inst=="lbu"||inst=="lhu"||inst=="lwu,0
orage,k=3;j<=end_storage;j++,k++){new_data[k]=memory[j];}r,3
mem_loc_bin=decimal_to_binary(i,20,0);stringmem_loc_hex="0x"+binary_to_hex(mem_loc_bin,false,5);co,2
//length-1-igivesthepositionfromtherigh,0
l;exit(0);}elseif(registers.find(assembly_code[instruction_no][,2
ind("mem")){//Hereweshowthecountnumberofmemorybytesstartingfrom,1
0;i<hex.size();i++){if(hex[i]=='0'){continue;}else{trimmed_hex=hex.,4
nt8_tbyte[4];for(inti=0;i<4;i++){byte[i]=bin,2
nstruction[1]);intimm;//Weacceptbothdecimalandhexadecimalvaluesif(instruction[2][1,2
{cout<<"Nothingtostep\n";}else{vector<string>cur_instr=assembly_code[PC/4];if(form,2
tackoffunctionsandtheirlastexecuted,0
<<"Errorinline:"<<inst,0
"011";funct3["lbu"]="100";fu,1
",Hit="<<hi,0
sed_once=false;for(inti=0;i<4;i++){by,0
][i]=new_data;break;}}//Nowcheckiftheremoveddatahasadirtybitset,andifso,weneedtoupdatethememoryif(,1
ackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack,0
irlastexecutedlineaccord,0
tions.pop();}}}elseif(command=="step"){//Gostepbystepintno_of_instruction,2
uction.substr(,0
]='I';format["j,0
ize/(associativity*block_size));//Th,1
ear();offset_to_label.,1
ize=log2(cac,0
rc:instruction){if(c==''||c==','){if(cur!=""){to_store.push_back(cur);}cur=",4
uesremainsat0register_values["x0"]=0;}//CodefortheSformatstepinstructionsvoidstep_S(vector<string>,2
yte[0];register_values[rd]=res;}elseif(inst=="lbu"){uint8_tbyte=read_access(start,3
{memory[to_store_mem_loc+i]=removed_data[3+i];}}}}}//Hereweneedtoensurethatallthebocksarewritte,3
ur_instr[0]]=='S'){step_S(cur_instr);}elseif(format[cur_instr[0]]==',5
set="0x"+binary_to_hex(bin_set,true,5,0
his_register+=num1;}intvalue_of_register_int=register_val,0
tfindthisblockinthecache,weloadthewholeblock,0
=byte[3]<<24|byte[2]<<16|byte[,2
_dirty=true;intto_store_mem_loc=0;//herethetagandindexshouldbeoftheremoveddatano?to_store_mem_l,0
ndhexadecimalvaluesif(instruction[2][1]=='x'){stringbin_instr=hex_to_binary(instruction[2].substr(,4
"){data_base_address=store_dword(to_store,data_base_add,0
0101"]='5';bin_to_hex["0110"]='6';bin_to_hex["0111"]='7';bin_to_hex["1000"]='8';bin_to,3
nt8_tbyte[4];for(inti=0;i<4;i++){byte[i],2
this_register;regi,0
nfig_file_name=command.substr(17);ifstreamcache_config_file;cache_config_file.open(cac,1
gvalue_of_register,0
n_or_dirty<<"fromupdatequeue"<<endl;}order_of_access[index]=q;}voidwrite_acc,1
"+binary_to_hex(bin_tag,true,5);cache_output<<read_or_write<<":Address:"<<hex_add,1
criticalwordfirstploicyintstart_storage=(mem_loc/block_size)*,1
&assembly_code,intinstruction_no){//Handlingerrorif(assembly_code[instruction_no].size()!=4){c,3
to_hex(instr);vector<s,1
false);write_access(mem_loc+1,byte[1],true);}if(inst=,2
oolto_break=false;intbreak_point_line_to_remove;i,0
"Dirty";}if(is_read){read_or_write="R";,1
else{//Storetherequireddword/word/byte/halfwordvector<st,0
ue;}vector<string>cur_instr=assembly_cod,1
/Iflastlineexecuted,thenensuretopopmainfromthestackif(PC/4==no_of_instruction){//Alsoe,1
sdontmatterorder_of_access.clear();order,1
if(cur!=""){if(cur[cur.size()-1]==','||cur[cur.size()-1,4
]=="slli"){if(stoi(as,0
else{//Storetherequireddword/word,0
fseybitszero//Weneedtodothisfortheof,0
_register_no+=to_string(i-18+,0
tring,int>>stack_of_functions;unordered_set<int>break_lines;intcount_how_,1
cation+i,accessed_once);accessed_once=true,0
sra"]="0100000";}//Definingtheformatof,0
0";funct3["sub"]="000";funct3["and"]="111";funct3["or"]="110";funct3["xor"]="100";funct3[,4
is_register;,0
>q=order_of_access[index];queue<int>dummy_q;intoffset_size=log2(block_size);//Thesem,3
4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);//charac,3
substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i,2
]);vector<uint8_t>byte(4);for(inti=0;i<4,2
'B'){step_B(cur_instr);}elseif(format[cur_instr[0]]=='J'){step_J(cur_instr);}elseif(format[cur_ins,7
iss="<<misses<<",HitRate="<<fixed<,0
isloaded,thiswillhandleinitiali,0
rimmed_hex=hex.substr(i);returntrimmed_hex;}}return"0";}returnhex;}//Codetoconverthexadecimalt,1
ude<fstream>#include<unordered_map>#include<unordered_set>#include<vector>#incl,4
ctions.top().first;inttop_line=stack_of_functions.top().second;top_line=PC/4+1;stack_of_functio,2
ubstr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(bin,3
ush_back(c);}}if(cur!=""){to_store.push_back(cur,2
houtbotheringtoddoanythinginthecacheif(write_back_policy=="WT"),1
stringhex_set="0x"+binary_to_hex(bin_set,true,5);stringbin_tag,1
0){register_va,0
i<4;i++){by,0
e[7-i]=store_value>>(7-i)*8;}for(inti=0;i<8;i++){memory[mem_loc+i]=byte[i];}mem_loc+=8;,5
1011"]='b';bin_to_hex["1100"]='c';bin_to_hex["1101"]='d';bin_to_hex["1110"]='e';bin_,3
elseif(r=="ra"||r=="x1"){r="x1";}elseif(r=="sp"||r=="x2"){r="x2";}elseif(r==,4
nstruction,intmem_loc){//Gothroughallthevaluesthattheuse,0
r=dummy_q.front();du,1
struction_no][3])<-pow,1
reakpointspresent\n";}}elseif(!command.find("break")){//Weparsethestringtogett,2
()){intcur=q.front();q.pop();if(cur!=,3
stack[i].first<<":"<<dummy_stack[i].second+count_how_many_to_skip<<end,2
);//Thesemanybitsareforoffse,0
ode[instruction_no][3]=to_stri,2
d_data(cache[0,0
'&&hex[0]>='0'){hex,1
nd('');stri,1
<<"D-cachestatistics:Accesses="<<h,0
";stringrd=registers[assembly_code[instruction_no][1]];stringimm=decimal_to_b,3
ry[mem_loc];//Getthevalueandthenstoretheremainingwords,criticalwordfirstploicyintstart_stora,1
ningallfunct3valuesvoidinitialize_funct3(){funct3["add"]="00,2
stfigureouthowour20bitsofmemoryaddressaredivided.intoffset_size=log2(block_size);//These,1
ethePCandensurethatx0remainsatvalu,0
gister_values[rd]=res;}elseif(inst=="lw"){vector<int32_t>byte(4);b,4
rs1]&register_values[rs2];}elseif(ins,1
ew_pc;}else{PC+=4;}}elseif(inst=="blt"){if(register_values[rs1]<register_values[rs2]){,4
w_data[k]=memory[j];}if(operation,2
ister_values[rs1]==register_values[rs2]){PC=new_pc;}else{PC+=,3
truction_no*4);}if(registers.fin,0
true;val=cache_block[3+offset];//Sincethisahit,weneedtoupdatetheorderofaccessvectorif(!accessed,1
x_to_binary(hex_ins,0
][0]]=='S'){execute_S(assembly_code,in,1
e[1];mem_loc+=2;}//Returnthenewmem_locwhereyouc,1
nd('');stringfirst_word,1
egister_values[rs1];uint64_tstore_value=registe,1
ex>>=(offset_size);//Let'sgetthevalueofoffsetbitsintoffset=offset,1
;//Performstoreaspertheinstructionif(inst=="sb"){uint8_tbyte=store_valu,1
_bin['d']="1101";hex_to_bin['e']="1110";hex_to_bi,2
<endl<<"Wrongsyntax,forRtypeformat,youmustenter4operands,0
r<string>instruction){//E,1
_to_bin['2']=",1
reakpointif(break_lines.find(break_point,0
]);}imm=imm<<12;register_values[rd]=imm;//Updatethestackoffunctionsandtheir,1
orylocation.//Ifwedonotfindthisblockinthecache,0
inttop_line=stack_of_functions.top().second;top_line=PC/4+1;stack_of_functi,1
oc+=2;}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_lo,0
te"){new_data[3+offset]=val;new_data[,1
s.insert("lwu");}//Wheneveranewfileisloaded,thiswillhandleinitializinganyus,1
sert(break_point-count_how_many_to_skip);cout<<"Insertedbreakpointatline:"<<break_po,1
cimal_to_binary(old_PC,32,0);stringhex_PC=bina,1
dress:"<<hex_address<<",Set:"<<hex_set<<","<<"Miss"<<",Tag:",0
x0"]=0;}//Codef,0
[1]);intimm;//Weacceptbothdecimalandhexadecimalvaluesif(instruction[2][1]=='x'){,4
intj=start_storage,k=3;j<=end_storage;j++,k++){new_data[k]=memory[j];}removed_data=,3
new_data(cache[0][0].size());intstart_storage=(mem_loc/block_size)*block_size;intend_s,5
ex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_,4
);//Notethatthesizeifblocksize+3because,1forva,0
<<(offset_size+index_size));to_stor,1
offset_size-index_size;//Andthesemanyaretagbits//Letusnowcalculatethemaskr,0
],true);}if(inst=="sw"){boolaccessed_once,1
ueoftagbitsinthememorylocationthatourprogramisrequestingto,0
rent_opened_file.pop_back();PC=0;while(getline(ins,1
ndl<<"Incorrectvalueofrs2";exit(0);}elseif(,1
d/byte/halfwordvector<string>to_store;stringcur="";for(charc:instruction){if(c==''||c==',2
r=f7+rs2+rs1+f3+rd+opcode;//Nowletuswriteintothetextsegmentofthememory://Wehavetheinstructio,0
to_hex(mem_loc_bi,0
="<<fixed<<setprecision(3)<<(double)(hits)/(hits+misses);}stack_of_functions.pop();}}}elseif,5
ingtheinstructionstringinstr=f7+rs2+rs1+f3+rd+opcode;//Nowletuswriteintothetextse,0
ptyCallStack:Executioncomplete\n";}}elseif(!command.find("d,0
,ultimatelythisfunctionhastoreturnonly1byteintoffset_mask=1;offset_mask=offset_mask<<(offset,0
_store.push_back(cur);}cur="";}else{,1
rs[saved_register_no]=this_register;}elseif(i>=2,1
"W"<<":Address:"<<hex_address<<,0
is_register;if(i==0){re,1
ti=0;i<4;i++){byte[i]=read_access(sta,1
nsertedbreakpointatline:"<<break_point<<endl;}elseif(!command.find("cache_simen,0
ex_to_binary(hex_instruction.,0
[5]<<40)|(byte[4]<<32)|(byte,2
in_to_hex["1011"]='b';bin_to_h,1
_value>>(7-i)*8;}for(inti=0;i<8;i++){memory[mem_loc+i]=byte[i];}mem_loc+=8;}//Returnthenewmem_lo,4
=4;}}//Updatethestackoffunctio,0
ands();initialize();ifstreaminstruction_file;vector<vecto,2
ssed_once=true;}}if(inst=="sd"){boolaccessed_once=false;vector<uint8_t>byte(8,2
tringzeros="",fs="";for(inti=length*4;i<binary.size();i++){zeros.push_back('0');fs,2
ion_no+1<<endl<<"Incorrectvalueofrd";exit(0);}el,1
['1']="0001";hex_to_bin['2']="0010";hex_to_bin['3']="0011";hex_t,3
imal_to_binary(stoi(assembly_code[instruction_no][3]),13,true);//Concatinatingthepartstoformtheins,4
frange";exit(0);}imm=decimal_to_binary(stoi(assembly_code[instruction_no][,2
ummyi%10+'0';dummyi/=10;charnum2=dummyi%10+'0';this_register+=num2;this_register,0
()==':'){executed_instruction=executed_instruction.substr(pos+1);}str,3
nstruction.substr(0,pos);if(first_word.back()==':'){executed_instruction=executed_,3
}if(labels.find(assembly_code[instruction_no][2])==labels.end()){cout<<"Errorinli,5
tojumptointnew_pc=PC,0
.size();i++){if(!check_space){if(command[i]==''){check_space=true;}else{s_addr.push_back(co,5
back();PC=0;while(getline(instruction_file,instruction)){//Iftheinstructionisdata,thenens,3
instruction_no][2][1]=='x'){stringbin_instr=hex_to_binary(assembly_code[in,2
uction_no][1]];stringimm=decimal_to_binary(dec_imm,20,true);//Concatinatingtheinstructionstri,2
r_values[rd]&=mask;}}elseif(inst=="srai"){register_values[rd]=register_values[rs1]>>imm;}/,5
unt.push_back(command[i]);}}s_addr=s_addr,2
it(0);}else{assembly_code[instruction_no][2]=to_str,3
x_instruction.su,0
truction_no+1<<endl<<"Incorrectvalueofrd";exit(0);}elseif(registers.find(assembly_code[instruc,1
_of_functions.push({top_of_stack,top_line}),2
valuevector<int,0
}else{//Firstcheckifwehaveaninvalidframe,andifwedo,thenwecandi,0
laccessed_,0
=no_of_instruction){cout<,0
false,true,val);break;}}//Ifwedidnotfindt,0
r];cache[index][random_number]=new_data;//Nowcheckiftheremoveddatahasadirtybit,2
ontactthecacheatall.So,weneedtoprintinthecache_outputfilefromh,0
aluetoitboolfound_in,0
e="<<fixed<<setprecision(3)<<(double)(hits)/,3
tmemory[0x50001];,1
;}elseif(break_lines.find(PC/4+1)!=break_lines.end()){cout<<"Executionstoppedatbreakpo,3
ftheremoveddatahasadirtybitset,andifso,weneedtoupdatethememoryif(removed_data[1]==,1
e[index][i];c,2
;}for(inti=0;i<8;i++){memory[mem_loc+i]=byte[i];}me,3
etagbits//Letusnowcalculatethemaskrequiredtofindoutthetagbitsl,0
ti=0;i<length;i++){//Ifthecurrentcharacteris'1',addthecorrespon,0
rue;}}//Updatethestackoffunctionsandt,0
tlineexecuted,thenensuretopopmainf,0
l<<"Valueofimmediateisoutofrange";,0
loc){//Gothroughallthevaluesthattheuserhasspecifiedandstorethemstartingforl,0
nspecifiedbythemem_locfor(inti=1;i<instruction.size();i++){uint64_tstore_value=,1
ister_values[rs2];//Performstoreaspertheinstr,1
nst=="andi"){register_values[rd]=register_values[rs1]&i,2
("cache_simdump")){stringmyfile_out_name=,1
ing,string>funct7;unordered_map<string,char>format;uno,1
decimal%2+'0');decim,0
enowextractthevalueofadd,0
();stack_of_functions.push({top_of_s,1
hex_PC<<endl;//Ensuretoremovethecalledfunctionfromthestackoffunct,0
acache.assign(no_of_indexes,vector<vector<int>>(associativity,vector,2
(inti=0;i<8;i++){byte[i]=read_access(start_location+i,accessed_once);accessed_once,2
d_operands.insert("lh,0
":Address:"<<hex_address<<",Set:"<<hex_set<<","<<hit_or_miss<<",Tag:"<,0
line=stack_of_functions.top().second;top_line=,1
memory[mem_loc]=val;//Incaseofwritethroughandmiss,wedonotcontactthecacheatall.So,weneedtoprinti,1
stack_of_func,0
e(index,tag,true,mem_loc,"read",true,false);returnval;}}}else{returnmemory[mem_loc];}//Thiswi,3
}elseif(format[cur_instr[0]]=='B'){step_,3
ions[PC/4];intpos=executed_instruction.f,1
umberofmemorybytesstartingfrommemorylocationspecifiedbytheuserstrings_addr="";//storethes,0
thevalueofindexbitsofmemorylocationbeingrequestedbypro,0
6";}elseif(r=="s11"||r=="x27"){r="x27";}elseif(r=="t3"||r=="x28"){r="x28";}elseif(r=="t4"||r,4
d,Dirty,tag,dataif(cache_block[0]==0){,2
d()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueof,1
matformat["addi"]='I';format["xori"]='I';format["ori"]='I';f,3
ealongwithcheckingifitiswithinrangeif(assembly_cod,0
Functiontostoredwordintstore_dword(vector<string>instruction,intmem_loc),2
ion[i]!='(',1
top_of_stack=stack_of_functions.top().first;inttop_line=stack_of_functions,1
lseif(r=="sp"||r=="x2"){r="x2";}elseif,2
rtythenblocksizeforthenumberofbytesinthecachedatacache.assign(n,0
characters67ofhex_instruc,0
x=hex.substr(i);returntrimmed_hex;},1
instructionstringopcode="0100011";stringf3=funct3[as,0
dirtynew_data[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,,1
_decimal(bin_s_addr);intcount=stoi(s_count),2
tmem_loc){//Got,0
uction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i+,2
]^register_value,0
[index][i]=cache_block;re,2
top());dummy_stack,1
_address="0x"+binary_to_hex(bin_address,false,5);stringbin_set=decimal_to_binary(index,20,0);st,2
(register_values[rs1]==register_values[rs2]),3
++){new_data[k]=m,1
de<stack>#include<queue>#include<random>#include<iomani,3
ize);//Let'sgetthevalueofoffsetbitsintoffset=offset_mask&mem_loc;//Wenowhavetheindexandtagw,0
tput.close();}elseif(command=="cache_siminv,1
ur.push_back(instruction[i]);}else{if(cur[cur.size()-1]==,4
tor<uint8_t>byte(8);for(i,2
dex=index_mask&mem_loc;i,0
Updatethestackoffunctionsandtheirlastexe,0
"]='I';format["andi"]='I';format["slli"]='I';format["srli"],3
shifting_amount!=0){register_values[rd]=register_values[rs1]>>register_values[rs2];,3
tpos=executed_instruction.find('');stringf,1
t_size=log2(block_size);//Thesemanybitsareforoffsetintindex_si,1
sstringinstr=imm+rs1+f3+rd+opcode;stringhex_instruction=binary_to_hex(instr);vector<stri,1
cur_instruc,0
ng>cur_instr=assembly_code[PC/4];if(format[cur_instr[0]]=='R'){step_R(cur_instr,4
boolisNegative=false;if(decimal<0){isNegative=true;}decimal=abs(decimal);stringbin="";wh,2
owcheckiftheremoveddatahasa,0
eif(r=="a3"||r=="x13"){r="x13";}elseif(r=="a4"||r=="x14"){r="x14";},4
[instruction_no].size()!=3){cout<<"Errorinline:"<<in,2
_to_hex["1010"]='a';bin_to_hex["1011"]='b',2
ypeformat,youmustenter4operands"<<,0
seif(format[cur_instr[0]]=='J'){step_J(cur_instr);}elseif(format[cur_instr[0]]=='U'){ste,8
/Getthetagwhichwene,0
struction_no][2])==l,1
oupdatethememoryif(,0
ted:"<<executed_instruction<<";PC="<<hex_PC<<endl,0
ctions[PC/4];intpos=executed_instruction.find('');s,2
scanbehandledbyourcode#definestoistoll#defineintlonglongusingnamespa,0
te(2);byte[0]=store_v,2
o_binary(stoi(assembly_code[instruct,0
_no][0]]=='B'){execute_B(a,1
rutionstringf3=funct3[assembly_code[instruction_no][,1
dirty="Clean";stringread_or_write="W";if(is_hit){hit_or_miss="Hit";}if(is_dirty){cl,3
w"]='I';format["lh"]=,1
r<uint8_t>byte(4);for(inti=0;i<4;i++){byte[3-i]=store_value>>(3-i)*8;}for(inti=0;i<4;i++,5
hevariouspartsstringinstr=imm.substr(0,7)+rs2+rs1+f3+imm.subst,1
ruction_no+1<<endl<<"Incorrectvalueofrd";exit(0);}elseif(registers.f,1
bin_to_hex[b]);}if(length*4>binary.,1
nvalidframe,ignorecontinue;}if(cache_block[2]==tag){if(!a,2
glystringtop_of_stack=stack_of_functions.top().first;inttop_line=stack_of_f,1
in_to_hex[b]);}if(length*4>binary.size()){st,3
ummy_q.front();dummy_q.pop();q.p,2
te[5]<<40)|(byte[4]<<32)|(byte[3]<<24)|(byte[2]<<16)|(byte[1]<<8)|byte[0];register,6
x(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//,1
lock;returnval;}}//Ifwewerenotabletofindanyinvalidblock,weneedtoapplyrep,0
|=(removed_data[2]<<(offset,1
offsetbitszero//Letusdothesameforindexmakintindex_m,0
;j++,k++){new_data[k]=memory[j];}if(operat,3
ativity=0,thenweneedtomakeitfullyassociativeif(,0
_store[0]==".half"){data_base_address=store_half(to_store,data_base_address);}elseif(to_s,3
='9';bin_to_hex["1010"]='a';bin_to_hex["1011"]='b';bin_to_hex["1100"]='c';bin_to_hex["11,3
_tag<<","<<is_clean<<endl;}}}myfile_out.close();}elseif(command=="cache_simstats"){,2
thelabelsfromthe,0
=="sw"){boolaccessed_once=false;vector<uint8_t>byte(4);,2
x<<offset_size);for(inti=0;i<block_size;i++){memory[to_store_mem_loc+,0
>instruction){//Extractthers1,rs2andimmediatevaluesstringrs1,rs,0
'suint64_tmask=,0
ize=log2(cache_size/(associativity*bloc,0
inti=dummy_stack.size()-1;i>=0;i--),1
ctionif(inst=="addi"){register_values[rd]=register,2
ed_instruction=all_instructions[PC/4];intpos=executed_instruction.find('');stringfirst_word=e,2
in['2']="0010";hex_to_bin['3'],2
on_no][3])>=pow(2,6)){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofra,2
stringvalue_of_register_hex=binary,0
pdate_queue(index,tag,false,mem_loc,"read",true,false);cache[index][i]=cache_block,3
n_no][3])>=pow(2,6)){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange,2
d=executed_instruction.substr(0,pos);if(first_word.back()==':'){executed_instruction=exec,3
os+1);}stringbin_PC=decimal_to_binary(old_PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_,2
[assembly_code[instruction_no][2]]-instruction_no*4);}if(registers.find(assembly_code[instruction,3
111";stringbin="";for(inti=0;i<hex.size();i++){bin+=hex_to_bin[hex[i]];}r,4
lllaodoperandsvoidinitialize_load_operands(,0
ver(instruction[2]);imm=stoi(instruction[3]);//Weassumethatrs1alwaysst,4
ce=true;}uint32_tres=byte[3]<<24|byte[2]<<16|byte[1]<<8|byte[0];registe,4
nt>removed_data(cache[0][0].size());vector<int>new_data(cache[0][0].size());intstart_storage,9
_hit=false;//Letusfirstfig,0
ouldbeoftheremoveddatano?to_store_mem_lo,0
ask=1;temp_mask=temp_mask<<offset_size;temp_mask=temp_mask-1;index_mask=index_mask^temp_ma,0
ur;cur="";continue;}if(cur[cur.size,0
"001";funct3["sw"],1
1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Inc,1
hifting_amount!=0),0
atinatingtheinstructionstringins,0
atethePCandensurethatx0remainsatv,0
"]="101";funct3["addi"]="000";funct3["xori"]="100";funct3["ori"]="110";funct3["andi",3
}//Take1'scomp,0
t64_tshifting_amount=register_values[rs2];if(shifting_amount!=0){register_va,2
size();j++){if(cache[i][j][0]==1&&cache[i][j][1]==1){intoffset_si,8
<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_,1
executed_i,0
"ld"]="011";funct3["lbu"]=",1
cation,false);uint16_tbyte1=read_access(start,0
imal_to_binary(PC,32,0);stringhex_PC=binar,1
_instructions[PC/4];intpos=exe,1
"0100011";stringf3=funct3[assembly_code[instruction,0
grs1=registers[assembly_code[instruction_no][2]];st,3
int>labels;unordered_map<string,int64_t>register_values;unordere,1
=1){intoffset_size=log2(block_size);//Thesemanybitsareforof,1
block_size;intend_storage=(mem_loc/block_s,0
r="x5";}elseif(r=="t1"||r=="x6"){r="x6";}elseif(r=="t2",2
ag,datainthits=0,misses=0;stringcurrent_opened_file="";vector<queue<int>>order_of_a,2
//CodefortheJformatstepinstructionsvoidstep_J(vector<st,0
//Ifwewerenotabletofindanyinvalidblock,weneedtoapplyre,0
se{opcode="0010011";}//Notingthevai,1
){intdecimal=0;intlength=bin.size();//Iterateoverthebinarystringfor(inti=0;i<length;i++){//Ifthecur,1
=registers.end,0
)-1;if(shifting_amount==0){for(inti=0;i<=63;i++){mask+=pow(2,i);}}register_values[rd]=regis,4
start_storage,k=3;j<=,0
}elseif(!command.find("cache_simdump")){stringmyfile_out_name=command,2
command=="step"){//Gostepbystepintno_of_instr,0
mem_loc];update_queue(index,tag,true,mem_loc,"read",true,false);returnval;}}}else{returnmemor,1
ethat64bitscanbehand,0
t}}returndecimal;}//Definingallregist,0
intdummyi=i;charnum1=dummyi%10+'0';dummyi/=10;charnum2=dummyi%10+'0';this_register+=num2;this_regis,0
gs,suchthatafterexecutionofeachrun,wecandequeuethetopstringins,0
art_storage=(m,0
on_no+1<<endl<<"Incorrec,0
ormat["lb"]='I';format["lbu"]='I';format["lhu"]='I';format["lwu,3
ty";}stringbin_set=decimal_to_binary(i,20,0);stringhex_set="0x"+binary_to_hex(bin_set,true,5,1
(mem_loc/block_size)*block_size+(block_size-1);new_data[0]=1;//The,3
e[instruction_no][3]),12,true);}//Concatinatingthevaluesstringinstr=imm+r,2
;break;}elseif(!command.find("mem")){//Hereweshowthecountnumberofmemorybytesstartin,2
ion_no][2])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrec,2
n.substr(0,pos);if(first_word.back()==':'){executed_instruction=executed_instruction.substr(pos+,3
if(registers.find(assembly_code[instruction_no][2])==registers.end()){cout<<"Errorinline:"<<instru,5
nct3["sra"]="101";funct3["addi"]="000";funct,2
if(first_word.back()==':'){executed_instruction=executed_instruction.substr(pos+1);}stringbin_PC=dec,4
hemainstackandprintthefortheuservector<pair<string,0
ndifso,weneed,0
xecute_I(vec,0
cimal=abs(decimal);stringbin="";while,1
inatingthev,0
seif(registers.find(assembly_code[instruction_no],1
i];}}}}if(replacement_policy=="RANDOM"){//Hereweareonlydealingwithcacheandno,1
uction[2]);}imm=imm<<12;register_values[rd]=imm;//Updatethestackoffunctionsandtheirlastexecute,2
sthattheuserhasspecifiedands,0
_instr);imm=decimal;}else{imm=stoi(instruction[2]);}imm=imm<<12;regis,3
nstruction=executed_instruction.substr(po,0
tringimm=decim,0
che[i][j].size();k++){cache[i][j][k]=0;}}}assembly_code.clear();assembly_code.assign(0,8
s2];if(shifting_amount!=0){register_values[rd]=register_v,2
cacheintcache_size,block_size,associativity;stringreplaceme,0
ister_values["x0"]=0;}//Codef,1
binary(intdecimal,intno_of_bits,boolisSigned){boolisNegative=false;,1
yte=read_access(start_location,false);uint8_tres=byte;register_values[rd,1
ary_register_no+=to_string(i-28+3);registers[temporary_register_no]=this_registe,2
nline:"<<instr,0
er_values[rd]=register_values[rs1]<<register_,2
nitialize_format();in,1
<"CacheSize:"<<cache_size<<endl;cout<<"BlockSize:"<<block_size<<endl;cout<<"Associativit,0
];}}//CodeforBformatinstructio,0
ite_access(mem_loc,0
ethestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=stack_of_fu,0
;}elseif(r=="s11"||r=="x27"),1
s1,rs2,inst;intimm;i,0
thestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack,0
lseif(registers.find(assembly_code[instruction_no][2])==registers.end()){cout<,5
p_line=PC/4+1;stack_of_functions,0
op().first;inttop_line=stack_of_funct,1
ta(cache[0][0].size());vector<int>new_data(cache[0][0].size());ints,9
"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forJtypeformat,youmuste,0
to_bin['a']="1010";hex_to_bin['b']="1011";hex_to_bin['c']="1100";hex_to_bin['d']="1101,4
<hit_or_miss<<",Tag:"<<hex_tag<<","<<clean_or_dirty<<"fromupdatequeue"<<,0
nstruction=binary_to_hex(instr);vector<st,1
kpointif(break_lines.find(br,0
f_functions.push({top_of_stack,top_line});stringexecuted_instruction=all_instructions[PC/4];intp,3
1]==1){is_dirty=,0
64_tstore_value=stoi(instruction[i]);v,2
=='S'){step_S(cur_instr);}elseif(format[cur_instr[0]]=='B'){step_B(cur_instr);}elseif(,7
k,top_line});stringexecuted_instruction=all_instructions[PC/4];intpos=exe,1
eirlastexecutedlineaccord,0
on.substr(0,pos);if(first_word.back()==':'){executed_instruction=executed_instruction.substr,3
string(i);stringthis_register=decimal_to_binary(i,5,false);registers[register_no]=this_r,3
cur;cur="";continue;}if(cur[cur.size()-1]==','||cur[cur.size()-1]==,4
er(instruction[1]);stringrs1=aliasRemover(instructio,2
the.dataor.te,0
x,forRtypeformat,youmuste,0
nsandtheirlastexecuted,0
n.find('');stringfirst_word=ex,1
tringfor(inti=0;i<length;i++){//Ifthecurrentcharacteris'1',addthecorrespondingpowero,0
();}}}elseif(command=="regs"){//Printtheregistervalueswhichares,2
0;//Initiallynotdirtycache_block[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,1
[instruction_no][0]]=='B'){execute_B(assembly_code,instruct,2
ti=0;i<4;i++){byte[3-i]=st,1
mp_mask=1;temp_mask=temp_mask<<offset_size;temp_mask=temp_mask-1;index_mask=index_mask,0
mem_loc;index>>=(offset_size);//Let'sgetthevalueofoffsetbitsintoffse,1
;}else{PC+=4;}}elseif(inst=="bge"){if(register_valu,2
vector<pair<string,int>>d,2
mem_loc){//Gothrough,0
mberofmemorybytesstartingfrommemoryloc,0
]=register_values[rs1]-re,1
mal_to_binary(i,5,false);registers[register_no]=this_re,2
nd(assembly_code[instruction_no][2])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<,4
"bgeu"]='B';//Jf,0
gister_values;unordered_map<string,string>registers_alis;vector<string>all,2
ing(i-10);registers[argument_register_no]=this_register;}elseif(i>=18&&i<=27){st,2
emoved_data[3+i];}}}}if(replacement_policy=="LRU"){if(!to_replace){w,3
}elseif(r=="a2"||r=="x12"){r="x12";}e,2
rs();initialize_funct3();initialize_funct7();initi,3
findanyinvalidblock,weneedtoapplyreplacementpolicyif(!found_invalid){val=memory[mem_loc];update_,2
rorinline:"<<instruction_no+1<<endl<<"Inco,0
ringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC=,2
elseif(i==4){registers["tp"]=this_register;}els,3
=new_pc;}//Updatethestackoffunctionsandthe,0
<<endl<<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_to_binary(stoi(assembly_code[instr,1
tion.find('');stringfirst_word=executed_instruction.substr(0,pos);if(first_word.back,2
;bin_to_hex["0110"]='6';bin_to_hex["0111"]='7';bin_to_hex["1000"]='8';bin_to,3
functions.pop();stack_of_functions.push({top_of_stack,top_line});stringexecuted_instr,3
ack_of_functions.pop();stack_of_functions.push({top_of_,1
oolaccessed_once=false;for(inti=0;i<8;i++){byte[i]=re,1
t,64,1);stringvalue_of_register_hex=binary_to_hex(value_o,0
ter_values[rs1],val_rs2=register_values[rs2];if(val_rs1>=val_rs2){PC=new_pc;}else{PC+=4;,4
['d']="1101";hex_to_bin['e']="1110";hex_to_bin['f']="1111";stringbin="";,3
accessed_once=true;}int32_tres=(byte[3]<<24)|(by,1
p_back();}cur_instruction.pus,1
)!=break_lines.end()){break;//to_break=true;}vector<stri,2
_policy,write_back_policy;boolcache_enabled=false;vector<vector<vector<int>>>cache;//,3
if(r=="s7"||r=="x2,0
e_queue(index,tag,false,mem_loc,"read",true,false,0
ue=stoi(instruction[i]);vector<uint8_t>b,3
ock[1]=1;//Thecacheblockisnowdirtycache_block[2]=tag;found_invalid=true;update_queue(index,ta,2
truction_no].size()!=4){cout<<"Errorinline:"<,1
koffunctionsandtheirlastexecutedlineaccordinglystringtop,0
;}else{PC+=4;}}else,1
m=decimal_to_b,0
temp_mask;//Makesthepositionsofindexbitsandoffsetbitszero//Letusdothesameforindexmakintind,0
(removed_data[2]<<(offset_size+index_size));to_store_m,2
cuted_instruction.substr(pos+1);}stringbin_PC=decim,1
lse{memory[mem_loc]=val;}}intread_access(intmem_loc,boolaccessed_on,2
or<uint8_t>byte(4);for(inti=0;i<4;i++){byte[3-i]=store_value>>(3-i)*8;}for(inti=0;i,5
);}elseif(format[cur_instr[0]]=='B'){step_B(cur_instr);}elseif,5
cess(start_location,false),1
exit(0);}elseif(registers.find(assembly_code[instruction_no][2])==registers.end()){cout,6
ly_code[instruction_no],1
ize));to_store_mem_loc|=(i<<offset_size);for(inti=0;i<block_size;i++){memory[to_store_mem_loc+,0
to_hex(instr);vector<string>binary_bytes(4);for(inti=0;,3
ummy_stack;stack<pair<string,int>>dummy_stac,2
fiedasperth,0
ute_I(vector<vector<string>>&assembly_code,intinstr,2
_to_decimal(binary_bytes[i]);//characters67ofhex_instruction}for(inti=0;i<4;i++){memor,2
struction_no);}elseif(format[assembly_code[instruction_no][0],2
}//CodefortheIformatstepinstructionsvoids,0
r<string>binary_bytes(4);for(inti=,2
funct7["srl"]="0000000";funct7["sra"]="0100000";}//Definingtheformatofvariousinstruct,2
d('');stringfirst_word=executed_instruction,1
addr+count;i++){intmem_val=memory[i];s,1
structionif(inst=="beq"){if(register_values[rs1]==register_values[rs2]){PC=new_pc;}else{PC+=4;}}else,7
;imm=stoi(instruction[3]);//Performthearithmeticaspertheinstructionif(,2
0){//memory[mem_loc]=val;//Getthe,1
instruction_no][1]];stringimm=decim,1
if(inst=="lwu"){vector<uint32,1
C;cout<<"Executed:"<<executed_instruction<,0
frame,ignorecontinue;}if(cache_block[2]==tag){is_hit=true;found=tru,2
nstr[0]]=='R'){step_R(cur_instr);}elseif(format[cur_instr[0]]=='I'){step_I(cur_instr,6
branchnottakenintold_PC=PC;,0
onglongusingnamespacestd;//Declarethememory//intmemory[0x50001];vec,1
ds.insert("lh");load_operands.insert("lw");l,2
e+offset_size);index_mask=index_mask-1;temp_mask=1;temp_mask=temp_mask<<of,0
assembly_code[instruction_no][0]]=='S'){execute_S(assembly_code,instruction_no,2
]=this_register;}elseif(i==1){registers["ra"]=this_register;},3
d=false;for(inti=0;i,0
r_no+=to_string(i);string,1
ex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC=",1
)){intcur=q.front();q.pop();if(cur!=tag){dummy_q.push(cur);}}while(!dummy_q.empty()){intcur,8
<<instruction_no+1<<endl<<"Wrongsyntax,forItypeformat,youmu,0
te_J(vector<vector<string>,1
tracttherdandimmediatevaluesstringinst,rd;inst=instruction[0];rd=aliasRemover(inst,1
n,false);uint16_tbyte1=read_access(start_location+1,true);uint16_tres=byte1<<8|byte0;register_v,1
2stringinst=instructi,0
st=="sub"){register_val,0
nitialize_funct3(){funct3["add"]="000";func,2
_addr.push_back(command[i]);}}else{s_count.push_back(command[i]);}},5
<instruction_no+1<<endl<<"Incorrectvalu,0
values["x0,0
o][3])<-pow(2,11)||st,2
_bin['3']="0011";hex_to_bin['4']="0100";hex_to_bin['5']="01,3
_invalid=false;for(inti=0;i<associativity;i++){vector<int>cache_block(b,1
;}elseif(break_lines.find(PC/4+1)!=break_lines.end()){cout<<"Executionstoppedatbreakpoint\,3
porary_register_no,0
alwordfirstploicyintstart_storage=(,0
ize()!=3){cout<<"Errorinline:"<<instruction_no,1
string>to_store;stringcur="";for(charc:instruction){if(c==''||c==','){if(cur!=""),3
.top().second;top_line=PC/4+1;stack_of_functio,1
=abs(decimal);stringbin="";while(decimal!=0){bin.push_back(decimal%2+'0');decimal/=2;}while(bi,4
_decimal(binary_bytes[i]);,2
al_to_binary(old,0
r(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction.substr(,1
uction_no][3])>=pow(2,6)){cout<<"Errorinline:"<<instruction_no+1<<endl,2
tion_no);}elseif(format,0
)<0||stoi(assembly_code[instruction_no][3])>=pow(2,6)){cout<<"Errorinline:"<<instructi,5
ions.pop();stack_of_functions.push({top_of_stack,top_line},2
_no][1])==registers.end()){cout<<"Errorinline:",2
1]>=register_values[rs2]){PC=new_pc;}else{,2
==registers.end()){cout<<"Errorinline:"<<in,1
;}//Codetoconvertdecimaltobinarystringdecimal_to_binary(intdecimal,i,0
nary(mem_val,8,0);stringhex_mem_val="0x"+binary_to_hex(bin_mem_val,tru,1
];stringrs1=registers[assembly_code[instruction_no][2]];s,3
ues["x0"]=0;}//CodefortheIformatstepinstruc,1
tion=executed_ins,0
;vector<string>binary_bytes(4);for(inti=0;i<4,2
yfile_out_name=command.substr(15);ofstreammyfile_out;myfile_out.open(my,1
nd"]="0000000";fu,0
thememoryif(removed_data[1]==1){is_dirty=true;intto_store_mem_loc=0;to_store_me,2
<<instruction_n,0
nsofoffseybitszero//Weneedtodothisfortheo,0
ewhichisreplacedq.push(tag);//Pushthenewtagvaluevector,1
s){bin.push_back('0');}reverse(bin.begin(),bin.end());if(!isSigned||!isNegative){retu,6
='B';//Jformatformat["jal"]='J';//Uform,1
code[instruction_no][2]];stringimm;//Assigningtheimmediatealongwithcheckingifitiswithinran,2
oleblockfromth,0
ore_value;byte[1]=store_va,1
i];//Valid,Dirty,tag,dataif(cache_block[0]==,1
atx0remainsatvalue0PC=PC+4;register_values["x0"]=0;}//Codefor,1
out<<"Erroronline:"<<instr,0
uspartsstringinstr=imm.substr(0,7)+rs2+rs1+f3+imm.substr(7)+opcode;stringhex_instruc,2
_no].size()!=3){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forUtypeforma,1
unct3["lhu"]="101";funct3["lwu"]="110";funct3["jalr"]="000";funct3["sb"]="000";fu,4
struction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_to_binary(,1
else{if(stoi(assembly_code[instruction_no][3])<-pow(2,11)||stoi(a,4
(cache[0][0].size());vector<int>,5
[rs2];if(val_rs1<val_rs2){PC=new_pc;}else{PC+=4;}}//Updatethestackoffunct,3
;write_access(mem_loc,byte[0],false);write,2
es[rd]=res;}elseif(inst==,1
n[i]='1';}else{bin[i]='0';}}//Add1tofind2'scomplementfor(inti=bin.size(,3
write_access(mem_loc+1,byte[1],true);}if(inst=="sw"){boolaccessed_once=false;vector<uint8_t>byt,4
cktothecorrectposition,0
te_back_policy=="WT"){memory[mem_loc]=val;cache[index][i][1]=0;//Setittonon-dirt,4
k_lines.find(break_point-count_how_man,0
16|byte[1]<<8|byte[0];register_values[rd]=res;}//Updatethestackoffunc,3
st_word=executed_instruction.substr(0,pos);if(first_word.back()==':'){executed_instr,3
k&mem_loc;//Wenowhavetheind,0
nt-count_how_many_to_skip);cout<<"Deletedbreakpointatline:"<<break_point<<endl;}else{cout,0
ge=(mem_loc/block_size)*b,1
nstructionsvoidexecute_U(vector<vector<string>>&asse,2
_to_bin['2'],1
st=="srai"){register_values[rd]=register_values[rs1]>>imm;}//Updatethestackoffunctionsand,3
ster_values[rs1]&reg,1
-pow(2,12)||stoi(assembly_code[instruction_no][3])>=pow(2,12,4
ue(index,tag,t,0
"<<executed_instruction<<";PC="<<hex_PC<<endl;//Ensuretoremovethecalledf,0
tofindoutthetagbitslaterinttag_mask=1;tag_mask=,0
seif(r=="s3"||r=="x19"){r="x19";}elseif(r=="s4"||r=="x20"){r="x20";}elseif(r==,4
ckdeletesabeakpointintheprogramintbreak_point=stoi(command.substr(10));//Wedeleteth,2
rd=aliasRemover(instruction[1]);r,2
er_values[rs2];}elseif(inst=="or"){register_values[rd]=register_values,3
or<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction.sub,3
o_binary(assembly_code[instruction_no][2].substr(,2
i=0;i<instruction.size();i++){if(instruction[i]!=''&&instruction[i]!=',3
ed_instruction.substr(0,pos);if(first_word.back()==':',2
bly_code[instruction_no][1]];stringimm=decimal_to_binary(stoi(assembly_code[instruction_no][2]),21,,5
chifconditionsatisfiedaspe,0
Erroronline:"<<instruction_no+1<<endl<<"Incorrectsyntax";exit(0);}}}elseif(command=="run"){//Runt,2
ers[assembly_code[instru,0
_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//UpdatethePCvalueandensurethatx0,0
ghex_tag="0x"+binary_to_hex(bin_tag,true,5);cache_output<<"W"<<":Address:,1
"]='S';format["sd"]='S';//Bformatformat["beq"]='B';format["bge"]='B';format,3
["1110"]='e';bin_to_hex["1111"]='f';,2
=="regs"){//Printtheregistervalueswhicharestoredinthemapcout<<,0
t_size);//Let,0
alue,weneedtolookinthememoryif(!found){if(!accessed_once){misses++;}//First,3
y_code[instruction_no][2])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<,3
(assembly_code[instruction_no][2])>=pow(2,20)-1){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Va,4
ex_size=log2(cache_size/(associativity*block_size));//Thesemanyareforindexinttag_size=20-,2
(2,20)-1){cout<<"E,1
programintindex=index_mask&mem_loc;index>>=(offset_size);//Let'sgetthevalueofoffsetbitsin,1
ize();j++){cache[i][j][0]=0;//Makethevalidbitaszero}}}elseif(!command.find("cache,5
isblockinthecache,weloadt,0
stoi(s_count);//Printingtheloca,1
ode[PC/4];if(format[cur_instr[0]]=='R'){s,4
nstructionsvoidexecute_U(vector<vector<string>>&assembly_code,i,2
willneverbereached}else{//Firstcheckifwehaveaninvalidframe,andifwedo,thenwecandirectlyaddou,0
_loc+i,byte[i],accessed_once);access,1
r_instr[0]]=='S'){step_S(cur_instr);}elseif(format[cur_instr[0,3
]=='J'){step_J(cur_instr);}elseif(format[cur_instr[0]]=='U'){step_U(cur_instr);}else{exit(0);}//,9
hevariouspartsoftheinstructionstringopcode="110001,0
ster_values["x0"]=0;}//CodefortheSformatstepinstructionsvoidstep_S(vector<string>instruc,2
HitRate="<<fixed<<setprecision(3)<<(double)(hits)/(hits+misses);}stack_of_functions.pop();}}}e,5
0";hex_to_bin['7']="0111";hex_to_bi,1
addourvaluetoitb,0
p_line});stringexecuted_instruction=all_instructions[PC/4];intpos=executed_instruc,1
ected_line;stack<pair<string,int>>stack_of_functions;unordered_set<int>,3
/halfwordvector<string>to_store;stringcur="";for(,1
.h>#include<sstream>#include<stack>#include<queue>,3
()){intcur=dummy_q.fro,1
em_loc,"read",true,false);cache[index][i]=cache_block;returnval;}}//Ifwew,2
;}elseif(r=="t3"||r=="x28"){r="x28";}else,2
redtofindoutthetagbitslaterinttag_mask=1;tag_mask=tag_mask<<20;tag_mask=tag_mas,0
ticaspertheinstructionif(inst=="addi"){register_values[rd]=register,2
swhile(true){//Nowsavethenextfilestringcommand;getline(cin,command);if(!command.find("load")){//F,4
code[instruction_no][3])>=pow(2,11)){cout<<"Errorinline:"<<instruc,3
iasRemover(instruction[1]);rs1=aliasRemover(instruction[2]);imm=stoi(instruction[3]);//Performtheari,6
ecimal_to_binary(stoi(assemb,0
mask-1;//Thismakesthemask20onesinttemp_mask=1;temp_mask=temp_ma,0
nt=true;}}w,0
otdirtycache_block[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,1
et_size);//Gettingt,0
es;unordered_map<string,string>registers_alis;vector<string>all_ins,2
nstr);}elseif(format[cur_instr[0]]=='B'){step_B(cur_instr);},5
e;if(decimal<0){isNegative=true;}decimal=abs(decimal);stringbin="";while(d,2
ctionsvoidexecute_S(vector<vector<string>>&assembly_code,intinstruction_no){//Handlingerrorif(as,3
mp_mask<<offset_size;temp_mask=temp_mask-1;index_mask=index_mask^temp_mask;//Makesthepos,0
=aliasRemover(instruction[2]);stringinst=instruction[0];//Kee,3
:'){executed_instruction=executed_inst,0
ccessed_once=false;for(inti=0;i<8;i+,0
0][0].size());vector<int>new_data(cache[0][0].size());intstart_storage=(mem_loc/block_siz,7
;funct3["sw"]="010";fun,1
nt=stoi(s_count);//Printingthe,1
uction_no*4+i]=byte[i];}}//CodeforJformat,1
e[instruction_no][3])>=pow(2,11)){cout<<"Errorinline:"<<instruction_no,3
ti=0;i<4;i++){byte[3-i]=store_value>>(3-i)*8;}for(inti=0;i<4;i++){write_access(me,3
i++){byte[3-i]=store_value>>(3-i)*8;}for(inti=0;i<4;i+,3
natingthepartstoformtheinstructionstringinstr=i,0
otabletofi,0
8;i++){byte[7-i]=store_value>>(7-i)*8;}for(inti=0;i<8;i++){write_ac,3
ion.find('');stringfirst_word=executed_instr,1
".data"){data=tru,0
;intcount=stoi(s_count);//Printingthelocationsofthememoryasspecifiedusingalooopfor(inti=,1
de[instruction_no][2]);}if(dec_imm<0||dec,2
yte[1],true);}if(inst=="sw"){boolaccessed_once=false;vector<uint,2
belnotdefined";exit(0);}else{assembly_code[instruction_no][3]=to_string(labels[assembly_code[instru,3
nt<<endl;}elseif(!command.find(,0
ock[2]=tag;found,1
de[instruction_no][0,1
x(bin_address,false,5);stringbin_set=dec,1
];}//Ensurethatx0valuesremainsat0register_value,0
ettheactualvalueoftagbitsinthememorylocationthatourprogramisrequestingtoreadinttag=tag_mask&mem_loc;,0
nstrutionstringopcode="0110011";stringf3=funct3[assembly_code[instruction_no][0]];stringf7=funct7[a,3
ues[rd]=register_values[rs1,1
;while(!dummy_stack_function.empty()){dummy_stack.push_back(dummy_stac,2
ters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//Co,3
hex_PC<<endl;//UpdatethePCandensurethatx0remainsatvalue0PC=PC+4;register_values["x0"]=,1
t_size-index_size;//,0
rs.find(assembly_code[instr,0
instruction_no][3]),12,true);//Concati,1
no][2]];strin,1
ctor<string>instruction){//Keeptrackofthenewpcvalu,1
rrent_opened_file+".output";cache_output.open(cache_output_name);}//Converttheassemblyc,1
isters.find(assembly_code[instruction_no][1])==registers.end(,3
eif(registers.find(assembly_code[instruction_no][1],2
emoveddatano?to_sto,0
k^temp_mask;//Makesthepositionsofindexbitsandoffsetbitszero//Letusdothesamefori,0
3);cache_block=cache[index][i];//Valid,Dirty,tag,dataif(cache_block[0]==0){,4
or"){register_values[rd]=register_values[rs1]|register_values[rs2];}elseif(inst=="xor"){register_va,5
="<<misses<<",HitRate="<<fixed<<setprecision(3)<<(double)(hits)/(hits+misses);}stack_of_,4
ty<<endl;cout<<"ReplacementPolicy:"<<replacement_po,0
index>>=(offset_size);//Let'sgetth,1
C="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//UpdatethePCacc,0
ndoffsetbitszero//Letusdothesameforindexmakintindex_mask=1;index_mask=index_mask<<(index_size+offse,0
["x0"]=0;}//CodeforRformatinstructionsvoidexecute_R(vector<,1
es;rd=res;}elseif(inst=="lh"){int16_tbyte0=re,1
egister_values[rs1]|imm;}elseif(inst=="andi"){register,2
nge";exit(0);}//Notingthevariouspartsof,1
bytes[i]);//characters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=,2
ring>>&assembly_code,intinstruction_no){//Handlingerrorif(as,0
ethevalidbitaszero}}}elseif(!command.find("cache_simdump")){stringmyfile_out_name=command.sub,2
).first;inttop_line=stack_of,0
/Thesemanyareforindexinttag_size=20-offset_size-index_size;//Andthesemanyaret,0
<hex_tag<<","<<clean_or_dirty<<"fromupdatequeue"<<endl;}order_of_ac,0
lock_size-1);new_data[0]=1;//Thebitisnowvalidnew_data[1]=,2
_once);accessed_once=true;}int64_tres=(byte[7]<<56)|(byte[6]<<4,2
10"||r=="x26"){r="x26";}elseif(r=="s11"||r==,1
ltu"]='B';format["bgeu"]='B';//Jf,1
Executed:"<<executed_instruction<<";PC="<<he,0
mm,20,true);//Concatinatingtheinstructionstringinstr=imm+rd+opcode;stringhex_instruction=binary_to_h,0
_policy;boolcache_enabled=false;vector<vector<vector<int>>>cache;//Valid,dirty,tag,datainthit,3
gister_no="t";temporary_register_no+=to_string(i-28+3);registers[tempora,1
x30";}elseif(r=="t6"||r=="x31"){r="x31";}returnr;}voidupdate_queu,2
ze());vector<int>new_data(cache[0][0].size());intstart_storage=(mem_loc/block_size)*block_size;in,7
binary_bytes[i]);//characters67ofhex_instruction}for(inti=0;i<4;i++){mem,1
,tag,dataif(cache_block[0]==0){//Thisisaninvalidframe,ignorecontinue;}if(cache_block[2]==tag,4
step_I(cur_instr);}elseif(format[cur_instr[0]]=='S'){step_S(cur_in,4
ahasadirtybitset,andifso,weneedtoup,0
ingexecuted_instruction=all_instructions[PC/4];intpos=executed_instruction.find('');s,2
bitaszero}}}elseif(!command.find("cache_simdump")){stringmyfile_out_name=comm,2
)<no_of_bits){bin.push_back('0');,1
cache[index][i];cache[index][i]=new_data;break;}}//Nowcheckift,4
and=="regs"){//Printtheregistervalueswhicharestored,0
tialize_funct7(){funct7["add"]="0000000";funct7["sub"]="0100000";funct7["and"]="0000000",4
uction){cout<<"Nothi,0
em_loc|=(index<<offset_size);for(inti=0;i<block_size;i++){memory[to_store_mem_loc+i]=removed_data,1
ourprogramisrequestingtoreadinttag=tag_mask,0
"x6";}elseif(r=="t2"||r=="x7"){r="x7";}elseif(r=="s0"||r=="fp"||r==",2
struction[2]);//Extracttherdva,1
<<endl<<"Valueofimmediateisoutofrange";exit(0);,1
truction[0];rd=aliasRemover(instruction[1]);intimm;//Weac,3
ingaliasRemover(stringr){if(r=="zero"||r=="x0"){r="x0";}elseif(r=="ra"||,3
e.clear();break,1
_s_addr=hex_to_binary(s_addr);intad,1
ruction[i]);uint8_tbyte=store_value;memor,1
r;}elseif(i>=10&&i<=17){stringargument_reg,0
lfunct7valuesvoidinitialize_funct7(){funct7["add"]="0000000";funct7,2
led=false;cache_output.close();}elseif(command=="cache_siminvalidate"){if(ca,2
h({top_of_stack,top_line});stringexecuted_instruction=all_instru,2
lock_size));//Thesemanyareforindexinttag_size=20-offset_size-index_size;//Andthesemanyareta,0
(offset_size);offset_mask=offset_mask-1;//Wecannowgettheactualvalueoftagbitsinthememory,1
=register_values[rs1]>>imm;}//Updatethestackoffunctionsandtheirlastexecut,1
inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));},4
ruction[3]);//Dothearithmeticaccordingtotheinstructionsif(inst=="add"){register_val,2
acheblockisnowdirtycache_block,0
tothecorrespondinginstructionif(load_operands.find(assembly_code[instruction_no][0])!,3
{data_base_address=store_byte(to_store,data_base_address);}}continue;}//removeunnecessaryspacef,2
che_block[2]==tag){is_hit=true;f,1
nstruction[2,0
ize+(block_size-1);cache_block[0]=1;//Thebitisnowvalidca,2
icharestoredinthemapcout<<"Registers:\n";,0
y=cache_size/block_size;}i,0
ngdecimal_to_binary(intdecim,0
='I';format["xori"]='I';format["ori"]='I';format["andi"]='I';format["slli"]='I';format["srl,4
alues[rs1]<<register_values,1
)'){cur.pop_back();}cur_instruction.push_back(cu,2
t3["sll"]="001";funct3["srl"]="101";funct3["sra",2
r=="s3"||r=="x19"){r="x19";}elseif(r=="s4"||r=="x20"),2
ndlingerrorif(assemb,0
"cache_simstatus"){if(cache_enabled){,1
cur="";}}if(cur!=""){if(cu,1
]=0;}//CodefortheJformatstepinstr,0
lueat0PC=PC+4;register_values["x0"]=0;}//CodefortheBformatstepinstruct,1
//Initiallyeverythingisinvalid,andothersdontmatterorder_of_access.clear();order_of,1
emp_mask=temp_mask-1;tag_mask=tag_mask^temp_mask;//Makesthepositionsofindex,0
^register_values[rs2];}elseif(inst=="sll"){register_values[rd,2
/Thesemanybitsareforoffsetintindex_siz,0
ut<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,,0
t=="addi"||inst=="xori"||inst=="ori"||inst=="andi"||inst=="srai",0
_instruction<<";PC="<<hex_PC<<endl;//Ensuretore,0
t3["srli"]="101";funct3["srai"]="101,2
d_map<string,int64_t>register_values;unordered_map<string,string>registers_alis;vector<,2
lib>#include<math.h>#include<s,1
c){//Gothroughallthevaluesthattheuserhasspecifiedandstorethemstartingforlocationspecified,0
_to_bin['c']="1100";hex_to_bin['d']="1101";hex_to_bin['e']="1110,3
Codetoconverthexadecimaltobinarystringhex_to_binary(string,0
s.push_back(instruction);stringcur="";for(inti=0;i,1
ssaryinformationunordered_map<string,string>registers;unordered_map<string,st,1
uePC+=4;}elseif(inst=="jalr"){//Extracttherd,rs1andimmediatevaluerd=aliasRemover(instruct,1
voidstep_J(vector<string>instruction){//Storethenewpcvaluetoj,2
tion_no].size()!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forBtypef,1
ruction_no,0
{//Printtheregistervalueswhicharestoredinthemapcout<<"Registers:\n";,0
euewillneverbereached}else{//Firstcheckifwehaveaninvalidframe,andifw,0
lesthatthepreviousfilemigh,0
struction.substr(0,pos);if(first_word.back()==':'){executed_instruction=executed_instruction,3
ss(start_location,,0
ed_once=true;}uint32_tres=byte[3]<<24|byte[2]<<16|byte[1]<<8|byte[0];register_values[rd]=res;}//Up,5
offsetbitszero//Letusd,0
outofrange";exit(0);}//Notingthevariouspartsoftheinstructionstringopcode="1100011";stringf3=fu,1
binary_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tby,3
4"){r="x14";}elseif(r=="a5"||r=="x15"){r=",2
inary_to_hex(instr);vector<string>binary_b,2
":Address:"<<hex_address<<",Set:"<<hex_set<<","<<"Miss"<<",Tag:"<<hex_tag<<","<<"Clean",0
ile_name=command.,0
PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<",0
ssembly_code[instruction_no][3])<-pow(2,12)||stoi(assembl,3
uction.substr(6-2*i,2));}uint8_tbyte[4];for(in,2
i=0;i<block_size;i++){memory[to_stor,0
to_store_mem_loc+i]=removed_data[3+i];}}}}if(replacement_policy=="LR,1
op_line=stack_of_funct,0
formatformat["jal"]='J';//Ufo,1
stack_of_functions.push({"main",0});last_exe,2
text"){data=false;}else{//Storetherequireddword/word/byte/halfwordvector<string>to_store;stringcur,2
1]!=register_values[rs2,0
nline:"<<instruction_no+1<,0
avetoinsertabreakpointintbreak_point=stoi(command.substr(6));//Wetakeintoac,2
m;//Performloadaspertheinstructionif(inst=="lb"||inst=="lh"||inst=,0
0||dec_imm>4294963200){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisouto,0
tinstructi,0
reak_point-count_ho,0
ex["1100"]='c';bin_t,1
r=="x26"){r="x26";}elseif(r=="s11"||r=="x27"){r="x27";}elseif(r=="t3"||r=="x28",3
ndi"||inst=="srai"||inst=="slli"||inst==,0
++){uint64_tstore_valu,0
}else{dec_imm=stoi(assembly_code[instruction,0
);while(!st,0
>byte(8);for(inti=0;i<8;i++){byte[7-i]=store_value,2
ringhex_set="0x"+binary_to_hex(bin_set,true,5);stringbin_tag=decimal_to_binar,1
dex][i];//Valid,Dirty,tag,dataif(cache_block[0],2
aminstruction_file;vector<vector<string>>assembly_c,2
data[0]=1;//T,1
i++){write_access(,0
e";exit(0);}imm=decimal_to_binary(stoi(assembl,1
_of_instruction){cout<<"Nothingtostep\n";}els,0
101";funct3["lwu"]="110";funct3["jalr"]="000";f,2
date_queuewillneverbereached}else{//Firstcheckifwe,0
32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC,1
_no++){if(format[assembly_code[instruction_no][0]]=='R'){execute_R,4
y[to_store_mem_loc+i]=removed_data[3+i];}}}}if(replacemen,2
gs,suchthatafterexecutionofeachrun,wecandequeuethetopstringinstru,0
ers["s0"]=this_register;registers["fp"]=this_register;}elseif(i==9){registers["s1"],4
cimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC=",2
ntindex,inttag,boolto_replace,0
{byte[i]=bina,1
/Valid,Dirty,t,0
size));//Thesemanyareforindexinttag_size,0
hichweneedtoreplaceq.pop();,1
t=="jalr"){//Extrac,0
hismakesthemask20onesintt,0
andstoreitina2dmatrixofstringsvector<string>cu,1
);offset_mask=offset_mask-1;//Wecannowgettheactualvalueoftagbitsinthememorylocationthat,0
e){if(cach,0
);stringbin="";while(decimal!=0,0
_size));//Thesemanyareforindexinttag_size=20-offset_size-index_size;//And,0
t>byte(8);for(inti=0;i<8;i++){byte[7-i]=store_value>>(7-i)*8;}for(inti=0;i<8;i++){memory,4
hebitisnowv,0
etodisplaythememorystrings_,0
on_no=0;instruction_no<assembly_code.size();instruction_no++){if(format[assembly_c,1
);initialize_funct3();initialize_funct7();initializ,2
g_size=20-offset_size-index_size;//Andthesemanyaretagbitsboolis_dirty=false;if(,0
itsareforoffsetintindex_size=log2(cache_size/(associa,0
ock[0]=1;//Thebitisnowvalidcache_block[1]=0;//Initiallynotdirtycache_block[2]=tag;for(in,3
+rs2+rs1+f3+rd+opcode;//Nowletuswriteintothetextsegmentofthememory://Wehavetheinstructionn,0
ormat["andi"]='I';format["slli"]='I';format["srli"]='I';format["srai"]='I';format["ld"],5
f(inst=="sw"){boolaccessed_once=false;vector<uint8_t>byte(4);for(inti=0;i<4;i++){byte[3-i]=store_va,4
"]="0000000";funct7[,0
ne});stringexecuted_instructio,0
tj=start_storage,k=3;,0
;boolcache_enabled=false;vector<v,0
eingrequestedbyprogramintindex=index_mask&mem_loc;index>>=(offset_size);//Let'sgettheva,1
<<",Miss="<<misses<<",HitRate="<<fixed<<setprecision(3),1
tions.empty(,0
+1<<endl<<"Valueofimmediateis,0
<iostream>#include<string>#include<,2
thatx0remainsatvalue0PC=PC+4;register_values["x0",0
ruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[,1
fmemorylocationbeingrequestedbyprogramintin,0
tringinstr=imm+rd+opcode;stringhex_instruction=binary_to_hex(instr);v,1
queuewillneverbereached}else{//Firstcheckifwehaveaninv,0
instr);}elseif(format[cur_instr[0]]=='B'){step_,3
r_values[rd]=register_values[rs1]>>re,2
_tag="0x"+binary_to_hex(bin_tag,tr,0
rmationuno,0
Wehavetheinstructionnumberinthevariableinstruction_nostringhex_instruction=binary_to_h,0
isses++;if(write_back_policy,0
;}imm=decimal_to_binary(stoi(assembly_code[instruc,0
oc/block_size)*block_size+(block_s,0
startingforlocationspecifiedbythemem_locfo,0
d_data(cache[0][0].size());vector<int>new_data(cache[0],6
ss(start_loc,0
or<string>instruction){//Storethen,1
slli"]='I';format["srli"]='I';format["srai"]='I';format["ld"]='I';format["lw"]='I';forma,4
ing>>&assembly_code,intinst,0
tionstringopcode="1100011";stringf3=funct3[assembly_code[instruction_no][0,1
eturnthenewmem_locwhereyoucanwritetonextreturnmem_loc;}/,0
ext(.text)count_how_many_to_skip++;if(instruction==".text"){data=false;}else{//Storetherequired,3
ction.substr(pos+1);}stringbin_PC=decimal_to_bin,1
PC/4];intpos=executed_instruction.find('');str,1
{memory[instruction_no*4+i]=byte[i];}}//CodeforUformatinstructionsvoidexecute_U(v,3
or(intj=0;j<cache[i].size();j++){cache[i][j][0]=0;//Makethevalidbitaszero}}}else,6
:Accesses="<<h,0
truction_no][0]=="jalr"){opcode="1100111";}else{opcode="00,2
ector<queue<int>>order_of_access;ofstreamcache,2
te=read_access(start_location,false);uint8_tres=byte;register_values[rd,1
rrorinline:"<<instruction_no+1<<endl<<"Incorrectvalueof,0
&mem_loc;index>>,0
function.top());dummy_stack_functio,1
atingtheinstruction,0
offset_size);offset_mask=offse,0
ster_values[rs2];}elseif(inst=="and"){regi,2
moved_data(ca,0
ememorystrings_count="";//Countofthenumberofmemorylocati,0
(0);}}}elseif(command=="run"){//Runtheentirecodetillthebreakpointintno_of_instruction=assembl,2
d_data(cache[0][0],2
rd=executed_instruction.substr(0,pos);if(first_word.back()==':'){exe,3
on//Ifwefindt,0
cimal!=0){bin.push_back(decimal%2+'0');decimal/=2;}while(bin.size()<,3
ecuted:"<<executed_instruction<<";PC="<<hex_PC<<endl;//UpdateP,0
ut<<"Executionstoppedatbreakpoint\n";}else{while(PC/4<no_of_instruction){if(break_,0
hex;bin_to_hex["0000"]='0';bin_to_he,1
acedq.push(tag);//Pushthenewta,1
ed_instruction.find('');stringfirst_word=executed_ins,1
1+f3+rd+opcode;//Nowletuswriteintothetextsegmentofthemem,0
ring,string>registers_alis;vector<string>all_instructions;u,1
reak;}}//Nowcheckiftheremoveddatahasadirtybitset,andifso,weneedtoupdatethememoryif(removed_data[1]=,1
y_code[instruction_no][0]];stringrs1=registers[assembly_code[instruction_n,2
lacement_policy,,0
*4<binary.size()){hex=hex.substr(,1
){executed_instruction=executed_instruction.,0
imm=decimal_to_binary(stoi(asse,0
g(i-5);registers[temporary_register_no]=this_register;}elseif(i==8){reg,3
nghex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<,3
;}if(cur[cur.size()-1]==','||cur[cur.size()-1,3
ary_to_hex(bin_t,0
3=funct3[assembly_code[instruction_no][0]];stringr,3
ed:"<<executed_instruction<<";PC="<,0
disable"){cache_enabled=false;cache,0
ed_data[3+i];}}}}}//Hereweneedtoensurethatallthebocksarewrittenifdirtyfor(inti=0;i<cache.size(,1
ndextractthers1andrs2valuesintnew_pc=PC+stoi(instruction[3]);stringrs1=aliasRemove,2
texecutedlineaccordinglystringtop_of_stack=stack_of_functions.top().,1
4"){r="x14";}elseif(r=="a5"||r=="x15"){r="x15";}elseif(r=="a6"||r=="x16"){r="x16";}elseif(r==,5
e_block[2]==tag){is_hit=true;found=true;val=cache_block[3+offset];/,2
;unordered_,0
Notingthevaiouspartsoftheinstrctionstringopcode="01101,0
ingbinary_to_hex(stringbinary,booltrim=fa,0
<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";e,0
l,true,2);intmem_loc=i;stringmem_loc_bin=decimal_to_binary(i,20,0),1
!=""){to_store.push_back(cur);}cur="";}else{cur.push_back(c);}}if(cur!=""){to_store.push_back(cu,5
t_exected_line;stack<pair<string,int>>stack_of_functions;unordered_set<int>break_lin,3
ned_file.pop_back();PC=0,1
_U(assembl,0
loc,byte[0],false);write_access(mem_loc+1,byte[1],true);}if(inst=="sw",3
.pop();stack_of_functio,1
+count;i++){intmem_val=memo,0
30"){r="x30";}elseif(r=="t6"||r=="x31"){r="x31";}returnr;}voidupdate_queue(intindex,,3
ction_no][,0
_file="";vector<queue<int>>order_of_a,2
n_no][3])>=pow(2,11)){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisouto,2
);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<execut,1
(vector<vector<string>>&assembly_code,inti,2
gtheinstructionstringinstr=imm.substr(0,1)+imm.substr(10,10)+,2
lseif(inst=="or"){register_values[rd]=register_values[rs1]|register_values[r,3
ssembly_code[instruction_no][2])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<,3
sk=index_mask-1;temp_mas,0
k_point_line_to_remove;if(PC/4==no_of_i,0
!=break_lines.,0
ntdecimal=binary_to_decimal(bin_instr);dec_imm=decimal;}el,1
isters.find(assembly_code[instruction_no][1])==reg,3
[0]]=='S'){execute_S(assembly_code,instruction_no);}elseif(fo,3
ring>instruction){//Extractrd,rs1,rs2stringinst=instruction[0];stringrd=aliasRemover(instruction[1]),3
substr(2,6)+rs2+rs1+f3+imm.substr(8,4)+imm.substr(1,1)+opcode;stringhex_instruction=binary_to_hex,3
y[i];stringbin_mem_val=decimal_to_binary(mem_val,1
lse);uint16_tbyte,0
ister_values[rs1]!=register_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=,4
urnmemory[mem_loc];}//Thiswillneve,1
sembly_code[in,0
inti=0;i<hex.size(,0
epinstructionsvoidstep_J(vector<string>instruction){//Storethenewpcv,2
d_access(start_location+i,accessed_once);accessed_once=true;}uint32_tres=byte[3]<<2,2
ndl<<"Incorrectvalueofrs2";exit(0);}elseif(stoi(assembly_code[instruction_no][3])<-pow(2,12)||sto,5
_miss="Miss";stringclean_or_dirty="Clean";stringread_or_write="W";if(i,0
//Andthesemanyaret,0
oc=0;//Hereth\etagandindexshouldbeoftheremoveddatano?to_store_mem_loc|=(removed_data[2]<,1
m_loc_bin,,0
ag=tag_mask&mem_loc;ta,0
to_binary(m,0
torehalfwordintstore_half(vector<string>instruction,intmem_loc){//Gothroughallthevaluesthattheuserha,2
]="000";funct3["and"],1
thenecessaryinformationunordered_map<string,string>registers;unordered_map<string,string>funct,2
ction.substr(0,pos);if(first_word.back()==':'){executed_,3
//Iflastlineisexecuted,thenensuretopopmainfromthestackif(PC/4==no_of_inst,0
untofthenumberofmemorylocationswehavetodisplayboolcheck_space=fal,0
es[rs2];}elseif(inst=="or"){register_values[rd]=register_values[rs1]|register,4
tore_value>>8;write_access(mem_,0
inganyusedvariable,0
//Initiallynotdirtyn,0
size();j++){if(cache[i,1
l;exit(0);}elseif(registers.find(assembly_code[instruction_no][1])==regi,4
amount1'suint64_tmask=(1U<<(64-shifting_amount))-1;if(shi,1
Extracttherdvaluestrin,0
ag_mask^temp_mask;//Makesthepositionsofindexbitsandoffsetbitszero//Letusdothe,0
uction[2].substr(2));intdecimal=binary_to_decimal(bin_instr);i,3
dl<<"Incorrectvalueofrs1";exit(0);}elseif,1
tr(0,1)+imm.substr(2,6)+rs2,2
mand=="show-stack"){//Hereweexecutetheshow-stackcommandcout<<"CallStack:\n";//,0
es[rd]=res;rd=res;}elseif(inst=="lh"){int16_tbyte0=read_access(start_location,false);int,3
uction_no][2]];stringrs2=registers[assembly_code[instruction_no][1]];stringimm=decimal_to_bina,4
on.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=b,2
u"]="110";funct3["bg,0
alues[rd]=PC+4;PC=imm+regi,1
];stringrs2=registers[assembly_code[instruction_no][3]];//Concatinatingtheinstructionst,3
ll_instructions;unordered_map<int,string>offset_to_label;unordered_map<string,int>last_e,2
-index_size;//Andthesemanyaretagbits,0
ofrs1";exit(0);}stringopcode;//Givingthecorrectopcodetothecorrespond,1
12";}elseif(r=="a3"||r=="x13"){r="x13";}elseif(r=="a4"||r=="x14"){r="x14";}elseif(r=="a5"||r=="x15,4
ofrange";exit(0);}//Notingthevariouspartsoftheinstrcutionst,1
rprogramisrequestingtoreadi,0
Errorinline:"<<instruction_no+1<<endl<<"Valueo,0
step_I(cur_instr);}elseif(format[cur_instr[0]]=='S'){step_S(cur_instr);}elseif(format[cur_i,6
ing>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction.subst,2
rtheBformatstepinstructionsvoidstep_B(vector<string>instruction){//Keeptrackoft,2
ocation+i,accessed_once);accessed_once=true;}uint,0
binary_to_hex(mem_loc_bin,false,5);cout<<"Memory["<<mem_loc_hex<<"]"<<"="<<hex_mem_val<<endl;}}else,1
sthemask20onesin,0
){is_dirty=true;intto_st,0
=='U'){execute,0
embly_code,intinstruction_no){//Handlingerrorsif(assembly_code[instruction_no].size()!=4){c,3
sembly_code.size();if(PC/4==no_of_instruc,1
=="lh"){int16_tbyte0=read_,0
inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instructio,1
or<vector<string>>&assembly_code,intinstruction_no){//Handlingerrorif(assembly_code[instr,2
enttion,viabinaryrepresentatio,0
al_rs1<val_rs2){PC=new,0
}else{memory[mem_loc]=val;}}intread_access(intm,2
[i];}}//CodeforSform,1
;j++){cache[i][j][0]=0;//Makethevalidbitaszero}}}elseif(!command.find("cache_s,4
seif(format[cur_instr[0]]=='I'){step_I(cur_instr);}elseif(format[cur_instr[0]]=='S'){ste,8
mbly_code[instruction_no][2])==registers.end()){cout<<"Errorinl,3
/Notethatheretagwillalway,0
;}returnr;}voidupdate_,0
<endl<<"Incorr,0
=20-offset_size-index_size;//Andthesemanyaretagbitsvec,0
tinstruction_no){//Handlingerrorif(assembly_code[i,0
imm="010000"+imm;}else{if(stoi(assembly_code[inst,0
decimal_to_binary(stoi(assembly_code[instruction_no][2]),21,t,3
"";for(inti=length*4;i<bi,0
t3["and"]="111";funct3["or",1
executed_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary,2
.clear();//cache.clear();for(i,2
ster_values[rs1];if(inst,1
k&mem_loc;//Wenowhavetheindexandtagwewant.Wecanproceedwithfindingtherealdatainth,0
//Andthesemanyaretagbitsboolis_dirty=false;if(replacement_policy=="FIFO"){if(!to_replace){boolis_pr,2
sfromwhichwehavetodisplaythememorystrings_count="";//Countofthenumberofmemorylocationswehavetodispla,0
"+binary_to_hex(bin_set,true,5);stringbin_tag=decimal_to_binary(cache[i][j][2],20,0);strin,5
arithmeticaccordingtotheinstructionsif(inst=="a,0
s.top().second;top_,1
s+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_P,1
eakpointatline:"<<break_point<<endl;}elseif(!command.find("cache_simenable")){,2
["1101"]='d';bin_to_hex["1110"]='e';bin_to_hex["1111"]='f';string,3
xected_line.clear();break_,1
string>binary_bytes(4);for(inti=0;,1
=="x13"){r="x13";}elseif(r=="a4"||r=="x14"){r="x14";}elseif(r=="a5"||r=="x15"){r="x1,4
dtheirlastexecutedlineaccordinglystringtop,0
;exit(0);}//Notingthevaiouspartsoftheinstrctionstringopcode="0110111";st,1
==2){registers["sp"]=this_register;}elseif(i==3){registers["gp"]=this_register;}else,5
ed_once){if(cache_enabled){//Letusfirstfigureouthowour20bitsofme,1
oved_data=cache[index][random_number];cache[index][random_number]=new_data;//Now,4
n_to_hex["0000"]='0';bin_to_hex["0001"]='1';bin_to_hex["0010"]='2';bin_to_hex["0011"]='3';bin_to_he,4
int8_tbyte=read_access(start_location,false);int8_tres=byte;register_values[rd],2
<4;i++){memory[instruction_no*4+i]=byte[i];}}//CodeforSformatinstructionsvoidexecute_S(v,3
ted_instruction.substr(pos+1);}stringbin_PC=dec,1
r(intj=start_storage,k=3;j<=end_storage;j++,k++){cache_block[k]=memory[j];}found_in,3
Makesthepo,0
:"<<associativity<<endl;cout<<"ReplacementPolicy:"<<replacement_,0
_values[rs1]<<imm;}elseif(inst=="srli"){uint32_tshifting_am,2
(format[cur_instr[0]]=='I'){step_I(cur_instr);}elseif(format[cur_instr,5
e(!dummy_stack_func,0
thiswillhandleinitializinganyusedvariablesthatthepreviou,0
break_point-count_how_many_to_skip)!=break_lines.end()){,1
n_address=decimal_to_binary(mem_loc,20,0);stringhex_address="0x"+bi,1
declareallvariablesrela,0
n_no][2]]-instruction_no*4);}if(registers.find(assembly_code[instruction_no][1])==registers.en,4
_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte,1
irstlineof,0
lse{assembly_code[instruction_,0
+register_values[rs1];uint64_t,1
thenewtagvaluevector<int>removed_data(cache[0][0].size());vector<int>new_data(c,6
age=(mem_loc/block_size)*block_size+(block_size-1);for(intj=start_storage,k=3;j<=end_storage,2
anchifconditionsatisfiedasperth,0
imm.substr(1,8)+rd+opcode;stringhex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4,3
alse);cache[index][i]=cache_block;returnval;}}//Ifwewerenotabletofindanyinvalidblock,weneedtoapp,2
>memory(0x50001,0);//InitializethevalueofPCintPC;//Herewedeclareallvariable,1
)==labels.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Labelnotdefined";exit(0),2
if(inst=="sh"){vector<uint8_t>byte(2);byte,3
x["0110"]='6';bin_to_hex["0111"]='7';bin_to_hex["1000"]='8';bin_to_hex["1001"]='9,4
ip)!=break_lines.end()){break_l,1
ause,ultimatelythisfunctionhastoreturnonly1byteintoffset_mask=1;offset_mask=offset_mask<<(offset_siz,0
ear();offset_to_label.clear();while(!,2
<endl<<"Valueofimmediateisoutofrange";exit(0);}//Notingthevariouspartso,1
stoppedatbreakpoint\n";break;}}//Iflastlineexecuted,thenensuretopopmainfromthestackif(PC/4==no,0
=="x21"){r="x21";}elseif(r=="s6"||r=="x22"){r="x22";}elseif(r=,3
+binary_to_hex(bin_tag,true,5);cache_output<<"W"<<":Address:"<<hex_address<<",Set:"<<hex,1
oi(assembl,0
ruction_file,instruction)){//Iftheinstructionisdata,thenensurethatuntilwesee.,0
ffset_mask-1;//Wecannowgettheactualvalueoftagbitsinthememorylocationthatourp,0
rd=executed_instruction.substr(0,pos);if(first_word.back(),2
heckiftheremoveddatahasadirtybitset,andifso,wene,0
sh"){vector<u,0
atx0remainsatvalue0PC=PC+4;reg,0
(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<execute,1
tringcurrent,0
enotabletofindanyinvalidblock,w,0
beatthetopq.push(tag);}else{inttop_tag=q.front();/,2
);rs1=aliasRemover(instruction[2]);imm=stoi(instruction[3]);//Updatethestackoffu,4
3]]-instruction_no*4);}if(registers.find(assembly_code[instruction_no][1])==register,3
="and"){regis,0
ts=0;misses=0;}elseif(command=="cache_simstatus"),1
yi%10+'0';this_register+=num2;this_register+=num1;}i,0
er+=num2;this_register+=num1;}intvalue_of_register_int=register_values[this_register];stri,1
}if(labels.find(assembly_code[instruction_no][2,1
allregistersvoidinitialize_registers(){for(inti=0;i<=31;i++){stringregister_no="x";r,1
R';format["sub"]='R';format["xor"]='R';format["or"]='R';format["and"]=',4
no="a";argument_register_no+=to_string(i-10);registers[argumen,1
offset_mask=1;offset_mask=offset_mask<<(offset_siz,0
][j];intto_store_mem_loc=0;//Hereth\etagandindexshouldbeoftheremoveddatano?to,1
ativity*block_size));//Thesemanyareforindexinttag_size=20-offse,0
rdintstore_word(vector<string,0
cur=q.front();q.pop();if(cur!=tag){dummy_q.push(cur);}},5
actthembreak_lines.insert(break_point-count_how_man,0
<<"D-cachestatistics:Accesses="<<hits+misse,0
ng(i-5);registers,1
ctlyaddourvaluetoitboolfound_invalid=false;for(inti=0;i<associati,0
ined";exit(0);}else{assembly,1
){step_I(cur_instr);}els,2
theinstructionstringinstr=imm+rd+opcode;stringhex_,0
ak_point-count_how_,0
tofrange";exit(0);}imm=decimal_to_binary(stoi(assembly_code[instruction_no][3]),6,true);,5
ned){boolisNegative=false;if(decimal<0){isNegative=true;}decimal=abs(decimal);stringbin="";while,2
1])==registers.end()){co,1
0;k<cache[i][j].size();k++){cache[i][j][k]=0;}}}assembly_code.clear();assembly_code.assign(0,8
toi(assembly_code[instruction_no][3,1
ear();count_how_many_to_skip=0;}stringaliasRemover(stringr){,2
ion_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//No,1
no*4+i]=byte[i];}}//CodeforSformatinstructionsvoidexecu,1
'){cur.pop_back();}cur_instruction.push_back(cur);}//Ifinwrongposition,bringtheoperandsback,3
t=stoi(command.substr(6));//Wetakeintoaccountthelinesthat,2
kesthepositionsofoffseybitszero//Weneedtod,0
egisters.find(assembly_code[instruction_no][,1
<16|byte[1]<<,1
//storethestart,0
no_of_instruction){cout<<"Nothingtostep\n";}elseif(break_lines.f,0
ed_once);accessed_once=true;}}//Updatethestackoffunctionsandt,0
["lhu"]="101";funct3["lwu",1
no][2]=to_string(l,1
"Errorinline,0
rd]=res;}//Updatethestackoffunctionsandtheirlastexecutedlineaccordinglystrin,0
);j++){for(intk=0;k<cache[i][j].size,2
;i++){vector<int>cache_block(block_size+3);cache_block=cache[index][i];//Valid,Dirty,tag,dataif(c,4
;}else{dec_imm=stoi(assembly_code[instruction_no][2]);}if(dec_imm<0||dec,4
yte[i]=binary_to_decimal(bi,1
(r=="s7"||r=="x23"){r="x23";}elseif(r=="s8"||r=="x24"){r="x24";}elsei,4
truction[0]=="jalr"){swap(cur_instruction[2],cur_instruction[3]);}as,5
instruction_nostringhex_instruction=binary_to_hex(instr);vec,1
="FIFO"){if(!to_replace){boolis_present=false;while(!q.empty()){intc,3
assembly_code[instruction_no][0]];stringrd=registers[assembly_code[instruction_no][1]];st,5
niteloopthatreadsuserinputswhile(true){//No,1
on_no][3])>=p,1
fx0is0register_values["x0"]=0;}//CodeforRformatinstructionsvoidexecute_R(vector<vector<string>>&as,3
acktopopthelabelsfromthemain,0
5']="0101";hex_to_bin['6']="0110";hex_to_bin['7,1
dummy_stack[i].first<<":"<<dummy_stack[i].second+count_how_many_to_skip<<endl;}if(sta,2
"<<dummy_stack[i].second+count_how_many_to_skip<<endl;}i,1
ssembly_code,0
);stringhex_tag="0x"+binary_to_hex(bin_tag,true,5);cache_output<<"W"<<":Address:"<<hex_address<<",Se,1
ont();q.pop();dummy_q.push(cur);if(cur==tag){is_present=true;}}while(!dummy,5
for(inti=0;i<bin.size();i++){if(bin[i]=='0'){bin[i]='1';}else{bin[i]='0';}}//Add1tofind2'scompl,8
mbly_code[instruction_no][2]];stringimm=decimal_to_binary(stoi(assembly_code[instruction_no][3,3
ction.find(,0
nstruction.substr(0,pos);if(first_word.back()==':'){executed_inst,3
stringis_clea,0
mbly_code[instruct,0
ary(stoi(assembly_code[instru,0
eforUformatinstructionsvoidexecute_U(vector<vector<string>>,2
truction.substr(pos+1);}stringbin_PC=decimal_to_binary(old_PC,32,0);stringhex_PC=binary_to_hex(bin_P,2
ngthevariouspartsoftheinstrcutionstringopcode="1101111";stringrd=registers[assembly_c,0
nstruction_no=0;instruct,0
e[0][0].size());intstart_storage=(mem_,3
nctions;while(!dummy_stack_function.empty()){dummy_s,2
store_value>>8;memory[mem_loc]=byte[0];memory[mem_loc+1]=byt,3
racttherdvaluestringrd=aliasRemover(instruction[1]);intold_PC=PC;stringinst=in,2
n=executed_instruction.substr(pos+1);}stringbin_,1
ormat["jal"]='J';//Uforma,1
;}elseif(r=="a3"||r=="x13,0
seif(inst=="sub"){register_,1
ffset_size+index_size));to_store_,0
frs1";exit(0);}elseif(registers.find(asse,1
ddress="0x"+binary_to_hex(bin_address,false,5);stringbin_set=decimal_to_binary(index,20,0),2
egister_values[rs2];if(shifting_amount!=0){register_values[rd]=register_values,3
mat[cur_instr[0]]=='S'){step_S(cur_instr);}elseif(format[cu,4
de.clear();assembly_code.assign(0,vector<string>(0));//Checkiftheuserisspecifyingthe,4
]),13,true);//Concatinatingthepartsto,0
he_enabled){cout<<"D-cachestatistics:Accesses="<<hits+misses<<",Hit="<<hits<,0
und_invalid){update_queue(index,ta,0
_storage=(mem_loc/block_size)*block_size;intend_storage=,1
command.find("mem")){//Hereweshowthecountnumberofmemorybyt,1
rt_location,false);uint8_tres=byte;register_values[rd]=res;}els,1
orary_register_no+=to_string(i-5);registers[temporary_register_no]=this_register;},2
ngth-1-igivesthepositionfromtheright}}returndecimal;}//Definingallregistersvoidinitialize_r,0
h(tag);}else{,1
ctions.pop();}}}elseif(command=="step"){//Gostepbystepintno_of_instruction=ass,2
ter_values[r,0
voidinitialize_fu,0
r<vector<int>>>cache;//Valid,dirty,tag,datainthits=0,misses=0;string,2
tion[0];rd=aliasRemover(instruction[1]);intimm;//Weacceptbothdecimalandh,3
aliasRemover(instruction[1]);strin,2
C=new_pc;}else{PC+=4;}}elseif(inst=="bge"){if(register_values[rs1]>=register_values[rs2],4
_to_bin['3'],1
vetoinsertabreakpointintbreak_point=stoi(command.substr,0
for(inti=0;i<4;i++){byte[3-i]=sto,1
intif(break_lines.find(break_point-count_how_many_to_skip)!=break,1
omemorywithoutbotheringtoddoanythinginth,0
:"<<instruc,0
_back(c);}}if(cur!=""){to_store.push_bac,2
]<<16|byte[1]<<8|byte[0];register_values[rd]=res;}//Updatethestackoffunctionsandtheir,3
ow(2,length-1-i);//length-1-igivesthepositionfromtheright}}returndecimal;},1
=="x17"){r="x17";}elseif(r=="s2"||r=="x18"){r="x,2
alues.clear();all_i,1
Keeptrackofthenewpcvalueandextractthers1andrs2valuesintn,0
-1*pow(2,20)||st,1
)<-pow(2,11)||stoi(assembly_code[instruction_no][3])>=pow(2,11)){cout<<"Errorinline:"<<instru,6
_S(cur_instr);}elseif(format[cur_ins,1
on.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=bi,2
ess(start_location+1,true);uint16_tres=byte1<<8|byt,1
this_register;}}}//Definingallfunct3valuesvoidinitialize_funct3(){funct3["add"]="000";funct3["s,2
tore_mem_loc|=(i<<offset_size);for(inti=0;i<block_size;i++){memory[to_store_,0
reak;}}//Nowcheckiftheremoveddataha,0
embly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<instruction_no+1<,2
size();i++){if(instruction[i]!=''&&instruction[i]!='('){cur.push_back(instr,4
toi(assembly_code[instruction_no][3]),13,true);//Concatinatingthepartstofo,3
struction_no][1])==registe,1
d:"<<executed_instruction<<";PC="<<hex_PC<<endl;,0
r="x0";}elseif(r=="ra"||r=="x1"){r,1
_tbyte[4];for(inti,1
x_PC<<endl;//UpdatethePCaccordinglyPC+=4;}elseif(inst=="addi"||inst=="x,0
sembly_code[instruction,0
addi"]='I';format["xori"]='I';format["ori"]='I';format["andi"]='I';format["slli"]='I';form,4
in[i]=='0'){bin[i]='1';break;}bin[i]='0';}returnbin;}//Fun,4
letethebreakpointif(break_lines.find(break_point-count_how_many_to_sk,0
rs.end()){cout<<"Errorinline:"<<instruction_no+1<<en,1
isisaninvalidframe,ignorecontinue;}if(cach,0
stackcommandcout<<"CallStac,0
struction[3]);}assembly_code.push_back(cur_instruction);PC+,2
eisexecuted,thenensuretopopmainfro,0
||!isNegative){returnbin;}//Take1'scomplementfor(inti=0;i<bin.size();i++){if(bin[i]=='0'){bin[i],5
Gothroughthecurrentinst,0
//Definingallfunct3valuesvoidi,0
;for(inti=0;i<block_size;i++){memory[to_store_mem_loc+i]=removed_,1
nds.insert(,0
ion_no+1<<endl<<"Incorrectvalueofrs1";exit(0);}elseif(registers.,1
current_opened_file="";vector<queue<int>>order_of_access;ofstreamcache_output;/,2
tializealltherequiredfieldsinitialize_registers();initialize_funct3();initialize_func,2
1];if(inst=="lb"){int8_tbyte=read_access(start_location,false);int8_tres=byte;register,2
d"]="111";funct3["or"]="110";funct3["xor"]="100";,2
cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forJtypefo,0
S(assembly_code,instruction_no);}elseif(format[asse,1
ring,int>>stack_of_functions;unordered_set<int>break_line,1
){r="x0";}elseif(r=="ra"||r=="x1"){r="x1";}elseif(r=="sp"||r=="x2"){r="x2";}elseif(r=="gp"||r==",5
tionspecifiedbythemem_locfor(inti=1;i<instruction,0
unctions.pop();stack_of_functions.push({top_of_stack,top_li,1
ce);accessed_once=tru,0
hex_instruction}for(inti=0;i<4;i++){memory[i,0
l<<"Incorrectvalueofrs1";exit(0);}elseif(registers.find(assembly_code[instruction_no][2])==regi,4
for(inti=0;i<instruction.size();i++){if(trim&&instruction,1
[mem_loc]=val;//Incaseofwritethroughandmiss,wedonotcontacttheca,1
0;misses=0;}elseif(comma,0
ntoaccountthelinesthatareoccupiedbythedatasection,andsubtractthembreak_lines.insert(brea,0
{if(cur!=""){to_store.push_back(cur);}cur="";}else{cur.push_back(c);}}if(cur!,6
tethePCaccording,0
isters[assembly_code[instruction_no][1]];strin,3
no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Notingthevaiouspartsoftheinstrcti,1
aveusedvoidinitialize(){for(inti=0;i<32;i++){stringreg="x"+to_s,1
rrorinline:,0
f(assembly_code[instruction_no][2][1]=='x'){stringbin_instr=hex_to_bin,4
r(inti=0;i<32;i++){stringthis_register="x";i,0
o_hex(bin_address,false,5);stringbin_set=decimal_to_,1
=0;}}}assembly_code.cle,0
er_values[rs1]>=registe,1
clude<cstring>//Thefollow,1
(cache_enabled){cout<<"D-cachestatistics:Accesses="<<hit,1
string>to_store;stringcur="";for(char,0
(inti=0;i<memory.size();i++){memory[i]=0;}for(inti=0;i<cache.size();i++){for(intj=0;j<ca,4
t-count_how_many_to_skip),0
_no+1<<endl<<"Incorrectvalueofrs2";exit(0);}//Notingthevaiourspartsoftheinstrutionstringopc,1
=funct3[assembly_code[instruction_no][0]];stringrs1=regis,3
uted_instruction.substr(pos+1);}stringbin_PC=,1
cation+1,true);uint16_tres=byte1<<8|byte0;register_values[rd]=res;}elseif(inst=="lw,1
al=memory[mem_loc];//Getthevalueandthenstoretheremainingwords,criticalwordfirstploicyintsta,1
orage;j++,k++){cache_block[k]=memory[j,1
_q;intoffset_size=log2(block_size);//Thesemanybitsareforoffsetintindex_siz,1
cur=dummy_q.front();dummy_q.pop();q.push(cur);}if(!i,3
uction_no].size(),1
.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[,3
0000000";funct7["srl"]="0000000";funct7["sra"]="0100000";}//Defi,2
substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;,2
myfile_out_name=com,0
0onesinttemp_mask=1;temp_mask=temp_mask<<(index_si,0
<<hex_PC<<endl;//UpdatethePCandensurethatx0remainsatvalue0PC=PC+,0
1],true);}if(inst=="sw"){boolac,1
0";funct7["or"]="0000000";funct7["xor"]="0000000";funct7["sl,2
t,wekeepstoringdataif(instruction==".data"){data=true;count_how_many_to_skip,1
1;i++){stringregister_no="x";register_no+=to_string(i);stringthis_register=decimal,1
ctions[PC/4];intpos=exe,1
yte(4);boolaccessed_once=false;for(inti=0;i<4;i++){byte[i]=,2
andcountbyparsingthelinefor(inti=4;i<command.size();i++){if(!check_space){if(command[i]==''){chec,4
ugh,wejustwritetomemorywithoutbotheringtoddoanyt,0
truction=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=he,4
0;i<memory.size();i++){memory[i]=0;}for(inti=0;i,3
s0register_valu,0
mstartingforlocationspec,0
}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_loc;}//Functiontostorewo,0
"||r=="x25"){,0
i"){if(stoi(assembly_code[instruction_no][3]),3
ct7["sll"]="0000000";funct7["srl"]="0000000";funct7["sra"]="0100000";},3
opthatreadsu,0
e();j++){cache[i][j][0]=0;//Makethevalidbitaszero}}}elseif(!,5
seif(r=="s9"||r=="x25"){r="x25";}elseif(r=="s10"||r=="x26"){r="x26";}elseif(r=="s11"||r,4
ngs,suchthatafterexecutionofeachrun,wecandequeueth,0
x"+binary_to_hex(bin_tag,true,5);cache_output<<"W"<<":Address:"<<hex_a,1
valuesvoidinitialize_funct7(,0
t;i++){intmem_val=memory[i];stringbin_mem_val=decimal_to_binary(mem_val,8,0);stringhex_,2
at["sll"]='R';forma,1
tswhile(true){//Nowsavethenextfilestringco,1
ethememoryif(removed_data[1]==1){is_dirty=true;intto_store_mem_loc=0;//he,2
C<<endl;//UpdatethePCandkeepx0valueat0PC=PC+4;register_v,0
intinstruction_no){//Handlingerrorsif(assembly_code[instruction_no].size()!=4,2
e)*block_size+(block_size-1);new_data[0]=1;//Thebitisnowvalidnew,2
w_data[k]=memory[j];}if(operation=="write"){new_data[3+offset]=val;new_dat,4
=="lh"){int16_tbyte0=read_access(start_location,false);int16_tbyte1=r,1
tionsofoffseybitszero//Weneedtodothisfor,0
yinformationunordered_map<string,string>registers;unordered_map<stri,1
embly_code[instruction_no][3])<-pow(2,12)||stoi(assembly_code[instruction_no][3]),6
al;//Incaseofwritethroughandmiss,wedonotcontactthecacheatall.So,weneedtoprinti,0
nt!=0){register_values[rd]=regi,1
ex_mask^temp_mask;//Makesthepositi,0
ionsatisfiedasperthegiveninstructio,0
st_word.back()==':'){executed_instruction=,1
y_code[instruct,0
in_to_hex["0001"]='1';bin_to_hex["0010"]='2';bin_to_hex["0011"]='3';bin_to_hex["0100"]='4';bi,4
ngisinvalid,andothersdontmatterorder_of_access.clear,0
:"<<break_point<<endl;}else{cout<<"Nobreakpointspresent\n";}}elseif(!command.find("break"),1
ddr);intcount=stoi(s_count);//Printingthelocation,1
ockinthecache,weloadthewholeblock,0
[instruction,0
mem_loc,"write",false,false,val);cach,0
harnum1=dummyi%10+'0';dummyi/=10;charnum2=dummyi%,0
e0;register_values[rd]=res;}elseif(inst=="lw"){vector<int32_t>byte(4);boolaccessed_onc,4
funct3;unordered_map<string,string>fun,1
toremovethecalledfunctionfromthestackoffunctionsstack_of_functions.pop();//Up,1
&mem_loc;tag>>=(index_size+offset_size);//Gettingthevalueofindexbitsofmemorylocationbeingrequeste,1
<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forIt,0
ength*4);}if(trim){stringtrimmed_hex="";for(inti=0;i<h,1
struction_no][1]];,1
orinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrd";exit(0);}elseif(registers.find(assembl,1
ck_of_functions.pop();stack_of_functions.push({top_of_stack,top_line});stringe,3
=="andi"||inst=="srai"||inst=="slli"||i,0
;to_store_mem_loc|=(index<<offset_size),0
tfilefromhereonly,sinceupdate_queuewillneverbereached}else{//Firstcheckifwehaveaninvalidframe,andif,0
struction[i]);}else{,1
racters67ofhex_instruction}fo,0
/Hereth\etagandindexshouldbeoftheremoveddatano?to_store_mem_loc|=(removed_data[2]<<,1
ughalltheval,0
greg="x"+to_string(i);register_values[reg]=0;}intPC=0x00000;for(inti=0x0,2
tostoredwordintstore_dword(vector<string>instructi,1
ocation//Ifwe,0
ter_values[rs1]<register_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="bge"){if(register_,5
Gothroughthecurrentinstructionandstore,0
memorylocationthatourprogramisrequestingtoreadinttag=tag_mask&mem_loc;tag,0
endl<<"Valu,0
eam>#include<unordered_map>#include<unordered,1
e{dec_imm=stoi(assembly_code[instruc,0
oftheinstructionstringopcode="0100011";stringf3=,0
size();i++){for(intj=0;j<cache[i].size();j++){if(cache[i][j][0]==1&&cache[i][,7
bly_code[instruction_no][2])==,2
ode[instruction_no][0]]=='R'){execute_R(asse,2
erenotabletofindanyinvalidblock,weneedtoapplyreplacementpolicy,0
pe;intdata_base_ad,0
indoutthetagbitslaterinttag_mask=1;tag,0
f(!isSigned||!isNegative){returnbin;}//Take1'scomplementfor(inti=0;i<bin,2
moryif(removed_data[1]==,1
q.pop();q.push(cur);}//Notethatheretagwillalwaysbea,2
;}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_loc;}signedmain(){//,1
_once);accessed_once=true;}int64_tres=(byte[7]<<56)|(byte[,1
t3(){funct3["add"]="000";funct3["sub"]="000";funct3["and"]="111";funct3["or"]="110";funct3[",5
<<32)|(byte[3]<<24)|(,1
ata[1]=1;//Setthebittodirty}for(inti=0;i<associativity;i++){if,1
nds"<<endl;exit(0);}if(labels.find(assembly_code,1
);}elseif(format[cur_instr[0]]=='S'){step_S(cur_instr);}elseif(format[cur_instr[0]],7
tore,data_base_addres,0
x_mask=inde,0
Tag:"<<hex_tag<<","<<"Clean"<<"Fromwriteaccess"<<endl;,0
utput;//Declarethevar,0
C=binary_to_hex(bin_PC);hex_PC="0x",1
ssembly_code[instruction_no][0]=="slli"){if(stoi(assembly_code[instruction_n,2
if(cache[index][i][2]==top_tag){removed,4
blockinthecache,wereadonlythisparticularmemorylocation.//Ifwedon,0
];intpos=executed_instruction,0
2]];stringrs2=registers[assembly_code[instruction_no][3]];//Concatinatingthei,3
_line=PC/4+1;stack_of_functions,0
ringthis_register="x";if(i<10){charnum='0'+i;this_register+=num;}else{intdummyi=i;char,1
'){executed_ins,0
k,top_line});stringexecuted_,0
s[rs2];}elseif(inst=="srl"){uint64_tshiftin,2
<endl;}}//Inthecaseofmisses,ifitiswritethorugh,wejustwr,0
sll"]="001";funct3["srl"]="101";,1
while(decimal!=0){bin.push_back(decimal%2+'0');decimal/=2;}while(bin.,3
dexecute_B,0
ut<<"Errorinline:"<<instruction_no+1<,0
orSformatinstructionsvoidexecute_S(vector<vector<str,0
ary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC,2
=4){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forBty,0
ugh,wejustwrit,0
e_access(mem_loc,byte,false);//memory[mem_loc]=byte;}if(inst=="sh"){,3
eingrequestedbyprogramintindex=index_mask&mem_loc;index>>=(offset_size);//Let'sgetthevalueof,1
ntmem_loc){//Gothroughallthevaluesthattheuserhasspecifiedandstoret,0
byte=store_value;memory[mem_loc]=byte;mem_loc++;}//Returnthenewmem_locwhereyoucanwritet,1
WT"){memory[mem_loc]=val;cache[index][i][1]=0;//Setittonon-dirty}//Sincethisahit,weneedtou,5
0);}elseif(r,0
;exit(0);}elseif(registers.find(assembly_code[instruction_no][1])==registers.end()){cout<<"Errorinl,6
;}elseif(stoi(assembly_code[instruction_no][3])<-pow(2,1,3
unctiontostorehalfword,0
t_storage=(mem_loc/block_size)*block,1
(registers.find(assembly_code[instruction_no][2])==registers.end()){cout<<"Errorinline:"<<,5
ecuted_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary,1
;vector<uint8_t>byte(4);for(inti=0;i<4;i++){byte[3-i]=st,3
2];}elseif(inst=="sll"){register_values[rd]=re,2
ount_how_many_to_skip++;continue;}if(data||(instruction==",0
f_functions.pop();,1
re_dword(to_store,data_base_address);}elseif(to_store[0]==".half"){,3
tinue;}if(cache_block[2]==tag){is_hit=true;found=true;val=cache_block[3+offset];//Sincethisahit,w,3
Keepingtrackofalllaodoperandsvoidinitia,0
n_to_hex["0100"]='4';bin_to_hex["0101"]='5';bin_to_hex["0110"]='6';bin_to_h,3
registersvoidinitialize_registers(){for(inti=0;i<=31;i++){st,1
e_load_operands();initialize();ifstreaminstruction_file;vector<vector<stri,2
eat0PC=PC+4;register_values["x0"]=0;}//CodefortheBformatstepinstructionsvoidstep_B(vector<string>,2
ze+index_size));to_store_mem_loc|=(index<<offset_size);for(inti=0;,0
fting_amount1'suint64_tmask=(1U<<(64-shifting_amount))-1;if(shifting_amount==0){for(inti=0;i<=63;i,2
++,k++){new_data[k]=memory[j];}removed_data=cache[in,3
ex.substr(i);retur,1
sent){q.push(tag);}}else{inttop_tag=q.front();//Getthetagwhichweneedtore,3
alueandensurethatx0willalwaysremainatvalueof0PC+=4;register_values["x0"]=0;}//CodefortheIform,1
nary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[,3
;for(inti=0;i<4;,0
{r="x12";}elseif(r,1
nsuretoremovethecalledfunctionfromthestackoffunctionssta,0
[1]=store_,1
che[index][i]=new_data;break;}}//Nowcheckiftheremoveddatahasadirtybitset,andi,2
"||inst=="ld"||inst=="lbu"||inst=="lhu"||inst=="lwu"){//Extractrd,rs,0
e";exit(0);}//Notingtheva,1
;if(shifting_amount!=0){register_values[rd]=register_values[rs1]>>regi,3
d_once){misses++;if(wri,0
binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=he,2
lues[rd]=register_values[rs1]>,2
<uint8_t>byte(2);byte[0]=store_va,3
o_bin['7']="0111";hex_t,1
pop_back();PC=0;while(getline(instruction_fi,1
ction_no);}elseif(format[ass,0
ache_enabled){stringhit_or_miss="Miss";stringclean_or_dirty="Clean";stringread_or_write="W";if(is_hi,0
d(assembly_code[in,0
_PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,,1
ringrs2=registers[assembly_code[i,0
yte[5]<<40)|(byte[4]<<32)|(byte[3]<<24)|(byte[2]<<16),4
registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs2";e,1
bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}ui,5
f_stack=stack_of_functions.top().first;inttop_line=stack_of_function,1
<<(index_si,0
;}elseif(stoi(assembly_code[instruction_no][3,1
erands"<<endl;exit(0);}elseif(registers.,1
illalwaysremainatvalueof0PC+=4;register_values["x0"]=0;}//CodefortheIformatst,1
em_loc,boolaccessed_once){if(cache_enabled){boolis_hit=false;//Letusfirstfigureouthowour20bitsofm,1
ouldbeoftheremoveddatano?to_store_mem_loc|=(removed_data[2]<<(offset_size+index_size));to_,2
hex_set<<","<<hit_or_miss<<",Tag:"<<hex_tag<<","<,0
turnonly1byteintoffset_mask=1;offset_mask=offset_mask<<(offset_size);offset_mask=offset_,1
lseif(r=="t6"||r=="x31"){r="x31";}returnr;,2
edlineaccordinglystringtop_of_stack=stack_of_functions.top().firs,1
use,ultimatelythisfunctionhastoreturnonly1byteintoffset_mask=1;offset_mask=offset,0
s67ofhex_instructio,0
2]<<16)|(byte[1]<<8)|byte[0];register_values[rd]=re,3
hex=zeros+hex;}else{hex=fs+hex;}}if(length*,1
gister_values[rs1]==register_v,1
ubstr(7)+opcode;stringhex_instruction=binary_to_hex(instr);vector<st,2
truction.find('');stringfirst_word=executed_instruction.substr(0,,1
offset_size=log2(block_size);//Thesemanybitsareforoffset,1
hisfortheoffsetaswell,because,ultimatelythi,0
(vector<vector<string>>&assembly_code,2
;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//UpdatethePCand,0
dontmatterorder_of_access.clear();order_of_access.resize(no_of_ind,1
tractrd,rs1,andimmediaterd=aliasRe,0
tring>instruction){//Extractrd,rs1,rs2stringinst=instructi,0
ize-1);cache_b,0
pertheinstructionif(inst=="sb"){uint8_tbyte=store_value;write_acces,1
se{exit(0);}if(to_break){cout<<"Executionstoppedatbreakpoint\n";break;}},3
bleinstruction_nostringhex_instruction=binary_to_hex(instr);,1
atelythisfu,0
['3']="0011";hex_to_bin['4']="0100";hex_to_bin['5']="0101";hex_t,3
unctions.top().first;inttop_,1
";funct3["srai"]="1,1
ut<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forRtypeformat,youmustenter4ope,0
alues[rd]=register_values[rs1]<<register_values[rs2];}elsei,3
ore_value>>8;write_access(mem_loc,byte[0],false);write_access(mem_loc+1,byte[1],true),4
xecutedlineaccordinglystringtop_of_stack=stack_of_functions.top().first,1
ex<<offset_size);for(inti=0;i<block_size;i++){memory[to_stor,0
(6-2*i,2));}uint8_tbyt,1
_access(start_locati,0
"0x"+hex_PC;cout<<"Execut,0
break;}}//Iflastlineexecuted,thenensuretopopmainfromthestackif(PC/4==no_of_instruction){//Als,1
cache_output.open(cache_output_n,0
_code[instruction_no][2])==r,2
mask;}}elseif(inst=="srai"){regist,1
ues[rs2];if(val_rs1>=,1
olookinthememoryif(!found){if(!ac,1
'');stringfirst_word=exe,0
partsoftheinstrcutionstringopcode="1101111";stringrd=register,0
ntintheprogramintbreak_point=stoi(command.substr(10));//Wedeletethebreakpointi,2
1]!=register_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="blt"){if(register_values[rs1]<,5
sters.end()){c,1
[instruction_no][2]);}if(dec_imm<0||dec_imm>4294963200){cout<<"Errorinline:"<<instruc,4
9"||r=="x25"){r="x25";}elseif(r=="s10"||r=="x26"){r="x26";}elseif(r=="s11"||r,3
ormat["srli"]='I';format["srai"]='I';format["ld"]='I';format["lw"]='I';f,4
6));//Wetakeintoaccountthelinesthatareoccupiedbythedatasection,andsubtra,0
(assembly_code[instruction_no][0]=="srli"||assembly_c,2
i<<offset_size);for(inti=0;i<block_s,0
_storage,k=3;j<=end_storage;j++,k++,0
;vector<uint8_t>byte(8);for(inti=0;i<8;,2
"bgeu"]='B';//Jformatformat["jal"]='J';//Uformatformat["lui"]='U';}//Keepingtrackofall,2
tractrd,rs1,andimmediaterd=aliasRemover(instruction[1]);r,2
/Alsoensuretoprintthecachestatisticsi,0
"]=this_register;}elseif(i==1){registers["ra"]=thi,2
U(cur_instr);}else{exit(0);}//Iflastlineisexecuted,thenensuretopopmainfromthestackif(PC/4==no_of_ins,3
_rs1=register_values[rs1],val_rs2=register_valu,1
lues[rd]=register_values[rs1]+register_values[rs2];}elseif(inst=="sub"){register_valu,4
of_stack,top_line});stringexecuted_instruction=all_instructions[PC/4];intpos=,1
r=imm+rd+opcode;stringhex_instruction=bina,0
gtop_of_stack=stack_of_functions.top().first;inttop_line=stack_of,1
instructionsvoid,0
push({top_of_stack,top_line},1
pdatethestackof,0
(assembly_code[instruction_no][3])<-pow(2,12)||stoi(assembly_code[instruction_no][3])>=po,8
/Initiallyeverythingisinvalid,andothersdontmatterorder,0
registers[assembly_code[,0
lse,mem_loc,"write",false,false,val);cache[index][i]=cache_block;return;}}//Ifw,2
s(){for(inti=0;i<=31;i++){stringregister_no="x";re,1
y_to_hex(bin_set,true,5);stringbin_tag=decimal_to_binary(tag,2,1
estackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=stack_of_functions.top().,1
werenotabletofindanyi,0
x_to_bin[hex[i]];}returnbin;}//Codetoconvertdecimalt,2
es;}elseif(inst=="lhu"){u,1
ved_data[1]==1){is_dirty=true;intto_store_mem_loc=0;//Hereth\etagandindexshouldbeofther,1
j];}cache_block[3+offset]=val;cache_block[0]=1;//The,2
rd=registers[asse,0
code[instruction_no][1]];string,2
irty=true;intto_store_mem_loc=0;to_store_mem_loc|=(tag<<of,0
instructio,0
rrectvalueofrs1";exit(0);}elseif(registers.find(assembly_code[instr,1
imm;}elseif(inst=="srli"){uint32_tshifting_a,1
_J(assembly_code,instruction_no);}elseif(format[assembly_code[instruction_no][0]]=='U'){execute_U(,5
decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+he,2
,top_line});stringexecuted_instruction=all,0
cimal!=0){bin.push_back(decimal%2+'0');decimal/=2;}while(bin.size()<no_of_bits){bin.push_back('0',3
frs2";exit(0);}elseif(registers.find(assembly_code[,1
"ld"||inst=="lbu"||inst=="lhu"||inst=="lwu"){//Extractrd,rs1,and,0
o*4+i]=byte[i];}}//CodeforI,1
<string,int>>dummy_stack;stack<pair<st,1
startingforlocationspecifiedbythemem_locfor(inti=1;i<instru,0
em_val=memory[i];stringbin_mem_val=decimal_t,1
)==registers.end()){cout<<"Errorinline:"<<instruction_no,1
);}}else{s_count.push_back(command[i]);}}s_addr=s,3
sociativity>>replacement_policy>>write_back_policy;,0
instruction_no][1]];stringrs1=registers[assembly_code[instruction_no][2]];stringimm;//Ass,4
ng>instruction){//Storethenewpcvaluetojumptointnew_pc=PC+stoi(instruction[2]);//Extracttherdvalues,2
nter3operands"<<endl;exit(0);}elseif(registers.find(assemb,1
llalwaysremainatvalueof0PC+,0
funct3["sh"]="001";funct3["sw"]="010";funct3["sd"]="011";funct3[,3
ofhex_inst,0
];}mem_loc+=8;}//Returnthenewmem_locwher,0
ommand=="st,0
ess,false,5);stringbin_set=decimal_to_binary(index,20,,0
accordinglystringtop_of_stack=stack_of_functions.top().first;inttop,1
binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i,3
temp_mask=temp_mask-1;tag_mask=tag_mask^temp_mask;//Makest,0
ered_map<string,string>funct7;unordered_map<strin,1
size+offset_size);index_mask,0
reamcache_output;//Declarethevariousmapswhichwillstorethenecessa,0
datethePCandkeepx0valueat0PC=PC+4;register_values["x0"]=0;}//Codeforth,1
=res;}elseif(inst=="lhu"){uint16_tbyte0=read_access(start_location,false);uint16_tbyte,2
=0;i<8;i++){byte[7-i]=store_value>>(7-i)*8;}for(inti=0;i<8;i++),3
er_values[rs1]>>register_values[rs2];//Ourmaskisshifting_a,2
elseif(inst=="lhu"){ui,1
'6']="0110";hex_to_bi,0
;}else{PC+=4;}}elseif(inst=="bltu"){uint64_tval_rs1=register_values[rs1],val_rs2=register_values,3
mal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x",2
//Loadthenextfileintoaqueueofstrings,suchthatafterexecutionofeachrun,wecandequeuethe,0
;}if(cache_block[2]==tag){if(!accessed_once){hits++;}found=true;c,4
sspecified,0
typeformat,youmustenter4operands"<<endl;exit(0);}if(labels.find(assembly_code[instruction_no][3,2
acters67ofhex_instruction}for(inti=0;i<4;i++){me,0
ur_instr);}else{exit(0);},2
truction_no][3]=to_string(labels[assembly_code[instruction_no][3]]-instruct,4
ion_no][1]];stringrs1=registers[assembly_code[instruction_no][2]];stringimm;/,4
>removed_data(cache[0][0].size());vector<int>ne,5
][2]==top_tag){removed_d,1
f(inst=="sra"){register_value,1
ctthecacheatall.So,weneedtoprintinthecache_outputfilefromhereonly,sinceupdate,0
1;//Thismakesthemask20o,0
_binary(stringhex){unordered_map<char,string>hex_to_bin;hex_to_bin['0']="0000";hex_to_bi,3
ster_values[rs1,0
ion.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){b,2
0]=1;//Thebitisnowvalidnew_data[1]=0;//Initiallynotdirtynew_data[2]=tag;for(intj=start_storage,2
nt>>dummy_stack;stack<pair<string,int>>dummy_stack_function=stack_of_functions;wh,2
misses<<",Hit="<<hits<<",Miss="<<misses<<",HitRate="<<fixed<<setprecision(3)<<(double)(hits)/(,3
{intoffset_size=log2,0
ty=true;intto_store_mem_loc=0;to_store_m,0
edtoreplaceq.pop();//Popthevaluewhichisreplacedq.push(tag);//Pushthenewtagvaluevector<int>r,3
e0;register_values[rd]=res;}elseif(inst=="lwu"){vector<uint32_t>byte(4);boolaccessed_once=fa,4
m_loc,stringoperation,boolis_read,boolis_hit,intval=-1,intoff,0
uction.size,0
eedtoreplaceq.pop();//Popthevaluewhichisr,1
=1){intoffset_size=log2(block_size);//Thesemanybitsareforoffsetintindex_size=log2(cache_size/(ass,1
isters["sp"]=this_register;}elseif(i==3){registers["gp"]=this_registe,3
[0].size());intstart_storage=(mem_loc/block_size)*block_,3
ary_to_hex(bin_address,false,5);stringbin_set=decimal_to_binary(index,20,0);stringhex_set="0x"+bina,2
hthenewtagvalueve,0
"<<clean_or_dirty<<"fromupdatequeue"<<endl;}order_of_access[index]=q,1
(i<<offset_size);for(inti=0;i<block_size;i++){memory[to_store_mem_loc+i]=remove,1
,thenensurethatuntilwesee.text,wekeepstoringdataif(instruction==".data"){data=true;c,1
l_instructions[PC/4];intpos=executed_instruction.find('');stringfirst_word=ex,2
<<":"<<dummy_stack[i].second+count_how_many_to_skip<<endl;}if(stack_of_functions.empty()){c,3
=':'){executed_instr,0
_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i],4
nweneedtomakeitfullyassociativeif(associativity==0){//Th,1
bstr(6-2*i,2));}uint8_tbyte[4,1
data=false;}else{//Storetherequireddword/word/byte/halfwordvector<string,0
bythemem_locfor(inti=1;i<i,0
playboolcheck_space=false;//Weno,0
tbyte1=read_access(start_location+1,true);int16_tr,1
in_PC);hex_PC="0x",0
ize;i++){memory[to_store_mem_loc+i]=removed_data[3+i];}}}}if(repla,3
m_loc];//Getthevalueandthenstoretheremaining,0
][0]]=='I'){execute,1
<<dummy_stack[i].first<<":"<<dummy_stack[i].secon,2
ands.find(cur_instruct,0
;}elseif(command=="cache_simstats"){if(cache_enabled){cout<<"D-cachestatistics:Access,2
uerd=aliasRemover(instruction[1]);rs1=alias,2
atstepinstructions,0
ex[b]);}if(length*4>binary.,1
ntinstruction_no){//Handling,0
/Makesthepositionsofindexbitsandoffsetbitszero//Letusdothesameforindexm,0
ctor<string>>&assembly_code,intinstruction_no){//Handlingerrorif(assembly_c,1
ue>>(3-i)*8;}for(inti=0;i<4;i++),1
ordered_map<string,string>registers_alis;vector<string>all_instructions;unordered_map<int,,2
intlength=bin.size();//Iterateoverthebinar,1
substr(0,pos);if(first_word.back()==':',2
.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex,2
mbly_code[instruction_no][1],2
";exit(0);}//Notingthevariou,1
lse{inttop_tag=q.front();//Getthetagwhichwenee,1
oc;index>>=(of,0
_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC,1
anythinginthecacheif(write_back_po,0
fset_mask=offset_mask<<(offset_size);offset_mask=offset_m,1
p_back();}c,1
egisters[assembly_code[instruction_no][2]];string,3
iteaccess"<<endl;}}//Inthecaseofmisses,ifitiswrite,0
dfor(inti=0;,0
]),12,true);//Concatinatingthevariouspartsstringinstr=imm.substr(0,7)+rs2+rs1+f3+i,1
replace){while(!q.empty()){intcur=q.front();q.po,3
ring>cur_instr=assembly_code[PC/4];if(format[cur_instr[0]]=='R,3
;q.pop();i,1
andi"||inst=="srai"||inst=="s,0
ile>>cache_size>>block_size>>associativity>>replacement_pol,0
.size());vector<int>new_data(cache[0][0].size());intstart_storage=(mem_loc,6
+){memory[m,0
){r="x24";}elseif(r=="s9"||r==",1
chisreplacedq.push(tag);//Pushthen,1
storethemstartingforlocationspecifiedbythemem_locfor(inti=1;i<instruction.size();i++){uint64_,1
in;hex_to_bin['0']="0000";hex_to_bin['1,1
actthevalueofaddrandcountbyparsingthelinefor(inti=4;i<command.size();i++),1
er+=num2;this_register+=num1;}intvalue_of_register_int=register_values[this_regi,0
code[instructio,0
nclude<fstream>#include<unordered_map>#include<unordered_,2
C="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl,0
y[instruction_no*4+i]=byte[i];}}//CodeforIformatinstructionsvoi,2
ister_value,0
sofoffseybitszero//Weneedtodothisfortheoffsetaswell,because,ultimatelythisfunctionhastoreturnon,0
_no+1<<endl<<"Wrongsyntax,forRtypeformat,youmuste,0
ess:"<<hex_address<<",Set:"<<hex_set<<","<<hit_or_miss<<",Tag:"<<,0
(byte[6]<<48)|(byte[5]<<40)|(byte[4]<<32)|(,3
r<string>instruction),1
ng,int64_t>regi,0
eading0xinthestring//Wenowwanttoconvertittodecimalrepresenttion,viabinaryrepres,0
ctor<vector<string>>&assembly_code,intinstruction_no){//Handlingerrorif(assembl,2
,forRtypeformat,youmustenter4operands"<<endl;exit(0);,1
stringhex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){bina,3
nybitsareforoffsetintindex_size=log2(cache_size/(associativity*,0
4294963200){cout<<"Err,0
nti=0;i<32;i++){stringreg="x"+to_string(i);register_values[reg]=0;}intPC=0x00000,3
rrorinline:"<<instruction_no+1<<endl<<"Wrongsynta,0
o_store_mem_loc=0;to_store_mem_loc|=(tag<<o,0
o_bin['f']="1111";stringbin="";for(inti=0;i<he,1
;//Makesthepositionsofoffseybitszero//Weneedtodothisfortheoffsetaswell,because,ultimate,0
i<0x50001;i++){memory[i]=0x00;}labels.clear();register_va,3
accordinglystringtop_of_stack=stack_of_functions.top().first;inttop_line=s,1
2]]-instruc,0
binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Execute,2
clude<queue>#include<random>#include<iomanip>#include<cstring>//Thefollow,4
spartsoftheinstrctionstringopcode="0110111";stringrd=registers[assembly_code[instruction_no][,1
bin_PC=decimal_to_binary(PC,32,0);stringhex_PC=b,1
es[rs1],val_rs2=register_values[rs2];if(val_rs1>=val_r,2
1"]='9';bin_to_hex["1010"]='a';bin_to_hex["1011",1
svoidstep_S(vector<str,0
ing>instruction){stringrd,rs1,inst;inst=instructi,0
yboolfound=false;for(inti=0;i<associativity;i++){vector<int>cache_block(block,1
struction=assembly_code.size();boolto_break=false;intbreak_po,1
nclude<vector>#include<array>#include<algorithm>#include<cstdlib>#include<math.h>#include<sstream,5
structions.push_back(instruction);stringcu,1
;if(first_word.back()==':'){exe,2
"0x"+hex_PC;cout<<"Executed:"<<e,0
.top().seco,1
size();i++){memory[i]=0;}for(inti=0;i<cache.size();i++){f,4
opcode;stringhex_instruction=binary_to_hex(instr);vect,1
ocwhereyoucanwritetonextreturnmem_loc;}//Functiontostore,0
ct3valuesvoidinitialize_funct3(){f,1
s(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction,2
struction_no][0]]=='U'){execute_U(assembly_code,1
t_storage=(mem_loc/block_size)*block_si,1
uction=binary_to_hex(instr);vector<string>binary_bytes(4);for(i,3
storethemstartingforlocationspecifiedbythemem,0
;new_data[1]=1;//Setthebittodirty}for(inti=0;i<associativity;i++){if(cach,1
ize();ifstreaminstruction_file;vector<vector<string>>assembly_code;s,3
le(!dummy_stack_function.empty(,0
instruction.size();i++){uint64_tstore_value=stoi(instruction[i]);vector<uint8_t>byte(8);for(inti=,5
sociativity==0){//Thisme,0
<"Incorrectvalueofrs1";exit(0);}elseif(registers.find(assembly_code[instr,1
rcode#definestoistoll#defineintlonglongusingnamespacestd;//Declarethememory//intmemor,0
ask=temp_mask<<(index_size+offset_,0
tringrs2=registers[assembly_code[instruction_no][1]];stringimm=decimal_to_binary(stoi(assem,3
ex_to_bin['6']="0110";hex_to_bin['7']="0111,2
]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++){new_data,0
_many_to_skip++;continue;}if(dat,0
exit(0);}elseif(registers.find(assembly_code[instruction_no][1])=,4
stringthis_register="x";if(i<10){ch,0
nstruction_no){//Handlingerrorif(assembly_code[instruction_no].size()!=4){cout<<"Errorin,3
ectlyaddourvaluetoitboolfound_invalid=false;for(inti=0;i<associativity;i++){vec,0
placement_policy=="FIFO,0
heonceswhicharevalidfor(inti=0;i<cache.size();i++){for(intj=0;j,1
ntdummyi=i;charnum1=dummyi%10+'0';dummyi/=10;charnum2=dummyi%,0
nctions.top().second;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_sta,2
ate_queue(index,tag,f,0
3=funct3[assembly_code[instruction_no][0]];stringrs1=registers[assembly_code[instr,3
te(4);for(inti=0;i<4;i++){byte[3-i]=store_value>>(3-i)*8;}for(inti=0;i<4,4
e=(mem_loc/block_size)*block_size;intend_storage=(mem_l,1
de[instruction_no].size()!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongs,2
"]=0;}//CodefortheJformatstepinstructionsvoidst,0
;stringhex_instruction=binary_to_hex(in,0
reak_lines.find(break_point-count_how_m,0
air<string,int>>s,1
ointif(break_lines.find(break_point-count_how_many_to_skip)!=break_lines.end()){break_lines.erase(br,3
ry[mem_loc]=byte;}if(inst=="sh"){vector<uint8_t>byte(2);byte[0]=store_valu,5
itsareforoffsetin,0
unt=imm;if(s,0
_hex(instr);vector<string>binary_bytes(,2
f3=funct3[assembly_code[instruction_no][0]];stringrs1=registers[assem,3
inary_to_hex(bin_tag,true,5);cac,1
){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Labelnotdefined";exit(0);}else{assembly_code[in,1
toi(assembly_code[instruct,0
(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC,2
o_decimal(bin_ins,0
ary_bytes[i],1
ode[instruction_no][0])!=load_,2
ecurrentinstructionandsto,0
_stack=stack_of_functions.top().first;inttop_line=stack_,1
h(tag);}else{inttop_tag=q.front();//Getthetagwh,2
{memory[instruction_no*4+i]=by,1
e();//Iterateoverthebinarystringfo,1
ze());intstart_storage=(mem_loc/bl,1
,20,true);//Concatinatingtheinstructionstringinst,0
bits//Letusnowcalculatethema,0
_no][3])>=pow(2,6)){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediate,2
nst=="andi"){register_values[rd]=register_values[rs1]&imm;}elseif(inst=="slli"){register_values,4
;funct3["sh"],1
ffset_to_label.clear();while(!stack_of_functions.empty()){stack_of_functions.pop();}stack_of_functi,5
);}elseif(to_store[0]==".half"){data_base_addr,2
structionsvoidexecute_J(vector<,0
ector<string>>&assembly_code,intinstr,1
]=cur;cur="";continue;},0
{cout<<"Nobreakpoint,0
its+misses);}stack_of_functions.pop();}}}elseif(command=="step"){//Gostepbystepintno_of_inst,2
ize));//Thesemanyareforindexinttag_size=20-offset_size-index_size;//Andthesemanyaretagbitsvector,0
al_to_binary(stoi(assembly_code[instruction_no][3]),13,true);//C,4
ngcurrent_opened_file="";vector<queue<int>>order_of_acces,2
,HitRate="<<fixed<<setprecision(3)<<(double)(h,2
edbythemem_locfor(inti=1;i<instruction.size();i++){uint64_tsto,1
"Valueofimme,0
uted_instruction=all_instructions[PC/4];intpos=executed_instruction.find('');st,2
=false;cache_output.c,0
ontostorebytwintstore_byte(vector<st,0
memory[mem_loc]=val;//Incaseofwritethroughandmiss,wedonotconta,1
g<<","<<clean_or_dirty<<"fromupdatequeue"<<endl;}order_of_access[index]=q;}voidw,1
s[rd]=register_values[rs1]|register_values[rs2];}elseif(inst=="xor"){register_v,4
o){//Handlingerrorif(assembly_code[instruction_no].size()!=3){cout<<"Errorinline:"<<in,3
struction_no);}elseif(format[asse,0
p().first;inttop_line=stack_of_functions.top().second;top_line=PC/4+1;s,2
ed_instruction=executed_instruc,0
k=1;temp_mask=temp_mask<<(index_size+offset_size,0
atano?to_store_mem_,0
mem_loc];update_queue(index,0
if(registers.find(assembly_code[in,0
}elseif(r=="s3"||r=="x19"){r="x19";}elseif(r=="s4"||r=="x20"){r="x20";}elseif(r=="s5"||r=="x21"){r=",5
ing>to_store;stringcur="";for(charc:inst,0
icharevalidfor(inti=0;i<cache.size();i++){for(intj=0;j<cache[i].size();j++){if(cache[i][j][0]==,6
unt!=0){register_values[rd]=register_values[r,1
eplacementpolicyif(!found_invalid){update_queue(index,tag,tru,1
y_code[instruction_no][0]=="srli"||assembly_code[instruction_no][0]=="slli"){if(stoi(assembly_cod,4
decimal_to_binary(index,20,0);stringhex_set="0x"+binary_to_hex(,1
sters;unordered_map<string,str,0
emory[mem_loc+i]=byte[i];}mem_loc+=4;}//Returnthenewmem_locwhereyoucanwritetonextretu,2
n";}else{vector<string>cur_instr=assembly_code[PC,1
tringimm=decimal_to_binary(dec_imm,20,true);//Concatinatingtheinstructionstringinstr=imm+rd+opcod,1
){if(register_values[rs1]<register_values[rs2]){PC=n,2
nstruction_no*4+i]=byte[i];}}//Fun,1
k_point-count_how_many_to_skip);cout<<"Deletedbreakpointatline:"<<break_point<<e,0
riousmapswhichwillstorethenecessaryinformationunordered_map<string,string>register,1
l<<"Incorrectvalueofrd";exit(0);}els,1
rue);//Concatinatingthepartstoformtheinstruction,0
ter_hex<<endl;}}elseif(command=="exit"){//Exitthesimulatorcout<<"Exitedthesimulator";break;}els,1
esetalltheregisters/memor,0
se;vector<uint8_t>byte(8);for(inti=0;i<8;i++){b,2
uction.substr(pos+1);},1
ormat,youmustenter4operands"<<endl;exit(0);}elseif(registers.find(assembly_code[instr,1
4+i]=byte[i];}}//CodeforJformatinstructionsvoidexecute_J(vector<v,1
no].size()!=3){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrong,1
euseadummystacktopopthel,0
;stack<pair<string,int>,1
(byte[0]);register_v,2
ons.pop();stack_of_functions.push({top_of_stack,top_line});str,3
sembly_code[instr,0
edq.push(tag);//P,1
top_line=PC/4+1;stack_of_functions.pop();stack_of_fun,1
veunnecessaryspacefromthebeginningofanylinebool,0
}intvalue_of_register_int=register_values[this_register];stringvalue_of_re,1
r_values[rs1];if(inst=="lb"){int8_tbyte=read_access(start_location,false);int8_tres=byte,3
cy;//Iftheassociativity=0,thenwene,0
20,0);stringhex_set="0x"+binar,0
instruction_no+1<<endl<<"Wrongsyntax,forStypeformat,youmustenter4operands,0
nd(assembly_code[instruction_no][0])!=lo,3
rBformatinstructionsvoidexecute_B(vector<vector<string>>&assembly_code,intinstruction_no){/,3
for(inti=0;i<associativity;i++){v,0
lues[rd]=register_values[rd]&mask;register_values[rd]&=mask;}}elseif(inst=="sr,3
(){load_oper,1
='8';bin_to_hex[,0
ng,int>>stack_of_functions;unordered_set<int>break_lines;intcount_how_many_to_sk,1
<algorithm>#include<cstdlib>#include<math.h>#include<sstream>#include,4
(inti=0;i<bin.size();i++){if(bin[i]=='0'){bin[i]='1';}else{bin[i]='0';}}//Add1tofind2'scomplem,8
tr(17);ifstreamc,1
instruction;all_instructions.push_back(instruction);stringcur="";for(inti=0;i<instruction.size(,1
te",false,false,val,offset);}}}}else{memory[mem_loc]=val;}}intread_acce,2
tions.top().second;top_line=PC/4+1;stack_of_functions.pop();s,2
he_simdisable"){cache_enabled=false;cache_output.close();}elseif(command=="c,2
ommand.find("mem")){//Hereweshowthecountnumberofmemoryb,1
de[instruction_no][3]),6,true);imm="010000"+imm;}else{if(stoi(assembly_c,2
ing>cur_instr=assembly_code[P,0
and=="cache_simstats"){if(cache_enabled){cout<<"D-cachestatistics:Accesses="<<hits+misses<<",Hit="<,1
dl<<"Wrongsyntax,forItypeformat,youmustent,0
pq.push(tag);}else{inttop_tag=q.front();//Getthetagwhichweneedtoreplaceq.pop();//Poptheva,3
isfiedasperthegiveninst,0
)){opcode="0000011";}elseif(assembly_code[instruction_no][0]=="jalr"){opcode="1100111,4
vector<string>cur_instr=assembly_code[PC/4];if(format[cu,2
ty;i++){if(cache[index][i][2]==top,3
*block_size+(block_size-1);new_data[0]=1;//Thebitisnowvalidnew_data[1]=0;//Initial,3
i<=17){stringargument_register_no="a";argument_register_no+=to_string(i-10);registers[argument_regi,1
"t6"||r=="x31"){r="x31";}returnr;}voidupdate_queue(in,1
hex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;co,1
lues[rs2];//Ourmaskisshifting_amount0'sfollowedby64-shifting_amount1'suint64_tmask=(1U<,1
register_values[rs1];if(inst=="lb"){int8_tbyte=read_access(start_,2
atstepinstructionsvoidstep_R(vector<string>instruction){//Extractrd,rs1,rs2stringinst=instructio,2
//Functiontoconvertbinaryst,0
="srl"){uint64_tshifting_amount=register_values[rs2];if(shifting_am,1
();}cur_instruction.push_back(cur);cur,2
Ourmaskisshifting_amount0'sfollowedby64-shi,0
icharevalidfor(inti=0;i<cache.size();i++){for(intj=0;j<cache[i].size(),3
ntostorebytwintstore_byte(vector<string>instruction,i,1
ity>>replacement_policy>>write_back_policy;//Iftheassociativity=0,thenweneedtomakei,0
So,weneedtoprintinthecache_outputfilefromhereonly,sin,0
wordintstore,0
_binary(hex_instructi,0
ex_to_bin['f']="1111",1
["0001"]='1';bin_to_hex["0010"]='2';bin_to_hex["0011"]=,3
ckSize:"<<block_size<,0
hembreak_lines.insert(break_point-count_how_many_to_skip);cout<<"Insertedbreakpointatlin,1
aninvalidframe,andifwedo,thenwecandirectlya,0
(inti=0;i<instruction.size();i++){if(trim&&instruction[i]==''){continue;}else{trim=false;tr,4
address="0x"+binary_to_hex(bin_address,false,5);stringbin_set=decimal_to_binary(index,20,0);stringh,2
if(!command.find("break")){//Weparsethestringtogetthelinenumberwherewehaveto,2
Usingalooptoprintth,0
le_name=command.substr(17);ifstreamcache_config_file;cache_config_fi,1
ecimal_to_binary(stoi(assembly_code[instruction_no][2]),21,true);//Concatinatingth,4
lse{if(stoi(assembly_code[instruction_,0
1){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit,0
tion_no].size()!=4){cout<<"Errorinline:"<<instruction_no+1<<e,1
all_instructions[old_PC/4];intpos=executed_instruction.find('',1
ecimal_to_binary(mem_val,8,0);stringhex_mem_val="0x"+binary_to_hex(bin_mem_val,true,2);int,2
;format["bgeu"]='B';//Jformatformat["jal"]='J';//Uformatformat["lui"]='U';}//Keepi,3
;format["sra"]='R';//Iformatformat["addi"]='I';format["xori"]='I';format[,3
cur!=""){if(cur[cur.size()-1]==','||cur[cur.size()-1]==')'){cur,5
');stringfirst_word=executed_instruction.s,0
:"<<executed_instruction<<";PC="<<hex_PC<<endl;//UpdatethePCvalue,0
ingrd=registers[assembly_code[instruction_no][1]];stringrs1=regis,3
k_size)*block_size+,0
