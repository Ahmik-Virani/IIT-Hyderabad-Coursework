d]=PC+4;PC=new_pc;}// 0
cfor(inti=1;i<instruction.size();i++){uint64_tstore_value=stoi(inst 1
etittonon-dirty}//Sincethisahit,weneedtoupdate 0
gcur="";for(charc:instruction){i 1
000000";funct7["sub"]="0100000";f 1
e;//Givingthecorrectopcodetothecorrespondinginstructionif(load_operands.find(assembly_c 0
x_PC<<endl;//UpdatethePCandensurethatx0remainsatvalue0PC=PC+4;register_values["x0" 0
code[instruction_no][2]);}if(dec_imm<0||dec_imm>4294963200){cout<<"Errorinline:"<<instruct 4
o+1<<endl<<"Incorrectvalueof 0
n_no].size()!=4){cout<<"Error 1
g>instruction,intmem_loc){//Gothroughallthevaluesthat 0
l<<"Valueofimmediateisoutofrange";exit(0);}//Notingthevariouspartsoftheinstrcutionstringopco 1
.empty()){cout<<"EmptyCallStack:Executioncompl 1
m_loc];update_queue(index,tag,true,mem_loc,"read",true,false);returnval;}}} 1
wu"]='I';format["jalr"]='I';//Sformatformat 1
cur);}//Notethatheretagwillalwaysbeatthetopq.push(tag);}else{ 1
/Extracttherdandimmediatevaluesstringinst,rd;inst=instruct 0
mporary_register_no="t";temporary_register_no+=to_string(i-5);registers[temporary_register_ 1
ues[rs2];}elseif(inst=="and"){register_ 2
etbitszero//L 0
owour20bitsofmem 0
n['2']="0010";hex_to_bi 1
r[0]]=='J'){step_J(cur_instr);}elseif(format[cur_instr[0]]=='U 5
tion=all_instructions[old_PC 0
s[rd]&=mask;}}elseif(inst=="srai"){register_values[rd]=register_values[rs1]>>imm;}//Updatethes 5
k_size)*block_size+(block_size-1); 1
;}//CodefortheRformatstepinstructionsvoidstep_R(vector<string>instruction){//Extractrd,rs1,rs2string 2
ector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binar 3
"<<instruction_no+1<<endl<<"Incorrectvalueofrs2";exit(0) 1
ed_instruction<<";PC="<<hex_PC< 0
ndl<<"Labelnotdefined";exit(0);}else{assembly_code[instruction_no][3]=to_s 3
if(is_dirty){clean_or_dirty="Dirty";}if(is_read){read_or_write="R";}stringbin 4
ex_instruction=binary_to_hex(instr);vector<string>binary_b 2
rectvalueofrs1";exit 0
oreplaceq.pop();//Popthevaluewhichisreplacedq.push(tag);//Pushthenewtagvaluevector<int>removed_d 3
code[instruction_no][2])==labels.end()){cout<<"Errorinline:"<<instruct 3
se{cout<<"CacheDisabled";}}elseif(command=="cache_simdisable"){cache_enabled=false;cache_output.clo 1
_to_bin['9']="1001";hex_to_bin['a']="1010";hex_to_bin['b']="1011";hex_to_bin['c']="1100";hex_t 4
'B';format["bgeu"]='B';//Jformatf 1
on_no][3]]-instruction_n 1
&&hex[0]>='0'){hex=zeros+hex 1
uction.substr(pos+1);}stringbin_PC 1
e:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Notingthevariouspartsof 1
block(block_size+3);cache_bl 1
.substr(2));in 1
(PC/4<no_of_instruction){if(break_lines.find(PC/4 0
1){is_dirty=true;intto_store_mem_loc 0
ache.size();i++){for(intj=0;j<cache[i] 2
<<40)|(byte[4]<<32)|(byte[3]<<24)|(byte[2]<<16)|(byte[1]<<8)| 4
<<(64-shifting_amount))-1;if(shif 1
xit(0);}else{assembly_code[instru 1
"Incorrectvalueofrd";exit(0);}elseif(registers.find(assembly_code[instruction_n 1
){r="x6";}elseif(r=="t2"||r=="x7"){r="x7";}elseif(r=="s0"||r==" 3
intPC=0x00000;for(inti=0x0;i<0x50001;i++){memory[i]=0x00;}labels.clear();regis 3
te[0];register_values[rd]=res;}elseif(ins 2
Thecacheblockisnowdirtycache_block[2]=tag;fo 1
exit(0);}imm=decimal_to_binary(stoi( 1
intimm;//Weacceptbothdecimalandhexadecimalvaluesif(instruction[2][1]=='x'){stringbin_instr=hex_to_ 3
i]);}else{if(cur[cur.size()-1]==':'){ 3
e,intlength=8){unordered_map<string,char>bin_to_hex;bin_to_hex["0000"]='0';bin_to_h 2
size=log2(block_size);//Thesemanybitsareforoffsetin 1
ebitisnowvalidnew_data[1]=0;//Initiallynotdirtynew_data[2]=tag;for(intj=start_storage,k=3;j<=e 2
.pop();if(cur!=tag){dummy_q.push(cur);}}while(!dummy_q.empty()){intcur=dummy_q.front(); 7
hex_PC=binar 0
=break_lines.end()){cout<<"Executio 1
<instruction_no+1<<endl< 0
o_replace,intmem_loc,stringoperation,boolis_read,boolis_hit,intval=-1,intoffset=-1){queue<int> 1
ions.pop();stack_of_functions.push({top_of_stack,top_line});stringexecuted_instruction=all_instruct 3
tack_of_functions.push({top_of_stack,top_line});stri 2
wu"){//Extractrd,rs1,andimmediaterd=aliasRemo 0
uctionsvoidstep_B(vector<string>instruction){//Keeptrac 2
tream>#include<stri 0
d('');stringfirst_word=executed_instruction.substr(0, 1
atstepinstruction 0
;i++){write_access(mem_loc+i,byte[i],accessed_once);accessed_once=true;}}if 3
[i];//Valid,Dirty,tag,dataif(cache_block[0]==0){//Thisisaninv 3
lvariablesrelatedtocacheintcache_size,blo 0
ry_register_no]=this_register;}}}//Definingall 0
hifting_amount0'sfollowedby64-shifting_amount1'suint64_tmask=(1U<<(64-shifti 0
rue){//Nowsavethenextfilestringcommand;getline(cin,comm 0
ne=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,top_li 1
C+stoi(instruction[3]);stringrs1=aliasRemover(instruction[1]);stringrs2=aliasRemove 4
int64_tval_rs1=register_values[rs1],val_rs2=register_values[rs2 1
ask-1;tag_mask=tag_mask^temp_m 0
_once=false;for(inti=0;i<4;i++){byte[i]=read_access(sta 1
ase_address);}elseif( 0
}uint32_tres=byte[3]<<24|byte[2]<<16|byte[1]<<8|byte[0];register_values[rd]=res;}// 5
inary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to 2
ialize_load_operands(){load_operands.insert("lb");load_operands.insert("lh");load_operands. 3
o_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction 1
lock_size));//Thesemanyareforindexinttag_size=20-offset_size-index_size;//Andthesemanyareta 0
ormat();initialize_load_ope 1
bin['c']="1100";hex_to_bin['d']="1101";hex_to_bin['e']="1110";hex_to_bin 3
{byte[i]=binary_to_decima 1
;for(inti=0;i<4;i++){byte 0
bly_code.size();if(PC/4==no_of_instruction){cout<<"Nothingt 2
="x22";}elseif(r=="s7"||r=="x23"){r="x23";}elseif(r=="s8"||r=="x24"){r="x24";}elseif(r=="s9"||r== 4
C="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="< 0
ialize_funct3();initialize_funct7();initialize_format();initialize_load_operands();in 4
e_of_register_int,64,1);stringvalue_of_register_hex=binary_to_hex(value_of_register_ 0
ruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0); 1
gbitslaterinttag_mask=1;tag_mask=tag_mask<<20;tag_mask=tag_mask-1;//Thismakesthemask20onesintte 0
_line=stack_of_functions.top().second;top_line=old_PC/4+1;stack_of_functions.pop( 1
true);}returnval;//Thedatastartsfromindex3andextendstillblocksize//break;}}//Ifwedidnotfindtheva 0
tion[i]==''){ 1
0,vector<string>(0));//Checkiftheuserisspecifyingthe.dataor.textfieldbooldata=false;stringdat 2
weneedtoupdatetheorderofaccessvectorupdate_queue(index,tag,false,mem_loc,"write",false,true,v 0
_no][1]];stringimm=decimal_to_binary(stoi(assembly_code[inst 1
nstruction[1]);strin 1
nt1'suint64_tmask=(1U<<(64-shifting_amount))-1;if(shif 1
ruction_no][1 0
<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction.subs 3
ction_no][2]);}if(dec_imm<0||dec_imm>4294963200){cout<<"Errorinlin 3
ode[instruction_no][0]=="jalr"){opcode="1100111";}else{opcode="0010011" 3
alues[rs2];}elseif(inst=="sll"){register_values[rd]=register_values[rs1]<<register_values[rs2] 5
truction<<";PC="<<hex_PC<<endl;//Ensuretoremovethecalledfunctionfromthestackoffunctionsstack_of_func 0
eblockisnowdirtycache_block[2]=tag;found_invalid=true;update_queue(index,tag,false,mem 1
lockinthecache,weloadthewholeblockfromthememoryboolfound=false;for(inti=0;i<associ 0
tor<vector<vector<int>>>cache;//Valid,dirty,t 3
p().first;inttop_line=stack_of_functions.top().second;top_line=old_PC/4+1;stack_of_functio 2
rnum1=dummyi%10+'0';dummyi/=10;charnum2=dummyi%10+'0';this_register+=num2;this_register+=n 0
inst=="lbu"||inst=="lhu"||inst=="lwu"){/ 0
ck_size);//Thesemanybitsareforoffsetintindex_size=log2(cache_size/(associa 0
address=decimal_to_binary(mem_loc,20,0);stringhex_address="0x"+binary_to_hex(bin 1
s[rd]=res;}elseif(inst=="lbu"){uint8_tbyte=read_acce 2
;mem_loc++;}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_loc;}signedma 0
setbitsintoffset=offset_mask&mem_lo 0
seif(registers.find(assembly_code[instruction_no][1 1
t<<"Errorinline:"<<instruction_no+1<<endl<<"Wr 0
partsoftheinstructionstringopcode="1100011";stringf3=funct3[assemb 0
t_word.back()==':'){executed_in 1
estackoffunctionsandtheirlastexecutedlineaccordi 0
ion<<";PC="<<hex_PC<<endl;//Ensurethatthex0valueremainsat0register_values["x0"]=0;}//Codefort 1
k_policy=="WT"){memory[mem_loc]=val;//Incaseofwritethroughand 1
ry_to_hex(value_of_register_bin,tr 0
ion.size();i++){if(instruction[i]!=''&&instruction[i]!='(') 4
1;//Thebitisnowvalidnew 0
x_to_binary(assembly_code[instruction_no][2].substr(2));intdecimal=binary_to_decimal(bin 4
t();q.pop();if(cur!=tag){dummy_q.push(cur);}}while(!dummy_q.empty()){intcur=d 7
bin_PC=decimal_to_binary(PC, 0
{//Extracttherd,rs1andimmediatevaluerd=aliasRem 0
"1100"]='c';bin_to_hex["1101"]='d';bin_to_hex["1110"]='e';bin_t 2
storage,k=3;j<=end_storage;j++,k++) 0
_instr);}elseif(format[cu 0
q.push(cur);}if(!is_present){q.push(tag);}}else{int 4
bitslaterinttag_mask=1;tag_mask=tag_mask<<20;tag_mask=ta 0
.substr(pos+1);}stringbin_PC=decimal_to_binary(old_PC,32,0);str 2
1<<endl<<"Incorrectvalueofrs1";exit(0 0
dl<<"Incorrectvalueofrd";exit(0);}elseif(stoi(assembly_code[instruction_no][2])<-1*pow(2,20)||stoi( 5
embly_code[i 0
akpointatline:"<<break_point<<endl;}else{cout<<"Nobreakpointspresent\n";}}elseif( 0
s1=register_va 0
oncatinatingtheinstruct 0
ormat[cur_inst 0
tion_no+1<<endl<<"Wrongs 0
0";funct3["ori"]="110";funct3["andi" 1
rd"){data_base_address=store_dword(to_store,data_base_address);}elseif(to_store[0]==".half"){data_b 4
=0){register_values[rd]=register_values[rs1]>>imm;//Ourmaskisshifting_a 2
d(assembly_code[instruction_no][3])==labels.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<< 4
no*4+i]=byte[i] 1
n(){//Initializealltherequiredfieldsinitialize_registers();initialize_funct3();initialize_funct7 3
or(inti=0;i<length;i++){//Ifthecurrentcharacteris'1',addthecorrespondingpo 0
);vector<int>new_data( 1
f(r=="a5"||r=="x15"){r="x15";}elseif(r=="a6"||r=="x16"){r="x16";}elseif(r=="a7"||r=="x17"){r="x17";} 6
infromthestackif(PC/4==no_of_instruction){stack_of_functions.p 1
3["add"]="000";funct3["sub"]="000";funct3["and"]="11 3
cifiedandstorethemstartingforlocationspecif 0
alueofoffsetbitsintoffset=offset 0
og2(cache_size/(associat 0
in[hex[i]];}returnbin;}//Codetoconvertdecimaltobinarystringdecimal_to_binary(intdecimal,intno_o 2
xecuted_instruction=all_instructions[PC/ 0
ewhichisreplacedq.p 0
;temp_mask=1;temp_mask=temp_mask<<o 0
nti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);//characters67ofhe 3
on_no){//Handling 0
ory[instruction_no*4 0
isparticularmemorylocation.//Ifwedonotfindthisblockinthecache,weloadthewholeblockfromthememoryboolf 0
_skip++;if(instruction==".text"){data=false;}else{//Storetherequireddword/word/byte/halfwor 2
_binary(s_addr);intaddr=binary_to_decimal(bin_s_addr);intcount=stoi(s_c 2
einstructionif(inst=="lb"||inst=="lh"||inst=="lw"||inst=="ld"||inst=="lbu"||inst== 0
Keeptrackofhowmanylineswereusedfordatasegmentand 0
registers[a 0
yte[7-i]=store_value>>(7-i)*8;}for(inti=0 2
obreakpointspresent\n";}}el 0
word.back()==':'){executed_instruction=e 1
sk<<(index_size+offset_size);index_mask=index 1
Definingallfunct7value 0
d]&mask;}}elseif(inst=="sra"){register_values[rd]=register_values[rs1]>>reg 3
-igivesthepositionfromtheright}}returndecimal;}//Definingallregistersvoidini 0
tring&bin){intdecimal=0;intlength=bin.siz 0
tr(2);//Weremovetheleading0xinthestring//W 1
he[index][i]=n 2
ringopcode 0
lock_size-1);new_data[0]=1;//Th 1
//Extracttherd 0
irlastexecutedlineaccordin 0
intdecimal=0;intlength=bin.size();//Iterateoverthebinarystringfor(inti=0; 1
(!found){if(!acc 1
0";funct3["ld"]="011";funct3["lbu"]= 2
PC/4];intpos=executed_instruction.find('');stringfirst_ 1
=(byte[3]<<24)|(byte[2]<<16)|(byte[1]<<8)|(b 3
es[rd]=register_values[rs1]>>register_val 2
(cur_instr);}elseif(format[cur_instr[0]]=='I' 3
,20,0);stringhex_tag="0x"+binary_to_hex(bin_tag,true,5);cache_ou 1
e()-1]==')'){cur.pop_back();}cur_instruction.push_back(cur);}//Ifinwrongposition,bringtheope 4
in[hex[i]];}returnbin;}/ 2
code="0010011";}//Notingthevaiourspartsoftheinstrutionstringf3=funct3[assembly_code[instruct 0
ck_size>>associativity>>replacement_polic 0
cimaltobinarystringdecimal_to_binary(intdecimal,intno_of 0
++){mask+=pow(2,i);}}register_values[rd]=register_values[rd]&mask;regis 4
es[i]=hex_to_binary(hex_instruction.substr(6-2*i,2) 2
or(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i] 2
ine:"<<instruction_no+1<<endl<<"Wrongsyntax,forUtypefor 0
_hex(bin_set 0
,5,false);registers[register_no]=this_register;if(i==0){registers["zero"]=this 3
tno_of_indexes=cache_size/(ass 0
]=register_values[rs1]<<register_values[rs2];}elseif(inst=="srl"){uint64_tshifting_amount=regist 3
index][i][2]==top_tag){removed_ 2
er_of_access.clear();order_of_access.resize(no_of_indexes);cache_confi 2
licy<<endl;cout<<"WriteBackPolicy:"<<write_back_policy;}else{cout<<"CacheD 0
){r="x22";}elseif(r=="s7"||r=="x23"){r="x23";}elseif 3
=="srli"||assembly_code[instruction_no][0]=="slli"){if(stoi(assembly_ 2
ex_to_bin['f']="1111";stringbin="";for(inti=0;i<hex.size();i++) 2
to_decimal(conststring&bin){intdecimal=0;intlength=bin.size();//Iter 2
ry_to_hex(bin 0
cationspecifiedbythemem_locfor(inti=1;i<i 0
cache[i][j].size();k++){cache[i][j 4
nstr[0]]=='I'){step_I(cur_instr);}elseif(format[cur_instr[0]]=='S'){step_S(cur_in 6
<string,int>last_exected_line;stack<pair<string,int>>stack_of_functions;unordered_set<int>bre 4
i]);}else{if(cur[cur.size()-1]==':'){cur.pop_back();labels[cur] 5
dtolookinthememoryif(!f 0
="srli"){uint32_tshifting 0
myfile_out.open(myf 0
register_values[rd]&=mask;}}elseif(ins 1
dex3andextendstillblocksize//break;}}//Ifwedidnotfindthevalue,we 0
ing_amount=imm;if(shifting_amount!=0){register_values[rd]=register_values[rs1]>>im 3
_code[instruction_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl< 3
<32;i++){stringreg="x"+to_string(i);register_values[reg]=0;}intPC=0x00000;for(inti=0x0;i<0x50001;i++ 3
;//Wenowextractthevalueofaddrandcountbyparsingthelinefor(inti=4;i<command 0
dress=decimal_to_binary(mem_loc,20,0); 1
ers67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//Functio 3
exadecimaltobinarystringhex_to_binary(stringhex){unordered_map<char,string>hex_to_bi 2
tistics:Accesses="<<hit 0
truction_no][0]];stringrs1=registers[assembly_code[instruc 1
bitslaterinttag_mask=1;tag_mask=tag_mask<<20;tag_mask=tag_mask-1;//Thi 0
j][0]=0;//Makethevalidbitaszero}}}elseif(!command.find("cache_simdump")){stringmyfile_out_name=com 3
mbly_code[instruction_no][2].substr(2));intdecimal=binary_to_decimal(bin_instr);dec_imm=d 4
g_mask=1;tag_mask=tag_mask<<20;tag_mask=tag_mask-1;//Thismakesthemask20onesinttemp_mask=1;temp_mask 0
binarystringhex_to_binary(stringhex){unordered_map<char,string>hex_to_bin;hex_to_bin['0']="0000";he 3
;i++){intmem_val=memory[i];st 1
orrectvalueofrs1";exit(0);}e 1
.end()){break_lines.erase(break_point-count_how_many_to_ 1
,intinstruction_no){//Handlingerrorif(assembly_code[instruction_no].size()!=3){cout<<"Erro 3
values[rs1]>>regi 1
ttodecimalrepresenttion,viabinaryrepres 0
ed_map>#include<unordered_ 0
enabled){for(inti=0;i<cache. 0
rands();initialize();ifs 2
R';format["sll"]='R';format["srl"]='R';format["sra"]='R';//Iformatformat["addi"]='I';format["xori 4
{boolaccessed_once=false;vector<uint8_t>byte(4);for(inti=0;i< 2
'){step_S(cur_instr);}elseif(format[cur_instr[0]] 4
valuesthattheuserhasspecifiedandstorethemstartingforlocationspecifiedbythemem_loc 0
funct3["and"]="111";funct3["or"]="110";fun 2
no+1<<endl<<"Wrongsyntax,forUtypeform 0
mory[mem_loc]=byte[0];memory[mem_loc+1]=byte[1];mem_loc+=2;}//Re 4
gister_values["x0"]=0;}//CodeforRform 1
>#include<unordered_set>#include<vector>#include<array>#include<algorithm>#include<cst 4
==4){registers["tp"]=this_register;}elseif(i>=5&&i<=7){stringtemp 2
k_of_functions.top().first;inttop_line=st 1
false);uint8_tres=byte;register_values[rd]=res;}elseif(inst=="lhu"){uint16_tbyte0=read_access(start_ 2
n[i]=='0'){bin[i]='1';}else{bin[i]='0'; 4
(index,tag,false,mem_loc,"write",false,true,val);break;}}//I 1
i]=store_value>>(7-i)*8;}for(inti=0;i<8;i++){write_access(mem_loc+i,byt 1
nthenewmem_locwhereyoucanwritetonextreturnme 0
ed_instruction=all_instructio 0
aliasRemover(instruction[3]);//Dothear 2
t8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal( 2
command.find("cache_simdump")){stringmyfil 1
is_register;}elseif(i>=5&&i<=7){stringtemporary_register_no="t";tempora 0
wour20bitsofmemoryaddressaredivided.into 0
lue=register_values[rs2];//Performstoreaspertheinstructionif(inst=="sb"){uint8_tb 2
e(4);boolaccessed_once=false;for(inti=0;i<4;i++){byte[i]=read_access(start 2
amespacestd;//Declarethememory//intmemory[0x50001];vector<int>memory(0x50001,0);//Initializethevalu 3
ineaccordinglystringtop_of_stack=stack_of_functions.top().first;inttop_line=stack_o 1
fortheoffsetaswell 0
memorylocationthatourprogramisrequestingtoreadinttag=tag_mask&mem_loc;tag>>=(inde 0
srai"||inst=="slli"||inst=="srli"){//Extracttherd,rs1,immvaluesrd=aliasRemover(instruction[1]);rs 2
itetonextreturnmem_loc;}//Functiontos 0
nary(stoi(assembly_code[instr 0
="a3"||r=="x13"){r="x13";}elseif(r=="a4"||r=="x1 1
acktothecorrectpositioninthematrixif(load_operands.find(cur_instruction[0])!=load_operands.end()| 3
ebittodirty}for(inti=0;i<associativity;i++){if(cache[index][i][2]==top_tag){re 4
/Ensurethatthex0valueremai 0
present=true;}}while(!dummy_q.empty()){intcur=du 2
-count_how_many_to_skip);cout<<"Deletedbreakpointatline:"<<break_point<<endl;}else{cout<<" 0
out<<"D-cachestatistics:A 0
tetonextret 0
=pow(2,12)-1){c 1
reak_lines.find(break_point-count_how_ma 0
lueofimmed 0
ed,thenensuretopo 0
rystringhex_to_binar 0
d()%associativity;vector<int>removed_data(cache[0][0].siz 4
;stringrs1=registers[assembly_code[instruction_no][1]];stringrs2=registers[assembly_code[instructi 3
onstringopcode="0110011";stringf3=funct3[assembly_code[instruction_no][0]];stringf7=funct7[assembl 3
=4;}elseif(inst=="addi"||inst=="xori"| 0
lseif(r=="s1"||r=="x9"){r="x9";}elseif(r=="a0"||r=="x10"){r="x10";}elseif(r==" 4
sh"){vector<uint8_t>byte(2);byte[0]=store_value;byte[1]=store_value>>8;write_access(mem_loc,byte[0 4
count_how_many_to_skip;//Codetoconvertbinarytohexadecimalstringbinary_to_hex(str 0
op().first;inttop_line=stack_of_functions.top().second;top_line=PC/4 2
lycodetomachinecodehexadecimalandstoreintextmemoryfor(in 0
em_loc|=(tag<<offset_size+index_size);to_store_mem_loc|=(index<<offset_si 0
values[rs1]>>imm;}//Updatethestackoffunctionsandtheirlastexecute 1
n_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_inst 0
{cout<<"Errorin 0
ddress,false,5);stringbin_set=decimal_to_binary(index,20,0);stringhex_se 1
e+offset_size) 0
etagbitslaterinttag_mask=1;tag_mask=tag_mask<<2 0
oint\n";break;}}//Iflastlineexecuted,thenensuretopopmainfromthestackif(PC 0
nstruction_no*4+i]=byte[i];}}// 1
(registers.find(assembly_code[instruction_no][ 1
anttoconvertittodecimalrepresenttion,viabinaryrepresentation 0
wedonotfindthisblockinthecache,weloadthew 0
n['3']="0011";hex_ 1
4];intpos=executed_instructio 0
rage;j++,k++){new_data[k]=memory[j];}remo 3
setaswell,because,ultimatelythisfunctionhastoreturnonly1byteintoffset_mask=1;offset_mask=offset_ma 0
de[instruction_no][1]];stringrs1=registers[assembly_code[instruction_no][2]];stringimm;//Ass 5
tion==".text")){//Keeptrackofhowmanylineswereusedf 0
(instruction[1]);rs1=aliasRemover(ins 2
ock[2]==tag){is_hit=true;found=true;val=cache_block[3+offset];//Sincethisahit,weneedt 2
gister_values[rs1]>>register_values[rs2];//Ourmas 2
i++){memory[instruction_no*4+i]=byte[i];}}//CodeforJforma 3
ofhex_instruction}for(inti=0;i<4;i+ 0
ioncomplete\n";}}elseif(!command.find("delbreak")){//Thisblockdeletesabeakpointintheprogramintb 2
ange";exit(0);}imm=decimal_to_binary(stoi(assembly_code[instruction_no][3 2
gister_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(i 3
e_block=cache[index][i];//Valid,Dirty,tag,dataif(cache_block[0]==0){//Thisisaninvalidfram 4
clude<iomanip>#include<cstrin 1
if(assembly_code[instruction 0
tion,false);int16_tbyte1=read_access(start_location+1,true);int16_tres=byte1<<8|byte0;register_value 1
cuted_instruction=all_instructions[PC/4];intpos=executed_instruction.find('') 2
s["sp"]=this_register;}elseif(i==3 1
r];cache[index][random_number]=new_data;//Nowcheckift 2
iss="<<misses<<",HitR 0
e:"<<instructi 0
mbly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forR 2
eitina2dmatrixofstringsvector<string>cur_instruction;all_instructio 1
ress);}elseif(to_store[0]==".byte"){data_base_address=store_byte(to_store,data_base_address);}}conti 4
g2(cache_size/(associativity*block_size));/ 2
ister_values;unordered_map<string,string>registe 1
=binary_to_hex(instr);vector<string>binar 2
:"<<instruction_no+1<<endl<<"Incorrectval 0
on.find('');stringfirst_word=executed_instruction.substr(0,pos);if(first_wor 2
PC,32,0);stringhex_PC=binary_to_hex(bin_PC 0
while(!dummy_q.empty()){intcur=dummy_q.front();dummy_q.pop();q.push(cur);}if(!is_pre 6
alid,Dirty,tag,dataif(cache_block[0]==0){//memory[mem_ 2
eaccordinglystringtop_of_stack=stack_of_functions.to 0
uction_no][0]=="slli"){if(stoi( 1
ndl<<"Incorrectvalueofrs1";exit(0) 1
sareforoffsetintindex_size=log 0
"x13"){r="x13";}elseif(r=="a4"||r=="x14"){r="x14";}elseif(r=="a5"||r=="x15") 4
truction.substr(0,pos);if(first_word.back()==':'){executed_instruction=executed_i 3
00"]='8';bin_to_hex["1001"]='9';bin_to_hex["1010"]='a';bin_t 2
sembly_code[instruction_no][0]]; 2
Donothing}else{intrandom_number=rand()%associativity;vector<int>re 2
tynew_data[2]=tag;for(intj=start_storage,k=3;j<=end_ 1
j<cache[i].size();j++){if 2
<associativity;i++){if(cache[index][i][2]==top_tag){removed_data=cache[index][i];cache[ 6
ode="1100111";}else{o 0
stics:Accesses="<<hits+misses<<",Hit="<<hits<<",Miss="<<misses<<",HitRate="< 0
ntfor(inti=0;i<bin.size();i++){if(bin[i]=='0'){bin 3
values["x0"]=0;}//CodefortheUformatstepinstructionsvoidstep_U(vector<string> 2
ationaddressandvalueofPCacco 0
(4);for(inti=0;i<4;i++){binar 1
file_out<<"Set:"<<hex_set<<",Tag:"<< 0
tag,20,0);stringhex_tag="0x"+binary_to_hex(bin_tag,true,5);cache_output<<read 1
j++){cache[i][j][0]=0;//Makethevalidbitaszero}}}elseif(!command.find("cache_simdump")){s 6
][0]]=='J'){execute_J(assembly_code,instruction_no);}elseif(format[assembly_cod 3
tano?to_store_mem_loc|=(removed_data[2]<<(offset_size+index_size));to_store_mem_loc|=( 2
n_no][2])>=pow(2, 1
_how_many_to_skip++;if(instruction==".text"){data=false;}else{//Storetherequireddword/word/byte/half 2
aliasRemover(instruction[1]);stringrs 2
;//Makestheposit 0
_tbyte[4];for(inti=0;i<4;i++){byte[i]=bina 2
=="s6"||r=="x22"){r="x22";}elseif(r=="s7"||r= 1
tes[i]);//characters67ofhex_instruction}fo 1
thatthereisonly1index,everyoneisfightingforthisoneindexassociativity=cache_s 0
;//Initiallynotdirtynew_d 0
}if(operation=="write"){new_data[3+offset]=val;new_data[1]=1;//Setthebittodirty}for(inti=0;i< 4
i++){binary_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4 4
etoitboolfound_invalid=false;for(inti= 0
struction.substr(0,pos);if(first_word.back()==':'){executed_instruction=executed_instruction.subs 3
t["sb"]='S';format["sh"]='S';format["sw"]='S';format["sd"]='S';//Bformatfor 4
<string>binary_bytes(4);for(inti=0;i 2
)|byte[0];register_values[rd]=res;}elseif(inst=="lbu"){uint8_tbyte=read_access(start_loca 3
rdfirstploicyintstart_storage=(mem_loc/block_size)*block_size;intend_stora 1
k=1;temp_mask=temp_mask<<offset_size;te 0
{inttop_tag=q.front();//Getthetagwhichweneedtoreplaceq.pop();//Popthevaluewhichisre 2
dex_size));to_store_mem_loc|=(index<<offset_size);for(inti=0;i<b 0
hex_PC="0x"+hex_PC;cout<<"Executed:"<<execut 0
eptrackofhowmanylineswereusedfordatasegmentandthefirstlineofte 0
er_values[rs1];if(inst=="lb"){int8_tbyte=read_ 2
.dataor.textfieldboold 0
struction[2][1]=='x'){stringbin_instr=hex_to_binary(instruction[2].substr(2));i 5
>>cache_size>>block_size>>associativity>>replacement_policy>>write_back_p 0
ndsubtractthembreak_lines.insert(break_point-count_how_many_to_skip);cout<< 1
nt8_t>byte(4);for(inti=0;i<4;i++){byte[3-i]=store_value>>(3-i)* 3
8_t>byte(8);for(inti=0;i<8;i++){byte[7-i]=store_value>>(7-i)*8;}for(inti=0;i<8;i++){ 4
ask-1;temp_mask=1;temp_ 0
th*4>binary.size()){stringzeros="",fs="";for(inti=length*4;i<binary.size();i++){zeros.push_b 2
tthereisonly1index,everyoneisfightingforthisoneindexassociativity=cache 0
ythisparticularmemorylocation.//Ifwedonotfindthisbl 0
mbly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<< 2
fset_size-index_size;//Andthesemanyaretagbi 0
"){r="x27";}elseif(r=="t3"||r=="x28"){r="x28";}elseif(r=="t4"||r=="x29"){r="x29";} 5
for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instructi 1
e[0][0].size());intstart_s 3
t1'suint64_tmask=(1U<<(64-shifting_amount))-1;if(shifting_amount==0){for(inti=0;i<=63;i+ 2
//UpdatePCvaluePC+=4;}elseif(inst=="jalr"){//Extracttherd,rs1andimmediatevaluerd=a 1
_opened_file.pop_back(); 1
nary_to_decimal(binary_bytes[i]);//characters6 2
;}//Updatethestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of 0
nglystringtop_of_stack=stack_of_functions.top().first 1
.find('');stringfirst_word=execute 1
_to_binary(stoi(assembly_code[instruction_no][3]),6,true);imm="000000"+imm;}else 4
ordingtotheinstructionsif(inst=="add"){register_values[rd]=register_values[rs1]+register_value 3
_to_binary(index,20,0);stringhex_set="0x"+binary_to_h 1
ty}//Sincethisahit,weneedtoupda 0
ueofimmediate 0
e;}uint32_tres=byte[3]<<24|byte[2]<<16|byte[1]<<8|byte[0 3
alandhexadecimalvaluesif(assembly_code[instruction_no][2][1]=='x'){stringbin_instr=hex_to_binary(ass 4
te_back_policy=="WT"){memory[mem_loc]=val;ca 1
{//Handlingerrorif(assembly_code[instruction_no].size()!=3){cout<<"Errorinline:"<<instruction_no+1<< 3
on=all_instructions[PC/4];intpos=executed_instruction 1
ock_size+3);cache_block=cache[index 0
Caccordinglyregister_values[rd]=PC+4;PC=im 1
ut;myfile_out.open( 0
ctionsvoidexecute_J(vector<vector<string>>&assembly_code,intinstruction_no){//Handlingerrorif(a 3
llyeverythingisinvalid,andothersdontmatterorde 0
hebitisnowvalidnew_data[1]=0;//Initiallynotdirtynew_data[2]=tag;for(intj=star 2
exshouldbeoftherem 0
}uint8_tbyte[4];for(inti=0;i<4;i++ 1
it_or_miss="Hit";}if(is_dirty){clean_or_dirty="Dirty"; 1
ex,tag,false,mem_l 0
exit(0);}imm=decimal_to_binary(stoi(as 1
ir<string,int>>stack_of_functions;unordered_set<int>break_lines;intcount_how_m 2
e;vector<uint 0
1";stringrd=registers[assembly_ 0
[rd]=res;}//Updatethestackoffunctionsandtheirlastexecu 1
mem_loc;}//Functiontostorehalfwordintstore_half(vector<string>instruction,intm 1
eadonlythisparticularm 0
(assembly_code[instruction_no 0
achrun,wecandequeuethetopstringinstruction;instruction_file.open(command.substr(5));current_opened_f 2
config_file.close();hits=0;misses=0;}elseif(command 1
ngth-1-i);//length-1-igivesthepositionfromtheright}}returndecimal 0
e();i++){for(intj=0;j<cache[i].size();j++){if(cache[i][j][0]==1&&cache[i][j][1]==1){intoffse 10
r=imm+rd+opcode;stringhex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0; 3
3]);rs1=aliasRemover(instruction[2]);intmem_ 2
vector<string>>&assembly_code,intinstruction_no){//Handli 1
Hereweshowthecountnumbe 0
0101";hex_to_bin['6']="0110";hex_to_bin['7']="0111";hex_to_bin['8']="1000";hex_to_bin['9']="1 4
no].size()!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forStypeformat,youmus 1
=="lbu"||inst=="lhu"||inst=="lwu"){//Extractrd,rs1,andimmediaterd=aliasRemover(instruction[1]);rs1 2
unt.push_back(command[i]);}}s_addr=s_addr.substr(2);//Weremovethe 3
;}elseif(r=="s10"||r=="x26"){r="x26";}elseif(r=="s11"||r=="x 2
om_number=rand()%associativity;vector<int>removed_data(cache[0][0]. 4
xected_line.clear();break_lines.clear() 2
6";}elseif(r=="s11"||r=="x27 0
;vector<string>all_instructions;unordered_map<int,string>offset_to_label; 2
enabled){//Letusfirstfigureouthowour20bitsof 0
n[2],cur_instruction[3]);}assembly_code.push_back(cur_instructi 2
che[index][i][2]==top_tag) 3
ster_values[rs1]+register_values[ 1
de="0010011";}//Notingthevaiourspartsoftheins 0
ne=PC/4+1;stack_of_functions.pop();stack_of_functions.p 1
,64,1);stringvalue_ 0
inenumberw 0
]&=mask;}}el 0
ngwithcacheandnotqueueif(!to_replace){//Donothing}else{intrandom_number=rand()%associativ 3
;stringinst=instruction[0];if(inst=="jal"){register_values[rd]=PC+4;PC=new_pc;}//Updatethestac 4
_instruction=all_instructions[PC/4];intpos=executed_instruction. 1
de[instruction_no][2])<-1*pow(2,20)||stoi(assembly_code[instruction_no][2] 5
out<<"Errorinline:"<<inst 0
d.back()==':'){executed_instruction=executed_instruction.substr(pos+1);} 3
ddr.substr(2);//Weremovetheleading0xinthestring//Wenowwanttoco 1
13";}elseif(r=="a4"||r=="x14"){r="x14";}elseif(r=="a5"||r=="x15"){r="x15"; 3
ter_values[ 0
tag,true,mem_loc,"wr 0
emoved_data[2]<<(offset_size+index_size));to_store_mem_loc|=(index<<offset_size);for 2
<<executed_instruction<<";PC= 0
x_to_bin['2']="0010";hex_to_bin['3']="0011";hex_to_bin['4']="0100";hex_to_b 3
tion);PC+=4;}instruction_file.close();//EnsurethattheP 1
sub"]='R';format["xor"]='R';format["or"]='R';format["and"]='R';format["sll"]='R';format["srl"]='R'; 5
tion_no][2].substr(2));intdecimal=binary_to_decima 2
C/4];if(format[cur_instr[0]]=='R'){step_R(cur_instr);}elseif(format[cur_instr[0]]=='I'){step_I(cur_i 8
erd=aliasRemover(in 0
glystringt 0
n_to_hex["1101"]='d';bin_to_hex["1110"]='e';bin_to_hex["1111"]='f 3
in[hex[i]];}returnbin;}//Codetoconvertdecimaltobinarystringdecimal_to_binary(intdecimal, 2
;i++){byte[i]=read_access(start_locat 1
/memory.clear();//cache.clear();for(inti=0;i<memory.size();i++){memory[i]=0;}for(inti=0;i<c 5
bitszero//Letusdothesameforindexmakintindex_mask=1;index_mask=index_mask<<(index 0
ckoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=stack_of_functions.top 0
lse{//Storetherequireddword/word/byte/hal 0
i][2]==top_tag){removed_data=cache[inde 1
e);//Let'sgetthevalueofoffsetbitsintoffset=offset_mask&mem_loc;//Wenowhavetheindexandtagwewant.Wec 0
oc_hex="0x"+binary_to_hex(mem_loc_bin,false,5);cout<<"Memory["<<mem_loc_hex< 1
szero//Weneedtodothisfortheoffsetaswell,because,u 0
"]='I';format["andi"]='I';format["slli"]='I';format["srli"]='I';fo 3
int>memory(0x50001,0);//InitializethevalueofPCintPC;//Herewedeclareall 1
;}//Codetoconverthexadecimaltobinarystringhex_to_binary(stringhex){ 1
for(inti=0;i<associativity;i++){vector<int>cache_block(block_size+3);cache_block=cache[index] 3
bge"]="101";funct3["bl 0
1],val_rs2=register_values[rs2];if(val_rs1<val_rs2){PC=new_pc;}else{PC+=4;}}//Updatethestac 3
iourspartsoftheinstrutionstringopcode= 0
cache[i].size();j++){if(cache[i][j][0]==1&&cache[i][j][1]==1){intoffset_size 9
tatline:"<<break_point<<endl;}elseif(!comma 0
ered_map>#include<unordered_set># 1
ion}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i]; 2
texecutedlineaccordinglystringtop_of_stack=stack_of_functions.top().fi 1
svoidinitialize_registers(){for(inti=0;i<=31;i++){stringregister_no="x";re 1
);cache_block=cache[index][i];//Valid,Dirty,tag,da 2
"WriteBackPolicy:"<<write_back_policy;}else{cout<<"CacheDisabled";}}elseif(command= 0
ize+offset_size 0
he_block[0]==0){ 1
"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs1";exit(0);}stringopc 1
k=3;j<=end_storage;j++,k++){cache_block[k]=memory[j];}found_invalid=true;update_queue(index,tag 3
PC<<endl;//UpdatethePCandensurethatx0remain 0
;stringrd=registers[assembly_code[instruction_no][1]];stringrs1=registers[assemb 3
gth*4;i<binary.size();i++){zeros.push_back('0');fs. 2
gister_values[rd 0
ode#definestoistoll#defin 0
mmand=="ca 0
w(2,i);}}register_values[rd]=register_values[rd]&mask;}}elseif(inst=="sra"){register_ 4
lueofaddrandcountbyparsingthelinefor(inti=4;i<command. 0
_file;vector<vector<string>>assembly_cod 2
(2,6)+rs2+rs1+f3+imm.substr(8,4)+imm.substr(1,1)+opcode;stringhex_instruction=bina 3
alid=false;for(inti=0;i<associativity;i++){vector<int>cache_block(block_size+3);cache_bloc 2
embly_code[instruction_no 0
i++){memory[i]=0;}for(inti=0;i<cache.size();i++){for(intj=0;j<cache[i].size();j++){for(in 5
_mask=temp_mask<<(index_size+offset_size);temp_mask=temp_mas 1
f_register_bin=decimal_to_binary(value_of_register_int,64,1);stringvalue_of_register_hex=bin 1
veranewfileisloaded,thiswillhandleinitializinganyusedvariablest 0
nttag_size=20-offset_size-index_size;//Andthesemanyaretagbits//Letusnowcalculatethema 0
n_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_no 2
vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(h 3
ativity;i++){vector<int>cache_block(block_size+3);cache_block=cache[index][i];//Valid 4
ap<char,string>hex_to_bin;hex_to_bin['0']="0000";hex_to_bin['1']="00 3
(r=="s1"||r=="x9"){r="x9";}elseif(r=="a0"||r=="x10"){r="x1 3
);//Getthetagwhichweneedtoreplaceq.pop();//Popthevaluewhichisreplacedq.push(tag);//Pusht 2
i<instruction.size();i++){uint64_tstore_value=stoi(instruction[i]);vector<uint8_t>byte(2);byt 5
2]=tag;for(intj=start_storage,k=3;j<=e 0
tcur=q.front();q.pop();if(cur!=tag){dummy_q.push(cur);}}while(!dummy_q.empty()){intcur=dummy_q.fro 7
s=store_ha 0
imm.substr(9,1)+imm.substr(1,8)+rd+opcod 2
formatstepinstructionsvoidstep_U(vector<string>instructi 1
ected_line;stack<pai 0
][j][0]=0;//Makethevalidbitaszero}}}elseif(!command.find("cache_simdump")){string 4
]<<24)|(byte[2]<<16)|(byte[1]<<8)| 2
tthesizeifblocksize+3because,1forvalid,1fo 0
="1100011";stringf3=funct3[assembly_code[instruction_no][0]];stringrs1=r 3
];}cache_block[3+offset]=val;cache_block[0]=1;//Thebitisnowvalidcache_block[1]=1;//Thecacheblockisno 3
Stypeformat,youmustenter4operands"<<endl;exit(0);}elseif(registers.find(assem 1
rmat["or"]='R';format["and"]='R';format["sll"] 3
evalidbitaszero}}}elseif(!command 0
<hex_set<<","<<hit_or_miss<<",Tag:"<<hex_tag<<","<<clean_or_dirty<<"fromupdatequeue"<<end 0
d_once){misses++;}//Firstcheckifwehaveaninvalidframe,andifwedo,thenwecandirec 1
0;if(cache_enabled){if(fopen(cache_o 1
sembly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<instruction 2
00";hex_to_bin['5']="0101";hex_to_bin['6']="0110";hex_to_bin[ 2
fig_file>>c 0
ck(block_size+3);cache_block=cache[index][i];//Valid,Dirty 3
p_of_stack=stack_of_functions.top().first;inttop_line=stack_of_fu 1
x_set="0x"+binary_to_hex(bin_set,true,5);stringbin_tag=decimal_to_binary(tag,2 1
es[rs1]^register_values[rs2];}elsei 2
.find(assem 0
=="x23"){r="x23";}elseif(r=="s8"||r=="x24"){r="x24";}elseif(r=="s9"||r=="x25"){r="x25";}elseif(r 5
oved_data(cache[0][0].size());vector<int>new_data(cache[0][0].size());intstart_storage=(mem_ 9
cur_instr=assembly_code[PC/4];if(format[cur_instr[0]]=='R'){step_R(cur_i 4
itsareforoffsetintindex_size=log2(cac 0
userhasspecifiedandstorethemstartingforlocationspecifiedbythemem_locfor(inti=1;i<instructi 0
alues[rs1]+register_values[rs2];}elseif(ins 2
,rs2,inst;intimm;inst=instruction[0];rs2=aliasRemover(instruction[1]);imm=sto 3
//Thismakesthemask20onesinttemp_mask=1;temp_mask 0
esthepositionsofoffseybitszero//Weneedtodothisforthe 0
=4;register_values["x0"]= 1
Thecacheblockisnowdirtycache_block[2]=t 1
r.push_back(c);}}if(cur!=""){to_store.push_ 2
sif(cache_enabled){cout< 1
Printtheregistervalueswhicharestoredinthemapcout<<"Registers:\n";for(inti=0;i<32;i++){st 0
Ensuretoremovethecalledfunctionfromthestackoffunctions 0
ters[assembly_code[instruct 0
ingfirst_word=executed_instruction.substr(0,pos);if(first_word.bac 1
seif(r=="a3"||r=="x13"){r="x13";}elseif(r= 2
chinecodehexadecimalandstoreintextmemoryfor(intinstruction_ 0
_to_hex["0101"]='5';bin_to_hex["0110"]='6';bin_to_hex["01 2
st=="lbu"){uint8_tbyte=read_access(start_location,false);uint8_tres=byte;regi 1
enabled){cout<<"CacheEnabled"<<endl;cout<<"CacheSize:"<<cache_size<<endl;cout<<"B 0
63;i++){mask+=pow(2,i);}}register_values[rd]=register_ 3
edbythedatasection,andsubtra 0
ory/PCbeforeloadingthenextfileinitialize();hits=0;misses=0;//me 1
eue(index,tag,false,mem_loc,"read",tr 0
e_address);}elseif(to_st 0
ne:"<<instruction_no+1<<endl<<"Wrongsyntax,forRtypeform 0
tag<<","<<clean_or_dirty<<"fromupdatequeue"<<endl;}order_of_access[index]=q;}voidwrite_access(i 1
em_loc|=(removed_data[2]<<(offset_size+index_size));to_store_mem_loc|=(index<<offset_size);for(i 2
em_loc++;}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_loc;}signedmain(){//Initi 1
k;}elseif(!command.find("mem")){//Hereweshowthecountnumberofmemorybytesstartingfromme 2
o+1<<endl<<"Incorrectvalueofrs2";exit(0);}elseif(stoi(assembly_code[instruction_no][3])<-pow(2, 4
hm>#include<cstdlib>#include<math.h>#include<sstream> 3
(byte[7]<<56)|(byte[6]<<48)|(byte[5]<<40)|(byte[4]<<32)|(byte[3]<<24)| 5
(byte[6]<<48)|(byte[5]<<40)|(byte[4]<<32 3
fiedbythemem_locfor(inti 0
=registers[ 0
{//Firstresetalltheregisters/memory/PCbeforeloadin 0
_line=stack_of_functions.top().s 1
tinatingtheinstructionstringinstr=imm.substr(0,1)+imm.s 1
){register_values[rd]=register_values[rs1]>>register_values[rs2];//Ourmaskisshifting_amount0'sfollow 3
;if(inst=="lb"){int8_tb 1
se);returnval;}}}else{returnmemory[mem_loc];}//Thiswillneverreachreturn-1;}//CodefortheRformatstep 2
_stack,top_line});stringex 0
ofmisses,ifitiswritethorugh,wejustwritet 0
oc,20,0);stringhex_address="0x 0
ngth-1-igivestheposition 0
stack,top_line});stringex 0
back();PC=0;while(getline(instruction_file,instruction)){//Iftheinstructionisdata 3
k[3+offset];//Sincethisahit,weneedtoupdatetheorderofaccessvectorif(!access 1
otfindthisblockinthecache,weloadthewhole 0
unct3["addi"]="000";funct3["xori" 1
='R';format["xor"]='R';format["or"]= 2
to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//U 1
tmask=(1U<<(64-shifting_amount))-1;if(shifting_amount==0){for(inti=0;i<=63;i++){mask+=pow(2,i);}}r 4
ses++;}//Firstcheckifwehaveaninvalidframe,andifwedo,thenwecandirectl 0
;}}//CodeforUformatinstructionsvoidexecute_U(vector<vector<strin 0
_no+1<<endl<<"Valueofimmediateis 0
lues[rd]=PC+4;PC=imm+register_values[rs1];}//Ensurethatx0valuesremainsat0register 2
ctiontostoredwordintstore_dword(vector<string>instruction,intmem_l 1
le(!q.empty()){intcur=q.front();q.pop();if(cur!=tag){dum 5
_location+1,true);uint16_tres=byte1<<8|byte0;register_values[rd]=res;}elseif(inst=="lwu"){vector<uin 2
Miss"<<",Tag:" 0
ngtheinstructionstringinstr=f7+rs2+rs 0
e=PC/4+1;stack_ 0
str(pos+1);}stringb 1
erbereached}else{//Firstcheckifwehavean 0
ache_enabled){cout<<"D-cachestatistics:Accesses= 0
<<"Errorinline:"<<instruction_no+1<<endl 0
top_tag=q.front();//Getthetagwhichweneedtoreplaceq.pop();//Popthevaluewhichisreplacedq.push(tag);// 3
toi(assembly_code[instruction_no][3]),12,true);//Co 3
ize<<endl;cout<<"BlockSize:"<<block_size<<endl;cout<<"Associativity:"<<associ 0
neoftext(.text)count_how_many_ 1
/block_size)*block_size;intend_stora 0
_values[rd]=res;}elseif(inst=="lw"){vector<int32_t>byte(4);boolaccessed_once=false;for( 4
n_no+1<<endl<<"Valueofimmediate 0
r(inti=0;i<c 0
5);cache_output<<read_or_writ 0
)-1]==')'){cur.pop_back();}cur_instruction. 2
ant.Wecanproceedwithfindingthereald 0
{memory[to_s 0
_instruction=assembly_code.size();if(PC/4==no_of_instruction){cout<<"No 2
torage;j++,k++){new_data 0
4']="0100";hex_to_bin['5']="0101";hex_to_bin['6']=" 2
ttag=tag_mask&mem_loc;tag>>=(index_size+offset_size);//Gettingthevalueofindexbitsofmemorylocation 1
on){//Alsoensuretoprintthecachestatisticsif(cache_ena 0
rmat,youmustenter4operands"<<endl;exit(0);}if(labels.find(assembly_code[instr 1
ister_value 0
sk&mem_loc; 0
}if(dec_imm<0||dec_imm>4294963200){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediat 2
or_miss<<",Tag:"<< 0
struction<<";PC="<<hex_PC<<endl;//Ensurethatthex0valueremainsat0register_values["x0"]=0;}//C 1
e[instruction_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_ 3
nt,64,1);stringvalue_of_register_hex=binary_to_hex(value_of_registe 0
imm=decimal_to_binary(stoi(assembly_code[instruct 0
es[rd]&mask;}}elseif(inst=="sra"){register_values[rd]=register_values[rs1]>>register_values[ 4
mbly_code[instru 0
exadecimaltobinarystringhex_to_binary(stringhex){unordered_map<char,string>hex_to_bin; 2
nd=="exit"){//Exitthesimulatorcout<<"Exitedthesimulator";break;}e 0
y_code[instruction_no][2]];stringimm;//Assigningtheimmediatealongwithch 2
;}elseif(r=="tp"||r=="x4"){r="x4";}elseif(r=="t0"||r=="x5"){r="x5";}elseif(r=="t1"||r==" 4
"<<mem_loc_hex<<"]"<<"="<<hex_mem_val<<endl;}}elseif(command=="show-stack 0
rdinglyPC+=4;}elseif(inst=="addi"||in 0
_dirty="Dirty";}if(is_read){rea 1
tions.top().second;top_line=PC/4+1;stack_of_functions.pop();stack 2
pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC 1
cache_size/(associativity*block_size);cache.clear();//Notethatthes 2
],val_rs2=register_values[rs2];if(val_rs1>=val_ 1
"ld"]="011";funct3["lbu"]="100";funct3["lhu"]="101";funct3["lwu"]="110";funct3["jalr"]="0 4
ationaddressandvalueofPCaccordinglyregister_values[rd]=PC+4;PC=i 1
ngensurethat64b 0
bly_code,instruction_no);}else{cout<<"Erroronline:"<<i 0
reak_lines.end()){break;//to_break=true;}vector<string>c 3
d(assembly_code[instruction_no][2])==registers.end()){cout<<"Erro 4
ingzeros="",fs="";for(inti=length*4;i<binary.size();i++){zeros.push_back('0');fs.push_back 2
f(r=="s11"||r=="x27"){r="x27";}elseif 2
e[0]);register 1
ty,vector<int>(block_size+3,0)));//Initiallyeverythingisi 2
_instruction}fo 0
dirtybitset,andifso,weneedtoupdate 0
d()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs1";ex 1
ut;//Declarethevariousmapswhic 0
oroffsetintindex_size=log2(cache_size/(associativity*block_size));//Thesemanyarefori 2
s1]>=register_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="bgeu"){uint64_tval_rs1=register_va 4
oronline:"<<instruction_no+1<<endl<<"Incorrectsyntax";exit(0);}}}elseif(command=="run" 1
ningtheformatofvariousinstructionsvoidinitialize_format(){ 1
rent_opened_file=command 0
enewmem_locwhereyoucanwritetonextreturnmem_loc;}//Functiontostorebytwintstore_byte(vector<st 0
size+(block_size-1);for(intj=start_storage,k=3;j<=end_storage;j++,k++){cache_block[k]=memory[j];}cac 4
egister_values["x0"]=0;}//CodefortheIformatstepinstr 1
olicy;}else{cout<<"CacheDisa 0
er_values[rs1];if(i 1
struction=executed_instruction.substr(pos+1 0
e(8);boolaccessed_once=false;for(inti=0;i<8;i++){byte[i]=read_acce 2
alueofPCintPC;//Herewede 0
xit(0);}if(to_break){cout<<"Executionstoppedatbreakpoint\n";break;}}//Iflastlineexecuted,thenen 2
y_code.size();boolto_break=false;intbreak_point_line_to_remove;if(PC/4==no_of_instruction){cou 2
te_queue(intindex,inttag,boolto_replace,intmem_loc,stringoperatio 0
struction_no+1<<endl<<"Wrongsyntax,forBty 0
menable")){cache 0
substr(0,pos);if(first_word.back()==':'){executed_instruction=executed_instruction.substr 3
elseif(inst=="blt"){if(register_values[rs1]<register_values[rs2]){PC=new_pc;}else{P 4
-1});stringexecuted 0
command[i]);}}s_addr=s_addr.substr(2);//Weremovetheleading0xinthestring//Wenowwanttoconvertittod 2
uction.size();i++){uint64_tstore_value=stoi(instruction[i]);ui 3
_size)*block_size+(block_size-1);cache_block[0]=1;//Thebitisnowvalidcache_block[1]=0;//Ini 3
rorinline:"<<instruction_no+1<<endl<<"Valueo 0
tr(2));intdeci 1
;inttop_lin 0
*block_size));//Thesemanyareforindexinttag_size=20-offset_size-index_size; 0
I'){execute_I(assembly 0
//Concatinatingthevaluesstringinstr= 0
l=0;for(inti=0;i<associativity;i++){vector<i 0
eq.pop();//Popth 1
finwrongposition,bringtheoperandsbacktothecorrectp 0
dl;//UpdatethePCvalueandensurethatx0willalwaysremainatvalueof0PC+=4;register_values 0
no][3])==registers.end()){cout< 2
pen(cache_co 0
ringopcode="1100 0
alues[rd]&mask;register_values[rd]&=mask;}}elseif(in 2
dr=s_addr.substr(2);//Weremovetheleading0xinthestring//Wenowwanttoconvertitt 1
ositionsof 0
ex_to_bin['2']="0010";hex_to_bin['3']="0011";hex_to_bin['4']="0100";hex_to_bin['5']="0101";hex_to 4
){is_present=true;}}while(!dummy_q.empty()){intcur 3
(inti=bin.size()-1 1
ccessed_once=false;for(inti=0;i<8;i++){byte[i]=read_access(start_location+ 1
truction.substr(0,pos);if(first_word.back()==':'){executed 3
tcontactthecacheatall.So,weneedtoprintinthecache_outputfilefromhereon 0
_back(decimal%2+'0');decimal/=2;}while(bin.size()<no_of_bits){bin.push_back('0');}reve 4
returnbin;}//Codetoconvertdecimaltobinarystringdecimal_t 0
cuted_instruction.find('');stringfirst_word=executed_instruction.substr(0,pos);if(f 2
p"){//Gostepbystepintno_of_instruction=assembly_code.size();if(PC/4==no_of_instruction){cout<<"No 2
code[instructi 0
writetonextreturnmem_loc;}//Functiontostorehalfwordintstore_half(vector< 0
nchifconditionsatisfiedasperthegiveninstructionif(inst=="beq"){if(register_values[rs1]==register_va 2
=true;}}while(!dummy_q.empty()){intcur=dum 2
;unordered_map<int,string>offset_to_label;unordered_map<string,int>last_exected_line;stack<pair 2
cimalstringbinary_to_hex(stri 0
mem_loc/block_size)*block_size+(block_size-1);for(intj=start_storage,k=3;j 1
ntmem_loc){//Gothroughallthevaluesthattheuserhass 0
dex_mask<<(index_size+offset_size);index_ma 1
hex_PC<<endl;//UpdatethePCandkeepx0valueat0PC=PC+4;register_ 0
cache[0][0].size());intstart_storage=(mem_loc/blo 3
instruction[i]);vector<uint8_t>byte(8);f 3
));//Thesemanyareforindexi 0
sk=tag_mask^temp_mas 0
ndex,everyoneisfightingforthisoneindexassociativity=cache_size/bloc 0
_back(decimal%2+'0');decima 1
cutedlineaccordinglystringtop_of_stack=stack_of_funct 0
d=="regs"){//Printther 0
t8_t>byte(8);for(in 1
=false;for(inti=0;i<4;i++){byte[i]=read_access(start_locatio 1
d_instr="";for(inti=0;i<instruction.size();i++){if(trim&&instruction[i]==''){continue;}else{trim 4
tringhex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){bi 3
"s0"]=this_register;registers["fp"]=this_register;}elseif(i==9) 2
1=aliasRemover(instruction[2]); 2
"0000000";funct7["sub"]="0100000";funct7["and"]="0000000";funct7[ 2
gister;}elseif(i>=10&& 0
<hits<<",Miss="<<misses<<",HitRate="<<fixed<<setprecision(3)<<(do 1
e.size();boolto_break=false;intbreak_point_line_to_remove;if(PC/4==no_of_instruction){co 2
t_word.back()==':'){executed_instruction=executed_instruction.substr(pos+1);}strin 3
ueofrs1";exit(0);}elseif(registers.find(assembly_code[instr 1
svoidexecute_R(vector<vector<string>>&assembly_code,intinstru 2
();while(!stack_of_functions.empty()){ 3
0110111";stringrd=registers[assembl 0
n_no+1<<endl<<"Valueofimmedi 0
e[instruction_no][3])<-pow(2,11)||stoi(assembly_code[instruction_no][3])> 7
=q.front();q.pop();if(cur!=tag){dummy_q.push(cur);}}while(!d 5
ed_instruction<<";PC="<<hex_PC<<endl;// 0
ifting_amount!=0){register_values[rd]=re 1
ction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_to_binary(stoi(a 1
ector<string>(0));//Checkiftheuserisspecifyingthe 2
in['4']="0100";hex_to_bin['5']="0101 2
_tbyte=read_access(start_location,false);uint8_tres=byte;register_values[rd]=res;}elseif(inst=="l 2
Remover(instruction[ 0
ffset_size-index_size;//Andth 0
tackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=stack_of 0
;queue<int>dummy_q;intoffset_size=log2(block_size);//Thesemanybitsareforoffsetintindex_size= 2
embly_code[instruction_no].size()!= 2
(index_size+offset_size);temp_mask=temp_mask-1;tag_mask 1
ndl;//UpdatePCvaluePC+=4;}elseif(inst=="jalr"){//Extracttherd,rs1andimmediatevaluerd=aliasRemover(i 1
i(instruction[3]);//Performthearithmeti 2
0||stoi(assembly_code[instruction_no][3])>=pow(2,6)){cout<<"Errorinline:"<<inst 4
(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC= 1
gdataif(instruction==".data"){data=true;count_how_many_to_s 1
}elseif(inst=="ori"){register_values[rd] 2
Valueofimmediateisoutofrange";exit(0);}imm=decimal_t 1
tack_of_functions.pu 0
2dmatrixofstringsvector<string>cur_instruction;all_instructions.push_back(instruction) 2
i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for 5
bin_set=decimal_to_binary(i,20,0);stringhex_set= 1
isters[argument_register_no]=this_register;}elseif(i>=18&&i<=27) 1
n_no].size()!=4){cout<<"Errorinline:"<<instruction_ 1
,1fordirtythenblocks 0
ndoffsetbitszero//Letusdothesameforindexmakintindex_mask=1;index_ 0
of_functio 0
){read_or_write="R";}stringbin_address=decima 1
owgettheactualvalueoftagbits 0
{PC=new_pc;}else{PC 1
in_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<< 0
bly_code[instruction_no][3]),12,true);//Concatinatingthevariouspartsstringinstr=imm.subs 2
_functions.empty()){stack_of_functions.pop();}stack_of_functions.push({"main",0});last_ 5
;PC="<<hex_PC<<endl;//UpdatethePCvalueandensurethat 0
ector<string>>assembly_code;stringcache_output_name;//Infiniteloopthatreadsuseri 1
f(write_back_policy=="WT"){memory[mem_l 1
nstruction_no][0])!=load_operands.end()){opcode="0000011";} 3
ction_no][2]=to_string(labels[assembl 1
instruction_no+1<<endl<<"Labelnotdefined";exit(0);}else{assembly_code[instruct 1
range";exit(0);}//Notingthevaiouspa 1
g;for(intj=start_storage,k=3;j<=end_storage;j++,k++){new_data[k]=memo 1
at["lui"]='U';}//Keepingtr 1
;format["sw"]='S';format["sd"]='S';//Bformatformat["beq"]='B';format["bge"]='B';format["blt"]='B 5
removeddatahasadirtybitset,andifso,weneedtoupdatethememoryif(removed_data[1 0
exit(0);}elseif(registers.find(assembly_code[instruction_no][1])==registers.end()){co 6
[0]=="srai"){if(stoi( 1
32_tshifting_amount=imm;if(shifting_amount!=0){register_values[rd]=register_values[rs1]> 3
="<<hex_PC<<endl;//UpdatethePCvalu 0
if(cache_enabled){for(inti=0;i<cache.size();i++){for(intj=0;j<cache[i] 3
tion.find('');stringfirst_word=executed_instruction.substr(0,pos);if(first_word.back() 3
he_size/(associativity*bl 0
simulatorcout<<"Exitedthesimulator";break;}elseif(!com 0
1){is_dirty=true;intto_store_mem_loc=0;//herethetagandindexshouldbeoftheremoveddatan 0
irst_word.back()==':'){executed_instruction=executed_instruction.substr(pos+1);}strin 3
_code,instruction_no);}elseif(format[assembly_cod 0
str=hex_to_binary(instruction[2].substr(2));intdecimal=binar 3
ngthelocationsofthememoryasspecifiedusingalooopfor(inti=addr;i<addr+cou 0
|byte[1]<<8|byte[0];register_values[rd]=res;}//Updatethestacko 3
peformat,youmustenter4operands"<<endl;exit(0);}elseif(registers.find(asse 1
"]='1';bin_to_hex["0010"]='2';bin_to_hex["0011"]='3';bin_to_hex["0100"]='4';bin_to_hex["0101 3
rJtypeformat,youmustent 0
ur_instr);}elseif(format[cur_instr[0]]=='B'){step_B(cur_i 3
loc]=byte;mem_loc++ 0
<<executed_instruction<<";PC="<<hex_PC<<endl;//UpdatethePCvalu 0
indexbitsandoffsetbitszero//Letusdothesameforindexmakintindex_ 0
nst;intimm;inst=instruction[0];r 1
[1]=store_value>>8;memory[mem_loc]=byte[0];memory[mem_loc+1 3
(inti=0;i<4;i++){byte[i]=binary_to_decim 1
s+1);}stringbin_P 0
ngposition,bringtheoperan 0
p_back();current_opened_file.pop_back();PC=0; 2
["bltu"]="110";funct3["bgeu"]= 2
offset_size-index_size;//Andthesemanyaretagbitsvector<int>removed_data=cache[i][j]; 3
_loc){//Gothroughallthevaluesthattheuserhasspecifiedandstorethemstartingforlocationspec 0
neexecuted,thenensuretopopmainfromthestackif(PC/4==no_of_instruction){//Alsoensuretop 1
funct3["jalr"]="000";funct3["sb"]="000";funct3["sh"]="001";funct3["sw"]="010";funct3 4
="100";funct3["ori"]="110";funct3["andi"]="111";funct3["slli"]="001";funct3["srli"]="101";f 4
"jalr"){opcode="1100111";}else{opcode="0010011";}//Notingthe 2
stringsaved_register_no="s";saved_register_no+=to_string(i-18+2);registers[saved_register_no]=this_r 2
unct7["xor" 0
nd;top_line=PC/4+1;stack_of_func 0
_to_hex(instr);vector<string>binary_bytes(4);for(inti=0; 3
size();i++){if(instruction[i]!=''&&instruction[i]!='('){cur.push_back(instruction[i] 5
x4";}elseif(r=="t0"||r=="x5"){r="x5";}elseif(r=="t1"||r=="x6"){r="x6";}elseif(r=="t2"||r=="x7") 5
decimal=binary_to_decimal(bin_instr);imm=decimal;}else{imm= 1
n.size()<no 1
evaluerd=alia 0
register_no]=this_register;}}}//Definingallfunct3valuesvoid 0
ew_data;break;}}//Nowcheckiftheremoveddatahasadirtybitset,andifso,weneedtoupdatethememor 0
_code[instruction_no][0]];stringf7=funct7[as 2
end_storage;j++,k++){new_data[k]=memory[j];}if(operation=="write"){new_data[3+offset]=val;new_d 5
{cout<<"Errorinline:"<<instruction_no+1<<endl<<"Labelnotdefined";exit(0);}else{assembly_c 1
oidwrite_ac 0
sthemask20onesinttemp_mask=1 0
){r="x19";}elseif(r=="s4"||r=="x20"){r="x20";}elseif(r=="s5"||r=="x21"){r=" 4
ion[3]);//Weassumethatrs1alwaysstor 1
2";}elseif(r=="s7"||r=="x23" 0
nctions.push({top_of_stac 0
lb");load_operands.insert("lh");load_operands.insert("lw") 2
inst=="addi"||inst=="xori"||inst=="ori"||inst=="andi 0
_bytes[i]=hex_to_bin 1
!=break_lines.e 0
_U(vector<vector<string>>&assembly_code,intinstruction_no){//Handlingerrorif(assembly_code[in 3
d_instruction<< 0
ary_to_hex(mem_loc 0
st=="lwu"){//Extractrd,rs 0
pcode;stringhex_instruction=binary_to_hex(inst 0
<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Notingtheva 1
{cout<<"Errorinline:"<<instruction_no+1<<en 0
voidinitialize_format(){//Rformatformat["add"]='R';format["sub"]='R';format["xor"]='R' 4
ryif(!found){if(!accessed_once){misses++;}//Firstcheckifwehaveaninvalidframe,and 3
0";funct3["lhu"]="101";funct3["l 1
op();stack_of_functions.push({top_of_stack,top_line});string 3
'scomplementfor(inti=0;i<bin.size();i++){if(bin[i 1
y_stack[i].first<<":"<<dummy_stack[i].second+count_how_many_to_skip<<endl;}i 2
=no_of_instruc 0
=0;i<hex.size();i+ 1
ved_data[1]==1){is_dirty=true;intto_store_mem_loc=0;t 1
p_tag=q.front();//Getthetag 1
ons.top().second;top_line=PC/4+1;stack_of_functions.pop( 1
ction[i]);}else{if(cur[ 1
ver(instruction[1]);rs1=alia 2
"0001";hex_to_bin['2']="0010";hex_to_bin['3']="0011";hex_to_bin['4']="0100";hex_to_bin['5 3
em_loc/block_size)*block_size+(block_size-1);cache_block[0]=1;//Thebit 2
ction_no][3])<0||stoi(assembly_code[instruction_no][ 2
_location+i,accessed_once);accessed_once=true;}int64_tres=(byte 0
ted,thenensuretopopmainfromthestackif(PC 0
='R'){step_R(cur_instr);}elseif(format[cur_instr[0]]=='I'){step_I(cur_instr);}elseif(forma 7
neisexecuted,thenensuretopopmainfromthestackif(P 0
;bin_to_hex["1011"]='b';bin_to_hex[" 1
n['9']="1001";hex_to_bin['a']="1010";hex_to_bin['b']="101 3
}if(cur[cur.size()-1]==','||cur[cur.size()-1]==')'){cur.pop_back();}cur_instruction.push_back 7
mm.substr(10,10)+imm.substr(9,1)+imm 2
lines.find(PC/4+1)!=break_lines.end()){cout<<"Executio 2
e());intstart_storage=(mem_loc/block_size)*b 2
{inttop_tag=q.front();//Getthetagwhichweneedtoreplaceq.pop();//Popthe 2
tcur=dummy_q.front();dummy_q.pop();q.push(cur);}//N 3
orStypeformat,youmustenter4operands"<<endl;exit( 0
p_line=stack_of_functions.top().second;top_line=PC/4+1;stack_of_functions.pop(); 2
er_no="s";saved_register_no+=to_string(i-18+2);registers[saved_register_no]=this_register;}elseif(i> 2
nary(stoi(assembly_ 0
andirectlyaddou 0
irstploicyintstart_storage=(mem_loc/block_size)*blo 1
eweneedtoensurethatallthebocksarewrittenifdirtyfor(inti=0;i<cac 0
orrectvalueofrs1";exit(0);}elseif(reg 1
block_size)*block_size+(block_size-1);cache_block[0]=1;//Thebitisnowv 2
o+1<<endl<<"Valueofimmediateisoutofrange 0
_tbyte0=read_access(start_location,false);uint16_tbyte1=read_access(sta 1
st_word=executed_instruction.substr(0,pos) 1
ss(mem_loc,byte,false);//memory[mem_loc]=byte;}if(inst=="sh"){vector<uint8_t>byte(2);byte[0]=stor 6
[assembly_code[instruction_no][3]]-instruction_no*4);}if(registers.find(assemb 3
_of_stack,top_line});stringexecuted_instruction=all_instructions[PC/4];intpos=executed_instru 1
tingtheinstructionstringinstr=imm.substr(0,1) 1
;val=cache 0
d_instructio 0
",Tag:"<<hex_tag 0
(cur!=""){to_store.push_back(cur);}if(to_store[0]==".dword"){data_base_address=store_d 5
emory[mem_loc+1]=byte[1 1
=="write"){new_data[3+of 0
n(){//Init 1
ess[index];queue< 1
x(value_of_register_bin,true,16);cout<<this_register<<"=0x"<<value_of_regist 1
,wereadonlythisparticularmemorylocation.//Ifwedonotfi 0
stoi(instruction[3]);stringrs1=alia 2
_binary(ins 0
f(!is_present){q.push(tag);}}else{inttop_tag=q.front();//Getthetagwhichwen 4
or<uint8_t>byte(2);byte[0]=store_value;byte[1]=st 4
oidexecute_S(vector<vector<string>>&assembly_co 2
gp"||r=="x3"){r="x3";}elseif(r=="tp"||r=="x4"){r="x4";}elseif(r 3
sblockdeletesabeakpointintheprogramintbreak_point=stoi(command.substr(1 0
acheEnabled"<<endl;cout<<"CacheSize:"<<cache_size<<endl;co 0
g2(block_size);//Thesemanybitsareforoffsetintindex_size=log2(cache_size/(assoc 1
n_no][3]=to_string( 1
ndlingerrori 0
nary(hex_instruction.substr(6-2*i 0
char>format;unordered_set< 0
dummy_q.empty()){intcur=dummy_q.front();dummy_q.pop();q.push(cur);}if(!is_present){q.push(tag);}}e 8
);load_operands.i 0
toconverthexadecimaltobinarystringhex_to_binary(string 0
ode[instruction_no][3]),12,true);//Concatinatingthevar 2
n.find('');stringfirst_word=executed 1
mem_loc;}//Functiontostorehalfwordintstore_half(vector<string>instruction,intmem_loc){//Gothro 2
rthebinarystringfor(inti=0;i<length;i++){//Ifthecurrentcharacteris'1',addthe 0
vector<vector<vector<int>>>cache;//Valid,dirty,tag,datainthits=0,misses=0;stringcurrent_opened_file 3
ll_instructions[PC/4] 1
inst;intimm;inst=instruction[0];rs2=aliasRemover(instruction[1]);imm=stoi(instructi 3
tr(8,4)+imm.substr(1,1)+opcode;stringhex_ins 2
associativity;i++){if(cache[index 0
ouspartsoftheinstruct 0
andlingerrorif(assembly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<instruc 3
if(r=="t4"||r=="x29"){r="x29";}else 2
telythisfunctionhastoreturnonly 0
ecaseofmisses,ifitiswritethorugh,wejustwritetomemorywithoutbotheringtoddoa 0
"||inst=="sll 0
put";cache_output.open(cache 0
efiningallregist 0
(cur[cur.size()-1]==', 2
ex_to_bin['9']="1001";hex_t 1
0].size());intstart_storage=(mem_loc/block_size)*block_si 2
ed"<<endl;cout<<"CacheSize:"<<cache_size<<end 0
;to_store_mem_loc|=(index<<of 0
}elseif(inst=="xor"){regis 1
assembly_code[in 0
it(0);}stringopcode;//Givingthecorrectopcodetothecorrespondinginstru 1
_of_access.clear();order_of_access.resize(no_of_indexes);cache_config_file.close();hits=0;misses 3
hevalueofPCintPC;//Herewedeclareallvariablesrelatedtocache 0
w_many_to_skip=0;}stringaliasRemover(stringr){if(r=="zero"||r==" 1
y[mem_loc]=val;cache[index][i][1]=0;//Setittonon-dirty}//Sincethi 4
//Notethatthesizeifblocksize+3bec 0
trim=false;trimmed_instr.push_back(instruction[i]);}}instruction=trimmed_instr;//Gothrought 2
ffsetintindex_ 0
mbly_code[instruction_no][3]=to_string(labels[assembly_code[instruction_no][3]]-instruction_no*4);}i 6
);}}}elseif(command=="run"){//Runtheentirecodetillthe 1
ruction_no][3])<-pow(2,11)||stoi(assembly_code[instruction_no][3])>=pow(2,11)){cout 7
ions.push({top_of_stack,top_line});stringexecuted_instruction=all_instructions[PC/4];intpos 3
i);//length-1-igivesthepositionfr 0
if(!accessed_once){hits++;update_queue(index,tag,false,mem_loc,"read 1
rd]=register_values[rs1]>>imm;}//Updatethestackoffunctions 1
(instruction[2]);string 2
1]+register_values[rs2];}elseif(inst=="sub"){register_values[rd]=register_values[rs1]- 4
cout<<"Executionstoppedatbreakpoint\n";break;}}//Iflastlineexecuted,thene 0
'e';bin_to_hex["1111"]='f';stringhex="";for(inti=0;i< 1
chinecodehexadecimalandstorei 0
t[assembly_code[instruction_no][0]]=='S'){execute_S(assembly_code,instruction_no);}else 5
articularmemorylocation.//Ifwedonotfindthisblockinthecache,weloadthewholeblockfromt 0
cimal(binary_byt 0
//Hereweneedtoensurethatallthebocksarewrittenifdirtyf 0
itset,andifso,weneedtoupdatethememoryif(removed_data[1]==1){is_dir 2
satisfiedasperthegiveninstructionif(inst=="beq"){ 1
"lb"]="000";funct3["lh"]="001";funct3["lw"]="010";funct3["ld"]="011";funct3["lbu 3
index,tag,false,me 0
offset_mask&mem_loc;//Wenowhavethein 0
ction,intmem_loc){//Gothroughallthevaluesthattheu 0
lookinthememoryif(!found) 1
]<register_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst 3
set=-1){queue<int>q=order_of_access[index];queue<int>dummy_q;intoffset_ 3
format,youmustenter4operands"< 0
gument_register_no+=to_string(i-10);r 1
inary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;c 2
f(!is_present){q.push(tag);}}else{intto 3
executed_instruction.fi 0
Printtheregistervalueswhicharestoredinthemapcout<<"Re 0
nttheregistervalueswhicharestoredinthemapcout 0
e+(block_size-1);new_data[0]=1;//Thebitisnowvalidnew_data[1]=0;//Initiallynotdirtynew_data 3
pty()){dummy_stack.push_back(dummy_stack_function.top());dummy_stack_ 3
sstringins 0
dfirstploicyi 0
ndindexshouldb 0
isters["tp"]=this_register;}elseif(i>=5&&i<=7){stringtemporary_register_no= 1
format["sw"]='S';format["sd"]='S';//Bformatformat["beq"]='B';f 3
rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="bne"){if(register_values[rs1]!=register 4
to_hex(instr);vector<string>binary_bytes(4);for(in 3
ta(cache[0][0].size());ints 4
0]=="jalr"){opcode="1100111";}else{opcode="0010011";}// 2
specifiedandstorethemstartingforlocationspecifiedbythemem_locfor(inti=1 0
;stringrs2=registers[assembly_code[instruction_no][3]];//Concatinatingtheinstructionstringinstr=f 3
syntax,forStypeformat,youmustenter4operands" 0
ringtheoperandsbacktothecorrect 0
lseif(format[cur_instr[0]]=='B'){step_B(cur_instr);}elseif(format 5
bly_code[instruction_no][3]),12,true);/ 2
ction_no+1<<endl<<"Wrongsyntax,forUtypeformat,youmustenter3operands"<<endl;exit(0);}els 1
=(index<<offset_size);for(inti=0;i<block_size; 0
ata[2]<<(offset_size+index_size));t 2
mm.substr(0,1)+imm.substr(10,10)+imm.substr(9,1)+imm.substr(1,8)+rd+opcode;stringhex_instruc 4
;}elseif(form 0
r>format;unordered_set<string>load_operands;un 1
no+=to_string(i 0
ueremainsat0register_values["x0"]=0;}//CodefortheJformatstepinstruc 1
100000";funct7["and"]="0000000";funct7["or"]="0000000";funct7["x 2
sembly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<instruction_no+1<< 2
mbly_code[ins 0
(assembly_code[instruction 0
nti=0;i<hex.size();i++){bin+=hex_to_bin[hex[i]];}returnbin;}//Codetoconvertdecimaltob 4
<<"Wrongsyntax,forJtypeformat,youmustenter3operands"<<endl;exi 0
y_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<execute 1
ction[2]);imm=stoi(instruction[3]);//Performthearithmeticaspertheinstructionif(inst=="addi 3
a[2]<<(offset_size+index_size));to_store_mem_lo 2
iteonlytheonceswhicha 0
,weneedtoapplyreplacementpolicyif 0
q.pop();q.push(cur);} 2
"){r="x6";}elseif(r=="t2"||r=="x7 1
,val,offset);}}}}else{memory[mem_loc]=val;}}intread_access(intm 2
k();PC=0;while(getline(instructio 1
){//Gostepbystepintno_of_in 0
=4;}}elseif(inst=="bgeu"){uint64_tval_ 1
"]="111";funct3["or"]="110";funct3["xor"]="100";funct3["sll"]="0 3
age,k=3;j<=end_stor 0
<iomanip>#include<cstring>//Thefollowingensurethat64bitscanbehand 2
gister_no+=to_string(i-28+3);registers[temporary_register_no]=this_register;}}}//Def 2
seif(inst=="srl"){uint64_tshifting_amount=reg 1
=0;i<4;i++){byte[i]=read_access(start_location+i,accessed_once);accessed_once=true;}in 3
ns.top().first;inttop_line=stack_of 1
11";hex_to_bin['c']="1100";hex_to 1
;ifstreamcache_confi 0
.size();i++){for(intj=0;j<cache[i].size();j++){for(intk=0 3
=executed_instruction.substr(0,pos);if(first_word.back()==':'){executed_instruc 3
_instr);}elseif(format[cur_instr[0]]=='U'){step 3
op_line});stringexecuted_instructio 0
e,val);break;}}//Ifwedidnotfindthevalue,weneedtolookinthememory 0
p_of_stack=stack_of_functions.top().first;inttop_line=stack_of_function 1
over(instruction[1]);stringrs1=aliasRemover(instruction[2]);string 4
essed_once=false;vector<uint8_t>byte(4); 2
enumberofbytesinthecachedatacache.assign(no_of_indexes,vector<v 0
[2]<<(offset_size+index_s 1
p_mask=temp_mas 0
inst=="lhu"){uint16 0
4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);//characters67ofhex_instruction 3
_block[0]= 1
sters["gp"]=this_register;}elseif(i==4){registers["tp"]=this_register;}elseif( 4
<string>binary_bytes( 1
=addr;i<addr+count;i++){intmem_val=memory[i];stringbin_mem_val=decimal_to_binary(mem_val,8,0); 2
youmustenter4operands"<<endl;exit(0);}elseif(registers.find(assembly_code[instruction_n 1
rue;stringtrimmed_instr="";for(inti=0;i<ins 0
_code[instruction_no].size()!=4){cout<<"Errorinlin 2
owmanylineswereusedfordatasegmentandthe 0
cimal_to_binary(i,20,0);stringmem_loc_hex="0x"+binary_to_hex(m 1
is_hit=false;//Letusfirstfig 0
snowvalidnew_data[1]=0;//Initiallynotdi 1
2];}//Updatethestackoffunctionsandtheirlastexecutedlineaccordinglystri 0
write_access 0
e=log2(cache_size/(associativity*block_size));//Thesemanyareforindexinttag_size=20-offs 2
uted,thenensuretopopmainfromthestackif(PC/4==no_of_instruction){//Alsoensuretoprin 1
efor(inti=4;i<command.size();i++){if(!check_space){ 2
[3]];//Concatinatingtheinstructionstrin 1
(inst=="ori"){reg 1
<<endl<<"Incorrectvalueofrd";exit(0);}elseif(registers.find(assembly_code 1
illhandleinitializinganyusedvariablesthatthepreviousfilemighthaveusedvoidinitia 0
tion_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Inc 2
operation=="write"){new_data[3+offset]=val;new_data[1]=1;//Setthebittodi 2
nyusedvariablesthatthepreviousfilemighthaveusedvoidinitialize(){for(inti=0;i<32;i++){stri 1
[0]]=='I'){execute_I(assembly_code,instruction_no);}elseif(format[assembly_code[instruction_no][0] 5
ableinstructio 0
lues[rs1]+imm;}elseif(inst=="xori"){register_val 2
f(!to_replace){while(!q.empty()){intcur=q.front();q.pop();if(cur!=tag){dummy_q.push(cur);}}while(! 9
<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exi 0
many_to_skip);cout<<"Insertedbreakpointatline:"<<break_point<<endl;}elseif(!com 0
ck_size-1);new_data[0]=1;//Thebitisnowvalidnew_data[1]=0;//Initia 2
ileinitialize();hits=0;misses=0;//memory.clear();//cache.clear() 3
ecifiedbythemem_locfor(inti=1;i<instructi 0
s[rs1]|register_values[rs2];}elseif(inst=="xor"){register_values[rd]=register_val 4
st=="or"){register_values[rd]=register_values[rs1]|register_values[rs2];}el 4
tion_no][2]];stringimm=decimal_to_binary(stoi(assemb 1
set_mask=offs 0
0){//Thisisaninvalidframe,ignorecontinue;}if(cache_block[2]==tag){is_hit=true;found=t 3
"){//Extracttherd,rs1,immvaluesrd=aliasRemover(instruction[1]);rs1=aliasRe 2
3";}elseif(r=="tp"||r=="x4"){r="x4";}elseif(r=="t0"||r=="x5"){r="x5";}elseif(r=="t1"||r=="x6"){r="x6 5
(first_word.back()= 1
find('');stringfirst_word=executed_instruction.substr(0,pos);if(first_word.back()==' 3
ciativity*block_size));//Thesemanyareforindexinttag_size=20-offset_ 0
ister_no="t" 0
ster_values[rs1]>>imm;//Ourmaskisshifting_amount0'sfollowedby64-shifting_amount1'suint64_tmask=( 1
break_lines.insert(break_point-count_how_m 0
val,offset);}}}}else{memory[mem_loc]=val;}} 2
.size();i++){if(!check_space){if(command[i]==''){check_space=true;}else{s_addr.pu 5
t(0);}imm=decimal_to_binary(stoi(assembly_code[instruction_no][3]),12,true);}//Concatinatin 5
);}stringbin_PC=decimal_to_binary(old_PC,32,0);stringhex_PC=binary_to_hex(bin 1
d_instruction.substr(0,pos);if(first_word.back()==':'){executed_instruc 3
,pos);if(first_word.back( 0
t["ld"]='I';format["lw"]='I';format["lh"]='I';format["lb"]='I';format["lbu"]='I' 5
nds"<<endl;exit(0);}elseif(registers.find(assembly_code[instruction_no][1])==register 4
=="bgeu"){uint64_tval_rs1=register_values[r 0
k_of_functions.top().first;inttop_line=sta 1
vector<int>new_data(cache[0] 2
(r=="a2"||r=="x12"){r="x12";}elseif(r=="a3"||r 2
m=stoi(instruction[3]);//Updatethestackoffunctionsandtheir 2
1]];stringim 0
)+rs2+rs1+f3+imm.substr(8,4)+imm.substr(1,1)+opcode;stringhex_instruction=binary_to_hex(inst 2
akpointintbreak_point=stoi(command.substr(6));//Wetakeintoaccountthelinesthatareoccu 2
block_size)*block_size;intend_storage=(mem_loc/block_size)*block_size+(block_size-1);for(intj=s 2
ano?to_store_mem_loc 0
).first;inttop_line=stack_of_functions.top().second;top_line=old_PC/4+1;stack_of_functions.pop();sta 2
hestackoffunctionsstack_of_functions.pop();//Updatethedestinationaddressa 1
thestackif 0
todirty}for(inti=0;i<associativity;i++){if(cache[index][i][2]==top_tag){removed_data=cac 4
ne:"<<instruction_no+1<<endl<<"Wrongsyntax,forJtypeformat,youmustenter3ope 0
ster<<"=0x"<<value_of_register_hex<<endl;}}elseif(command=="exit"){//Exitthesimulatorc 1
,20,0);stringhex_address="0x"+binary_ 0
te_queue(intindex,inttag,boolto_replace,intmem_loc,stringoperation,boolis_re 0
tore[0]==".dword"){data_base_address=store_dwor 1
formatstepinstructionsvoidst 0
tion=executed_instruction.subst 0
al(binary_bytes[i]);//character 2
.pop();stack_of_functions.p 1
"]='R';format["sll"]= 1
e[3]<<24)|(byte[2]<<16)|(byte[1]<<8)|(byte[0]);register_val 5
atingtheinstructionstringinstr=i 0
_functions.top().first;inttop_line=stack_of_functions.top().second;top_line=old_ 2
<endl;exit(0);}elseif(registe 1
instruction_no] 0
ry["<<mem_loc_h 0
<"Valueofimmediateisoutofrange";exit(0);}//Notingthevaiouspartsoftheinstrctionstring 1
alues["x0"]=0;}//CodefortheJformatstepinstructionsvoidstep_J(vector<string>instruction){//Storethen 3
){if(instruction[i]!=''&&instruction[i]!='('){cur.push_back(instr 3
pop_back();PC=0 1
ize+offset_size);index_mask=index_mask-1;temp_mask=1;temp_mask=temp_mask<<offset_size;temp_ma 0
agwewant.Wecanproceedwithfindingtherealdatainthatlocation//Ifwefindthisblocki 0
ctor<string>>&assembly_code,intinstruction_no){//Handlingerrorif(assembly_code[instruction_no]. 2
tivity*block_size));//Thesem 0
,rs2andimmediatevaluesstringr 0
ce);accessed_once=true;}}//Updatethestackoffunctionsandtheirlastexecutedli 0
(r=="a5"||r=="x15"){r="x15";}else 2
{register_values[r 0
nct3["xor"]="100";funct3["sll"]="0 2
ackandprintthefortheuservector<pair<string,in 0
lear();all_instructions.clear();offset_to_label.clear();w 3
s+1);}stringb 0
elseif(r=="a6"||r=="x16"){r="x16";}elseif(r=="a7"||r=="x17"){r="x17";}elseif(r=="s2 4
binary(old_PC,32,0);stringhex_PC=binary_to_h 1
;i<0x50001;i++){memory[i]=0x00;}labels.clear( 2
functionsandtheirlastex 0
["beq"]='B';format[ 1
tructions[PC/4];intpos=executed_instruction.find('');stringfirst_word=executed_instruction.substr 2
]<register_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst= 3
d_instruction.substr(0,pos);if(first_word.back()==': 2
inti=0;i<bin.size();i++){if(bin[i]=='0'){bin[i]='1';}else{bin[i]='0';}}//Add1tofind 8
byte[i]=read_access(start_locatio 1
achinecodehexadecimalandstoreintextmemoryfor(intinstruction_no=0;in 0
tringrs1,rs2,inst;intimm;inst=instruction[0];rs2=aliasRemover(instruction[1]);imm=stoi(instructio 3
nsofoffseybitszer 0
d_set>#include<vector 0
_code[instruction_no][2])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrect 3
ter_values["x0"]=0;}//Codefor 1
ooptoprintthelabelsinstack,botto 0
mand=="cache_simdisable"){cache_enabled= 0
if(!found){if(!accessed_once){misses++;if(write_back 2
mem_loc=imm+register_values[rs1];uint64_tstore 1
ction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_to_binary(stoi(as 1
opcode="1100011";stringf3=funct3[assembly_code[instruction_no][0]];st 3
ex;}else{hex=fs+hex;}}if(length*4<binary.size()){hex= 2
[1],true);}if(inst=="sw"){boolaccessed_once=false;vector<uint8_t>byte(4);for(inti=0;i< 4
/UpdatePCvaluePC+=4;}elseif(inst=="jalr") 1
";funct3["slli"]="001";funct3["srli"]="101";funct3["srai"]="101";funct3["lb"] 4
{binary_bytes[i]=hex_to_binary(hex_instruction.substr(6- 1
;//Weassumethatrs1alway 0
nary(stoi(assembly_code[i 0
ack:\n";//Weuseadummystacktopopthelabelsfromthemainstackandprintthef 0
);intimm;//Weacceptbothdecimalandhexadecimalvaluesif(instruction[2][1]==' 2
ex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_byt 3
ite<<":Address:"<<hex_address<<",Set: 0
ter_no="t";temporary_register_no+=to_string(i-5);registers[temporary_register_no 1
ed_instr.push_back(instruction[i]);}}instructio 2
3=funct3[assembly_code[instruction_no][0]];stringf7=funct7[assembly_code[instruction_no][0]];string 6
alid=true;update_queue(index,tag,false,mem_loc,"write",false,fal 0
cuted_instruction.substr(0,pos);if(first_word 1
,11)||stoi(assembly_code[instruction_no][3])>=pow(2,11)){cout<<"Errorinline:"<<instructi 4
1;index_mask=index_mask<<(index_si 0
ore_value;write_access(mem_ 0
ze);temp_mask=temp_mask-1;tag_mask=tag_mask^temp_mask;//Makesthepositionsofindexbitsandoffset 0
verthebinarystringfor(inti=0; 0
lthebreakpointintno_of_instruction=assembly_code.si 0
[1];mem_loc+=2;}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_loc;}//F 1
ne:"<<instruction_no+1<<endl 0
tslaterinttag_mask=1;tag_mask=tag_mask<< 0
l;unordered_map<string,int>last_exected_line;stack<pair<string,int>>stack_of_functions;unordered_ 3
t["sra"]='R';//Iform 1
include<array>#include<algorithm>#include<cstdlib>#include<math.h>#include<sst 4
=0){for(inti=0;i<=63;i++){mask+=po 0
,pos);if(first_word.back()==':'){executed_instruction=executed_instruction.substr(pos+1);}st 4
find(cur_instruction[0])!=load_operands.end( 2
owedby64-shifting_amount1'suint64_tmask=(1U<<(64-shifting_amount))-1;if( 1
s[rs1],val_rs2=register_values[r 1
_break=true;}vector<string>cur_instr=assembly_code[PC/4];if(forma 2
c';bin_to_hex["1101"]='d';bin_to_hex["1110"]='e';bin_to_hex["1111"]='f';stringhex="";for(i 3
elseif(to_store 0
olicy:"<<write_back_policy;}else{cout<<"CacheDisabled";}}elsei 0
l;//UpdatePCvaluePC+=4;}elseif(inst=="jalr"){//Extracttherd,rs1andimmediatevaluerd=aliasRemo 1
ount))-1;if(shifting_am 0
;unordered_map<string,string>funct7;unordered_map<string,char>format;unordered_set<string>lo 3
}cur_instruction.push_back(cur);cur="";}}if(cur!=""){if(cur[cur.size()-1]==','||cur[cur.size() 5
"||inst=="andi"||inst=="srai"||inst=="slli"||inst=="srli"){//E 0
];}//Updatethestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_s 0
oad_operands.insert("lhu");load_operands.insert("lwu");}//Wheneveranewfilei 2
}if(registers.find(assembly_code[instruction_no][1])==registers.end()){cout<<" 5
ry_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<e 1
e;}uint32_tres=byte[3]< 1
ffunctionsandthei 0
ntheD-cacheandwriteonlytheonceswhicharevalidfor(inti=0;i<cache.size();i++){for(intj=0;j<c 1
0"]=0;}//CodefortheUformatst 0
cifiedbythemem_locfor(inti=1;i<instruction.size(); 1
mmy_q.front();dummy_q.pop();q.push(cur);}if(!is_present){q.push(tag);}}else{intto 6
er_values[rs1]; 1
{if(cache_enabled){for(inti=0;i<cache.size();i++){for(intj=0;j<cache[i].size( 3
artingforlocations 0
os);if(first_word.back()==':'){executed_instruction=executed_instruction.substr(pos+1);}s 4
ing>#include<fstream>#include< 1
loc+=2;}//Returnthenewmem_locwhereyou 0
+i]=removed_data[ 0
insert("lhu");load_operands.insert("lwu");}//Wheneveranewfileisl 2
fortheuservector<pair<string,int>>dummy_stack 2
_code[instruction_no].size()!=4){cout<<"Err 2
or"){register_values[rd]=registe 1
lid,1fortag,1fordirtythenblocksizeforthenumberofbytesinthecachedatacach 0
unctiontostorehalfwordintstore_half(vector<string>instruction,intmem_loc 1
;stack_of_functions.push({top_of_stack,top_line});s 2
ex][i];//Valid,Dirty,tag,dataif 1
uction_no][0]]=='B'){execute_B( 1
k=temp_mask-1;index_mask=index_mask^temp_mask;//Makesthepositionsofoffseybitszero//Weneedtodot 0
e[i].size();j++){if(cache[i][j][0]==1&&cache[i][j][1]==1){intoffset_size=log2(block_size);//These 10
orinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs2";exit(0);}elseif(registers.find(as 1
;}elseif(to_store[0]==".byte"){data_base_address=store_byte(to_store,data_base_addr 2
+=4;}elseif(inst=="addi"||inst=="xori"||ins 0
ue<int>dummy_q;intoffset_size=log2(block_size); 2
")){stringmyfi 0
kintindex_mask=1;index_mask=index_mask<<(ind 0
funct3[assembly_code[instruction_no][0]];stringf 3
PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_i 1
bin_to_hex["0111"]='7';bin_to_hex[" 1
inghex_PC=binary_to_hex(bin_PC); 1
s[reg]=0;}intPC=0x00000;for(inti=0x0;i<0x50001;i++){memo 1
sinceupdate_queuewillneverbereached}else{//Fi 0
+=to_string(i-10);registers[ar 1
{new_data[k]=memory[j];}removed_data=cache[index][random_number];cache[inde 5
':'){executed_instruction=e 0
s2];if(val_rs1>=val_rs2){PC=new_pc;}else{PC+=4;}}e 3
e"){new_data[3+offset]=val;new_da 1
"){data_base_addr 0
/UpdatethePCandkeepx0valueat0PC=PC+4;register_values["x0"]=0;}// 1
lse,mem_loc,"read",true,false);cache[index][i]=cache_block;returnval; 2
"<<instruction_no+1<<endl<<"Incorrectvalueofrs2";exit(0);}//Notingthevaiourspartsoftheinstrutionstr 1
requiredtofindoutthetagbitslaterinttag_mask=1;tag_ma 0
tion//Ifwefindthisblockinthecache,wereadonlythisparticularmemor 0
s.top().first;inttop_line=stac 1
sthepositionsofindexbitsandoffsetbitszero//Letusdothesameforindexmakintindex_mask=1;index_mask=index 0
eswhicharevalidfor(inti=0;i< 0
e[instruction_no][2].substr(2));intdecimal=binary_to_decimal(bin_instr);dec_imm=decimal;}e 4
Wenowwanttoconvertittodecimalre 0
truction_no][3])==registers.end( 1
tart_location,false);int8_tres=byte;register 0
<is_clean<<endl;}}}myfile_out.close();}elseif(command=="cache_simstats"){ 2
7);ifstreamcache_config_file;cache_config_file.open(cache_config_f 0
tion_no][3])<0||stoi(assembly_code[instruction_no][ 2
ter_bin,true,16);cout<<this_register<<"=0x"<<value_of_register_hex<<endl;}}elseif(c 0
tor<string>instruction,intmem_loc){//Gothroughallthevaluesthatt 1
ex_to_bin['4']="0100";hex_to_bin['5']="0101";hex_t 2
mal(binary_bytes[i]);//characters67ofhex_instruction}fo 2
while(!dummy_q.empty()){intcur=dummy_q.front();dummy_q.pop();q.push(cur);}//No 6
correctvalueofrs 0
labels.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Labelnotdefined";exi 1
nstruction<<";PC="<<hex_PC< 0
mat[cur_instr[0]]=='U'){step_U(cur_instr 2
tion_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}// 1
uction,intmem_loc){//Gothroughallthevaluesthattheuserhasspecifiedandstorethemstartingforloca 0
ind('');stringfirst_word=executed_instruction.substr(0,pos);if(first_word.back()==':'){execut 4
inghex="";for(inti=0;i<binary.size();i+=4){stringb=binary.substr(i,4);hex.push 2
amintbreak_point=stoi(command.substr(10));//Wedeletethebreakpointif( 2
register_values[rd]=register_values[rs1]^register_values[rs2 2
partsofthei 0
funct7["and"]="0000000";funct7["or"]="0000000"; 2
+){new_data[k]=memo 1
ed_once=true;}uint32_tres=byte[3]<<24|byte[2]<<16|byte[1]<<8|byte[0];register_values[r 4
;intcount=stoi(s 0
struction_no][2])==registers.end()){cout<<"Errorinline:"<<instr 2
binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed: 2
ines.end()){break;//to_break=true; 1
I';format["lhu"]='I';format["lw 1
valuesvoidinitialize_funct3(){funct3["add"]="000";funct3["sub"]="00 3
oi(assembly_code[instruction_no][3]),6,true);imm="010000"+imm;}else{if(stoi(assem 3
ze()-1]==')'){cur.pop_back();}cur_instruction.push_back(cur);}/ 4
ters[assembly_code[instruction_no][2]];stringrs2=regi 3
tack_of_functions.push({"main",0});last_exected_line.clear();break_lines.clear();count_how_many 4
ore,data_base_address);}elseif(to_store[0]==".word"){data_base_address=store_word( 2
nstringbin_s_addr=hex_to_binary(s_addr);inta 1
mainsat0register_values["x0"]=0;}//CodefortheSformatstepinstru 1
rty=true;intto_s 0
uted_instruction.find(''); 1
retoprintthecachestatisticsif(cache_enabled){cout<<"D-cachestatistics:Accesses="<<hits+mi 1
its<<",Miss="<<misses<<",HitRate="<<fixed<<setprecision(3)<<(double)(hits)/(hi 3
ntinstructionandstoreitina2dmatrixofstrings 0
tion_no][3])==labels 1
al;}//Definingallregistersvoidinitialize_registers(){for(inti=0;i<=31 1
);}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);//char 4
!command.find("load")){//Firstresetalltheregisters/memory/PCbeforeloadingt 1
teaccess"<<endl;}}//Inthecaseofmisses,ifitiswritethorugh,wejustwritetomemorywithoutbothering 0
i==8){registers["s0"]=this_register;registers["fp"]=this_register;}elseif(i== 3
",Tag:"<<hex_tag<<"," 0
/Thesemanyareforindexinttag_size=20-offse 0
ingdecimal_to_binary(intdecimal,intno_of_bits,boolisSigned){boolisNegative=false;if(decimal<0) 1
0,0);stringhex_tag="0x"+binary_to_hex(bin_tag,true,5);cache_output<<read_or_write<<":Address:"<<hex_ 1
tructionsvoidstep_B(vector<string>instruction){//Keeptr 2
truction_no);}elseif(format[assembly_code[instruction_no][0]]=='U'){exec 4
/4];intpos=executed_instruction.find('');stringfirst_word=executed_in 1
efortheJformatstepinstructionsvoidstep_J(vector<string>instructi 1
over(instruction[2]);imm=stoi(instruction[3]);//U 4
ackofalllaodoperandsvoidinitialize_load_operands(){load_operands.insert("lb");load_ope 2
ory[j];}if(operation=="write"){new_data[3+offset]=val 3
_code[instruction_no][0]];stringrd=registers[assembly_code[in 2
{if(!check_space){if(command[i]==''){check_space=true;}else{s_addr.push_b 4
policy<<endl;cout<<"WriteBackPolicy:"<<write_back_policy;}else{cout<<"CacheDisa 0
unctions.top().fi 1
ur_instr);}else{exit(0);}//Iflastlineisexecuted,thenensuretopopmainfromthesta 2
f(format[assembly_code[ 0
])>=pow(2,20)-1){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofr 1
){for(inti=0;i<=31;i++){stringregister_no="x";register_no+=to_string(i);stringthis_register=decimal 1
tringtop_of_stack=stack_of_fun 0
n.substr(pos+1);}stringbin_PC=decimal_to_binary(old_PC,32,0);stringhex_PC=binary_to_hex 2
ocation+1,true);uint16_tres=byte1<<8|byte0;register_values[rd]=res;}elseif(inst=="lwu"){vector< 2
gfirst_word=execute 0
tetonextreturnmem_loc;}//Functiontostore 0
andi"]="111";funct3["slli"]="001";funct3["srli"] 2
'1'){decimal+=pow(2,length-1-i);//le 1
1+f3+imm.substr(8,4)+imm.substr(1,1)+opcode;stringhex_instruction=binary_t 2
h_back(command[i]);}}else{s_count.push_back(command[i]);}}s 5
e_R(vector< 0
imm.substr(9,1)+imm.subst 1
:Address:"<<hex_address<<",Set:"<<hex_set<<","<<"Miss"<<",Tag:"<<hex_tag<<","< 0
instructions[PC/4];intpos=executed_instruction.find('');stringfirst_word=executed_instruction.su 2
i,20,0);stringhex_set="0x"+bina 0
agandindexshouldbe 0
<<8)|(byte[0]);re 2
f(command=="cach 0
PC+=4;}elseif 0
nstructions[PC/4];intpos=execu 1
tingtheinstructionstringinstr=imm.substr(0,1)+imm.s 1
offset]=val;new_data[1]=1;//Setthebittodirty}for(inti=0;i 1
ecision(3)<<(double)(hits)/(hits+misses);}st 4
n_no+1<<endl<<"Wrongsyntax,forRtypeformat,youmustenter4operands" 0
_functions.top().first;inttop_line=stack_of_functions.top().s 2
inghex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Execute 1
pos=executed_instruction.find('');stringfirst_word 1
<=63;i++){mask+=pow(2,i);}}r 2
inationaddressandvalueofPCaccordinglyregister_values[rd]=PC+4;PC=im 1
p_line});stack_of_functions.push({offs 0
ord=executed_instruction.substr(0,pos);if(first_word.back()==':'){executed_instru 3
memorylocation.//Ifwedonotfin 0
lseif(registers.find(assembly_code[instruction_no][1])==registers.end() 4
//Thedatastartsfromindex3andextendstillblocksize//break;}}//I 0
oftagbitsinthem 0
show-stack"){//Hereweexecutetheshow-stackcommandcout<<"CallS 0
operands"<<endl;exit(0); 1
n_or_dirty="Dirty";}if(is_re 0
substr(8,4)+imm.substr(1,1)+opcode;stringhex_instruction=binary_to_hex(instr);vector<string>binary_ 4
riouspartsoftheinstructionstringop 0
sshifting_amount0'sfollowedby64-shifting_amount1'suint64_tmas 0
.second;top_line=P 0
ion.substr(6-2*i 0
code,intinstruction_no){//Handlingerrorif(assembly_code[instru 0
e_block(block_size+3) 1
;//Printingthelocationsofthememoryasspecifiedusingalooopfor( 0
"||r=="x24"){r="x24";}elseif(r=="s9"||r=="x25"){r="x25 2
necessaryinformationunordered_map<string,string>regi 1
clude<unordered_set>#include<vector>#include<array>#include<alg 3
='0'){continue;}else{trimmed_hex=hex.substr(i);returntrimmed_h 2
0"]='e';bin_to_hex["1111"]='f';stringhex="";for(inti=0;i<binary.size();i+=4){stringb=bi 2
datainthatlocatio 0
andifwedo,thenwecandirectlyaddourvaluetoitboolfound_invalid=false;for(inti=0;i<associativity;i++) 0
<<16|byte[1]< 1
/Keepingtrackofalllaodoperandsvoidinitialize_load_operan 0
frommemorylocationspecifie 0
lues[rd]=PC+4;P 1
lude<random>#include<iomanip>#include<cstring>//Thefollowingensurethat64bitscanbehandledb 3
rnum='0'+i;this_register+=num; 0
x(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary 3
<<dummy_stack[i].first<<":"<<dummy_ 1
ngopcode="1100011";stringf3=funct3[assembly_cod 0
erofaccessvectorupdate_queue(index,tag,false,mem_loc,"write",false,true,va 0
_tag){removed_data=cache[index][i];cache[index][i] 4
=byte[0];memory[mem_loc+1]=byte[1];mem_loc+=2;}//Returnthenewmem_locwherey 3
inary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_inst 2
r"){register_values[rd]=register_values[rs1]^register_values[rs2];}elseif(inst=="sll"){r 5
to_skip=0;}stringaliasRemover(stringr){if(r=="zero"||r=="x0 1
);}elseif(registers.find(assembly_code[i 0
;//Thebitisnowvalidnew_data[1 0
ta_base_address);}elseif(to_store[0]==".half"){data_base_ 2
lystringtop_of_stack=stack_of_functions.t 0
ocationspecifiedbythemem_locfo 0
embly_code[instruction_no][2]);}if(dec_imm<0||dec_imm>4294963200){cout<<"Errorinline:"<<instructi 4
int8_tbyte=read 0
["bge"]='B';format["blt"]='B';format["bne"]='B';for 3
='I';format["lhu"]='I';format["lwu"]='I';format["jalr"]='I';//Sformatformat["sb"]='S 4
length*4;i<binary.size();i++){zeros.pus 1
in="";while(decimal!=0){bin.push_back(deci 1
ldbooldata=false;stringdata_type;intdata_base_address=0x10000;//L 0
]=0;//Initiallynotdirtynew_data[2]=tag;for(intj=start_storage,k=3;j<= 1
<<endl;}order_of_access[index]=q;}voidwrite_access(intmem_loc,intval,boolaccessed_once){if( 2
][0]=="slli"){if(stoi(assembly_code[instruction_no][3])<0||stoi(assembly_code[instruction_no][3])>= 8
tr.push_back(instruction[i]);}}instruction 2
owcheckiftheremoveddatahasadirtybitset,andifso, 0
ata[k]=memory[j];}if(operation==" 2
elseif(inst=="srai"){register_values[rd]=register_values[rs1]>>imm;}//Updatethestackof 4
imal!=0){bi 0
heirlastexecutedlineaccordinglystringtop_of_stack=stack 0
]=val;}}intread_access(intmem_loc,boolaccessed_once){if(cache_enabled){booli 2
eamcache_config_file;cache_config_fil 0
)>=pow(2,6)){cout<<"Errorinline:"<< 1
+offset_size);//Gettingthevalueofindexbitsofmemorylocationbeingrequestedbyprogramintindex=index_ 0
opcode="0110011";stringf3=funct3[assembly_cod 0
reakpointatl 0
ead_access(start_location+1,true);int16_tres=byte1<<8|byte0;register_values[rd]=res;}elseif(inst 2
_or_write="W";if(is_hit){hit_or_miss="Hit";}if(is_dirty){clean_or_dirty="Dirty";}if( 4
eis0PC=0;if(cache_enabled){if(fopen(cache_output_name.c_str(),"a")!=NULL){cache_output.close();}ca 6
struction)){//Iftheinstructionisdata,thenensurethatuntilwe 0
intoffset=offset_mask&mem_loc;//Wenowhavetheindexandtag 0
dbythemem_locfor(inti=1 0
temporary_register_no+=to_string(i-5);registers[tempo 1
r"]="110";fun 0
gbits//Letusnowcalculatethemaskrequiredtofin 0
t_word.back()==':'){executed_instruction=exec 1
ry/PCbeforeloadingthenextfileinitialize 0
andprintthefortheuservector<pair<string,int>>dummy_stack;stack<pair<string,int>>dummy_stack_functi 4
_dirty<<"fromupdatequeue"<<endl;} 0
("load")){//Firstresetalltheregisters/memory/P 1
tionspecifiedbythemem_locfor(inti=1;i<instruc 0
k=tag_mask<<20;tag_mask=tag_mask-1;//Thismakesthemask20onesinttemp_mask=1;temp_mask=temp_mask<<( 0
="0000011";}elseif(as 0
4);for(inti= 0
0x50001;i++){memory[i]=0x0 1
;i<=63;i++){mask+=pow(2,i);}}register_values[rd]=regist 3
lseif(command=="cache_simstats"){if(cache_enabled){cout<<"D-cachestatistics:Accesses="< 2
4<binary.size()){hex=hex.substr(binary.size()-length*4);}if(trim){stringtrimmed_h 5
111";funct3["or"]="110";funct3["xor"]="10 2
ue(index,tag,false,mem_loc,"read",true,tr 0
imalintbinary_to_decimal(conststring&bin){intdecimal 1
if(assembly_code[instruction_no].size()!=3){cout<<"Errorinline:"<<ins 3
over(instruction[1]);rs1=aliasRemover(instruction[2]);imm=stoi(i 4
struction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_ 2
="a0"||r=="x10"){r="x10";}elseif(r=="a1"||r=="x1 1
y_code[instruction_no][ 1
1;offset_mask=offset_mask<<(offset_size);offset_mask=offset_mask-1;//Wecannowget 1
[rs1]>>register_values[rs2];//Ourmaskisshifting_amount0'sfollowedby64-shifting_amount1'suint 2
first;inttop_line=stack_of_functions.top().second;top_line=PC/4+1;stack_of_functio 1
n_no][2]];stringimm;//Assigningtheimmediatealongwithchec 1
tu"]="110";funct3["bgeu"]="111";}//Definingallfunct7values 1
+i]=byte[i];}}//CodeforJform 1
ster_values[rd]=res;}elseif(inst=="ld"){vector<int64_ 2
t=instruction[0];if(inst=="jal"){register_values[rd]=PC+4;PC=new_pc;}// 4
eif(format[cur_instr[0]]=='U'){step_U(cur_instr);}else{exit(0); 6
ptbothdecimalandhexadecimalvaluesif(instruction[2][1]=='x'){strin 3
instruction_no][2]];stringrs2=registers[assembly_code[instruction_no][3]];//Concatinatin 4
}//Notethatheretagwillalwaysbeatthetopq.push(tag); 1
initialize_registers(){for(inti=0;i<=31;i++){stringregister_no="x";register_no+=t 1
ers67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//CodeforJfo 3
ck(cur);cur="";}}i 1
eouthowour20bitsofmemoryadd 0
uctionsvoidexecut 0
tmem_loc,boolaccessed_once){if(cache_enabled){boolis_hit=false;//Letusfirstfigur 1
ze;//Andthesemanyaret 0
=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<he 1
sdata,thenensurethatuntilwesee.text,wekeepstoringdataif(instruction==".data"){data=true 1
sk=offset_mask<<(offset_size);offset_mask=offset_mask-1;//Wecannowgettheactualv 1
veunnecessaryspacefromthebeginningofanylinebooltrim=true;stringtrimmed_instr="";for(inti=0;i< 0
_set<<","<<"Miss"<<",Tag:"<<hex_tag<<","<<"Clean"<<"Fro 0
in_to_hex["1111 0
code[instruction_no][3])<-pow(2,11)||stoi(asse 3
nothing}else{intrandom_number=rand()%associativity;vector<int>removed_data(cache[0][0]. 4
p_mask<<offset_size;temp_mask=temp_mask-1;index_mask=index_mask^temp_mask;//Makesthepositionsofof 0
senttion,viabinaryrepresentationstringbin_s_addr=hex_to_binary(s_addr); 1
ion[i]);vector<uint8_t>byte(8);for(inti=0;i<8;i++){byte[7-i]=store_value>>(7-i)*8;}for(inti=0; 6
ister_values[rs2];//Performstoreaspertheinstructionif(inst=="sb"){uint8_tby 2
//Popthevaluewhichisreplacedq.push(tag);//Pushthenewtagvaluevector<int>removed 2
dword(to_store,data_base_address);}elseif(to_store[0]==".half"){data_base_address=store_ha 3
x_to_bin['c']="1100";hex_to_bin['d']="1101";hex_to_bin['e']="1110";he 3
illalwaysremainatvalueof0PC+=4;register_values["x0"]=0;}//CodefortheIformatstepinstruc 1
outhowour20bitsofmemor 0
(6));//Wetakeintoaccountthelinesthatareoccupiedbythedatasection,andsubtractthembre 1
l;//UpdatethePCvaluea 0
al_to_binary(tag,20,0);stringhex_tag="0x 1
ddourvaluetoitboolfound_invalid 0
n;}//Codetoconvertdecimaltob 0
<<endl;//Ensuretoremovethecalledfunctionfromthestackoffuncti 0
kandprintthefortheuservector<pair<string,int>>dummy_stack;stack<pair<string,int>>dummy_stack_fu 4
fsetbitszero//Letusdothesameforindexmakintindex_mask=1;index_mask=index_ 0
_hex(bin_address,false,5);str 1
functions.push({"main",0}); 2
onstoppedatbreakpoint\n";}else{while(PC/4<no_of_instructi 0
oidinitialize_registers(){for(inti=0;i<=31;i++){stringregister_no="x";register_no+=to_string(i);st 2
"bge"]="101";funct3["bltu"]="110";funct3["bgeu"]="111";}//Definingallfunct7valuesvoidinitializ 2
0;//Makethevalidbitaszero}}}elseif(!command.find("cache_simdump")){stringmyfil 2
t>register_values;unordered_map<string,string>registers_alis;vect 1
/CodefortheIformatstepinstructionsvoidstep_I(vector<string>instruction){stringrd,rs1,inst;inst=in 2
[2]);}if(dec_imm<0||dec_imm>4294963200){cout<<"Errorinline:"<<instruction_no+1<<end 3
y_code[instruction_no][1]];stringimm=decimal_to_binary(dec_imm,20 2
x0valuesremainsat0register_values["x0"]=0;}//CodefortheSformatstepinstructionsvoidstep_S(vec 1
line=stack_of_functions.top().second;top_line=PC/4+1 1
U(cur_instr);}else{exit(0);}if(to_break){cout<<"Executionstoppedatbreakp 4
_pc;}//Updatethestackoffunctionsandtheirlastexecutedlineaccordi 0
"x25"){r="x25";}elseif(r=="s10"||r=="x26"){r="x26";}elseif(r=="s11"||r== 3
rd]=register_values[rs1]+imm;}elseif(inst=="xori"){register_values[rd]=register_valu 3
f_functions. 0
inst=="bne"){if(register_values[rs1]!=register_values[rs2]){PC=new_pc;}else{PC 4
tr(0,pos);if(first_word.back( 1
;format["blt"]='B';format["bne"]='B 2
l/=2;}while(bin.size()<no_of_bits){bin.push_back('0');}reverse(bin.begin(),bin 4
if(cur[cur.size()-1]==','||cur[cur.size()-1]==')'){cur.pop_back();}cur_instruct 7
detothecorrespondinginstructionif(load_operands.find(assembly_code[instruction_no][0])!=load_ 3
accessvectorif(!accessed_once){hits++;update 1
executedlineaccordinglystri 0
stoppedatbreakpoint\n";break;} 0
_enabled){for(inti=0;i< 0
instruction,intmem_loc){//Gothroughallthevaluesthattheuserhasspecifiedandstorethemsta 0
ngmem_loc_hex="0x"+binary_to_hex(mem_loc_bin,false,5);cout<<"Memory["<<mem_loc_hex<<"]"<<"="<<hex 1
che_enabled){cout<<"CacheEnabled"< 0
);i++){if(bin[i]=='0'){bin[i]='1';}else{bin[i]='0';}}//Add1tofind2'scomplementfor( 7
uction_no);}else{cout<<"Erroronline:"<<instruction_no+1<<endl 0
();i++){if(!check_space 1
nordered_set<int>b 1
ofoldPCifbranchnottakenintold_PC=PC;//Executet 0
[assembly_code[instruc 0
rite_access(mem_l 0
set_size-index_size;//Andthesemanyaretagbits//Letusnowcalculatethemaskrequiredtofindoutthetagbitsl 0
Thiswillneverreachreturn-1;}//CodefortheRformatstepinstructionsvoidstep_R(vec 0
ordfirstploicyintstart_storage=(mem_loc/block_size)*block_ 1
ttop_tag=q.front();//Getthetagwhichweneedtoreplaceq.pop();//Popthevaluewhichisrepla 2
mbly_code[instruction_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"In 3
write_back_policy;}else{cout<<"CacheDisabled";}}elseif(comm 0
cout<<dummy_stack[i].first< 1
saddressesinformofintegerintstart_location=imm+register_values[rs1];if(inst 1
lock_size+3);cache_block=cache[index] 1
<endl;//UpdatethePCaccordinglyPC+=4;} 0
ivity*block_size);cache.clear();//Notethatthesizeifblocksize+3because,1forvalid,1fortag,1fordi 1
che_block=cache[index][i];//Valid,Dirty,tag,dataif(cache_block[0]==0){//Thisisaninvalidframe,i 4
e_size>>block_size>>associativity>>replacem 0
.substr(5);//Thisistoremove.scurrent_opened_file.pop_back();current_opened_file.po 2
ster_no+=to_string(i-18+2);registers[sav 1
(assembly_code,instruction_no);}elseif(format[assembly_code[instruction_no 1
lse;if(decimal<0){isNegative=true;}decimal=abs(decimal);string 2
ex_mask^temp_mask;//Makesthepositions 0
byte"){data_base_address=store_byte(to_store,data_base_addres 0
ster_values[reg]=0;}intPC=0x00000;for(inti=0x0;i<0x50001;i++){memory[i 1
uction_nostringhex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i+ 3
tethemaskrequiredtofindoutthetagbitslaterinttag_mask=1;tag_mask=tag_mask<<20;tag_ma 0
ng,int>>stack_of_functions;unordered_set<int>break_lines;intcount_how_many_to_skip;//Codetoconvert 1
<<endl<<"Wrongs 0
theorderofaccessvectorupdate_queue(index,tag,false,mem_lo 0
mask=1;temp_mask=temp_mask<<(index_size+offset_size);temp_mas 1
_size;temp_mask=temp_mask-1;index_mask=index_mask^temp_mask;//Makesth 0
helinesthatareoccupiedbythedatasection,an 0
nowvalidcache_block[1] 1
<"Valueofimmediateisoutofrange";exit(0);}//Notingthevaiouspartsoftheinstrctionstringopcode="0110111 1
binary(PC,32,0 0
d_access(start_location,false);uint16_tbyte1=read_ac 1
}for(inti=0;i<4;i++){memory[instructi 0
emory[to_store_mem_loc+i]=removed_data[3+i];}}}}}//Hereweneedtoensurethatallthebocksarewrittenifdirt 2
_string(i);register_values[reg]=0;}intPC=0x000 2
f3=funct3[assembly_code[instruction_no][0]];stringrs1=registers[assembly_ 3
'){step_B(cur_instr);}elseif(format[cur_i 2
heinstrcutionstringopcode="1101111";stringrd=regis 0
code[instruction_no][2])==registers.end()){cout<<"Erro 3
hex_to_bin['f']="1111";stringbin="";for(inti=0;i<hex.s 1
ndex,20,0);stringhex_set="0x"+binary_to_hex(bin_set,true,5);stringbin_t 1
;offset_to_label.clear();while(!stack_of_functions.empty()){stack_of_functions 3
[k]=memory[j];}removed_da 2
(no_of_indexes);cache_config_file.close();hits=0;misses=0;}elseif 2
ereyoucanwritetonextreturnmem_loc;}//Functiontostorebytwin 0
c|=(index<<offset_size);for(inti=0;i<bloc 0
_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:" 1
>>write_back_policy;//Iftheassoc 0
ed:"<<executed_ 0
rebytwintstore_byte(vector<string>instruct 1
registers[assembly_code[instruction_no][1]];stringimm=decimal_to_binary(d 3
0]=store_value;byte[1]= 1
s=0;misses=0;//memory.clear();//cache.clear();for(inti=0;i<memory.size(); 3
rrorinline:"<<instruction_no+1 0
ourprogramisre 0
(binary_bytes[i]);//characters67ofhex_instruction}for(inti=0;i<4;i++){memory[instructio 2
>last_exected_line;stack<pair<string 0
no][2][1]=='x'){stringbin_instr=hex_to_binary(assembly_code[instruction_no][2].su 4
set];//Sincethisahit,weneedtoupdatetheorderof 0
er];stringvalue_of_register_bin=decimal_to_binary(value_of_re 0
assembly_code[instruction_no][3])==labels.end()){cout<<"Errorinline:"<<instr 3
accessed_once);accessed_once=true;}int32_tres=(byte[3]<<24)|(byte[2]<<16)|(byte[1]<<8 3
=20-offset_size-index_size;//Andthesemanyaretagbitsboolis_dirty=false;if(rep 0
nstructionsvoidstep_U(ve 0
ythemem_locfor(inti=1;i<i 0
ction_no+1<<endl<<"Incorrectvalueofrd";exit(0);}elsei 1
nctiontostorebytwin 0
}}if(cache_enabled) 1
id,Dirty,tag,dataif(cache_block[0]==0){//Thisisaninvalidframe,ignorecontinue;}if(cac 3
etheremainingwords,criticalwordfirstploicyintstart_storage=(mem_loc/block_size)*bloc 1
<associativity;i++){if(cache[index][i][2]==top 3
tion.substr(0,pos);if(first_wo 1
gister_values[rs1]^register_values[rs2];}elseif(inst=="sll"){register_values[rd]=regi 4
valueofindexbitsofmemorylocationbeingrequestedbyprogram 0
e[instruction_no][ 1
_no][2]];stri 1
}stringaliasRemover(stringr){if(r=="zero"||r=="x0"){r="x0";}elseif(r=="ra"||r=="x1"){r=" 4
ckofhowmanylineswereusedfordatasegmentandthefirstlineoftext(.text)count_how_many_to_skip++;if(i 1
uction_file;vec 0
cimaltobinarystringhex_to_binary(stringhex){unord 1
t3["blt"]="100";funct3["bge"]="101";funct3["bltu"]= 3
s2){PC=new_pc;}else{PC+=4;}}elseif(inst=="bltu"){uint64_tval_rs1=register_values[rs1], 4
tion_no);}else{cout<<"Erroronline:"<<i 0
nlytheonceswhicharevalidfor(inti=0;i<cache.size();i++) 1
doperandsvoidinitialize_load_operands(){load_operands.insert("lb");load_operands.insert("lh"); 3
assembly_code[instruction_no][3])>=pow(2,11)){cout<<"Errorinline:"<<instruction_no+1<<endl 3
;}//Updatethestackoffunction 0
++){byte[i]=read_access(star 1
_operands.insert("ld");load_operands.insert("lbu");load_ope 2
ze;i++){memory[to_s 0
d=executed_instruction.substr(0,pos);if(first_word.back()== 2
_back_policy;}else{cout<<"CacheDisabl 0
mory[to_store_mem_loc+i]=re 1
x(mem_loc_bin,false,5);cout<<"Memory["<<mem_loc_hex<<"]"<<"="<<hex_mem_val<<endl; 1
erands"<<endl;exit(0);}if(labels.find(assembly_code[instruction_no][2])==labels.end()){cout<<"Errori 6
fmemorybytesstarting 0
;}elseif(inst=="lwu"){vector<uint32_t>byte(4);boolaccessed 3
ack<pair<string,int>>stack_of_functions;unordered_set<int>bre 3
tack[i].first<<":"<<dummy_stack[i].second+count_how_many_to_skip<<e 2
de[instruction_no 0
cyif(!found_invalid){update_queue(index,tag,true,mem_lo 1
=true;found=true;val=cache_block[3+offset];//Sincethisahit 1
'e']="1110";hex_to_bin['f']="1111";stringbin="";for(inti=0;i 1
ry_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i 3
ringtrimmed_hex="";for(inti=0;i<he 0
vity;i++){if(cache[index][i][2]==top_tag){remov 4
t8_tbyte=read_access(start_location,false);int8_tres=byte;regis 1
]=1;//Setthebittod 0
ngsyntax,forItypefor 0
="";for(charc: 0
rywithoutbotheringtoddoanythinginthecacheif(write_b 0
t0'sfollowedby64-shifting_amount1'suint64_tmask=(1 0
to_binary(stoi(assembly_code[instruction_no][3]),12,true);//Concatinatingt 4
cache.clear();/ 1
enextfileinitialize();hits=0;misses=0;//memory.clear();//cache.clear();for 3
ethestackoffunctionsandtheirlaste 0
block_size;i++) 0
roughallthevaluesthattheuserhasspecifiedandstorethemstartingforlocationspecified 0
][j][0]==1){stringis_clean="Clean";if(cache[i][j][1]==1){is_clea 6
ffset_to_label[PC],-1});stringexecuted_instruction=all_ins 1
x[b]);}if(length*4>b 1
nitialize();ifstreaminstruction_file;vector<vector<string>>asse 3
storage;j++,k++){cache_block[k]=memory[j];}cac 3
es.end()){cout<<"Executionstoppedatbreakpoint\n";}else{while( 1
ue=stoi(instruction[i]);vector<uint8_t>byte(4);for(inti=0;i<4;i++){byte[3-i]= 5
heintcache_size,block_size,associativity;stringreplace 0
cur.size()-1]==')'){cur.pop_back();}cur_instruction.push_back(cur); 4
alue_of_regis 0
unct3["bgeu"]="111";}//Definingallfunct7valuesvoidinitialize_funct7(){funct7["add"]="000000 3
top_line});stringexecuted_instruction 0
red_map<string,ch 0
=true;}else{s_addr.push_back( 0
struction[2]);//Extracttherdvalue 1
000000";funct7["xor"]="0000000";funct7["sll"]="0000000";funct7["srl"]="0000000";funct7["sra"]=" 4
mat["add"]='R';format["sub"]='R';format["xor"]='R';format["or"]='R';format["and"]='R';f 5
o_hex(bin_address 0
i<4;i++){memory[instr 0
queueif(!to_replace){//Donothing}els 2
address<<",Set:"<<hex_set<<","<<"Miss"<<",Tag:"<<hex_ta 0
;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);//characters67ofhex_inst 3
x];queue<int>dummy_q;intoffset_size=log2(block_size);//Thesemanybitsareforoffsetintindex_siz 2
t=offset_mask&mem_loc;//Wenowhavetheindexandtagwewant.W 0
PC="<<hex_PC<<endl;//UpdatethePCvalueandensu 0
e,intinstru 0
.back()==':'){executed_instruction=execut 1
ruction[i]);vector<uint8_t>byte(4);for(inti=0;i<4;i++){byte[3 3
ction_no);}elseif(format[assembly_code[instruction_no] 1
geu"){uint64_tval_rs1=register_values[rs1],val_rs2=register_values[rs2];if(val_rs1>=val_rs2) 3
nt>new_data(cache[0][0].size());intstart_storage=(mem_ 4
ty=false;if(re 0
{//Extractthers1,rs 0
data[2]<<(offset_size+index_size)) 2
["srli"]="101";funct3["srai"]="101";funct3["lb"]= 3
nstruction_no][2])>=pow(2,20)-1){cout< 2
nct3[assembly_code[instruction_no][0]];stringrs1=registers[assembly_code[instruction_no][1]];st 6
stack_of_functions.pop();stack_of_function 1
1"]='b';bin_to_hex["1100"]='c';bin_to_hex["1101"]=' 2
;}//Updatethestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of 0
oi(instruction[i]);vector<uint8_t>byte(4);for(inti=0;i<4;i++){b 4
t3["srai"]="101";funct3["lb"]="000";funct3["lh"]="001";funct3["lw"]="010";funct3["l 4
ind(cur_instruction[0])!=load_operands.end()||format[cur_ 3
";exit(0);}elseif(stoi(assembly_code[instruction_no][3])<-pow(2,12)||stoi(assembly_code[instruction 5
ordinglyregister_values[rd]=PC+4;PC=imm+register_values[rs1];}//Ensure 2
d]=register_values[rs1]>>imm;//Ourmaskisshifting_amount0'sfollowedby64-shifting_amount1'su 1
o]=this_register;}elseif(i 0
ity==0){//Thismeansthatthereisonly1index,everyoneisf 0
size();i++){uint64_tstore_value=stoi(instruction[i]);uin 3
bly_code[instruction_no][3]];//Concatinatingtheinstructionstringins 2
]=new_data;break;}}//Nowcheckiftheremoveddatahasadirtybitset,andifso,weneedtoupdatethe 0
/4==no_of_instructi 0
00"+imm;}elseif 0
command[i]);}}s_addr=s_addr.substr(2);//Weremovetheleading0xinthestri 2
format[assembly_code[instruction_no 0
immediateisoutofrange";exit(0);}//Notingthevariouspartsoftheinstructionstringopco 1
/Definingallfunct7valuesvoidini 0
orrectvalueofrd";exit(0);}intdec_imm;//Weacceptbothde 1
ode[PC/4];if(format[cur_instr[0]]=='R'){step_R(cur_inst 4
_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//CodeforIformatin 3
gtrimmed_instr="";for(inti=0;i 0
to_replace){while(!q.empty()){intcur=q.front();q.pop();if(cur!=tag){dummy_q.push(cur);}}whi 8
ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//CodeforB 3
;cache[index][i]=new_data;break;}}//Nowcheckiftheremoveddatahasadirtybitset,andifso,weneed 2
stexecutedl 0
ertabreakpointintbreak_ 0
semanyaretagbitsboolis_dirty=false;if(replacement_polic 0
[2].substr(2));intdecimal=binary_to_decimal(bin_instr);dec_imm=deci 3
str(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringh 2
emaskrequiredto 0
r_instr[0]]=='U'){step_U(cur_instr);}else{exit(0);}if(to_break){cout<<"Executionstoppedatbreakpoint\ 6
gister_valu 0
=decimal_to_binary(old_PC,32,0);stringhex_PC=bina 1
ion_no+1<<endl<<"Incorrectsyntax";exit(0 0
==".data"){data=true;count_how_many_to_skip++;continue;}if(dat 1
te0;register_values[rd]=res;}else 1
estatistics:Accesses="<<hits+misses<< 0
decimal_to_binary(tag,20,0);stringhex_tag="0x"+binary_to_hex(bin_ 1
Iformatformat["addi"]='I';format["xori"]='I';format["ori"]='I';format["and 3
(start_location 0
new_data[2]=tag;for(intj=start_storage,k=3;j<=end_ 1
ction_no][3]]-instruction_no*4);}if(registers.find( 1
e[instruction_no][2]);}if(dec_imm<0||dec_imm>4294963200){cout<<"Errorinline:"<<instruction_no+1<<en 4
set_mask=offset_mask<<(offse 0
i];//Valid,Dirty,tag,dataif(cache_block[0]==0){//Thisisaninvalidframe,ign 2
if(command=="cache_simstats"){if(cache_enabled){cout<<"D-cach 2
ruction[i]!=''&&instruction[i]!='('){cur.push_back(instruction[i]);}else{if(cur[cur.size( 6
_R(cur_instr);}elseif(format[cur 1
ind('');stringfirst_word=executed_instruction.substr(0,pos);if(first_word.back()== 3
;exit(0);}elseif(registers.find(assembly_code[instruction_ 1
to_store_mem_loc|=(removed_data[2]<<(offset_size+index_size));to_store_mem_ 2
memory[0x50001];vector<int>memory(0x50001,0);//InitializethevalueofPCintPC;//Herewedeclareallvar 3
ex["1011"]='b';bin_ 1
}}//CodeforJformatinstructionsvoidexecute_J(vector<vector<strin 0
ction){stringrd,rs1,inst;inst=instruction[0];intimm;//Per 1
hex.size();i++){if(hex[i]=='0'){continue;}else{ 4
on_no+1<<endl<<"Incorrectvalueofrd";exit(0);}elseif(registers.find(assem 1
rs.find(assembly_code[instruction_no][2])==registers.end()){cout 4
ybytesstartingfrommemorylocationspecif 0
if(dec_imm<0||dec_imm>4294963200){cout<<"Errorinline: 2
sandtheirlastexecutedlineaccordinglystringtop_of_stack=stack_of_functions.top().first;inttop_line= 1
o_bin['e']="1110";hex_to_bin['f']="1111";stringbin="";for(inti=0;i<hex.size();i++){bin+= 3
otdirtynew_data[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++){new_data[k]=memory[j]; 3
Gettingthevalueofindexbitsofmemorylocationbeingrequestedbyprogramintinde 0
_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Exe 2
ntilwesee.text,wekeepstoringdataif(instruction==".data 0
oc;//Wenowhavetheinde 0
ize+offset_size);index 0
<(64-shifting_amount))-1;if(shifting_amount==0){for(inti=0;i<=63;i++){mask+=pow(2,i);}} 4
rst_word=executed_instruction.subst 0
1<<endl<<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_to_binary 1
seif(r=="t0"||r=="x5"){r="x5";}elseif(r=="t1"||r=="x6"){r="x6";}els 4
functions.pop();stack_of_functions.push({top_of_stack,top_line});strin 3
C="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<he 0
abled){stringhit_or_miss="Miss";stringclean_or_di 0
ite_access(mem_loc+i,byte[i],accessed_once);accessed_once=t 2
me);}//Converttheassemblycodetomachinecod 0
}signedmain(){//Initializea 1
r_instr[0]]=='R'){step_R(cur_instr);}elseif(for 3
ize;//Andthesemanyaretagbitsboolis_dirty=false;if(replacement_policy=="FIFO"){if(!to_re 1
val;new_data[1]=1;//Setthebittodirty}for(inti=0;i<associativit 1
hex_to_bin['5']="0101" 1
s[assembly 0
{r="x2";}elseif(r=="gp"||r=="x3"){r="x3" 2
);//characters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//Fun 3
_values[rs2]){PC=new_pc;}else 2
/Wedeletethebreakpointif(break_lines.find(break_poin 0
rs2];//Ourmaskissh 0
,Set:"<<hex 0
size+3);cache_b 0
"add"){register_va 0
y(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_P 2
e(bin.begin(),bin.end());if(!isSigned||!isNegative){returnbin;}//Take1'scomplementf 5
ache_size/(assoc 0
ck_of_functions.push({top_of_stack,top_line 0
ewant.Wecanproceedwithfindingtherealdat 0
s.find(assembly_code[instr 0
()-1]==')'){cur.pop_back();}cur_instruction.push_back(cur);}//Ifinwrongposition,bringth 4
<"fromupdatequeue"<<endl;}order_of_access[index]=q;}voidwrit 1
emory.size();i++){memory[i]=0;}for(inti=0;i<cache.size();i++){for(intj=0;j<cache[ 4
2,i);}}register_values[rd]=register_values[rd]&mask;}}elseif(inst=="sra"){register 3
<block_size;i++){memory[to_store_ 0
PC=imm+register_values[rs1];}//Ensurethatx0valuesremainsat0register_values["x0"]=0 2
he[index][random_number]=new_data;//Nowcheckiftheremoveddatahasadirtybits 2
[rs1]-register_values[rs2];}e 2
cimal_to_binary(stoi(assembly_code[instruction_no][3]),6,true);imm="000000"+i 4
=8){unordered_map<string,c 0
imal(binary_bytes[i]);//characte 2
nd()){break;//to_break= 1
stringbin_address=decimal_to_binary(mem_loc,20,0);st 1
k_policy=="WT"){memory[m 0
8+3);registers[temporary_register_no]=this_register;}}}//Definingal 1
ertheinstructionif(inst=="lb"||inst=="lh"||ins 0
][1]];stringimm=decimal 1
r"]="000";fun 0
)+rs2+rs1+f3+imm.substr(7)+opcode;stringhex_instruction=binary_to_h 1
ssembly_code[instruction_no][0]=="slli"){if(stoi(assembly_code[instruction_no 2
on_no+1<<endl<<"Incorrectsyntax 0
tasection,andsubtractthembreak_lines.insert(break_point-count_how_many_to_s 0
removeddatano?t 0
no][3])>=pow(2,6)){cout< 2
bstr(2,6)+rs2+rs1+f3+imm.substr(8,4)+imm.substr(1,1)+opcode;stringhex_instruction=bi 3
ine:"<<instruction_no+1<<endl<<"Incorrectvalue 0
ionfromtheright}}returndecimal;}//Definingallregistersvoidinitialize_registers(){for(inti=0;i 1
nt();dummy_q.pop();q.push(cur);}//Notethatheretagwillalwaysbeatthetopq.push(tag);}el 4
ntend_storage=(mem_loc/block_size)*block_size+(block_size-1);new_data[0]=1;//Thebitisnowval 3
ut_name.c_str(),"a")!=NULL){cach 1
//EnsurethatthePCvaluei 0
n_no][1])==registers.end()){cout<<"Errorinl 2
)==':'){executed_instruction=execut 0
hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0 3
/characters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4+i]=byt 1
y[mem_loc]=byte[0];memory[mem_loc+1]=byte[1];mem_loc+=2;}//Returnthenewmem_locwher 4
code[instruction_no][3]),13,true);//Con 2
ex[b]);}if(length*4>binary.size()){stringzeros="",fs="";for(inti=length*4;i<binary.size();i++){ 4
i"||inst=="srli"){//Extracttherd,rs1,immvaluesrd=aliasR 0
isters.find(assembly_code[instruction_no][2])==registers.end()){cout<<"Errori 4
nstack,bottomtotopcout<<dummy_sta 0
estedbyprogramintindex=index_mask&mem_loc;index>>=(offset_size);//Let'sgetthevalueofoffsetbitsint 1
_size<<endl;cout<<"Associativity:"<<associativity<<endl;cout<<"ReplacementPolicy:"<<repl 0
fset);}}}}else{memory[mem_loc]=val;}}intrea 2
size);offset_mask=offset_mask-1;//Wecannowg 0
for(inti=4;i<command.size();i++){if(!check_s 1
r_instr);}elseif(format[cur_instr[0]]=='I'){step_I(cur_in 3
n){intdecimal=0;intlength=bin.size();//Itera 1
llyassociativeif(associativity==0){//Thismeansthatthereisonly1index,everyon 1
eeptrackofhowmanylineswereusedfordatasegmentandthefirstlineoftext(.text)count_how_many_to_skip++;if( 1
ethestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=stack_of_f 0
[instruction_no][2][1]=='x'){stringbin_instr=hex_to_binary(a 3
ster;}elseif(i==1){registers["ra"]=this_register;}elseif(i==2){registers["sp"]=t 5
x4"){r="x4";}elseif(r== 1
<cache[i].size();j++) 2
<vector<int>>(associativity,vector<int>(block 3
=tag_mask-1;//Thismakesthemask20onesinttemp_mask 0
;j++){if(cache[i][j][0]==1&&cache[i][j][1]==1){intoffset_size=log2(block_size) 8
elseif(r=="t2"||r 0
ptrackofthenewpcvalueandextractthers1andrs2valuesintnew_pc=PC+stoi(instruction[3]);stringr 2
ninthematrixif(load_operands.find(cu 0
(cur);}if(to_store[0]==".dword"){data_base_address=store_dword(to_store,data_base_address);}e 5
l[PC]=cur;cur="";continue;}if(cur[cur.size() 2
tack,top_line});stringexecuted_instruction=all_instructions[PC/4 0
main(){//Initializealltherequiredfieldsinitialize 1
"";for(inti=0;i<hex.size();i++){if(hex[i]=='0'){continue;}else{trimmed_hex=he 4
7(){funct7 1
=break_lines.end()){cout<<"Executionstoppedatbreakpoint\n";}else{while(PC/4<no_of_i 1
popmainfromthestackif(PC/4== 0
ode;stringcache_output_name;//Infinitel 0
erd=aliasRemover(instruction[1 0
on,intmem_l 0
tion.size();i++){if(instruction[i]!=''&&instruction[i]!='('){cur.push_back(instru 4
nt64_tshifting_amount=register_values[rs2];if(shifting_amount!=0){register_values[rd] 3
s1";exit(0);}elseif(registers.find(assembly_ 1
+imm.substr(8,4)+imm.substr(1,1)+opcode;stringhex_instruction=binary_to_hex(instr); 3
ringf3=funct3[assembly_code[instruction_no][0]];stringrs1=registers[assembly_code[instruct 3
;//Updatethestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=stack_of_funct 0
//Gettingthevalueofindexbitsofmemorylocation 0
timm;//Performloadaspertheinstructionif(inst=="l 0
i<=31){stringtemporary_register_no="t";temporary_register_no+=to_string(i-28+3);register 1
checkiftheremoveddatahasa 0
nttop_line=stack_of_functions.top().second;top_line=old_PC/4+1;stack_of_functions.pop();stack 2
]){PC=new_pc;}else{PC+=4;}}elseif(inst=="bge 2
t,andifso,weneedtoupdatethememoryif(removed_data[1]==1){i 2
i<command.size();i++){if(!check_space){if(command[i]==''){c 4
e;stringhex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){bi 3
ruction_no);}elseif(format[assembly 0
nstruction_nostringhex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4);for(in 3
lse;//Wenowextr 0
ytes[i]);//characters67ofhex_instruction}for(inti=0;i<4;i++ 1
=4;register_values["x0"]=0;}//CodefortheIformatst 1
n_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Notingthevariouspartsoftheinstruction 1
==1&&cache[i][j][1]==1){intoffset_size=log2(block_si 3
sboolis_dirty=false;if(replacement_policy=="FIFO"){if(!to_replace){boolis_presen 2
){r="x13";}elseif(r=="a4"||r== 1
=="x24"){r="x24";}elseif(r=="s9"||r=="x25"){r="x25";}elseif(r=="s10 3
in_to_hex["0011"]='3';bin_to_hex["0100"]='4';bin_to_hex["0101"]='5';bin_to 3
estackoffunctionsstack_of_functions.pop();//UpdatethedestinationaddressandvalueofPCa 1
e_size/block_size;}intno_of_indexes=cache_size/(associativity*block_size);cache.clear();//Not 2
}}if(inst=="sd"){boolaccessed_once=false;vector<uint8_t>byte(8);for(inti=0;i<8;i++){byte[7-i]=store 4
int32_tres=(byte[ 0
nd('');stringfirst_word=ex 1
]=memory[j];}if(operation=="write" 1
rs[saved_register_no]=this_register;}e 1
trutionstringopcode="0110011";stringf3=funct3[assembly_code[instructi 0
mory[mem_loc]=byte[0];memory[mem_loc+1]= 3
of_functions.pop();}}}elseif(command=="regs"){//Prin 2
hisistoremove.scurrent_opened_file.pop_back 0
binary_bytes[i]);//characters67ofhex_instruction}for(inti=0;i<4;i++){memory[ 1
roceedwithfindingtherealdatainthatlocation//Ifwefindthisblo 0
t<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_ 1
evaluewhichisreplacedq.push(tag);//Pushthenewtagvaluevector<int>removed_data(cache[0] 3
on_no+1<<endl<<"Incorrectvalueofrs2";exit(0);}elseif(stoi(assembly_code[ 1
ry_to_hex(bin_PC);hex_PC="0x"+hex_PC;c 1
tack_of_functions.top().second;top_line=PC/4+1;stack_of_functions 1
_number]=new_data;//Nowcheckiftheremoveddatahasadir 0
{stringtemporary_register_no="t";temp 0
|=(removed_data[2]<<(offset_size+ 1
elseif(!command.find("break")){//W 2
(cache_enabled){if(fopen(cache_output_name.c_str(),"a")!=NULL){cache_output 4
ode="1101111";stringr 0
_data[3+i];}}}}if(replacement_policy=="LRU"){if(!to_replace){while(!q.empty()){intcur=q.front() 6
ythenblocksizeforthenumberofbytesi 0
mask=1;offset_mask=offset_mask<<(offset_size);offset_mask= 1
o_string(i-28+3);registers[t 1
(inst=="xor"){register_values[rd]=register_values[rs1]^register_values[rs2];}elseif(inst=="sl 5
nghex_tag="0x"+binary_to_hex(bin_tag,true,5);cache_output<<read_or_write<<":Address:" 1
nt<<endl;}else{cout<<"Nobreakpointspresent\n";}}elseif(!command.find("break")){//Wepar 2
hex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout< 1
]=='S'){step_S(cur_instr);}elseif(format[cur_instr[0]]=='B'){step_B(cur_instr);}elseif(format[cur_ 7
ines.insert(break_point-count_how_many_to 0
n_no);}elseif(format[ 0
es.end()){break;//to_brea 1
eif(command= 0
]="011";funct3["lbu"]="100";funct3["lhu"]="101";funct3["lw 2
_block=cache[index][i];//Valid,Di 2
ted_instruction.find('');stringfirst_word=ex 1
funct3;unordered_map<string,string>funct7;unordered_map<string,cha 1
ion_no);}else{cout<<"Erroronline:"<<instruction_no+1<<endl<<"Incorrectsyntax";exit(0);}}}elseif(co 1
//Take1'scomplementfor(inti=0;i<bin.size();i++){if(bin[i]=='0'){bin[i]='1';}else{bin[i]='0';}}// 8
n_no][2][1]=='x'){strin 2
oved_data(cache[0][ 1
='S'){execute_S(assembly_code,instruction_no);}elseif(format[assembly_c 2
nsvoidstep_U(vector<string>instruction){//Extracttherdandimmediatevaluesstringinst,rd;in 2
][0])!=load_operands.end()){opcode="0000011";}elseif(assembly_code[instruction_no][0]=="jalr"){opcod 6
ctor<int32_t>byte(4);boolaccessed_once=fals 2
ccess(start_location+1,true);uint16_tres=byte1<<8|byte0;register_v 1
nstrutionstringopcode="0110011";stringf3=funct3[assembly_code[instruction_no][0]];stringf7=fu 3
1]&imm;}elseif(inst=="slli"){register_values[rd]=register_valu 2
ssembly_code.assign(0,vect 0
o_hex["0000"]='0';bin_to_hex["0001"]='1';bin 2
t_policy,write_back_policy;boolcache_enabled=false;vector<vector<vector<int>>>cache;//Valid,dirty,t 3
[3+i];}}}}if(cache_enabled){stringhit_ 2
<<endl<<"Valueofimmediateisoutofr 0
ackoffunctionsandtheirlastexecutedlineaccordinglys 0
y_code,intinstruction 0
[i],accessed_once 1
tr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction 3
0);}elseif(registers.find(assembly_code[instruction_no][1])==registers.end()){cout<<"Errorinli 5
ck_size>>asso 0
,weneedtolookinthememoryif(!found) 1
i]=store_value>>(3-i)*8;}for(inti=0;i<4;i++){write_access(mem_loc+i,byte[i],accessed_o 2
p();stack_of_functions.push({top_of_stack,top_line});stringexecuted_instruction=all_instructions[ 3
data[3+i];}}}}if 1
t["lwu"]='I';format["jalr"]='I';//Sformatformat["sb"]='S';format["sh"]=' 4
2";exit(0);}elseif(stoi(assembly_code[instruction_no][3])<-pow(2,12)||stoi(assembly_code 5
=pow(2,i);}}register_v 1
f(format[cur_inst 0
ur_instr);}elseif(format[cur_instr[0]]=='U'){step_U(cur_ins 3
rs2,inst;intimm;inst=instruct 0
pened_file.pop_back();c 1
n_set=decimal_to_binary(i,20,0);stringhex_set="0x"+bin 1
bltu"]='B';format["bgeu"]='B';//Jformatformat["jal"]='J';//Uforma 2
ers67ofhex_instruction}for(inti=0;i<4;i++){mem 0
oroffsetintindex_size=log2(cache_size/(associativity*block_siz 0
ress,false,5);stringbin_set=decimal_to_binary(index,20,0);stringhex_set="0x"+binary 1
ntrandom_number=rand()%associativity;vector<int>removed_data(cache[0][0].size());vector< 6
herequireddword/word/byte/halfwordvector<string>to_store;stringcur="";for(char 1
_loc/block_size)*block_size;int 0
S'||cur_instruction[0]=="jalr"){swap(cur_instruction[2],cur_instruction[3]);}assembly_code.push_ 5
_binary(dec_imm,20,true);//Concatina 1
vity==0){//Thismeansthatthereison 0
{stringregister_no="x";register_no+=to_string(i);stringthis_regis 1
{top_of_stack,top_line});st 1
ary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"E 1
e[0];memory[mem_loc+1]=byte[1];mem_loc+=2;}//Returnthenewmem_l 3
in['c']="1100";hex_to_bin['d']="1101";hex_to_bin['e']="1110";hex_to_bin['f']= 4
lse,false,val,offset);}}}}else{memory[mem_loc]=val;}}intread_access(intmem_loc,boolaccessed_once) 3
Iformatinstructionsvoidexecute_I(vector<vector<string>>&assembly_code,intinstruction_no){//Handli 3
bly_code[in 0
of_stack,top_line});stack_of_functions.push({offset_to_label[PC],-1 1
(r=="a2"||r=="x12"){r="x12";}elseif(r=="a3"||r=="x13"){r="x13";}elseif(r=="a4"| 4
config_file.cl 0
ster_bin=decim 0
000;//Loadthenextfileintoaqueueofstrings,suchthatafterexecutionofeachrun,wecandequeuethetopstri 0
<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutof 0
mat[cur_instr[0]]= 2
d_storage=(mem_loc/block_size)*block_size+(block_size-1);new_data[0]=1;//Thebitisnowval 3
e[instruction_no].si 1
>cache_block(block_size+3);cache_block=cac 1
his_register+=num2;this_register+=num1; 0
fileinitia 0
1";hex_to_bin['c']="1100";hex_to 1
emoryif(removed_data[1]==1){is_dirty=true;intto_store_mem_loc=0;//Hereth\etagandindexsho 2
<is_clean<<endl;}}}m 0
i=0;i<hex.size();i++){if(hex[i]=='0'){continue;}else{trimmed_hex=hex.substr(i);returntrimmed_hex 5
code[instruction_no][2])==registers.end()){cout<<"Erro 3
[2]);stringinst=instruction[0];//KeeptrackofoldPCifbranchnot 2
>>dummy_stack_function=stack_of_functions;while(! 0
struction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_dec 3
ommand.substr(10));//Wedeletethebreakpointif(b 1
tack_of_functions;unordere 0
PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//Up 0
c]=byte;}if(inst=="sh"){vector<uint8_t>byte(2);byt 3
t=="lb"||inst=="lh"||inst=="lw"||inst=="ld"||inst=="lbu"||ins 0
x_instruction=binary_to_hex(instr);vector<string>binary_bytes(4);for 3
ssembly_code[instruction_no][3]),6,true);imm="01000 2
"a7"||r=="x17"){r=" 0
srequestingtoreadintta 0
]=register_values[rs1]<<regist 1
oneisfightingforthisoneindexassociativit 0
dump")){stri 0
ction[i]!=' 1
for(inti=0;i<4;i++){memory[instruction_no* 0
nsurethatallthebocksarewrittenifdirtyfor(inti=0; 0
nsurethatthex0valueremainsat0r 0
usingnamespacestd;//Declar 0
eif(associativity==0){//Thismeansthat 1
;}elseif(inst=="or 0
="0x"+binary_to_hex(bin_tag,tr 0
nt>labels;unordered_map<string,int64_t>register_values;unordered_map<stri 1
ge;j++,k++){cache_block[k]=memory[j];}f 3
tructionsvoidexecute_B(vector<vector<string>>&assembly_code,intinstruction_no){//Handlinge 3
g>binary_bytes(4);for(inti=0;i< 1
ask^temp_mask;//Makestheposi 0
k;returnval;}}//Ifwewerenotabletofindanyinv 0
;//Makethevalidbi 0
truction=executed_instruction.substr(pos+1);}string 1
instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Notingthevari 1
nary_to_he 0
code[instruction_no][3]),12,true);}//Concatinatingthevaluesstringinstr=imm+rs1+f3+rd+opcode 2
suretoremovethecalledfunctionfromthestackoffunctionsstack_of_ 0
ters[saved_register_no]=this_register;}elseif(i>=28&&i<=31){stringtemporary_regis 1
ion.size();i++){if(trim&&instruction[i]==''){continue;}e 4
(inst=="sd"){boolaccessed_once=false;vector<uint8_t>byte(8);for(inti=0;i<8;i++){byte[7-i]=st 4
se,mem_loc,"write",false,false,val);cache[index][i]=cache_block;return;}}// 2
_to_hex(instr);vector<string>binary_bytes(4);for(in 3
B';format["bne"]='B';format[" 1
l_to_binary(old_PC,32,0);stringhex 1
<executed_instruction<<";PC="<<hex_PC<<endl; 0
c;index>>=(offset_size);//Let'sgetthevalueofoffsetbitsintoffset=offset_mask&mem_loc;//Wenowhavethe 1
deforJformatinstructionsvoidexecute_J(vector<vector<string>>&asse 2
hm>#include<cstdlib>#include<math.h>#include<sstream>#include<stack>#include<queue 4
m>#include<cstdlib>#include<math.h>#include<sstrea 2
sthattheuserhasspecifiedandstorethemstartin 0
for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_byte 1
einstructionisdata,thenensurethatuntilwesee.text,wekeepstoringdataif(instruction==".data"){da 1
//Extractrd,rs1,rs2stringinst=instruction[0];stringrd=aliasRem 1
tring>load_operands;uno 0
_invalid=true;update_queue(index,tag,false,mem_loc,"write",false,false,val);cache[index][ 2
c_imm;//Weacceptbothdecimalandhexadecimalvaluesif(assembly_code[instr 0
=executed_instruction.find('');stringf 1
if(r=="t3"||r=="x28"){r="x28";}elseif(r=="t4"|| 2
ofindexbitsandoffsetbitszero//Letusdothesameforind 0
";funct3["lhu"]="101" 1
xor"]="100";funct3["sll"]="001";funct3["srl"]="101";funct3["sra"]="101";funct3["addi"]="000";fun 4
ister_values[rs1],val_rs2=register_values[rs2];if(val_rs1<val_rs2){ 2
wu"){vector<uint32_t>byte(4);boolaccessed_once=false;for(inti=0;i<4;i++){byte[i]=re 3
nthematrixif(load_operands.find(cur_instruction[0])!=load_operands.end( 2
eif(write_back_policy=="WT"){memory[mem_loc]=va 2
epositionsofoffseybitszero//Weneedtodothisfortheoffsetaswell,be 0
theuserisspecifyingthe.dataor.textfieldbooldata=false;stringdata_type 0
nct7["sub"]="0100000";funct7["and"]="0000000";funct7["or"] 3
lue;byte[1]=store_value>>8;memory[mem_loc]=byte[0];memory[mem_loc+1]=byte[1];mem_loc+=2;}// 5
t>q=order_of_access[index];queue<int>dummy_q;intoffset_size=log2(block_size);//Thesemanybit 3
o_skip++;continue;}if(d 0
i%10+'0';dummyi/=10;charnum2=dummyi%10+'0';this_register+=num2;this_register+=num1;}intvalue 0
theentirecodetillthebreakpointintno_of_instruction=assembly_code.size();boolto_break= 1
n_no+1<<endl<<"Incorrectvalueofrs1";ex 0
ction=trimmed_instr;//Gothroughthecurr 0
ystringtop_of_stack=stack_o 0
on_no][1]];stringrs2=re 1
);//Getthetagwhichweneedtoreplaceq.pop();/ 1
egister_value 0
ted_instruction=all_instruc 0
ak;}}//Nowcheckiftheremoveddatahasadirtybitset,andifso,weneedtoupdatethememoryif 0
1]^register_values[rs2];}elseif(inst=="sll"){register_values[rd]=register_ 3
oolcheck_space=false;//Wenowextractthevalueofaddrandcountbyparsingthelinefor(inti=4;i<command.si 0
rindexmakintindex_mask=1;index_mask=index_mask<<(index_size+offset_size);index_mask=index_mask-1 1
_size);//Thesemanybitsareforoff 0
yte[i];}}//CodeforJformatinstructionsvoidexecute_J(vector<vector<string>>&assembly_code,in 3
age=(mem_loc/block_size)*block_size;intend_storage=(mem_loc/b 1
R';format["sub"]='R';format[" 1
ssigningtheimmediatealongwithcheckingifitiswithinrangeif(assembly_code[instructio 0
tag,true,5);myfile_out<<"Set:"<<hex_set<<",Tag:"<<hex_tag<<","<<is_cl 0
ock_size;i++){memory[to_store_mem_loc+i]=removed_data[3+i];}}}}if(replace 3
<<hex_PC<<endl;//UpdatePCvaluePC+=4;}elseif(inst==" 0
re_word(vector<string>instruction,intmem_loc){//Gothroughallthevaluesthattheuserhasspecified 2
che.size();i++){fo 1
gsvector<string>cur_instruction;all_inst 1
_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Exec 2
outofrange";exit(0);}imm=decimal_to_binary(stoi(assembly_code[instr 1
al;cache[index][i][1]=0;//Setittonon-dirty}//Sincethisahit,weneed 3
cimalvaluesif(assembly_code[instruction_no][2][1]=='x'){stringbin_instr=hex_to_binary(assembly_c 4
ter_values[rs2];//Ourmaskisshifting_amount0'sfollowedby64-shifting_amount1'suint64_t 1
e<<endl;cout<<"Associativity:"<<associativity<<e 0
;}if(labels.find(assembly_code[instruction_no][2])==labels.end()){cout<<"Errorinline:"<<ins 5
offsetbitszero//Letu 0
dex_mask<<(index_size+offset_size);index_mask=index_mask-1;temp_mask=1;temp_m 1
y_code[instruction_no][2])==registers.end()){cout<<"Er 3
mask=offset_mask<<(offset_size);offset_mask=offset_mask-1;//Wecannowgettheactualvalueo 1
nary(stringhex){unordered_map<char,string>hex_to_bin;hex_to 2
[2]==top_tag){removed_data=cache[index][i];cache[inde 3
nstruction[3]);//Weassumethatrs1alwaysstoresaddressesinformofin 1
eremovetheleading0xi 0
;bin_to_hex["0110"]='6';bin_to 1
CallStack:\n";//Weuseadummystacktopopthelabelsfromthemainstackandprintthefortheuservector<pair<st 0
im=false,intlength=8){unordered_map<string,char>bin_to_hex;bin_to_hex 1
strings_count="";//Countofthenu 0
ionhastoreturnonly1byteintoffset_mask=1;offset_mask=offset_mask<<(of 0
0;i<associativity;i++){if(cache[index][i][2]==top_tag){removed_data=cache[index][i];cache[inde 6
funct7();initialize_format();initialize_load_operands();initialize();ifstreaminstructi 4
lwesee.text,wekeepstoringdataif(instruction==".data"){data=true;count_how_many_to_skip++; 1
nstr=imm+rd+opcode;stringhex_instruction=binary_to_he 0
+(block_size-1);new_data[0]=1;//Thebitisnowvalidnew_data[1] 3
s1]^imm;}elseif(inst=="ori"){register_values[rd]=register_valu 2
cond;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,top_line 1
_locfor(inti= 0
n=all_instructions[PC/4];intpos=executed_instruction.find('');stringfirst 2
=stack_of_functions.top().first;inttop_line=stack_o 1
01";funct3["lwu" 0
ag=tag_mask&mem_loc;tag>>=(index_size+offset_size);//Gettin 1
am>#include<unordered_map>#include<unordered_set>#include<vector># 3
Storethenewpcvaluetojumptointnew_pc=PC+stoi(instruction[2] 1
push_back(dummy_stack_function.top());dummy_sta 2
nwritetonextreturnmem_loc;} 0
struction[i]);vector<uint8_t>byt 2
if(cache_enabled){boolis_hit=false;//Letusfirstfigureouthowour20bitsofmemoryaddres 1
//Ensurethatx0valuesremainsat0register_values["x0"]=0;}//CodefortheSformatstepinstructi 1
close();}cache_output_name=current_opened_file+".output";cache_output.open(cache_out 1
values[rs1]|imm;}elseif(inst=="andi"){register_values[rd]=register_values[rs1]&imm;}elseif 5
tcur=dummy_q.front();dummy_q.pop();q.push( 2
values[rs1]|regis 1
at["sub"]='R';format["xor"]='R';format["or"]='R';format["and"]='R'; 4
emoved_data=cache[index][random_number]; 2
nge";exit(0);}//Notingthevariousp 1
correspondinginstructionif(load_operands.find(assembly_code[instruction_no][0])!=load_operands.e 3
="sb"){uint8_tbyte=store_value;write_acces 0
register_values["x0"]=0;}//CodeforRformatinstructionsvoidexecute_R(vector< 1
;}//Updatethesta 0
herequiredfieldsinitialize_registers();initialize_f 1
ndingtherealdatainthatlocation//Ifwefindthisblockinthecache,wereadonlythisparticular 0
=to_string(i);stringthis_register= 1
PC<<endl;//UpdatethePCvalueandensurethatx0willalwaysremainatvalueof0PC+=4;registe 0
ssociativity=0,thenweneedtomakeitfullyassociativeif(associativity==0){//Thismean 1
k;}}//Nowcheckiftheremoveddatahasadirtybitset,andifso,weneedtoupdatethememoryif(removed_data[1]==1){ 2
rd]=res;}elseif 0
();i++){if(hex[i]=='0'){continue;} 4
ruction_no][2])<-1*pow(2,20)||stoi(assembly_code[in 2
(bin_set,true,5);stringbin_tag=decimal_to_binary(t 1
alueswhicharestoredinthemapcout<<"Reg 0
!to_replace){//Donothing}else{in 1
nstruction_no){//Handlingerrorif( 0
f(cur!=tag){dummy_q.push(cur);}}while(!dummy_q.empty()){intcu 5
o_store,data_base_address);}}continue;}//removeunnecessar 0
seif(r=="s7"||r=="x23"){r="x23";}elseif(r=="s8 2
ngbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex 1
n=all_instructions[PC/4];intpos=executed_instruction.find('');stringfirst_word=executed_inst 2
nt!=0){register_values[rd]=register_values[rs1]>>register_values[rs2];//Ourmas 3
alues[rd]=res;rd=res;}elseif(inst=="lh"){int16_tbyte0=read_access(start_loca 2
x_size);to_store_mem_loc|=(index<<offset_size);for(inti=0;i<block_size;i++) 0
vity,vector<int>(block_size+3,0)));//Initiallyeverythingisinvalid,ando 2
orrectvalueofrd";exit(0);}elseif(registers.find(assembly_cod 1
t<<"Set:"<<hex_set<<",Tag:"<<hex_tag<<","<< 0
2])==registers.e 0
ffset_size);//Let'sgetthevalueofoffsetbitsintoffset=offset_mask&mem_loc;//W 0
irstlineoftext(.text)count_how_many_to_skip++;if(instruction==".text"){data=false;}else 3
seif(format[assembly_code[instruction_no] 1
t3["sub"]="000";funct3["and"]="111";funct3["or"]="110";funct3["xor"]="100";funct3["sll"]="001";f 5
if(instructi 0
ite"){new_data[3+offset]=val;new_data[1]=1;//Setthebittodirty}for(inti=0 3
rn"0";}returnhex;}//Cod 0
ffset_size) 0
ruction_no][2]);}if(dec_imm<0||dec_imm>4294963200){cout<<"Errorinline:"<<instruction_no+1 3
cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forBtypeformat,youmus 0
=')'){cur.pop_b 0
de;stringhex_instruction=binary_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){ 3
{cout<<"EmptyCallStack:Executioncomplete\n";}}else 0
isfightingforthisoneindexassociativity=cache_size/block_size;}intno_of_indexes=ca 0
s.insert("ld");load_oper 1
remove.scurrent_opened_file.pop_back();current_opened_file.p 1
k;register_val 0
ask-1;tag_mask=tag_mask^temp_mask;//Makesthepos 0
d_invalid=false;for(inti=0;i<associativity;i++){vector<in 0
ck[2]==tag){if(!accessed_once){hits++;}found=true;cache[index][i][3+off 5
int8_tbyte[4];for(inti=0;i<4;i++){byte[ 1
nginst=instruction[0];//Keeptracko 1
mem_loc|=(index<<offset_size);for(inti=0;i<block_size;i++){memory[to_store_mem_loc+i]=removed_data[ 1
ssembly_code[instruction_no][ 1
index_size=log2(cache_size/(associativity 0
er="x";if(i<10){c 0
ve;if(PC/4==no_of_instruction){cout<<"Nothingtostep\n";}elseif(break_lines.find(PC/4 1
uesrd=aliasRemover(instr 0
ofoffseybitsz 0
ummy_q.push(c 0
if(cur!=""){to_store.push_back(cur);}cur="" 3
nstruction.substr(0,pos);if(first_word.bac 1
struction_no][2])==labels.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Labelnotd 2
ze);//Let'sgetthevalueofoffsetbitsintoffset=offset_mask&mem_loc; 0
ti=0;i<block_size;i++){memory[to_s 0
_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Inc 2
ne:"<<instruction_no+1<<endl<<"Wrongsyntax,forJtypeformat,youmustenter3operands"<<endl;exit 0
ster_values[rs1 0
tions.pop();}}}elseif(command=="step"){//Gostepbystepintno_of_instruction=assembly_cod 2
0,1)+imm.substr(2,6)+rs2+rs1+f3+imm.subst 1
position,bringtheoperandsbacktothecorrectpositioninthematrixif(lo 0
lse{while(PC/4<no_of_instruction){if(break_lines.find(PC/4+1)!=break_lin 1
eareonlydealingwithcacheandnotqueueif(!to_replace){//Donothing}else{intrandom_num 2
hex="";for(inti=0;i<bina 0
//Notethatthesizeifblocksize+3because,1forvalid,1fortag,1fordirtythenblocksizeforthenumberofbytesi 0
s1andrs2valuesintnew_pc=PC+stoi(instruction[3]);stringrs1=aliasRemover(instruction[1]); 4
_mask=1;temp_mask=temp_mask<<offset_s 0
ioninthematrixif(load_op 0
stoi(instruction[3]);//Weassumethatrs1alwaysstoresaddressesinformofintegerint 2
on[3]);rs1=aliasRemover(instruction[2]);intmem_loc=imm+register_va 3
32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed 1
firstploicyintstart_storage 0
itionsatisfiedasp 0
"sll"]="0000000";funct7["srl"]="0000000 1
'R';format["and"]='R';format["sll"]='R';format["srl"]='R';format["sra"]='R';//Iformatforma 4
00";funct3["lhu"]="101";fu 1
houldbeoftheremoveddatano?to_store_mem_loc|=(removed_data[2]<<(offset_si 1
gister_no+=to_string(i-5);registers[temp 1
uction.size();i++){uint64_tstore_value=stoi(instructi 1
ckiftheremoveddatahasadirtybitset,andifso,weneedtoupdatethememoryif(removed_data[1]==1) 2
e.c_str(),"a")!=NULL){cache_output.close();}cache_o 3
ex_size));to_store_mem_loc|=( 0
];stringrd=aliasRemover(instruction[1]);stringrs1=aliasRemover( 2
and[i]);}}else 1
ore_mem_loc 0
inst=="lb"){int8_tbyte=r 0
t="0x"+binary_to_hex(bin_set,true,5);stringbin_tag=decimal_to_binary(cache[i][j][2],20,0);stringhe 5
;PC="<<hex_PC<<endl;//Ensurethatthex0valueremainsat0regis 0
ctiontostorewordintstor 0
63;i++){mas 0
="x6"){r="x6";}elseif(r 1
nghex="";for(inti=0;i<binary.size();i+=4){st 1
ticalwordfirstploicyintstart_storage=(mem_loc/block_size)*block_size;intend 1
ockfromthememoryboolfound=fal 0
ex][i];//Valid,Dirty,tag,dataif(cache_block[0]==0){//Thisisan 3
szero//Letusdothesameforindexmakintindex_mask=1;index_ 0
_line});stringexecuted_instruction=all_instructions[PC/ 0
ction.substr(0,pos) 1
acceptbothdecimalandhexadecimalvaluesif(instruc 0
registers.find 0
tingthevariouspartsoftheinstructionstringop 0
nstruction,intmem_loc){//Gothroughallthevaluesthattheuserhasspecifiedan 0
size+index_size));to_store_mem_loc|=(i<<offset_size);for(inti=0;i<bloc 0
x6";}elseif(r=="t2"||r=="x7"){r="x7";}elseif(r=="s0"||r=="fp"||r=="x8"){r="x8";}el 4
ed_instruction.substr(0,pos);if(first_word.back()==':'){executed_instruction=e 3
ly_code[ins 0
;}stack_of_functions.push({"main",0} 1
nesthatareoccupiedbythedatasection,andsubtractthembreak_lines.insert(break_point-count_how_ma 0
yfile_out.close();}elseif(command=="cache_simstats"){if(cache_enabled){cout 3
sthepositionsofoffseybitszero//Weneedtodothisfortheoffsetaswell,because,ultimatelythisfunctionhasto 0
ak_lines.end()){cout<<"Executionstoppedatbreakpoint\n";}else{while(PC/4<no_of_instruction){i 1
t=instruction[0];if(inst=="jal"){regist 2
)){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs1";exit(0);}s 1
ata[2]=tag;for(intj=start_storage,k=3;j<=end_storage 1
mediaterd=aliasRemover(instruction[1]);rs1=aliasRemover(i 2
//CodeforJformatinstructionsvoidexecute_J(vector<vector<string>>&assembly_code,intinst 2
eif(i==8){registers["s0"]=this_register;registers["fp"]=this_register;}elseif(i==9){regi 5
nfiniteloopthatreadsuserinputswhile(true){//Nowsavethenextfilestringcommand;getline(cin,command);i 2
t;//Declarethevariousmapswhichwillstorethenecessaryinformationu 0
luevector<int>removed 1
tringhex_to_binary(stringhex){unordered_map<char,string>hex_to_bin;hex_to_bin['0']="0000"; 3
current_opened_file.po 0
ad_access(start_location,false);int16_tbyte1=read_access(start_location+1,true);int16_tre 2
ues[rs1]>=register_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="bgeu"){uint6 5
"){//Gostepbystepintno_of_in 0
tringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instructi 1
tag,20,0);stringhex_tag="0x"+binary_to_hex(bin_tag,true,5);cache_output<<read_or_write<<":Add 1
al=-1,intoffset=-1){queue<int>q=order_of_access[index];queue<int>dummy_q;intoffset_size=log2(bloc 3
ck_policy=="WT"){memory[mem_loc]=val;c 1
er_values[rs2] 1
xit(0);}//Notingthevaiouspartsof 1
00";funct7["sll"] 1
_to_binary(mem_val,8,0);stringhex_mem_val="0x"+binary_to_hex(bin_mem_val,true,2);in 2
ode[instruction_no][2]];stringrs2=registers[assembl 2
e[0]==".dword"){data_base_address=store_dword(to_store,data_base_address);}else 3
){//Rformatformat["add"]='R';format["sub"]='R';format["xor"]='R';format["or"]='R';forma 4
,true,mem_loc,"write",false,false,val,offset);}}}}else{memory[mem_loc]=val;} 2
;i++){if(hex[i]=='0'){continue;}else{trimmed_hex=hex.substr(i);returntrimmed_hex;}}re 6
cur_instr) 0
nds(){load_operands.insert("lb");load_operands.insert("lh");load_operands.insert("lw");load_oper 4
eif(r=="a1"||r=="x11"){r="x11";}elseif(r=="a2"||r=="x12"){r="x12" 3
lb"||inst=="lh"||inst=="lw"||i 0
_size);offset_mask=offset_mask-1;//Wecannowgettheactua 0
nstruction_no+1<<endl<<"Incorrectsyntax";exit(0);}}}elseif(command=="run") 2
licy<<endl;cout<<"W 0
unct3["bgeu"]="111";}//Defini 1
){register_values[rd]=register_values[rs1]<<imm;}elseif(inst=="srli"){uint32_tshift 3
alueofPCacco 0
sed_once){misses++;}//Firstcheckifwehaveaninvalidfr 1
ile_name=command.substr(17 0
_no][3]];//Concatinating 1
s0"||r=="fp"||r=="x8"){r="x8";}elseif(r=="s1"||r=="x9"){r="x9";}elseif(r=="a0"||r=="x 3
nst=="addi"){register_values[ 0
vector<int>>>cache;//Valid, 1
ainfromthestackif(PC/4==no_of_instruction){stack_of_functions.pop();}}}elseif(command=="reg 3
instructionif(inst=="beq"){if(register_values[rs1]==register_values[rs2]){PC=new_pc;}else 5
Iftheassociativity=0,thenweneedtomakeitfullyassociativeif(associativity==0){//Thismeanst 1
e[7-i]=store_value>>(7-i)*8;}for(inti=0;i<8;i++){write_access(mem_loc+i,byte[i], 3
how-stack"){//Hereweexecutetheshow-stackcommandcout<<"CallStack:\n";//Weusead 0
servector<pair<string,int>>dummy_stack;stack<pair<string,int 2
intrandom_number=rand()%associativity;vector< 1
(mem_loc,20,0);stringhex 1
+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC 1
1]];stringimm=decimal_to_binary( 0
ed_line.clear();break_lines.clear();count 2
forJtypeformat,youmustenter3operands"<<endl;exit(0);}if(labels.find(assembly_code[instru 1
ata[0]=1;//Thebitisnowvalidn 1
"ra"]=this_register;}elseif(i==2){r 1
dPCifbranc 0
ds.insert("lh");load_operands.insert("lw");load_operands.insert("ld");load_op 3
inti=0;i<4;i++){byt 0
on_no][0]];stringrs1=registers[assembly_code[instruction_no][2]] 4
]=register_values[rs1]|imm;}elseif(inst=="andi"){register_values[rd]=register_values[rs1 3
ctions.top().se 1
bled=false;v 0
e;}if(inst=="sh"){vector<uint8_t>byte 2
&&cache[i][j][1]==1 3
gtogetthelinenumberwherewehavetoinsertabreakpoin 0
tivity;stringrepl 0
tintindex_size=log 0
ngrequestedbyprogramintindex=index_m 0
hile(getline(instruction_file,instruction)){//Iftheinstructionisdata,thenensur 2
+imm;}elseif(assembly_code[instruction_no][0]=="srai"){if(s 3
em_loc=0;//Hereth\etagandindexshouldbeoftheremoveddatano?to_store_mem_loc|=(removed_data[2]<<( 1
instruction_no][3]),12,true);}//Concatinatingthevaluesstringinstr=imm+rs1+f3+rd 1
k=3;j<=end_storage;j++,k++){cache_block[k]=memory[j];}cache_block[3+offset]=val;cache_block[ 4
);imm="000000"+imm;}elseif(assembly_code[instruction_no][0]=="srai"){if( 3
thetopq.push(tag);}else{inttop_tag=q.front();//Getthetagwhich 2
_s_addr=hex_to_binary(s_addr); 1
i=0;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//CodeforJformatinstruction 3
tput";cache_output.open(cache_output_ 0
="t1"||r=="x6"){r="x6";}elseif(r=="t2"||r=="x7"){r="x7";}elseif(r=="s0"||r=="fp"||r=="x8") 4
lues[rd]=register_values[rs1]>>imm;}//Updatethestackoffun 2
old_PC/4]; 0
rif(assembly_code[instruction_no].size()!=3){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongs 3
ion){cout<<"Nothingtostep\n";}else{vector<string>cur_instr=assembly_code[PC/4];if(format[cur_ 2
utionstringopcode="0110011";stringf3=funct3[assembly_code[instruction_no][ 1
nt_how_many_to_skip);cout<<"Deletedbreakpointatline:"<<break_point<<endl;} 0
nt64_t>register_values;unordered_map<string,string>registers_alis 1
,true,mem_loc,"read",true,false);returnval;}}}else{returnmemory[mem 0
){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forBtypeformat,youmus 0
+1<<endl<<"Valueofimmediateisoutofrange" 0
loc]=val;//Getthevalueandt 0
reoccupiedbythedatasection,andsubtractthembreak_lines.insert(break_point-coun 0
ghex_PC=binary_to_hex(bin 0
{new_data[k]=memory[j];}if(operation=="write"){new_data[3+offset]=val;new_data[1]= 6
nd;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,top_line});strin 3
glystringtop_of_stack=stack_of_functions.top().first;inttop_ 1
ntstore_word(vector<string>instruction,intmem_loc) 2
ache_block;return;}}//Ifwewerenotabletofindanyinvalidblock,we 0
'I';//Sformatformat["sb"]='S';format["sh"] 2
ta[2]=tag;for(intj=start_storage,k=3 1
sRemover(i 0
onsvoidexecute_U(vector<vector<string>>&assem 2
iningallregistersvoidinitialize_registers(){for(inti=0;i<=31;i++){stringregister_no="x"; 1
line:"<<instruction_no+1<<endl<<"Wrongsyntax,forRtypeformat,youmustenter4operands"<<endl 0
load")){//Firstresetalltheregiste 0
<"Incorrectvalueofrs2";exit(0);}//Noti 1
atethemaskrequiredtofindoutthetagbitslaterintta 0
tp"]=this_register;}elseif(i>=5&&i<=7){stringtemporary_register_no="t";tempora 0
lueandthenstoretheremainingwords,critical 0
taddr=binary_to_decimal 0
.clear();while 1
/Popthevaluewhichisreplacedq.push(tag);//Pushthenewtagvaluevector<int>remov 2
{memory[instruction_no*4+i]=byte[i];}}//CodeforUformatinstructionsvoidexecute_U(vector<vector<str 3
<endl;cout<<"BlockSize 0
te[i]=binary_to_decimal(binary_bytes[i]);//charac 3
y(s_addr);inta 1
ecimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;co 2
";stringread_or_write="W";if(is_hit){hit_or_miss="Hit";}if(is_dirty){clean_or_dirty="Dirty 3
(break_lines.find(PC/4+1)!=br 1
]="0000000";funct7["or"]="0000000";funct7["xor"]="0000000";funct7["sll"]="0000000";funct7["srl"]=" 4
lystringtop_of_stack=stack_of_functions.top().fi 1
assembly_code[instruction_no][0]];stringrd=registers[assembly_cod 2
ex][i];cache[index][i]=new_data;break;}}/ 3
name);}//Converttheassemblycodetomachinecodehexadecimalandst 0
top_of_stack,top_line} 0
he_enabled= 0
voidinitialize_registers(){for(inti=0;i<=31;i++){strin 1
re_value;byte[1]=store_value>>8;write_access(mem_loc,byte[0],false);write_access(me 3
PC<<endl;//Update 0
]="101";funct3["lwu"]="110";funct3["jalr"]="000";funct3[ 2
,weneedtoupdatetheorderofaccessvectorupdate_queue(index,tag,false,mem_loc,"write",fal 0
struction_no][2])==registers.end()){cout 2
matstepinstructionsvoidstep_ 0
ingsaved_register_no="s";saved_register_no+=to_string(i-18+2);regist 1
(inst=="sra"){register_values[rd]=register_values 2
alues["x0"]=0;}//CodefortheIformatstepinstructionsvoidstep_I(vector<string>instruction){string 3
value_of_register_hex=binary_to_hex(value_of_register_bin,true,16);cout<<this_ 1
size();i++){for(intj=0;j<cache[i].size();j++){if(cache[i][j][0]==1&&cache[i 6
<"Associativity 0
2_tres=(byte[3]<<24)|(byte[2]<<16 2
}elseif(!command.find("cache_simdump")){stringmyfile_ 2
=byte[3]<<24|byte[2]<<16|byte[1]<<8|byte[0];register_values[rd] 5
c,boolaccessed_once){if(cache_enabled){boolis_hit=false;//Letusfirs 1
ringcur="";fo 0
||stoi(assembly_code[instruction_no][2])>=pow(2,20)-1){cout<<"Errorinline:"<<instru 4
attheuserhasspecifiedandstorethemstar 0
false;for(inti=0;i< 0
edq.push(tag);//Pushthenewtagvaluevector<in 1
if(i>=10&&i<=17){stringargument_register_no="a";argument_regist 0
ly_code[instruction_no][2]];stringimm;//Assign 2
tructionstringinstr=f7+rs2+rs1+f3+rd+opcode;//Nowletuswriteintothetextsegmentofthe 0
ruction_file;vector<vector<string>>as 2
loc+i,byte[i],accessed_once);accessed_onc 1
d_instruction<<";PC="<<hex_PC<<endl;//UpdatePCvaluePC 0
t>cache_block(block_size+3);cache_block=cache[index][i];//Vali 3
);}if(length*4>binary.size()){stringzeros 2
ions.push({top_of_stack,top_line});stringexecuted_instruction=all_instructions[PC/4];intp 3
truction[2].substr(2));intdecimal=binary_to_decimal(bin_ 2
,12,true);//Concatinatingthevariouspartsstringinstr=imm.substr(0,7)+rs2+rs1+f3+imm. 1
R";}stringbin_address=decimal_to_binary(mem_loc,20,0);stringhex_address=" 1
nordered_set<string>load_operands;unordered_map<strin 1
"Wrongsyntax,forStyp 0
ybitszero//Weneedtodothisfortheoffsetaswell,because,ultimatelythi 0
gthevaiourspartsoftheinstrutionstringf3=funct3[ 0
".data"){data=true;count_how_many_to_skip++;continue;}if(data||(instruction==".text")){/ 3
or(inti=0;i<block_size;i++){mem 0
embly_code,instruction_no);}elseif(format[assembly_code[instruction_no][0]]=='J'){execute_J(asse 4
nsert(break_point-count_how_many_to_skip);cout<<"Insertedbreakpointatline:"<<br 1
atingthevariouspartsstringinstr=imm.subst 0
krequiredtofindoutthetagbitslaterinttag_mask=1;tag 0
ruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Notingthevaiousp 1
intpos=executed_instruction. 0
18";}elseif(r=="s3"||r=="x19"){r="x19";}elseif(r=="s4" 2
C=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC= 2
no][3])==registers.en 1
=cache_size/block_size;}intno_of_indexes=cache_size/( 0
instruction_no] 0
f_functions.top().first;inttop_line=stack_of_functions.top().seco 2
fset);}}}}else{memory[mem_loc]=val;}}intread_access(intmem_lo 2
block(block_size+3);cache_block=cache[index][i];//Valid,Dirty,tag,datai 3
bly_code[instruction_no].size() 2
sembly_code[instruction_no][3]),6,true);imm="010000"+imm;}else{if 2
<misses<<",HitRate="<<fixed<<setprecision(3)<<(double)(hits)/(hits+misses);}stack_of_function 4
_load_operands(){load_operands.insert("lb");load_operands.insert("lh");lo 3
w(2,11)||stoi(assembly_code[instruction_no][3])>=pow(2,11)){cout<<"Errorinline:"<<instruction_no+1<< 5
irtyfor(inti=0;i<cache.size();i++){for(intj=0;j<cache[i].size();j++){cache[i][j][ 5
srai"]='I';format["ld"]='I';format["lw"]='I';format["lh"]='I';format["lb"]='I';format 4
for(inti=0;i<length;i++){//Ifthecurrentcharacteris'1',addthecorre 0
theformatofvariou 0
on.top());dummy_stack_function.pop();}for(inti=dummy_stack.size()-1;i>=0;i--){//Usingaloop 4
<<(offset_size);offset_mask=offset_mask-1;//Wecannowgettheactualvalueof 1
cause,ultim 0
_hex(mem_loc_bin,fals 0
["0100"]='4';bin_ 1
s2=registers[assembly_code[instruction_n 0
){step_R(cur_instr);}elseif(format[cur_instr[0]]=='I'){step_I(cur_instr);}elseif(form 7
no][3])<-pow(2,12)||stoi(assembly_code[instruction_no][3])>=pow(2,12)-1){cout<<" 7
c,"write",false, 0
nti=0;i<=63;i++){mask+=pow(2,i);}}register_values[rd]=regi 3
t3["sd"]="011";funct3["beq"]="000";funct3["bne"]="0 3
values[rs2];}//Updatethestackoffunctionsandth 1
einstructionif(inst=="addi"){register_values[rd]=register_values[rs1]+imm;} 4
//Wecannowgettheac 0
et_mask=offset_mask<<(offset_size);offset_mask=offset_mask- 1
k()==':'){executed_instruction=execute 1
("load")){//Firstresetalltheregisters/memo 1
oc,stringoperation,boolis_read,boolis_hit,intval=-1,intoffset=-1){queue<int>q=order_of_acc 1
hex_instruction=binary_to_hex(in 0
le="";vector 0
DOM"){//Hereweareonlydealingwithcacheandnotqueueif(!to_replace){//Donothing}else{intrandom_nu 2
decimalandhexadecimalval 0
/Notingthevariouspartsoftheinstructionstringopcode="0100011";stringf3=f 0
or(inti=0;i<cache.size(); 1
;inttop_line=stack_of_functions.top().second;top_line=PC/4+1;stack_of_fun 1
//Makesthepositionsofoffseybitszero//Weneedtodothisfortheo 0
a=cache[index][i];cache[index][i 3
<<"Valueofimmediateisoutofrange";exit(0);}//Notingthevaiouspartsoftheinstrctionst 1
storage,k=3;j<=end_storage;j++,k++){cache_block[k]=memory[j];}cache_ 3
s_register;}elseif(i>=28&&i<=31){stringtemporary_register_no="t";temporary_register_no+=to_string(i- 0
emory[mem_loc]=val;cache[index][i][1]=0;//Setittonon-dirt 4
_values[rd]=res;}elseif(inst=="lwu"){v 2
n<<";PC="<<hex_PC<<endl;//Ensurethatthex0valueremai 0
rdvector<string>to_store;stringcur="";for(charc:instruction){if(c==' 2
isters.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueo 1
r[cur.size()-1]==')'){cur.pop_back();}cur_instruction.push_back(c 4
fset_size+index_size));to_store_mem_loc|=(i<<offset_size);for(inti=0;i<block_size;i++){ 0
(mem_loc+i,byte[i],accessed_once);accessed_once=true;}}//Updatethestackoffunctionsandtheirlastex 2
fromwhichwehavetodisplaythememorystrings_count="";//Countofthenumberofmem 0
fwedo,thenwecandirectlyaddourvaluetoitboolfound_invalid=false;for(inti=0;i 0
e=(mem_loc/block_size)*block_size+(block_size-1);cache_block 2
new_data[3+offset] 1
nti=0;i<cache.size();i++){for(intj=0;j<cache[i].size(); 3
["jalr"]='I';//Sformatformat["sb"]='S';format["sh"]='S';format["sw"]='S';format["sd"]='S 5
ex_address="0x"+binary_to_hex(bi 0
gisters.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs2";e 1
str(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_ 2
ep_R(cur_instr);}elseif(format[cur_instr[0]]=='I'){step_I(cur_instr);}elseif(forma 6
close();}cache_output_na 1
ines.find(PC/4+1)!=break_lines.end()){ 2
/memory[mem_loc]=val;//Getthevalueandthenstorethere 1
e:"<<instruction_no+1<<endl<<"Valueofimmediateisout 0
egisters[assembly_code[instruction_no][1]];stringrs1=registers 3
instructions[PC/4];intpos=execut 1
truction_no][2]=to_string(labels[as 1
lr"]="000";funct3["sb"]="000";funct3["sh"]="001";funct3["sw"]="010";funct3["sd"]="011";funct3["beq" 4
rethatx0remai 0
1<<endl<<"Wrongsyntax,forItypeformat,youmustenter4operands"<<endl;exit(0);}elseif(registers.fin 1
datano?to_store_mem_loc|=(removed_dat 0
rs[assembly_code[instruction_no][3]];//Concatinatingtheinstruc 3
offsetaswell,because,ultimatelythisfunctionhastoreturnonly1byteintoffset_mask=1;offs 0
hedatacache.assign(no_of_indexes,ve 0
ruction.substr(0,pos);if(first_word.back()==':'){executed_instruction=executed_instruction.sub 3
;funct3["bge"]="101"; 1
r=hex_to_binary(instruction[2].substr(2));intdecimal=binary_to_decimal(bin_instr);imm=decimal 4
ons.top().second;top_line=PC/4+1;stack_of_functions.pop();s 2
accessed_once=fal 0
tilwesee.text,wekeepstoringdataif(instruction==".data"){data=true;count_how_many_to_s 1
back(comman 0
esses="<<hits+misses<< 0
0"]='6';bin_to_hex["0111"]='7';bin 1
k[0]==0){//Thisisaninvalidframe,ignorecontinue;}if(ca 2
4){cout<<"Errorinline:"< 0
();i++){for(intj=0;j<cache[i] 2
=tag){is_hit=true;found=true;val=cache_block[3+offset];//Since 1
ex_PC;cout<<"Executed:"<<executed_instruction<<";PC= 0
uction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_to_binary(stoi(as 1
if(r=="t4"||r=="x29"){r="x2 1
e_address=store_half(to_store,data_base_address);}elseif(to 1
_instr[0]]== 1
=="lbu"||inst=="lhu"||inst=="lwu"){//Extractrd,rs1,andimmed 0
rue;stringtrimmed_instr="";for(inti=0;i<instruction.size();i++){if(trim&&instruction[i]==''){co 3
ion_no+1<<endl<<"Valueofimmedi 0
{if(cache[index][i][2]==top_tag){removed_data=cache[index][i];cache[index][i]=new_data;b 8
etopq.push(tag);}else{inttop_tag=q.front();//Getthetagwhichweneedt 2
orary_register_no+=to_string(i-28+3);registers[te 1
emainatvalueof0PC+=4;register_valu 0
_no][1]];stringimm= 1
["zero"]=this_register;}elseif(i==1){registers["ra"]=this_register;}elseif(i==2){regis 5
binary_to_hex(mem_loc_bin,false,5);cout<<"Memo 1
decimalintbinary_to_decimal(conststring&bin){intdecimal= 1
p().second;top_line=PC/4+1;stack_of_functions.pop();s 2
r_instruction.push_ba 0
er_values[rd]&=mask;}}elseif(inst=="srai"){register_values[rd]=register_values[rs1]>>imm;}//Update 5
r_values[rs2];if(shifting_amount!=0){re 2
ction_no][3])<-pow(2, 1
rst_word=executed_instruction.substr(0,pos);if(first_word.back()==':'){ex 3
"||r=="x21"){r="x21";}elseif(r=="s6"||r=="x22"){r="x22";}elseif(r=="s7"||r=="x23"){r="x23";}elseif(r 5
toringdataif(instruction==".data"){data=true;count_how_many_to_skip++;continue;}if(data||(i 2
xecuted_instruction.find('');stringfirst_word=executed_instruction.substr(0,pos);if(first_wo 2
alize_funct3(){funct3["add"]="000";funct3["sub"]="000";funct3["and"]=" 4
ne:"<<instruction_no+1<<endl<<"Incorrectvalueofrd";exit(0);} 1
t[cur_instr[0]]=='I'){step_I(cur_instr);}elseif(forma 4
truction=all_instructions[PC/4]; 1
i]=='0'){bin[i]='1';break;}bin[i]='0';}returnbin;}//Functiontoconver 3
over(instruction[1] 1
xit(0);}stringopcode;//Givingthecorrectopcodetothecorrespondinginstructionif(load_operand 1
dress);}elseif(to_store[0]==".half 1
pos+1);}stringbin_PC=decimal_to_binary(old_PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+ 2
t0register_values["x0"]=0;}//CodefortheSformatstepinstructionsvoid 1
ummystacktopopthelabelsfromthemainstackandprintthefortheuservector<pair< 0
atinstructionsvoidexecute_I(vector<vector<string>>&assembly_code,intinstruc 2
k(cur);}//Ifinwrongposition,bringtheoperandsbackto 1
owcalculatethemaskrequiredtofindoutthe 0
k+=pow(2,i);}}register_values[rd]=register_values[rd]&mask;}}elseif( 3
ew_pc;}else{PC+=4;}}elseif(inst=="blt"){if(register_values[rs1]<registe 3
substr(0,pos);if(first_word.back()==':'){ 3
_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"E 1
ind('');stringfirst_word=executed_instruction.substr(0,pos);if(first_word. 2
p_S(vector<string>instruction){//Extractthers1, 2
="Clean";if(cache[i][j][1]==1){is_clean="Dirty";}stringbin_set=decimal_to_binary(i,20,0 5
ueofindexbitsofmemorylocationbeingrequestedbyprogra 0
sk=tag_mask-1;//Thismakesthemask20onesintt 0
;cache_block=cach 0
)){intcur=q.front();q.pop();if(cur!=tag){dummy_q.push(cur);}}while(!dummy_q.empt 6
vector<int>removed_data(cache[0][0].size());vector<int>new_data(cache[0][0].size());intstart_s 10
ruction);PC+=4;}ins 0
em_loc|=(index<<offset_size);f 0
);myfile_out<<"Set:"<<hex_set<<",Tag:"<<hex_tag<<","<<is_c 0
notdirtynew_data[2]=tag;for(intj=start_storage,k 1
uted_instruction.find('');stringfirst_word=exe 1
ur.pop_back();labels[cur]=PC;offset_to_label[PC]= 3
r[0]]=='I'){step_I(cur_instr);}elseif(format 3
=byte;mem_loc++;}//Returnthenewmem_loc 0
lineaccordinglystringtop_of_stack=stack_of_functions.top().first; 1
vector<string>to_store;stringcur="";for(charc:instruction){ 2
d=aliasRemover(instruction[1]);rs1=aliasRemove 2
=PC/4+1;stack_of_functi 0
assembly_c 0
itsintoffset=offset_mask&m 0
.back()==':'){executed_instruction=executed_instruction.substr(pos+1);}stri 3
boolfound_invalid=false;for(inti=0; 0
binary_to_hex(bin_mem_val,true,2);intme 1
ndex,tag,true,mem_loc,"read",true,false);retur 0
oceedwithfindingtherealdatainthatlocation//Ifwefindthisblockinthecache,wereadonlythisparticularme 0
placedq.push(tag);//Pushthenewta 1
e+offset_size);index_mask=index_mask-1;temp_mask=1;temp_mask=temp_mask<<offset_size;temp_m 0
nsurethatthePCvalueis0PC= 0
"";for(inti=0;i<hex.size();i++){b 1
unct3["or"]="110";funct3["xor"]="100";funct3["sll"]="001";funct3["srl"]="1 4
ed_instruction= 0
new_data[3+offset]=val;new_data[1]=1;//Setthebittodirty}for(inti=0;i<associativity;i++){if(cache[ind 2
alf"){data_base_address=store_half(to_store,data_ 0
e(index,tag,false,mem_loc,"read",true,true);}returnval;//Thedatastartsfromindex 1
){byte[i]=read_access(start_location+i,accessed_once);accessed_once=true;}uint32_tres 3
top());dummy_stack_function.pop();}for(inti=dummy_stack.size()-1;i>=0;i--){// 4
k_size)*block_size+(block_size-1);for(intj=start_storage,k=3;j<=end_storage;j++,k++){cache_block[k] 2
executionofeachrun,wecandequeuethetopstringinstruction;instruction_file.open(command.subs 0
i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_ 4
"]='B';format["bgeu"]='B';//Jformatfor 1
ngcache_outpu 0
se,false,val);cache[index][i]=cache 2
update_queue(index,tag,false,mem_loc,"write",false,true,val);bre 1
;if(shifting_amount!=0){register_values[rd]=register_values[rs1]>>imm;//Ourmaskisshi 3
t[cur_instr[0]]=='I'){step_I(cur_instr);}elseif(format[cur_instr[0]]=='S'){ 7
c,"write",false,false,val,offset 0
ingrs1=aliasRemover(instruction[2]);stringrs2=aliasRemover(instruction[3]);//Dothea 4
suretoremovethe 0
top().first;inttop_line=stack_of_functions. 1
e,instruction_no);}elseif(format[ass 0
size;intend_storage=(mem_loc/block_size)*block_size+(block_size-1);cache_block[0]=1; 3
_operands.find(assembly_code[instruction_no][0])!=load 3
dexmakintindex_ma 0
_word.back()==':'){executed_instruction=executed_instruction.substr(pos+1);}str 3
thdecimalandhexadecimalvaluesif(instruction[2][1]=='x'){stringbin_instr=hex_to_binary(instruction[2 3
ter+=num1;}intvalue_of_register_int=register_values[this_register]; 1
alues;unordered_map<string,string>registers_alis;vector<string>all_instructions;unordered_map<int,s 2
sk&mem_loc;index>>=(offset_size);//Let'sgetthevalueofoffsetbitsintoffset=offset_mask&mem_loc;//Wenow 1
Dirty,tag,dataif(cache_block[0]==0){//Thisisaninvalidframe,ignorecontinue;}if(cache_block[2]==tag) 5
irtyif(write_back_policy=="WT"){memory[mem_loc]=val;cache[index] 3
ntstore_byte(vector<string>instruction,intmem_loc){/ 2
<string>instruction){//Extractrd,rs1,rs2stringins 1
_write<<":A 0
i=0;i<cache. 0
++){cache[i][j][k]=0;}}}assembly_code.clear();assembly_ 5
(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);//characters67ofhex_i 3
rdered_map>#include<un 0
struction_no][0]]=='J'){execute_J(assembly_code,instruction_no);}elseif(format[assembly_code[instr 3
ctions[old_PC/4];intpos=executed_instruction.find('') 2
x11";}elseif(r=="a2"||r=="x12"){r="x12";}elseif(r=="a3"||r=="x13"){r="x13";}elseif(r=="a4 4
pop();stack_of_functions.push({top_of_stack,top_line});stringexecuted_inst 3
(decimal<0){isNegative=true;}decimal=abs(decimal);stringbin="";while(decimal!=0){bin.push_back 3
<register_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="bge"){if(register_values[rs1]>=regi 5
smakesthemask20onesinttemp_mask=1;temp_mask= 0
c++;}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_loc;}signedmain(){//Init 1
load_operands.insert("ld");load_operands.insert("lbu");load_operands.ins 2
peformat,youmustenter4operan 0
1]^imm;}elseif(inst== 0
;top_line=PC/4+1;stack_of_functions.pop( 0
lse{cout<< 0
n+i,accessed_once);accessed_once=true;}int32_tres=(byte[3]<<24)|(byte[ 1
rd=aliasRemover( 0
_miss="Miss";stringclean_or_dirty="Clean" 0
j=0;j<cache[i].size();j++){if(cache[i][j][0]==1){stringis_clean="Clean";if(cache[i][j][1]==1){i 10
[random_number];cache[index][random_number]=new_data;//Nowcheckiftheremoveddatahasad 3
oc,20,0);st 0
);register_values[rd]=res;}elseif(i 1
e_value>>8;write_access(mem_loc,byte[0],false);write_access(mem_loc+1,byte[1],true);}if 4
e[index][i]=cac 2
e,ultimatelythisfunctionhastoretu 0
if(format[cur_instr[0]]=='B'){step_B(cur_instr);}elseif(format[cur_instr[0]]=='J'){s 8
executedlineaccordinglystringtop_of_stack=stack_of_functions.t 0
x_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;// 0
tr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[ 2
block=cache[index][i];//Valid,Dirty,tag,dataif(cache_block[0]==0){//Thisisaninvalidframe,ignoreconti 4
_lines.clear();count_how_many_to_skip=0;}stringaliasRemover(stringr){if(r=="zero"||r=="x0" 2
ekeepstoringdataif(instruction==".data"){data=true;count_how_many_to_skip++;conti 1
rase(break_point 0
nclude<iostream>#include<string>#include<fstream>#include<unordered_map>#includ 4
ry_to_decimal(binary_bytes[i]);//characters67ofhex_instruction}for(inti=0;i<4;i++){memory[instru 2
ecimal%2+'0');decimal/=2;}while(bin.size()<no_of_bits){bin 1
diateisoutofrange";exit(0);}//Notingthevario 1
enumberofbytesi 0
sed_once);accessed_once=true;}int64_tres=(byte[7]<<56)|(byte[6]<<48)|(byte[5]<<40)|(byte[4]< 4
str=imm.substr(0,1)+imm.substr(10,1 1
ta=cache[index][i];cache[index][i]=new_data;break;}}//Nowcheckiftheremoveddata 4
truction=execu 0
ters();initialize_funct3();initialize_funct7();initialize_format();init 4
harnum2=dummyi%10+'0';this_register+=num2;this_registe 0
++){if(bin[i]=='0'){bin[i]='1';}else{bin[i]='0';}}//Add1tofind2'scomplementfor(inti=bin.size()-1;i 8
nstruction_no][0]];stringf7=funct7[assembl 1
tacache.assign(no_of_indexes,vector<vector<int>>(associativity,vector<int>(block_s 3
/Thebitisnowvalidnew_data[1]=0;//Initiallynotdirtynew_data[2]=tag;for 2
xecuted:"<<executed_instruction<<";PC="<<hex_PC<<endl;//UpdatethePCaccordinglyPC+=4;}elseif(in 0
)*8;}for(in 0
ction){stack_of_functions.pop();}}}elseif(command=="regs"){//Pri 3
mbly_code[instruction_no][2])==registers.end()){cout<<"Errorinline:"<<instruction_no+1< 3
/Notethatthesizeifblocksize+3because,1forvalid,1fortag,1ford 0
ion.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_dec 3
d"]="0000000";funct7["or"]= 1
e";exit(0);}imm=decimal_to_binary(stoi(assem 1
s)/(hits+misses);}stack_of_functions.pop();}}}elseif(command=="step"){//G 3
_of_stack,top_line});stringexecuted_instruction=all_instructions[PC/4];intpos=executed_instru 1
step_B(cur_instr);}elseif(format[cur_i 1
index][i];//Valid,Dirty,tag,dataif(cache_block[0]==0){val=memory[mem_loc];/ 4
ine=stack_of_functions.top().second;top_line=PC/4+1;stack_of_function 1
ry(PC,32,0);stringhex_PC=binary_to_hex(bin_PC) 2
it(0);}//Notingthevaiouspartsoftheinstrctionstringopcode="0110111";stringrd=registe 1
tor<int>removed_data=cache[i][j];intto_store_mem_loc=0;// 3
s[saved_register_no]=this_register;}elseif(i>=28&&i<=31){stringtemporary_register_no="t";te 1
{binary_byt 0
).second;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({ 1
;to_store_mem_loc|=(index<<offset_size);for(inti=0;i<block_size;i++){memory[to_store 0
spertheinstructionif(inst=="lb"||inst==" 0
r);}elseif(format[cu 0
ytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];f 4
ack_of_functions.top().fi 1
][2])<-1*pow(2,20)||stoi(assembly_code[instruction_no][2])>=pow(2,20)-1){cout<<"Errorinline 7
or<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=he 3
+rs1+f3+rd+opcode;stringhex_instruction=binary_to_ 0
<string,int>last_exected_line;stack<pair<string,int>>stack_of 3
value>>(7-i)*8;}for(inti=0;i<8;i++){write_access(mem_loc+i,byte[i],accessed_once); 3
t["sub"]='R';format["xor"]='R';fo 2
lse,mem_loc,"read",true,false);cache[index][i]=cache_block;returnv 2
;tag_mask=tag_ma 0
ualvalueoftagbitsinthememorylocationthatourprogramisrequestingtoreadin 0
!found_invalid){val=memory[mem_loc];update_queue(index,tag,true,mem_loc,"read",true,false); 2
i<block_size;i++){memory[to_store_mem_loc+i]=removed_data[3+i];}}}}if(replacement_policy==" 3
de<algorithm>#include<cstdlib 1
.assign(no_of_indexes 0
s[rs1]<<imm;}elseif(inst=="srli"){uint32_tshifting_amount=imm;if 2
_J(vector<vector<string>>&assembly_code, 2
olcheck_space=false;//Wenowextractthevalueofaddrandcountbyparsingthelinefor(inti=4;i<command.si 0
]==top_tag){removed_data=cache[index][i]; 2
)!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forR 0
.size());vector<int>new_ 2
requestedbyprogra 0
e:"<<instruction_no+1<<endl<<"Incorrectsyntax";exit(0);}}}elseif(comman 1
2,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_inst 1
Iterateoverthebinarystringfor(inti=0;i<length;i++){//Ifthecurrentcharacteris'1',addthecorrespondin 0
theassemblycodetomachin 0
//Handlingerrorif(assembly_code[instruction_no].size( 1
ction=executed_instruction.substr(pos+ 0
g="0x"+binary_to_hex(bin_t 0
nowhavetheindexandtagwewant.Wecanproceedw 0
ldatainthatlocation//Ifwefindthisbloc 0
#include<unordered_set> 1
="lwu"){vector<uint32_t>byte(4);boolaccessed_once=false;for(inti=0 2
cache[index][i]=cache_block;return;}}//Ifwewerenotabletofindanyinvalidb 2
kip)!=break_lines.end()){break_ 1
e[0];register_values[rd]=r 2
uted_instruction=all_instructions[PC/4];intpos=executed_instruction.find('');stringfir 2
val;//Getthevalueandthenstoretheremainingwords,criticalwordfirstploicyintstart_storage=(mem_loc/bl 0
S(assembly_code,instruction_no);}elseif(format[assembly_code[instruction_no][0]]== 4
;order_of_a 0
acefromthebeginningofanylinebooltrim=true;stringtr 0
ion_no){//Handlingerrorif(assembly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<instructio 3
f(inst=="lb"||inst=="lh"||inst=="lw"||inst=="ld"||inst=="lbu"||inst=="lhu"||inst=="lwu"){//Extr 1
otqueueif(!to_replace){//Donothing}else{intrandom_number=rand()%associativity;vec 3
str);}elseif(format[cur_instr[0]]=='J'){step_J(cur_instr); 4
s,boolisSi 0
oved_data(cache[0][0].size());vector<int>new_data(cache[0][0].size());intstar 9
iss="<<misses<<",HitRate="<<fixed<<se 0
,true);//Concatinatingthevariouspartsstringinstr=imm.su 0
){//Extractrd,rs1,andimmediaterd=aliasRemover(ins 0
heRformatstepins 0
truction<<";PC="<<hex_PC<<endl;//Ensuretoremovethecalle 0
ly_code[instruction_no][2]. 2
;//characters67ofhex_instruction}for(inti=0;i<4;i++){memory[in 0
k_size+(block_size-1);cache_block[0]=1;//Thebitisnowvalidcache_block[1]=0;//Ini 3
;i++){memory[to_store_mem_loc+i]=removed_data[ 1
rmatstepinstructionsvoidstep_I(vector<string>instruc 1
ata[3+offset]=val; 1
cache_output_name.c_str(),"a")!=NULL){cache_ou 1
f_functions.push({top_of_stack,top_line});stringexecute 2
grequestedbyprogramintindex=index_mask&mem_loc;index>> 0
t<<"Errorinline:"<<ins 0
"]="110";funct3["xor"]="100";funct3["sll"]="001";funct3["srl"]="101";funct3["sra"]="101" 4
"]="010";funct3["sd"]=" 1
olto_break=false;i 0
instruction_no+1<<endl< 0
_instructio 0
w_data(cache[0][0].size());intstart_storage=(mem_loc/block_size)*block_size; 5
at["srl"]='R';format["sra"]='R';//Iformatformat["add 2
=registers[assembly_code[instruction_no][3]];//Concatina 3
l_rs2=register_values[rs2];if(val_rs1>=val_rs2){ 2
chnottakenintold_PC=PC;//Executethebranchifconditionsatisfiedasperthegiveninstructionif(inst= 0
etopopmainfromthestackif(PC/4==no_of_instru 0
(6));//Wetakeintoaccountthelinesthat 1
i);}}register_values[rd]=regist 1
"]='R';format["sll"]='R';format["srl"]='R';format["sra"]='R';//Iformatformat[" 3
nthenewmem_locwhereyoucanwritetonextret 0
ck(dummy_stack_function.top());dummy_stack_function.pop 2
e);cache[index][i]=cache_ 2
sk=temp_mask-1;index_mask=index_mask^temp_mask;//Makesthepositionsofoffseyb 0
st=="beq"){if(register_valu 0
ummy_stack_function=stack_of_functions;while(!dummy_stack_function.empty( 0
nti=bin.size()-1;i> 1
sters.find(assembly_code[instruction_no][2])==registers.end()){cout<< 4
_PC=PC;stringinst=instruction[0];if(inst=="jal"){register_values[rd]=PC+4;PC=ne 3
='I';format["lb"]='I';format["lbu" 1
=".data"){data=true;count_how_many_to_skip++;continue;}if(data||(instr 1
eofrd";exit(0);}elseif(regi 1
s2]){PC=new_pc;}else{PC+=4;}}elseif( 2
yareforindexinttag_size=20-offset_size-index_size;//Andthesemanyaretagbits//Letusnowcalculateth 0
embly_code[inst 0
1;tag_mask=tag_mask^temp 0
;hex_to_bin['8']="1000";hex_to_bin['9']="1001";hex_to_bin[ 2
assembly_code[instruction_no][0]]=='R'){execute_R(ass 2
me,andifwedo,thenwecandirectlyaddourvaluetoitboolfound_invalid= 0
ck(instruction[i]);}else{if(cur[cur.size()-1]==':'){cur.p 5
28&&i<=31){stringtemporary_register_no="t";temporary_regi 0
tline:"<<break_point<<endl;}e 0
reg]=0;}intPC=0x00000;for(inti=0x0;i<0x50001;i++){memory[i]=0x00;}labels.clea 2
kip;//Codetoconvertbinarytohexadecimalstringbinary_to_hex(st 0
on.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to 3
gbinary,booltrim=false,intlength=8){unordered_map<string,char>bin_to_hex;bin_to_hex["0000"]='0';bi 2
rt_storage=(mem_loc/block_size)*block_size;inten 1
_write="R";}str 0
e:"<<instruction_no+1<<endl<<"Incorrectvalueofrs2";exit(0) 1
memorybytesstartingfrommemorylocationspecifiedbytheuserstrings_addr="";//storethestartaddr 0
ringhex="";for(inti=0;i<binary.size();i+=4){stringb=binary.substr(i,4);hex.pus 2
wordfirstploicyintstart_storage=(mem_lo 0
;found=true;val=cache_block[3+offset];//Sincet 1
ecuted,thenensuretopopmainfromthestackif(PC/4==no_of_instruction){stack_of_functions.pop 1
registers_alis;vector<string>all_instructions;unordered_map<int,string>offset_to_label;unord 2
intj=start_storage,k=3;j<=end_sto 0
/Converttheassemblycodetomachinecodehexadecimalandstoreintextmemoryfor(intinstruction_no=0;instruct 0
ace){//Donothing}else{intrandom_number=rand()%associativity;vector<int>remo 3
("mem")){//Hereweshowthecountnumberofmemorybytesstartingfrommemorylocationspecifiedbytheuserstrin 1
_map<string,string>regist 1
filestringcommand;getlin 0
i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);/ 4
//Concatinatingthevariouspartsstringinstr=imm 0
eretagwillalwaysbeatthetopq.push(tag);}else{inttop_tag=q.front();/ 2
;cache_confi 0
(i==1){registers["ra"]=this_register;}elseif(i==2){regis 4
swillhandleinitializinganyusedvariablesthatthepreviousf 0
9"){r="x9";}elseif(r=="a0"||r=="x10 1
er;}elseif(i==8){registers["s0"]=this_register;registers["fp"]=this_register;}elseif(i==9){ 5
tringinst=instruction[0]; 1
onsatisfiedasperthegiveninstructionif(inst=="beq"){if(register_values[ 1
memory[to_store_mem_loc+i]=removed_data[3+i];}}}}if(replacement_ 2
[i][j][1]==1){is_clean="Dirty";}stringbin_set=decimal_to_binary(i,20,0);stringhex_set="0x"+binary_t 5
ction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_ 2
if(i==0){registers["zero"]=this_register;}elseif(i==1){registers["ra"]=th 5
n"<<"Fromwriteaccess"<<endl;}}/ 0
sembly_code[instruction_no][3])>=pow(2,11)){cout<<"Errorinline:"<<instruction_no 3
ble")){cache_e 0
;//Concatinatingthein 0
ruction_no][2]];stringrs2=registers[assembly_code[instruction_no][3]];//Conc 4
ebreakpointif(break_lines.find(break_point-count_how_many_to_skip)!=break_ 1
[rs1]>>imm;}//Updatethestackoffunctionsandtheirlastexecutedlineaccordi 1
op().second;top_line=PC/4+1;stack_of_funct 1
funct3["sb"]="0 1
_code[instruction_no][0]];stringrs1=registers[assembly_code[instruction_ 2
dthisblockinthecache,weloadthewholeblockfromthememoryboolfound=false;for(inti=0; 0
text,wekeepstoringdataif(instruction==".data"){ 1
che_size,block_size,associativity;stringreplacement_policy,wri 0
ctions.push 0
lse);uint8_tres=byte;register_values[rd]=res;}elseif(inst=="lhu"){uint16_tbyte0= 2
s.pop();stack_of_functions.push({top_of_stack 1
nstruction=all_instructio 0
inghex_instruction=binary_to_hex(instr);vector<string>binary_bytes( 2
<<endl<<"Incorrectvalueofrd";exit(0);}intdec_imm;//Weacceptbothdecimalandhexadecimal 1
});last_exected_line.clear 0
[2]];stringrs2=registers[assembly_code[instructio 1
truction.substr(0,pos);if(first_word.back( 1
B(vector<string>instruction){//Keeptrackofthenewpcvalueand 2
ruction[2]);}im 1
funct3["sw"]="010";funct3["sd"]="011";funct3["beq"]="000";funct3[" 3
=executed_instruction.substr(pos+1);}stringbin_PC=decimal_to_binar 1
Notethatthesizeifblocksize+3be 0
hestackoffunctionsstack_of_functions.pop();//Updatethedestinationaddres 1
x<<"]"<<"="<<hex_mem_val<<endl;}}elseif(command=="s 0
ctionfromthe 0
;i<4;i++){memory[instruction_no*4+i]=byte[i] 2
memory[instruction_no*4+i]=byte[i];}}//CodeforSfor 2
l_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<" 2
int64_tshifting_amount=register_values[rs2];i 1
nary(stoi(assembly_code[instruction_n 0
tore_word(to_store,data_base_address);}elseif(to_store[0]==".byte"){data_base_address=store_byte 3
tes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[ 4
itset,andifso,weneedtoupdatet 0
thm>#include<cstdlib>#include<math.h>#include<sstream># 3
assembly_code[instruction_no][2])==registers.end()){cout<<"Errorinline:"<<instruction_no+1< 3
assembly_code[instruction_no][1])= 2
g_mask=tag_mask^temp_mask;//Makesthepositionsofindexbitsandoffsetbitszero//Letusdothesa 0
Handlingerrorif(assembly_cod 0
r=="s1"||r=="x9"){r 0
ed_instruction=all_instruc 0
sd"]="011";funct 0
y_register_no+=t 0
(.text)count_how_many_to_skip++;if(instruction==".text"){data=false;}else{//Storethere 3
s+1);}stringbin_PC=decimal_to_binary(PC,32,0 0
_present=false;while(!q.emp 0
embly_code[instruction_no][3]]-instruction_ 2
ue,16);cout<<this_register<<"=0x"<<value_of_register_hex<<endl;}}e 0
rt_location+i,accessed_once);accessed_once=true;}uint32_tres=byte[3]<<24|byte[2]<<16|byte[1]<<8|b 3
ion_no][0]]== 1
ndecimal;}//Definingallregistersvoidinitiali 0
e>>associativity>>replacement_policy>>write_back_policy 0
eakpoint\n";}else{while(PC/4<no_of_instruction){if(break_lines.find(PC/4+1)!=break_lines.end()){brea 3
include<sstre 0
+){cache[i][j][ 2
[0]]=='I'){step_I(cur_instr);}el 3
;cache_block=cache[index][i];//Valid,Dirty,tag,dataif(cache_block[0]==0){//Thisisa 4
ask-1;temp_mask=1;temp_mask=temp_mask<<offset_si 0
ters.end()){cout<<"Errorinline:"<<instructio 1
imdisable"){cache_enable 0
rmat();initialize_load_operands();initialize();ifstreaminstruction_f 3
stack_of_functions.pop();}stack_of_functions.push({"main",0});last_exected_line.clear();break_lin 4
ng>>&assembly_code,intinstruction_no){//Handlingerrorsif(assembly_code[instructi 0
t32_tshifting_amo 0
tion+i,accessed_once);accessed_once=true;}uint32_tres=byte[3]<<24|byte[2]<<16|byte[1]<<8|byte[0] 4
lthevaluesthattheuserhasspecifiedandstorethemstartingforlocationspecifiedbythemem_locfor(inti=1 0
<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_to_ 1
alues[rs1]<<register_values[rs2];}elseif(inst=="srl"){uint64 3
elseif(inst=="sra"){re 1
){PC=new_pc;}else{PC+=4;}}elseif(inst=="bge"){if(register_values[rs 3
access.resize(no_of_indexes);cache_config_file.close();hits=0;mi 2
.second+count_how_many_to_skip<<endl;}if(stack_o 0
um2=dummyi%10+'0';this_register+=num2;this_register+=num1;}int 0
tore_value=stoi(instruction[i]);vector<uint8_t>byte(8);for(inti=0;i<8;i++){byte[7-i] 5
ssembly_code[instruction_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<< 3
eforoffsetintindex_size=log2(cache_si 0
hestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=sta 0
es[rs2];}elseif(inst=="srl"){uint64_tshifting_amount=register_values[rs2];if(s 3
rSformatinstructionsvoidexecute_S 0
mat[cur_instr[0]]=='S'){step_S(cur_instr);}elseif(format[cur_instr[0]]=='B'){ste 7
/Popthevaluewhichisreplacedq.push(tag);//Pushthenewtagvaluevector<int>remo 2
r;}elseif(i>=10&&i<=17){stringargument_register_no="a";argument_regis 0
gister_values[rd]=register_values[rs1]>>imm;//Ourmaskis 2
te_access(mem_loc,byte[0],false);write_access(mem_loc+1,byte[1],true);}if(inst=="sw"){ 5
["sra"]='R';//Iformatformat["addi"]='I';format["xori"]='I';format["ori"]='I';f 4
ly_code[instruction_no][3])>=pow(2,12 2
ruction_no][0]]=='U'){execute_U(assembly_code,instruction_no);}else{cout<<"Erroronline:"< 3
d]=res;}//Updatethestacko 0
"addi"||inst=="xori"||inst=="ori"||inst=="andi"||inst=="srai"||inst=="slli 0
ack(bin_to_hex[b]);}if(length*4>binary.size()){stringzeros="",fs="";for(inti=length*4;i<bina 4
ache_block=cache[index][i];//Valid,D 2
1<<endl<<"Incorrectvalueofrs1 0
=binary_to_decimal 0
nst=="bgeu"){uint64_tval_rs1=register_va 0
s0register_values["x0"]=0;}//CodeforRf 1
k,top_line});stack_of_ 0
orlocationspecifiedbythemem_locfor(inti 0
ylocationbeingrequestedbyprog 0
);write_access(mem_loc+1, 0
]=read_access(start_location+i,acc 0
rif(assembly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<i 3
o][3]];//Concatinatingtheinstructionstringinstr=f7+rs2+rs1+f3+rd+opcode;//Nowletuswriteintothetext 1
;}if(cache_block[2]==tag){if(!accessed_once){hits++;}found=true;cache[ 4
;}else{PC+=4;}}elseif(inst=="bltu"){uint64_tval_rs1=regist 2
in,command);if(!command.find("load")){//Firstresetalltheregisters/memory/PCbeforeloa 2
["and"]="0000000";funct7["or"]=" 2
eofwritethroughandmiss,wedonotcontactthecacheatall.So,weneedtoprintinthec 0
to_store_mem_lo 0
i>=18&&i<=27){s 0
//KeeptrackofoldPCifbranchnottakenintold_PC=PC;//Executethebranchifconditionsatisfiedasp 0
k_point=stoi(command.substr(6));//Wet 2
);new_data[0]=1;//Thebitisnowvalidnew_data[1]=0;//Initiallynotdirtynew_data[2]=tag;fo 3
ce){misses++;if(write_back_policy=="WT"){stringbin_address=decimal_to_binary(mem_loc,20,0);stri 2
xshouldbeoftheremoveddatano?to_store_mem_loc|=(removed_dat 0
inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4]; 5
ind(assembly_code[instruction_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1 4
aiourspartsoftheinstrutionstringopcode="0110011";stringf3=funct3[assembly_code[in 0
tevaluesstringinst,rd;inst=instruction[0];rd=aliasR 1
;}}//CodeforBformatinstructio 0
cutionstoppedatbreakpoint\n";break;}}//Iflastlin 0
e_value>>8;memory[mem_loc]=byte[0];me 2
etittonon-dirty}//Sincethisahit,weneedtoupdatetheorderofaccessvectorupdate_queue 0
||r=="x19"){r="x19";}elseif(r=="s4"||r=="x20"){r="x20";} 3
wereadonlythisparticularmemory 0
remainsat0register_values["x0"]=0;}//CodefortheSformatstepinstructionsvoidstep_S(vector<string>in 2
_mask<<(index_size+offset_size);temp_mask=temp_mask-1;tag_mask=tag_mask^temp_ma 1
andprintthefortheuservector<pair<string,int>>dummy_stack;stack<pair<string,int>>dummy_stack 4
"Dirty";}stringbin_set=decimal_to_bin 0
on[i]!='('){cur.push_back(instruction[i]);}else{if(cur[cur 5
k(cur);}//Ifinwrongposition,bringtheoperandsbacktothecorrectpositio 1
){register_values[rd]=register_values[rs1]+imm;}elseif(in 3
/Ifinwrongposition,bringtheoperandsbacktoth 0
]);stringrs2=aliasRemover(instruction[3]);//Dothearithmeticaccordingtotheinstructionsif(in 2
<instruction_no+1<<endl<<"V 0
{uint64_tval_rs1=register_values[rs1],val_rs2=register_values[rs2];if(val_rs1<val_rs2 2
xit(0);}elseif 1
_of_functions;while(!dummy_stack_function.e 0
dr=binary_to_d 0
s="<<misses<<",HitRate="<<fixed<<setp 0
rue);//Concatinatingtheinstructionstringinstr=imm.substr(0,1) 1
();i++){for(intj=0;j<cache[i].size();j++){for(intk=0 3
log2(cache_size/(associativity*block_size));//Thesemanyareforind 2
while(getline(instruction_file,instruction)){//Iftheinstruc 2
ecacheif(write_back_policy=="WT"){memory[mem_loc]=val; 2
y>>replacement_policy>>write_back_policy;//Iftheassociativity=0,thenweneedtomakeitful 0
ack_of_functions.push({top_of_st 0
es;}elseif(inst=="lh"){int16_tbyte0=read_access(start_locatio 1
ed){boolisNegative=false;if(decimal<0) 0
culatethemaskrequiredtofindoutthetagbitslaterin 0
ad_access(start_location,false);int8_tres=byte;register_v 1
x_to_binary(s_addr);intaddr=binary_to_decimal(bin_s_addr);intcount=stoi(s_count);//Printingtheloc 3
eorderofaccessvectorif(!accessed_once) 1
;//GothroughallthevaluesintheD-cacheandwriteonlytheonc 0
e){if(command[ 0
ngexecuted_instruction=all_instructions[PC/4];intpos=executed 1
_imm>4294963200){cout<<"Errori 0
tion_no*4+i]=byte[i];}}//CodeforJformatinstr 1
ly_code[instruction_no 0
che_output<<read_or_write<<":Address:"<<hex_ 0
ecuted_instruction.substr(0,pos);if(first_word.back()==' 2
ngargument_register_no="a";argument_register 0
binary(cache[i][j][2],20,0);stringh 4
+1,byte[1],true);}if(inst=="sw") 2
3])>=pow(2,11)){cout<<" 1
e:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit( 0
ck_size);//Thesemanybitsareforoffsetintindex_size= 0
fimmediateisoutofrange";exit(0);}imm=de 1
l_instructions[PC/4 0
ector<uint32_t>byte(4);boolaccessed_once=false;for(inti=0;i<4;i++){byte[i]=read_access(start_l 3
]=res;}elseif(in 0
.empty()){dummy_stack.push_back(dummy_stack_function.top());dum 3
1alwaysstor 0
tart_location+i,accessed_once);accessed_once=true;}uin 0
ta[3+i];}}}}if(replaceme 1
p)!=break_lines.end()){break_lines.erase(break_point-count_how_many_to_skip);cout<<"Deletedbreak 2
k=temp_mask-1;index_mask=index_m 0
[0])!=load_operands.end()){opcode="0000011";}elseif(assembly_code[instruction_no][0]==" 5
)==labels.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Labelnotdefined";exit(0);}else{a 2
1<<endl<<"Incorrectvalueofrs2";exit(0);}elseif(stoi(assembly_code 1
tr(2));intdecimal=binary_to_decimal(bin_instr);imm=dec 2
dex,tag,true,mem_loc,"read",true,false);retur 0
ex,tag,true,mem_loc,"read",true,false);retur 0
,thenensurethatuntilwesee.text,wekeepstoringdataif(instruction==".data"){data=true;cou 1
xtracttherdvaluestringrd=aliasRemover(ins 0
";}else{cur.push_back(c);}}if(cur!=""){to_store.p 3
ghex_address="0x"+bina 0
format["or"]='R';format["and"]='R';format["sll"]='R';forma 3
0');}reverse(b 0
a(cache[0][0].size());intstart_storage=(mem_loc/block_size)*block_size;intend_storage= 5
ting_amount=imm;if(shifting_amount!=0){regi 1
";}stringbin_address=decimal_to_binary(mem_loc,20,0);stringhex_address="0x"+binary_t 1
x_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_de 3
;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack 1
es[rs2];}elseif(inst=="and"){register_values[rd]=register_values[rs1]&register_values[rs2];}el 6
ruction<<";PC="<<hex 0
_to_hex["1100"]='c';bin_to_hex 1
perands;unordered_map<string,int>labels;unorder 1
ction=executed_instruction.substr(pos+1);}stringbin_PC=de 1
.substr(2));intdecimal=binary_to_decimal(bin_instr);imm=de 2
r_instr=assembly_code[PC/4];if(format[cur_instr[0]]=='R' 3
ringis_clean="Clean";if(cache[i][j][1]==1){is_clean="Di 4
(instruction[i]);vector<uint8_t>byte(4);for(inti=0;i<4;i++){byte[ 4
='6';bin_to_hex["0111"]='7';bin_to_hex["1000"]='8';bin_to_hex["10 2
set_mask=off 0
tintindex_size=log2(cache_size/(associativity*block_size));// 2
no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_to_binary 1
executed_instruction<<";PC="<<hex_PC<<endl;//Ensurethatthex0valueremains 0
ock_size);//Thesemanybitsareforoffsetintind 0
m_loc,"read",true,false);cache[index][i]=cache_block;returnval;}}//Ifwewerenotabletofinda 2
ter+=num2;this_register+=num1;}intvalue_of_register_int=register_values[this_register];stringvalu 1
t=register_values[rs2];if(shifting_amount!=0){register_values[rd]=register 3
ssembly_code,intinstruction_no){//Handlingerrorif(assembly_code[instruction_no].size()!= 2
Executed:"<<executed_ins 0
evalueofaddrandcountbyparsingthelinefor(inti=4;i<command.size();i++){if(!check_spac 1
;temp_mask=temp_mask<<(index 0
s7"||r=="x23"){r="x23";}elseif(r=="s8"||r=="x24"){r="x24";}elseif(r=="s9"||r=="x25" 3
epositionfromtheright}}returndecimal;}//Definingallregistersvoidi 0
on(3)<<(double)(hits)/(hits+misses);}s 4
]=cache_block;returnval;}}//Ifwewerenotabletofindanyinvalidblock,weneedtoapp 0
temp_mask<<(index_size+offset_size);temp_mask=te 1
funct3["srl"]="101";funct 1
11";hex_to_bin['4']="0100";hex_to_bin['5']="0101";hex_to_bin['6']="0110";hex_to_ 3
=i;stringmem_loc_bin=decimal_to_binary(i,20,0);stringmem_loc_hex="0x"+bin 1
x_to_bin['2']="0010";hex_to_bin['3']="0011";hex_to_bin['4']="0100";hex_to_bin['5']= 4
correctvalueofrs1";exi 0
p().second;top_line=PC/4+1;stack_of_functions.pop();stack_of_fun 2
l<<"Incorrectvalue 0
ndingtherealdatainthatlocation//Ifwefindthisblockinthecac 0
_instructions[PC/4];intpos=executed_instruction.find('');stringfirst_wor 2
+){memory[mem_loc+i]=byte[i];}mem_loc+=4;}//Returnthenewmem_locwhereyoucanwritetonextreturnmem_loc; 3
_to_hex["0110"]='6';bin_to_hex["0111"]='7'; 2
=0;j<cache[i].size();j++) 2
block_size)*block_size;intend_storage=(mem_loc/block_size)*block_si 1
size();i++){for(intj=0;j<cache[i].size();j++){for(intk=0;k<cache[i][j].size();k++ 6
sembly_code[instruction_no][2])==registers. 2
")){//Firstresetalltheregisters/memory/PCbeforeloadingthenextfileinitialize();hits=0;misses=0;//me 1
="";}}if(cur!=""){if(cur 1
top_line=PC/4+1;stack_of_functions.pop 0
he_output_name;//Infiniteloopthatreadsuserinputswhile(true){//Nowsavethenextfilestri 1
<<"Incorrectvalueofrs1";exit(0);}string 1
nsvoidstep_S(vector<string>instruction){//Extractthers1,rs2andimmediatevaluesstringrs1,rs2,in 2
){cache_enabled=false;cache_output.close(); 1
f(assembly_code[instruction_no].size()!= 2
y_code[instruction_no][3])<-pow(2,11)||stoi(assembly_code[instruction_no][3])>=pow(2, 7
");load_operands.insert("lwu");}//Wheneveranewfileisloaded,thiswillhandleinitial 1
rd+opcode;stringhex_i 0
offseybitszero//Weneedtodothisfortheoffsetaswell,because,ultimatelythisfunctionhastoretur 0
functions.pop();stac 1
<"=0x"<<value_of_register_hex<<endl;}}elseif(command=="exit"){//Exitthesimulatorcout<<"Exi 1
byte[0];register_values[rd]=res;}elseif(inst=="lbu"){uint8_tbyte=read_acce 3
struction_no][1] 1
tion_no){//Handlingerrorif 0
=instruction[0];rd=aliasRemover(instruction[1]);i 3
g2(block_size);//Thesemanybitsareforoffsetintindex 1
cuted:"<<executed_instruction<<";PC="<< 0
+i,byte[i],accessed_once);accessed_once=true;}}//Updatethestackoffunctions 1
dex_size+offset 0
ffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=stack_of_functions.top().first 1
(!accessed_once){misses++;}//Fir 2
executed_instruction.s 0
l;exit(0);}elseif(reg 1
mbly_code[instruction_no][0]=="srai"){if(stoi(assembly 2
se{PC+=4;}}el 1
i"]='U';}//Keepingtrackofalllaodo 0
tionhastoreturnonly1byteintoffset_mask=1;offset_mask=offset_mask<<(offset_size);offset_mask= 1
s[assembly_code[instruction_no][1]];stringimm 3
gister_no="a";argument_register_no+=to_string(i-10);registers[argument_register_n 1
accordingtotheinstructionsif(inst=="ad 0
=true;intto_store_mem_loc=0;to_store_mem_loc|=(tag<<offset_size+ 0
tr(0,1)+imm.sub 1
ringfirst_word=executed_instruction.substr(0,pos);if(first_word.back()==':'){executed_instruction=ex 3
nghex_tag="0x"+binary_to_hex(bin_tag,true,5);cache_output<<"W" 1
PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<" 1
no][3])<0||stoi(assembly_code[instruction_no][3]) 4
esinttemp_mask=1;temp_mask=temp_mask<<(index_size+offset_size);te 1
front();q.pop 1
);last_exected_line.clear();bre 1
});last_exected_line.clear();b 1
C,32,0);str 0
=="step"){//Gostepbystepintno_of_instruction=assembly_code.size();if(PC/4== 1
f(r=="s6"||r==" 0
";funct3["ori"]="110";funct3["andi"]="111" 2
anchnottakenintold_PC=PC;//Executethebranchifconditionsatisfiedasper 0
,Dirty,tag,dataif(cache_blo 0
svectorupdate_queue 0
_mem_loc|=(i< 0
wherewehavetoinsertabreakp 0
ringrs1=aliasRemover(instruction[1]);stringrs2=aliasRemover(instr 2
location+i,accessed_once);accessed_once=true;}int64_tres=(byte[7]<<56)|(byte[ 1
oi(assembly_code[instruction_no][2])<-1*pow(2,20)||stoi(assembly_code[ins 4
"||inst=="lwu"){//Extractrd,rs1,andimmediaterd=aliasRemover(instruction[1]);rs1=aliasRem 2
(cur_instruction[0])!=load_operands.end()||format[cur_instruction[0]]=='S'||cur_instruct 5
[i]=binary_to_decimal(binary_bytes[i]);//charact 3
fsetbitsintoffset=offset_mask&mem_loc;//Wenowh 0
tformat["addi"]='I';format["xori"]='I';format["ori"]='I';format["andi"]='I';format["slli"]='I';forma 5
updatequeue"<<endl 0
ring(i-5);registers[temporary_register_no]=this_register;}elseif(i 2
.close();}cache_output_name=current_opened_file+".output";cache_output.open(cache_output_na 1
o_binary(PC,32,0);stringhex_PC=binary_ 1
size+index_size));to_store_mem_loc|=(index<< 0
/Sformatformat["sb"]='S';format["sh"]='S';format["sw"]='S';format["sd"]='S';//Bformatformat["be 4
ands.insert("lhu");load_operands.insert("lwu");}//Wheneveranewfileisloaded,thiswillh 2
cuted_instruction<<";PC="<<hex_PC<<endl;//UpdatethePCandensurethatx0 0
ted_instruction<<";PC="<<hex_PC<<endl;//Ensuretoremovethe 0
r(instruction[1]);intold_PC=PC;stringinst=instr 2
"<<dummy_stack[i 0
nctions.pop();stack_of_functions.push({top 1
"x25";}elseif(r=="s10"||r=="x26"){r="x26";}elseif(r=="s11"||r=="x27"){r="x27"; 3
d]=register_values[rd]&mask;register_values[rd]&=mask;}}elseif(inst=="srai"){regis 3
dd"){register_values[rd]=register_values[rs1]+re 2
eclarethevariousmapswhichwillstoret 0
licy=="RANDOM"){//Hereweareonlydealing 0
ldata=false;stringdata_type;intdata_base_address=0x10000;//Loadthenextf 0
^register_values[rs2];}elseif(inst=="sll"){register_values[rd]=register_ 3
rmat[cur_instr 0
for(inti=0;i<cache.size();i++){for(intj=0;j<cache[i].size();j++) 3
16_tbyte1=read_access(start_location+1,true);uint16_tres=byte1<<8|byte0;register_values[rd]=res;} 2
gisters.find(assembly_code[instruction_no][2])==registers.end()){cout<<"Errorinline:"<<in 4
tethebreakpointi 0
cuted:"<<executed_instruction<<";PC="<<hex_PC<<endl;/ 0
'S';format["sd"]='S';//Bformatformat["beq"]='B';format 2
!=tag){dummy_q.push(cur);}}while(!dummy_q.empty() 3
=1;i<instruction.size();i++){uint64_tstore_value=stoi(instruction[i]);uint 3
x_mask&mem_loc;index>>=(offset_ 0
=imm+rs1+f3+rd+opcode;stringhex_instruction=binary_to_hex 0
=='S'||cur_instruction[0]= 1
b';bin_to_hex["1100"]='c';bin_to_hex["1101"]='d';bin_to_he 2
r=hex_to_binary(assembly_code[instructio 0
embly_code[instruction_no][3])<0|| 2
rofmemorylocationswehavetodisplayboolcheck_space=false;//Wenowextractthev 0
uction.substr(pos+1);}stringbin_PC=decim 1
for(inti=0;i<cache.size();i++){for(intj=0;j<cache[i].size();j++){for(int 3
ex_size+offset_size);index_mask=index_mask-1;temp 0
ion_no][2]]-instruction_no*4);}if(reg 1
or(inti=0;i<4;i++){byte[i]=read_access(start_location+i,accessed_once); 2
ly_code[instruction_no][3]),12,true);}//Concatinatingthevaluesstringinstr=imm 2
ommand=="step"){//Gostepbystepintno_of_instructio 0
ysremainatvalueof0PC+=4;register_values["x0"]=0;}//Code 1
'I';format["lb"]='I';format["lbu 1
tedbreakpointatline:"<<break_point<<endl;}else{cout<<"Nobreakpointspr 0
yte[i]=binary_to_decimal(binary_bytes[i]);//characters67ofhex_instruction}for(inti=0;i<4;i++){ 3
_hex(bin_set,true,5);stringbin_tag=decim 1
_to_skip)!=break_line 0
truction[3]);rs1=aliasRemover(instruction[2]);intmem_loc 3
or<string>instruction){//Store 1
(){funct7["add"]="0000000";funct7["sub"]="0100000";funct7["and"]="00000 4
lseif(registers.find(assembly_code[instruc 0
o_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_byte 3
emoved_data=cache[i][j];intto_store_mem_loc=0;//Hereth\etagandindexshouldbeoftheremoveddatano?to_ 2
emaskrequiredtofindoutthetagbitslaterinttag_mask=1;ta 0
oolis_dirty=false;if(replacement_po 0
sthattheuserhasspecifiedandstorethemstartingforlocation 0
ons.pop();}}}elseif(c 1
"){r="x11";}elseif(r=="a2"||r=="x12"){r="x12";}elseif(r=="a3"||r=="x13"){r="x13";}elseif( 5
){cout<<"Errorinline 0
e_output_name=current_opened_file+".output"; 0
of_stack,top_line});stringexecuted_instruction=all_instructions[P 0
tring>(0));//Checkif 1
structionstringopcode="1100011";stringf3=funct3[assembly_code[ins 0
ssembly_cod 0
hinecodehexadecimalandstoreintextmemoryfor(intinstruction_no=0;instructio 0
or(inti=1;i<instruction.size();i++){uint64_tstore_value=stoi(instruction[i]);v 3
malandhexadecimalvaluesif(assembly_code[instruction_no][2][1]=='x'){s 4
tes(4);for(inti=0 1
t=offset_mask&mem_loc;//Wenowhavetheindexandtagwewant.Wecanp 0
.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++) 2
oftheinstructionstringopcode="1100011";s 0
ortheJformatstepinstructionsvoidstep_J(vector<string>in 1
cur_instr[0]]=='R'){step_R(cur_instr);}elseif(format[cur_instr[0]]=='I'){step_I(cur_instr);}elseif( 8
datethememoryif(removed_data[1]==1){is_dirty=true;intto_store_mem_loc=0;//Hereth\etagandinde 2
nd.find("load")){//Firstresetalltheregisters/memory/PCbeforeloadingthenextfileinitiali 1
lues[rs1];if(inst=="lb"){int8_tbyte=read_access(start_location,false);int8_tres=byte;register_val 3
di"){register_values[rd]=register_values[rs1]+imm;}elseif(inst=="xori"){ 4
ffset];//Sincethisahit,weneedtoupdatetheorder 0
of_instruction){s 0
][0]]=='J'){execute_J(assembly_code,instruction_no);}els 3
gtemporary_register_no="t";temporary_register_no+=to_string 0
struction_no<a 0
valid=false;for(inti=0;i<associativity;i++){vector<int>cache_block(block_size+ 1
st=="srli"){uint32_tshifting_amount=imm;if(shifting_amount!=0){register_values[rd]=register 2
front();q.pop();if(cur!=tag){dummy_q.push(cur);}}while(!dummy_q.empty()){intcur=dummy_q.front();du 8
(cache_con 0
0);stringmem_lo 0
o_of_bits){bin.push_back(' 0
rformloadaspertheinstructionif(inst=="lb"||inst=="lh"||inst=="lw"||inst=="ld"||inst== 0
f_register_int,64,1);stringvalue_of_register_hex=binary_t 0
_mask=temp_mask-1;index_mask=index_mask^temp_mask;//Makesthepositionsofoffseybitsze 0
ng>load_operands;unordered_map<string,int 0
tion_no].size()!=3){cout< 1
ri"||inst=="ori"||inst 0
size()<no_of_bits){bin.push_back('0');}reverse(bin.begin(),bin.end());if(!isSign 6
stringfirst_word=executed_instruction.substr(0,pos);if(first_word.ba 1
toi(assembly_code[instruction_n 0
Setthebittodirty}for(inti=0;i<associativity;i++){if(cache[index][i][2]==top_tag){removed_ 4
instruction.substr(p 0
ainingwords,criticalwordfirstploicyintsta 0
[0]=="slli"){if(stoi(assembly_code[instruction_no][3])<0||stoi(assembly_c 4
register_values["x0"]=0;}//CodefortheBformatstepinstructionsvoidstep_B(vector<str 1
();instruction_no++){if(format[assembly_code[instruction_no][0]]=='R'){execute_R(assembly_c 5
o][2][1]=='x'){stringbin_instr=hex_to_binary(assembly_code[instruction_no][2].s 4
on_no][1]];stri 1
k_size;intend_storage=(mem_lo 0
breakpointintbreak_point=stoi(command.substr(6));//Wet 2
bitsandoffsetbitszero//Letusdothesameforindexmakintindex_mask=1;index_mask=index 0
string,char>bin_to_hex;bin_to_hex["0000"]='0';bin_to_hex["0001"]='1';bin_to_h 2
ta[3+i];}}}}}//Hereweneedtoensurethatallthebocksarewritten 1
:"<<instruction_no+1<<end 0
rackofthenewpcvalueandextractthers1andrs2v 0
lock_size-1);for(intj=start_storage,k=3;j< 0
<endl<<"Incorrectvalueofrs2";exit(0);}elseif(registers.find(assembly_code[i 1
ters/memory/PCbeforeloadingthe 0
ngerrorif(assembly_code[instruction_no].size()!=4){cout< 3
<vector<int>>(associativity,vector< 2
printthelabelsinstack,bottomt 0
e=log2(block_size);//Thesemanybitsareforoffsetintindex_size=log2 1
"Executionstoppedatbreakpoint\n";}else{while(PC/4<no_of_instruction){if(break_lin 0
[0].size());intstart_storage=(mem_loc/block_size)*block_s 3
icalwordfirstploicyintstart_storage=(mem 0
(inti=0;i<4;i++){binary_bytes[i]=hex_to_binary(hex_instruction.substr(6- 1
hex;}}if(length*4<binary.size()){hex=hex.substr(binary.size()-length*4);}if(trim){stringtrim 5
heif(write_back_policy=="WT"){memory[mem_loc]=val;//Incaseofwritethroughandmiss,wedo 2
"a2"||r=="x12"){r="x12";}e 1
ount))-1;if(shifting_amount==0){for(inti=0;i<=63;i++){mask+=pow(2,i);}}regist 3
eingrequestedbyprogramintindex=index_mask&mem_loc;index>>=(offset_size);//Let'sgetthevalueofoffse 1
f(inst=="sw"){bool 1
immed_instr;//Gothroughthecurrentinstructionandstoreitina2dmatrixofstringsvector<string>cur_i 1
store,data_base_address);}}continue;}//remov 0
,offset);}}}}else{memory[mem_loc]=val;}}intread_access(intmem_loc,boolaccessed_once){if(cach 3
ciativity==0){//Thismeansthatthereisonly1index,everyoneisfightingforthisonein 0
=index_mask^temp_mask;//Makesthepositionsofoffseybitszero//Weneed 0
x(bin_PC);hex_PC="0x"+hex_PC;c 1
4";}elseif(r=="a5"||r=="x15"){r="x15";}elseif(r=="a6"||r=="x16"){r="x16";}elseif(r=="a7"||r=="x 4
lueofrs1";exit(0);}elseif(stoi(assembly_code[instruction_no][3])<-pow(2,11)||sto 5
ruction_no][3]];//Concatinatingtheinstructionstringinstr=f7+rs2+r 1
cond;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,top_l 1
uint32_tres=byte[3]<<24|byte[2]<<16|byte[1]<<8|byte[0];reg 4
nstructionsvoidstep_J(vector<string>instruction){//Storethenewpcvaluetojumptointne 2
\etagandindexshouldbeoftheremoveddatano?to_store_mem_loc|=(removed_data[2]<<(offset_size+index_size) 2
et:"<<hex_set<<","<<"Miss"<<",Tag: 0
eclarethememory//intmemory[0x50001];vector<int>memory(0x50001,0);//Initializethevalue 3
hestartaddressfromwhichwehavet 0
Remover(instruction[3]);//Dothearithmeticaccording 2
;}stringbin_PC=decimal_to_binary(old_ 0
bin.size()<no_of_bits){bin.push_back('0');}reverse(bin.begin(),bin.end());if 6
top_of_stack,top_line});stringexecuted_instruction=all_instructions[PC/4];intpos=executed_in 1
hevaluewhichisreplacedq.push(tag);//Push 1
size=log2(cache_size/(associa 0
rdinglyregister_values[rd]=PC+4;PC=imm+regi 1
e){returnbin;}//Take1'scomplementfor(inti=0;i<bin.size();i++){if(bin[i]=='0'){bin[i]='1';}else{b 6
icyif(!found 0
ringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";P 1
he_simstats"){if(cache_enabled){cout<<"D-cachestatistics:Accesses="<<hits+misses<<",Hit="<<hits 1
to_binary(value_of_register_int,64,1);stringvalue_of_register_hex=binary_to_hex(value_of 1
mberinthevariableinstruction_nostringhex_instruction=binary_to_hex(instr);vector< 1
ss,false,5);stringbin_set=decimal_to_binary(index,20,0);stringhex_set="0 1
executed_inst 0
loc/block_size)*block_ 0
ear();offset_to_la 1
ccessed_once=true;}int64_tres=(byte[7]<<56 1
=(mem_loc/block_size)*block_size+(block_size-1);new_data[0]=1;//Thebitisnowvalidnew_data 3
l<<"Valueofimmedi 0
torehalfwordintstore_half(vector<string>in 1
/Iterateoverthebinarystringfor(inti=0;i<length;i++){//Ifthecurrentcharacteris' 0
_mask=tag_mask<<20;tag_mask=tag_mask-1;//Thismakesthemask20onesinttemp_mask=1;temp_mask=tem 0
struction){//Extracttherdandi 0
check_space=false;//Wen 0
ctions[PC/4];intpos=executed_instruction.find('');strin 2
alwaysremaina 0
<bin.size();i++){if(bin[i]=='0' 2
ache_output.close();}cache_output_name 1
ingwords,criticalwordfirstplo 0
"<<hits+misses<<",Hit="<<hits<<",Miss="<<misses<<",HitRate="<<fixed<<setprecision(3)<<(double) 2
aif(instruction==".data"){data=true;count_how_ma 1
_function.top 0
er_hex=binary_to_hex(value_of_register_bin,true, 0
mal=binary_to_decimal(bin_instr);imm=decima 1
truction.substr(pos+1);}stringbin_PC=decimal_to_bi 1
ouspartsoftheinstrcutionstringopcode="1101111";string 0
ar>bin_to_hex;bin_to_hex["0000"]='0';bin_to_hex["0001"] 2
f(inst=="sd"){boolaccessed_once=false;vector<uint8_t>byte(8);for(inti=0;i< 3
x,forRtypeformat,youmustent 0
s,wedonotcontactthecacheatall.So,weneed 0
/Getthetagwhichweneedtoreplaceq.pop();//Popthevaluewhichisreplacedq.push(tag);//Pushthenewtagvaluev 2
nstr=hex_to_binary(instruction[2].substr(2));intdecimal=binary_to_decimal(bin_instr);imm=decimal 4
irstfigureouthowour20bitsofmemoryaddressaredivided.intoffset_size=log2(block_size);//Thesem 1
}}}elseif(command=="run"){//Runtheentir 1
t_size);for(inti=0;i<block_size;i++){memory[to_store_ 0
ghex_set="0x"+binary_to_hex(bin_s 0
(assembly_code[instruction_no][1])==registers.end()){cout<<"Errorinline:"<<i 4
gister_values[rs1]-register_values[rs2];}elseif(inst=="an 2
nstruction=executed_instruction.substr(pos+1);}stringbin_PC=de 1
locationthat 0
,instruction_no);}elseif(format[assembl 0
h(tag);//Pushthenew 1
ecimal(bin_instr);dec_imm=decimal;}else{dec_imm=stoi(asse 1
d_register_no="s";saved_register_no+=t 0
,string>funct7;unordered_map<st 0
trings_count="";//Countofthenumberofmemorylocationswehavetodisplayboolcheck_space=false;//Wenowe 0
truction_no+1<<endl<<"Incorrectvalueofrs2";exit(0);}//Notingth 1
t<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs1";exit(0);}else 1
reakpointintbreak_poin 0
){stringthis_register="x";if(i<10){cha 0
ut.open(cache_output_name 0
{inttop_tag=q.front();//Getthetagwhichweneed 1
olfound_invalid=false;for(inti=0;i<associativity;i++){vector<int>ca 1
);last_exected_line.clear();break_line 1
binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex 2
Givingthecorrectopcodetothecorrespondinginstructionif(load_op 0
ctionstringinstr=imm.substr(0,1)+imm.substr(10,10)+imm.substr(9,1)+im 3
[mem_loc];update_queue(index,tag,true,m 1
ary_to_hex(bin_set,true,5);stringbin_tag=decimal_to_binary(cache[i][j][2],20,0);stringhex_tag="0x"+ 5
tringhex_mem_val="0x"+binary_to_hex(bin_mem_val,true,2);intmem_loc=i;stri 1
xtfileinitiali 0
stoi(assemb 0
m_locwhereyoucanwritetonextreturnmem_loc;}//Functiontost 0
hevaluesintheD-cacheandwriteonlyt 0
f(hex[i]=='0'){continue;}else{trimmed_hex=hex.substr(i);returntrimmed_hex;}}return"0";}returnhex; 5
mem_loc;tag>>=(index_ 0
hit,weneedtoupdatetheorderofaccessvectorupdate_queue( 0
1)+imm.substr(2,6)+ 1
resent\n";} 0
<";PC="<<hex_PC<<endl;/ 0
erands"<<endl;exit(0);}if(labels.find(assembly_code[instruction_no][3])==la 4
ngtop_of_stack=stack_of_functions.top().first;inttop_li 1
in_set,true,5);stringbin_tag=decimal_to_binary(cache[i][j][2],20,0);stringhex_tag="0x"+bi 4
write_access(mem_loc+i,byte[i],accessed_once);accessed_once=true;}}//Updatethestackoffunctionsand 2
!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forItypeformat,youmustenter4oper 0
allynotdirtynew_data[2]=tag;for(intj=start_storage,k=3;j<=end_sto 1
structionsvoidexecute_B(vector<vector<string>>&a 2
code[instruct 0
["xor"]="100";funct3["sll"]="001";funct3["srl"]="101";funct3["sra 3
orrectvalueofrd";exit(0);}intdec_imm;//Weacceptbothdecimalandhex 1
struction_no+1<<endl<<"Wrongsyntax,forStypeformat,youmu 0
offsetaswell,because 0
c];update_queue(index,tag,true,mem_loc,"read",true,false);retur 1
0x"<<value_of_register_hex<<endl 0
;//Iterateoverthebinarystringfor(inti=0;i<length;i++){ 0
ock_size+3);cache_bloc 0
x0";}elseif(r=="ra"||r=="x1"){r="x1";}elseif(r=="sp" 2
_of_instruction=assembly_code.size();boolto_ 1
<string>instruction) 1
rs1]+register_values[rs2];}elseif(inst=="sub"){register_values[rd]=register_values[rs1]-regist 4
2,11)){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange"; 0
"110";funct3["xor"]="100";funct3["sll"]="001";funct3["srl"]="101";funct3["sra"]="101";funct3[" 4
s(start_locati 0
gth=bin.size();//Iterateoverthebinarystringfor(inti=0;i<length;i++){//Ifthecurr 1
ister_no+=to_string(i-18+2);registers[saved_register_no]=this_ 2
'S'||cur_instruction[0]=="jalr"){swap(cur_instruction[2],cur_instruction[3]);}assembly 5
1"]='5';bin_to_hex[ 0
sk=temp_mask-1;index_mask=index_mask^temp_mask;//Makesthepositionsofoffseybit 0
irstcheckifwehaveaninvalidframe,andifwedo,thenwecandirec 0
ializethevalueofPCintPC;//Herewedeclareallvariablesrelatedtocacheintcache_size,block_size 0
x_mask-1;temp_mask=1;temp_mask=temp_mask<<offset_size;temp_mask=temp_mask-1;index_mask=index_ 0
ange";exit(0);}imm=decimal_to_binary(stoi(assembly_code[instruction_no][3]),6,true);imm= 5
,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Execu 1
000000";funct7["s 0
ngcurrent_opened_file="";vector<queue< 0
bytes[i]);//characters67ofhex_instruction}for(inti=0;i<4;i++){memory[instruction_no*4 1
ead",true,false);retur 0
[assembly_code[instruction_no][0]]=='S'){execute_S(assembly_code,instruction_no);}el 5
ns.top().second;top_line=PC/4+1;stack_of_functions.p 1
queueofstrings,suchthatafterexecutionofeachrun,wecandequeuethetopstringinstructi 0
r_miss="Hit";}if(is_dirty){clean_or_dirty="Di 1
et_size);for(inti=0;i<block_si 0
3){registers["gp" 0
e);}if(inst=="sw"){boolaccessed_once=false;vector<uint8_t>byte(4);for(inti=0;i<4;i++){byte[3 3
liasRemover(instruction[3]);//Dothearithmeticaccordingtotheinstructionsif(inst 2
){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorr 0
urethatthevalueofx0is0register_values["x0"]=0;}//CodeforRformatins 1
mat["ori"]='I';format["andi"]='I';format["slli"]='I';format["srli" 3
truction_no][3])>=pow(2,11)) 2
toreadinttag=tag_mask&mem_loc;tag>>=(index_size+off 0
nd(assembly_code[instruction_no][1])==registers.end()){cout<<"Errorinline 4
lues[rs2];}//Updatethestackoffun 1
){//Weparsethestringtogetthelinenumberwherewehavetoinsertabr 0
(inst=="andi"){register_values[rd]=regi 2
stringrs2=aliasRemover(instruction[3]) 2
code[instruction_no][3])<-pow(2,11)||stoi(assembly_code[ins 3
_value>>(3-i)*8;}for(inti=0;i<4;i++){memory[mem_l 1
e_J(assembly_code,instruction_no);}elseif(format[assembly_code[instruction_no][0]]=='U'){execute_U(a 5
ze()-1]==','||cur[cur.size()-1]= 3
0PC=PC+4;register_valu 0
push_back(cur);}cur="";}else{cur.push_back(c);}} 3
gfirst_word=executed_instruction.substr(0,pos);if(first_wo 1
type;intdata_base_address=0x10000;//Loadthenextfileintoaqueueofstrings,suchthatafterexecutionofeac 0
tif(break_lines.find(break_point-count_how_many_to_sk 0
edfordatasegmentandthefirstlineoftext(.text)count_how_man 1
(0);}elseif(registers.find(assem 1
ead_access(start_location+i,accessed_once);accessed_once=true;}int32_tres=(byte[3]<<24)|(by 2
_values[rs2];if(shifting_amount!=0){register_v 2
asRemover(instruction[1]);rs1=aliasRemover(instruction[2]);imm=stoi(instruction[3]);/ 6
values[this_register];stringvalue_of_regist 1
8){registers["s0"]=this_register;registers["fp"]=this_registe 2
,accessed_once);accessed_once=true;}uint32_tres= 0
x7";}elseif(r=="s0"||r=="fp"||r=="x8"){r="x8";}elseif(r=="s1"||r=="x9") 3
="",fs="";for(inti=length*4;i<binary.size();i++){zeros.push_back('0');fs.push_back('f');}if(he 4
enowextractthevalueofaddrandcountbyparsingthelinefor(inti=4;i<command.size();i+ 1
_present=false;while(!q.empty()){intcur=q.front();q.pop();dummy_q.push(cur);if(cur==tag){is_pr 6
r;}elseif(i==8){regi 1
"]='I';format["ori"]='I' 1
ord.back()==':'){executed_instruction=executed_instruction 1
ewrittenifdirtyfor(in 0
tpos=executed_instruction.find('');str 1
0)|(byte[4]<<32)|(byte[3]<<24)|(byte[2]<<16) 3
hevaluewhichisreplacedq.push(tag);//Pushthene 1
mount))-1;if(shifting_amount==0){for(inti=0;i<=63;i++){mask+=pow(2,i);}}register_values[rd]=regi 4
uction_no][2]];stringrs2=registers[assembly_code[instruction_no 1
at();initialize_load_operands() 2
3]),12,true);//Concatinatingthevariouspartsstringinstr=imm.substr( 0
se,false,val);cache[index][i]=cache_block;re 2
"CacheEnabled"<<endl;cout<<"CacheSize:"<<cache_size<<endl;cout<<"BlockSi 0
notfindthisb 0
it(0);}imm=decimal_to_binary(stoi(assembly_code[instruc 1
rinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forItypeformat,youmustenter4operands"<<endl;ex 0
{cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyn 0
ngzeros="",fs 0
or(intj=start_storage,k=3;j<=end_storage;j 0
needtomakeitfullyassociativeif(associativity==0){//T 1
catinatingtheinstructionstringinstr=imm.substr(0,1)+imm.subs 1
eration,boolis_read,boolis_hit,intval=-1,intoffset=-1){queue<int>q=order_of_access[inde 1
tringdata_type;intdata_base_address=0x10000;//Loadthenextfileintoaqueueofstrings,suchtha 0
partsoftheinstrctionstringopcode="0110111"; 0
lse{vector<string>cur_instr=assembly_code[PC/4];if(format[cur_instr[0]]=='R'){step_R(cur_ 5
ex_size));to_store_mem_loc|=(i<<offset_ 0
_to_label.clear();while(!stack_of_fu 1
n_no){//Handlingerrorif 0
turnr;}voidupdate_queue 0
n[2]);intmem_loc=i 1
//Hereweareonlydealingwithcacheandnotqueueif(!to_replace){//Donothing}else{intrandom_num 2
g(labels[assembly_code[instruction_no][3]]- 3
;//Makesthepositionsofindexbitsandoffsetbitszero//Letusdothesameforindexmakintind 0
instruction_no+1<<endl<<"Incorrectvalueofrs2";exit(0);}elseif(stoi(assembly_c 1
se_address);}elseif(to_store[0]==". 1
ntj=start_storage,k=3;j<=end_storage;j++,k++){new_data[k]=memory[j];}if(operation=="write 3
_how_many_to_skip++;if(instruction==".text"){data=false;}else{//Storetherequireddw 2
chisreplacedq.push(tag);//Pushthenewtagvaluevector<int>removed_data( 2
ormat["sub"]='R';format["xor" 1
")){//Thisblockdeletesabeakpointintheprogramintbreak_point=stoi(command.substr(10) 1
]]=='J'){execute_J(assembly_code,instruction_no);}elseif(format[assembly_code[instruction_no][0]]= 5
1];vector<int>memory(0x50001,0);//InitializethevalueofPCintPC;//Herewedeclareallvariablesrela 2
iativity=0,thenweneedtomakeitfullyassociativeif(associativity==0) 1
nstringopcode="0110111";stringrd=registers[assembly_co 0
ore_mem_loc|=(index<<offset_size);for(inti=0;i<block_siz 0
+){memory[mem_loc+i]=byte[i];}mem_loc+=8;}//Returnthenewmem_locwh 3
g_mask<<20;tag_mask=tag_mask-1;//Thismakesthemask20onesinttemp_mask=1;temp_mask=temp_mask<<(inde 0
bly_code[instruction_no][1]];stringrs2=registers[assembly_code[instruction_no][2]];stringimm=decima 5
uction_no*4+i]=byte[i];}}//CodeforBformatinstruct 1
andcountbyparsingthelinefor(inti=4;i<command.size();i++){if(!check_space){if(command[ 2
ningwords,criticalwordfirstploicyintstart_storage=( 0
ingthevaiouspartsoftheinstrctionstringopcode="0110111";stringrd=registers[assembly_code[ 0
k_size)*block_size+(block_size-1) 1
er_values[rs2]){PC=new_pc;}e 2
icy,write_back_policy;boolcache_enabled=false;vector<vector<vector<int>> 2
ntostorehalfwordint 0
torethereq 0
="x31";}returnr;}voidupdate_queue(intindex,inttag,boolto_replac 0
t"]='B';format["bne"]='B';format["bltu"]='B';format["bge 2
che[index][i][2]= 3
<"Erroronline:"<<instruction_no+1<<endl<<"Incorrectsyntax";exit(0) 1
f_access[index]=q;}voidwrite_access(intmem_loc,intval,boolaccessed_once){if(cache_ 2
hit,weneedtoupdatetheorderofaccessvectorupdate_que 0
returnmem_loc;}//Functiontostorebytwintstore_byte(vector<string>instruction,intmem_loc){//Go 2
gister_values[rs1]&imm;}elseif(inst=="slli"){register_values[r 2
atethemaskrequiredtofindoutthetagbitslaterinttag_mask=1;tag_mask=tag_mask<<20;tag_mask=tag_ 0
vaiourspartsoftheinstr 0
breakpointatline:"<<break_point<<endl;}elseif(!command.find("cache_simenabl 0
ion_no*4+i]=byte[i];}}//Code 1
ned_file.pop_back();current_opened_file.pop_back();PC=0;while(getline(instruction_ 2
i<instruction.size();i++){uint64_tstore_value=stoi( 1
u"]="110";fu 0
i<4;i++){write_access(mem_loc+i,byte[i],accessed_once);accessed_ 2
xt"){data=false;}else{//Storetherequireddword/word/ 1
irty,tag,dataif(cache_block[0]==0){//Th 2
rsdontmatterorder_of_access.cl 0
x][i];//Valid,Dirty 1
lues[rd]&=mask;}}elseif(inst=="srai"){register_va 2
ntpos=executed_instruction.find('');stringfirst_word=executed_instruction.substr(0,pos);if(firs 2
false);regist 0
ar();//cache.clear();for(inti=0;i<memor 2
x_mask&mem_loc;index>>=(offset_size);//Let'sgetthevalueofoffsetbitsi 1
rmat["lb"]='I';format["lbu"]='I';format["lhu"]='I';format["lwu"]='I';format["j 4
//Gothroughthecurrentinstructionandstoreitina2dmatrixofstringsvector<string>cur_instruction; 1
ofhowmanylineswereusedfordatasegmentandthefirstlineoftext(.text)count_how_many_ 1
cache[index][i][3+offset]=val;cache[i 3
lues[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="bne"){if(register_val 4
ector<string>>&assembly_code,intinstruction_no){//H 1
_code[instruction_no][3])<-pow(2,11)||stoi(assembly_code[instruc 3
truction_no][2])==registers.end()){cou 2
";}elseif(r=="s10"||r=="x26"){r="x26";}elseif(r=="s11"||r 2
it="<<hits< 0
h_back(command[i]);}}else{s_count.push_b 2
ut<<"Errorinline:"<< 0
irty=false;if(replacement_policy==" 0
[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]);//char 4
ache_simenable")){cache_enabled=true;stringcache_config_file_name=command.substr(17);if 1
i"){register_values[rd]=register_values[rs1]^imm;}e 3
ep_S(cur_instr);}elseif(format[cur_instr[0]]=='B'){step_B(cur_instr);}elseif(form 6
uesthattheuserhasspecifiedandstorethemstartingforlocationspecifiedbythemem_locf 0
nt_opened_file="";ve 0
nstruction[2]);imm=stoi(instructi 1
c/block_size)*block_size+(block_size-1);new 1
nt_opened_file.pop_back( 0
nghex_instructio 0
/Infiniteloopthatreadsuserinputswhile(true){//Nowsavethenextfilestringcommand;ge 1
tsareforoffsetintindex_size=log2(cache_size/(associa 0
ddressesinformofintegerintstart_location=imm+register_values[rs1];if(ins 1
unct3["bne"]="001";funct3["blt"]=" 2
t;inttop_line=stack_of_functions.top().second;top_line=PC/4+1;stac 1
dered_map<string,string>reg 1
"srli"]='I';format["srai"]='I';format["ld"]='I';format["lw"]='I';format["lh"]='I';for 4
ut<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forStyp 0
et=-1){queue<int>q=order_of_access[index];queue<int>dummy_q;intoffset_size=log2(block_size);//These 4
[2])==labels.end()){cout<<"Errorinline:"<<instructi 2
registers.find(assembly 0
;}}register_values[rd]= 1
ers.find(assembly_code[instruction_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_ 4
dr.substr(2);//Weremovetheleading0xinthestring//Wenowwanttoconvertittodecimalrepresenttion,viabin 1
inttheregistervalueswhicharestoredinthema 0
00";funct3["sh"]="001" 1
offset_mask=1;offset_ 0
_bytes(4);for(inti=0;i<4;i++){bina 1
ring(labels[assembly_code[instruction_no][3]]-instruction_no 3
);//Concatinatingthepartstoformtheinstructionstringinstr=imm.su 0
tstepinstructionsvoi 0
rvalueswhicharestoredinthemapcout<<"R 0
"ra"]=this_register;}elseif(i==2){registers["sp"]=this_register;} 3
{stringthis_register="x";if(i<10){charnum='0'+i;this_re 0
format["lhu"]='I'; 1
mofintegerintstart_location=imm+register_values[rs1];if( 1
h"]="001";funct3["sw"]="010";funct3["sd"] 2
.find(assembly_code[instruction_no][1])==registers.end( 3
nary(assembly_c 0
;}if(is_dirty){clean_or_dirty="Dirty";}if(is_read){read_or_write="R";}strin 4
==':'){executed_instruction=exec 0
cordinglystringtop_of_stack=stack_of_fun 0
(tag,20,0);stringhex_tag="0x"+binary_to_hex(bin_tag,true,5);cache_output<<read_o 2
euethetopstringinstruction;instruction_file.open(comm 0
s1=register_values[rs1],val_rs2=r 1
second;top_line=old_PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,top_line} 2
";funct3["beq"]="000";funct3["bne"]="001";funct3["blt"]="100";funct3["bge"]="101"; 4
=register_va 0
rst_word.back()==':'){executed_instru 1
once=true;}}if(inst=="sd"){boolaccessed_once=false;vector<uint8_t>byte(8);for(inti=0 3
ecutetheshow-stackcommandcout<<"CallStack:\n";//Weuseadummystacktopopthelabelsfromthemai 0
ingopcode="1100011";stringf3=funct3[assembly_code[instruction_no][0]];stringrs1=registers[assem 3
ed,thenensuretopopmainfromthestackif(PC/4==no_o 0
"){uint64_tval 0
=".text"){data=false;}else{//Storetherequireddword/word/byte 1
sters[assembly_code[instruction_no][2]];s 3
ector<int32_t>byte(4);boolaccessed_once=false;f 2
ess=decimal_to_binary(mem_loc,20,0);stringhex_address="0x"+binary_t 1
Wrongsyntax,forStypeformat,youmustenter4operands"<< 0
tag,false,mem_loc,"read",true,false);cache[index][i]=cache 2
s=0,misses=0;stringcurrent_opened_file="";vector<queue< 0
i++){memory[instruction_no*4+i]=byte[i];}}//CodeforUform 3
<assembly_code.size();instruction_no++){if(format[assembly_code[i 1
_back(instruction[i] 1
){memory[to_store_mem_loc+i]=removed_data[3+i];}}}}}//Her 3
;}}elseif(command=="cache_simdis 0
=registers.end()){ 1
1;i>=0;i--){if(bin[i]=='0'){bin[i 2
instruction}for(inti=0;i<4;i++){memor 0
r;}elseif(i>=5&&i<=7){s 0
;stringhex_inst 0
hevalueandthenstoretheremainingwords,crit 0
lse{cout<<"Erroronline:"<<instruction_no+1<<endl<<"Incorr 0
policy=="LRU"){if(!to_replace){ 1
e{PC+=4;}}elseif(inst=="bgeu"){uint64_tval_rs1=register_values[rs1],val_rs2=re 3
f(format[assembly_code[instruction_no][0 1
art_storage=(mem_loc/block_size)*block_size;intend_storage=( 1
inary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[ 3
eoperandsbacktothecorrectpositioninthematrixif(load_operands.find(cur_instruction[0])!=load_op 2
heuserhasspecifiedandstorethemstartingforlocationspecifiedbythemem_locfor(inti=1;i<ins 0
em_loc,"write",false,tru 0
ur="";for(charc:instruction){if(c==' 1
=0;}elseif(command=="cach 0
y[i]=0;}for(inti=0;i<cache.size();i++){for(intj=0;j<cache[i].size();j++ 4
owwanttoconvertittodecimalrepresenttio 0
reonlydealingwit 0
ruction[1]);rs1=aliasRemover(instruction[2]) 3
iableinstruction_nostringhex_instruction=binary_to_hex(instr);vector<string>b 2
gettheactualvalueoftagbitsinthememoryl 0
ssembly_code[inst 0
ingthevaiourspar 0
);}elseif(format[cur_instr[0]]=='J'){step_J(cur_instr);}elseif(format[cur_instr[0]]=='U' 7
,weneedtolookinthememoryif(!found){if(!accessed_once){misses++;}//Firstcheckifwehav 3
(dec_imm<0||dec_imm>4294963200){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofi 2
dress,false,5);stringbin_set=decimal_to_binary(in 0
ze;intend_storage=(mem_loc/block_size)*block_size+(block_size-1);new_data[0]=1;//Thebitis 3
bitsboolis_dirty=false;if(replacement_policy=="FIFO"){i 1
to_label[PC],-1});stringexecuted_instruction=all_instruct 1
["sll"]="001";funct3["srl"]="101";funct3["sra"]="101";funct3["addi"]="000";funct3["xori"]="1 5
";funct3["andi"]="111";funct3["slli"]="001";funct3["srli"]="101";fu 3
hevalueofoffsetbitsintoffset=offset_mask&mem_loc;//Wenowhavetheindexandtagwewant.Wecanpro 0
(byte[4]<<32)|(byte[3]<<24)|(byte[2]<<16)|(byte[1]<<8)|byte[0];register_v 5
aliasRemover(instruction[2]);intmem_loc=imm+register_values[rs1];uint64_tstore_value 3
"x13"){r="x13";}elseif(r=="a4"||r=="x14"){r="x14";}elseif(r=="a5"||r=="x15"){r="x15"; 4
'){execute_ 0
_loc/block_size)*block_size+(block_size-1);cache_block[0]=1;//Thebitisnowvalidcache_b 2
tisticsif(cache_enabled){cout<<"D-caches 1
values[this_register];stringvalue_of_register_bin=decimal_to_binary( 1
g>cur_instruction;all_instructions.push_back(instruction);stringcur 1
"1011"]='b';bin_to_hex["1100"]='c';bin_to_hex["1101"]= 2
truction_no][3])<-pow(2,11)||stoi(assembly_ 2
]];}returnbin;}//Codetoconvertdecimaltobinarystringdecimal_to_binary(intdecimal,intno_of_bi 0
rithm>#include<cstdli 0
nt64_tstore_value=stoi(instruction[i]);vec 2
ock[0]==0){//Thisisaninvalidframe,ignorecontinue;}if(c 2
{vector<uint8_ 0
}if(inst=="sw"){boolaccessed_once=false;vector<uint8_t>byte(4);for(inti=0;i<4; 3
aceq.pop();//Popthevaluewhichisreplacedq.push(tag);//Pushthene 2
nordered_map<char,string>hex_to_bin;hex_to_bin['0']="0000";hex_to_bin['1']="0001";hex_to_bin['2 3
t(0);}intdec_imm;//Weacceptbothdecimalandhexadecimalvaluesif(assembly_code[instruction_no][2][1 3
etagbitslaterinttag_mask=1;tag_mask=tag_mask<<20;tag_mask=tag_mask-1;//Thismakesthemask20onesin 0
ock[2]==tag){is_hit=true;found=true;val=cache_block[3+offset];//Sincethisahi 2
/Notethatthesizeifblocksize+3because 0
else{if(cur[cur.s 0
ock_size+3);cache_block=cache[index][i];//Valid,Dirty,tag,dataif(cache_block[0]==0){val= 4
{unordered_map<string,char>bin_to_hex;bin_to_hex["0000"]='0';bin_to_hex["0001"]='1'; 3
ters.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrect 1
empty()){intcur=q.front();q.pop();dum 3
oncatinatingtheinstructionstringinstr=imm+rd+opcode;stringhex_instruction=bina 0
ur!=""){to_store.push_back(cur) 1
o_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl; 1
lseif(i==2){registers["sp"]=this_register;}elseif(i==3){registers["gp"]=this_regis 5
"break")){//Weparset 0
values[rs2];//Ourmaskisshifting_amount0'sfollowedby64-shifting_amount1's 1
/Thebitisnowvalidcache_blo 0
mory[instruction_no*4+i]=byte[i];}}//CodeforSformatinstructionsvoidexecute_S(vect 2
]==','||cur[cur.siz 0
word=executed_instruction.substr( 0
<(offset_size+index_size));to_store_mem_loc|=(i<<offset_si 1
dex<<offset_size);for(inti=0;i<block_size;i++){memory[to_store 0
ation=="write"){new_data[3+offset]=val;new_data[1]=1;//Setthebi 2
[0]==".dword"){data_base_address=store_dword(to_store,data_base_address);}e 3
om_number];cache[index][random_number]=new_data;//Nowcheckiftheremoveddatahasadir 2
;vector<string>all_instructions;unordered_m 1
ed_instruction.substr(0,pos);if(first_word.back( 1
on.substr(6-2*i,2)); 1
ex_instruction.substr(6-2*i,2));}u 1
lseif(r=="a4"||r=="x14"){r="x14";}elseif(r=="a5"||r=="x15"){r="x15";}elseif(r== 4
<write_back_policy;}else{cout<<"CacheDisabled";}}elseif(command==" 0
nline:"<<instruction_no+1<<endl<<"Incorrectvalueofr 0
r=="a2"||r=="x12"){r="x12";}elseif(r=="a3"||r=="x13"){r="x13";}elseif(r= 3
uted_instruction.substr(pos+1);}stringbin_PC=dec 1
r=hex_to_binary(instruction[2].substr(2));i 3
stexecutedlineaccordinglystr 0
.back()==':'){executed_instruction=executed_instructio 1
ex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_inst 0
="0x"+binary_to_hex(bin_address,false,5);stringbin_set=decimal_to_binary(index,20,0);stri 2
struction_no);}e 0
20,0);stringhex_tag="0x"+binary_to_hex(bin_tag,true,5) 1
l=memory[i];stringbin_mem_val=decimal_to_binary(mem_val,8,0);stringhex_mem 2
tring>instruction){stringrd,rs1,inst;inst=instruction[0];intimm;//Performloadaspe 1
ex,inttag,boolto_replace 0
=tag_mask^temp_mask;//Makesthepositionsofindexbitsandoff 0
hnottakenintold_PC=PC;//Exe 0
erequiredfieldsinitialize_registers();initialize_funct3();initialize_func 2
y_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_binar 2
reak_point<<endl;}elseif(!command.find("cache_simenable")){cache_ena 2
ude<random>#include<iomanip>#include<cstring>//Thefollowingensurethat64bitscanbehandledbyourcode#def 3
accordinglystringtop_of_stack=stack_of_functions.top().first;inttop_line=stack_of_funct 1
);new_data[0]=1;//Thebitisnowvalidnew_data[1]=0;//Initiallynotdirtynew_data[2]=tag;for(int 3
ndex_size=log2(cache_size/(associativity*block_ 0
nt>memory(0x50001,0);//InitializethevalueofPCintPC;//Herewedeclareallvariable 1
ndoffsetbitsz 0
<<24)|(byte[2]<<16)|(byte[1]<<8)|byte[0];register_values[rd]=res;}elseif(inst=="lbu" 4
<"Executed:"<<executed_ins 0
format,youmustenter4operands"<<endl;exit(0);}elseif(registers.find(assembly_ 1
uesif(instruction[2][1]=='x'){stringbin_instr=hex_to_binary(instruction[2].substr(2) 5
;exit(0);}elseif(stoi(assembly_code[instruction_no][3])<-pow(2,11)||stoi(assembly_c 5
]=binary_to_decimal(binar 0
_loc;}//Functiontostorehalfwordintstore_half(vector<string>instruction 1
ecuted_inst 0
tion_no][0]]=='U'){execute_U(assembly_code,instruction_no);}else{cout<<"Erroronline:"<<instruc 3
t_storage,k=3;j<=end_storage;j++,k+ 0
){cout<<"D-cachestatistics:Accesses="<<hits+misses<<",Hit="<<hits<<",Miss="< 0
t,string>offset_to_label;uno 0
I';format["srli"]='I' 1
ters67ofhex_instruction}for(inti=0;i<4;i++){memor 0
funct7(){funct7["add"]="0000000";funct7["su 2
umustenter3operands"<<endl;exit(0);}elseif(registers.find(assembly_code[instruction_ 1
,6)){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}im 1
){binary_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}ui 4
mbly_code[instruction_no][1])==registers.end() 3
t<<"Errorinline:"<<instructi 0
];queue<in 0
n_no);}elseif(format[assembly_code[instruction_no][0]]=='I'){execute_I(assembly_code,in 4
u");load_operands. 0
embly_code[instruction_no][0]]=='U'){execute_U(assembly 2
tag,true,5);cache_output<<read_or_write<<":Address:"<<hex_address<<",Set 0
nsvoidstep_B(vector<string>instruction){//Keeptrackofthenewpcvalueandextractth 2
=4){registers["tp"]=this_register;}elseif(i>=5&&i<=7){stringtemporary_registe 2
mmediateisoutofrange";exit(0);}imm=decimal_to_binary(stoi(assembly_code[instruction_no][3 2
te_queue(index,tag,false,mem_loc,"read",true,false);cache[index] 2
emanybitsareforoffsetintindex_size=log2(cache_size/(associativity*block_ 0
){if(cache[index][i][2]==top_tag){removed_data=cache[index][i];ca 6
put.close();}cache_output_name=current_opened_file+".output";cache_output.open(cache_output_nam 1
m_loc|=(removed_data[2]<<(offset_size+index_size));to_store_mem_loc|=(index<<offset_size);fo 2
eviousfilemighthaveusedvoidinitialize(){for(inti=0;i<32;i++){stringreg="x"+to_string(i);register_ 2
s1+f3+imm.substr(8,4)+imm.substr(1,1)+opcode;stringhex_instruction=binary_to_h 2
ra"]="101";funct3["addi"]="000";funct3["xori"]="100";funct3["ori"]="110";funct3["andi"]="111"; 4
:"<<break_point<<endl;}elseif(!command.find("cache_simenable 0
sh_back(c);}}if(cur!=""){to_store.push_back(cur);}if(to_store[0]==".dword"){data_base_address=store_ 6
out<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//Upd 0
yte[i];}}//Functiontostoredwordintstore_dword(vector<string>instruction,intmem_loc){//G 3
);}reverse(bin.begin(),bin.end());if(!isSigned||!isNegative){returnbin;}//Ta 5
hemaskrequiredtofindou 0
registers();initialize_funct3();initialize_funct7();init 3
//Ifwedidnotfindthevalue,weneedtolookinthememoryif(!found){if(!acce 1
]='c';bin_to_hex["1101"]='d';bin_to_hex["1110"]='e';bin_to_hex["1111"]='f 3
dirty}for(inti=0;i<ass 0
embly_code[in 0
strutionstringf3=funct3[ 0
<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrd";exit(0);}elseif(stoi(assembly_code[i 1
tialize_funct7();initialize_format();initialize_load_operands();initialize();ifstreaminst 4
te_back_policy=="WT"){stringbin_address=decimal_to_binary(mem_loc,20,0);st 1
gn(0,vector<str 0
[0].size());vector<int>new_data(cache[0][0].size());intstart_storage=(mem_loc/block_size) 8
is_present=true;}}while(!dummy_q.empty()){intcu 2
cifiedbythemem_locfor(int 0
gnorecontinue;}if(cache_block[2]==tag){if(!accessed_on 2
ter_values[rd]=res;}elseif(i 1
3();initialize_funct7();initialize_format();initialize_load_operands();initialize();ifs 5
e_access(mem_loc+i,byte[i],accessed_on 1
".half"){da 0
include<cstring>//Thefollowingensurethat64bitscanbehandledbyourcode#definestoistoll 1
1;//Wecannowgettheactualvalue 0
ynotdirtynew_data[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++){new_data[k]=memo 2
[instruction_no][1]];stringimm=decimal_to_binary(dec_imm,20,true);//Concatinatingtheinstr 3
0000";hex_to_bin['1']="0001";hex_to_bin['2'] 2
ordered_set<int>break_lines;in 1
d){read_or_write="R";}stringbin_address=decimal_to_binary(mem_loc,20,0);stringhex_address 2
ecorrectpositioninthematrixif(load_operands.find(cur_instruction[0])!=load_operands.en 2
_to_label.clear();while(!stack_of_functions.empty()){stack_of_functions.pop();}stac 5
][1]=1;//Settingittodirtyif(w 1
sters.end()){cout<<"Errorinline:"<<instru 1
index_mask=index_mask<<(index_size+offset_size);index_mask=i 1
){stringis_clean="Cle 0
'b';bin_to_hex["1100"]='c';bin_to_hex["1101"]='d';bin_to_hex["1 2
=register_values[rs1]>>register_values[rs2];//Ourmaskisshifting_amount0'sfollowedby 2
dex_mask=index_mask^temp_mask;//Makesthepositionsofoff 0
requireddword/word/byte/halfwordvector<string>to_store;stringcur="";for(charc:instr 1
d(to_store,data_base_address);}elseif(to_store[0]==".byte"){data_base_address=store_ 3
='3';bin_to_hex["0100"]='4' 1
3,0)));//Ini 0
ecuted,thenensuretopopmainfromthestackif(PC/4==no_of_instruction){stack_of_functions.pop(); 2
rmat[cur_instr[0]]=='J'){step_J(cur_instr);}elseif(format[cur_instr[0]]=='U'){st 7
;hex_to_bin['3']="001 1
[cur_instr[0]]=='S'){step_S(cur_instr) 3
x,forUtypeformat,youmustenter3operands"<<endl;exit( 0
[j][2],20,0);stringhex_tag="0x"+binary_to_hex(bin 2
orif(assembly_code[instruction_no].size()!=3){cout 3
){cout<<"Errorinli 0
,inttag,boolto_replace,intmem_loc,stringoperation,boolis_read,boolis_hit 0
t(0);}elseif(registers.find(assembly_code[instruction_no][2])==registers.end 4
val;}}intread_access(intmem_l 0
enabled){cout<<"D-c 0
count_how_many_to_skip);cout<<"Inse 0
ormat["srai"]='I';format["ld"]='I';fo 2
idblock,weneedtoapplyreplacementpolicyif(! 0
l<<"Wrongsyntax,forRtypeformat,youmustenter4operands"<<endl;exit 0
ing,int>last_exected_line;stack<pair<string,int>>stack_of_functions;unordered_set<int>break_line 3
substr(0,1)+imm.substr(2,6)+rs2+rs1+f3+imm.substr(8,4)+imm.substr(1,1)+opcode;stringhex_in 4
'){cur.push_back(instruction[i]);}else{if(cu 3
nly1byteintoffset_mask=1;offset_mask=of 0
"lw"||inst=="ld"||inst=="lbu"||inst=="lhu"||inst=="lwu"){ 0
tag){removed_data= 0
<<endl;exit(0);}if(labels.find(assembly 1
/4];intpos=executed_instruction.find('');str 1
instruction[0];rd=aliasRemover(instruction[1]);intimm;//Weacceptbothdecimalandhexadec 3
ess(start_loc 0
ck_of_functions.push({top_of_stack,top_line});stringexecuted_instruction= 2
s[rd]=PC+4;PC=imm+ 1
}register_values[ 0
command[i]==''){check_space=true;}else{s_addr.push_back(command[i]);}}else{s_count.push_back(comm 5
q.pop();q.push(cur);}//Notethatheretagwillalwaysbeatthetopq.push(tag);}else{in 3
d('');stringfirst_word=execute 1
(operation=="write"){new_data[3+offset]=val;new_data[1]=1;//Setthebittodirty}for(inti=0 4
is_dirty=true;intto_store_mem_loc=0;//Hereth\etagandindexshouldbeoftheremoveddatano?to_store 0
elseif(r=="t1"||r=="x6"){r="x6";}elseif(r=="t2"||r=="x7"){r="x7";}els 4
ncatinatingtheva 0
t>byte(8);for(inti=0;i< 1
dl<<"Wrongsyntax,for 0
assembly_code[instruction_no][1])==registers.end()){cout<<"Errorinline:"<<instruction 3
/removeunnecessaryspacefromthebeginningofanylinebooltrim= 0
"andi"||inst=="srai"||inst=="slli"||inst=="srli"){//Extract 0
value_of_register_hex=binary_to_hex(value_of_register_bin,true,16);cout<<this_regis 1
pop();}for(inti=dummy_stack.size()-1;i>=0;i--){//Usingalooptoprintthelabelsinsta 3
urcode#definestoistoll#defineintlonglongusingna 0
w(2,12)-1){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediate 1
oc_hex="0x"+binary_to_hex(mem_loc_bin,false,5);cout<<"Memory["<<mem_loc_hex<<"]"<<"="<<hex_ 1
_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,top_line});stri 3
0)|(byte[4]<<32)|(byte[3]<<24)|(byte[2]<<16)|(byte[1] 4
="fp"||r=="x8"){r="x8";}elseif(r=="s1"||r=="x9"){r="x9";}elseif(r=="a0"||r=="x10"){r="x 4
fthecurrentcharacteris'1',addtheco 0
o+=to_string(i);stringthis_register=decimal_to_binary( 1
turnmem_loc;}//Functiontostorebytwintstore_byte(vector<string>instruction,int 1
y(hex_instruction.substr(6-2*i,2));}uin 2
]<<40)|(byte[4 0
ecimalvaluesif(instruction[2][1]=='x'){stringbin_instr=hex_to_bina 3
)){//Hereweshowthecountnumberofm 0
q.front();q.pop();dummy_q.push(cur);if(cur==tag){is_present=true;}}while(!dumm 5
eaccordinglystringtop_of_stack=stack 0
ction_no);}else{cout<<"Erroronline:"<<instruct 0
executed_instruction<<";PC="<<hex_PC<<endl;//Updatet 0
<<endl<<"Va 0
instruction=executed_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(old_PC,32, 1
k<<20;tag_mask=tag_mask-1;//Thismakest 0
x_mask=index_mask<<(index_size+offset_si 0
stack=stack_of_functions.top().first;inttop_line=stack_of_functions.top().second;top_line=PC/4+ 2
}}else{inttop_tag=q.front();//Getthetagwhichweneedtoreplaceq.pop();//Popthevaluewhichisreplace 2
_mask&mem_loc;//Wenowhavetheindexandtagwewant.Wecanproceedwithfindingtherealdatainthatlocat 0
on_no][0]];str 1
em_loc]=byte;mem_loc++;}/ 0
tructionsvoidexecute_S(vector<vector<string>>&assembly_code,intinstruction_no){//Ha 3
ghex){unorder 0
nary.size();i++){zeros.push_back('0');fs.pus 2
r(inti=0;i<associativity;i 0
ngth*4;i<binary.size();i++){zeros.push_back('0');fs.push_back(' 2
tion_file;vector<vector<st 0
llynotdirtynew_data[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++){n 1
isses<<",HitRate="<<fixed<<setprecision(3)<<(double)(hits)/(hits+misses);}stack_of_functions. 4
';bin_to_hex["0001"]='1';bin_to_hex["0010"]='2';bin_to_hex["0011"]='3';bin_to_hex["0100"]='4';bi 4
pace=false;//Wenowextract 0
uction_no][0]]=='R'){ 1
thm>#include<cstdlib>#include<m 1
s(start_location+i,acce 0
f(!to_replace){while(!q.empty()){intcur=q.front();q.pop();if(cur!=tag){dummy_q.push(cur);}}while(!du 9
binary(index,20,0);stringhex_set="0x 1
}elseif(inst=="sll"){register_values[rd]=register_values[rs1]<<register_values[rs2];}elseif( 4
isses<<",Hit="<<hits<<",Miss="<<misses<<",HitRate="<<fixed<<setpre 0
vity;vector<int>removed_data(cache[0][0].size());vector<int>new_data(cache[0] 7
und=false;for(inti=0;i<associativity;i++){vector<int>cache_block(block_ 1
_PC;cout<<"Ex 0
e[i]=read_access(start_location+i,accessed_once);accessed_once=true; 2
){r="x29";}elseif(r=="t5"||r=="x30"){r="x30";}elseif(r=="t6"||r=="x31"){r="x31";}returnr;}voidupd 5
mal<0){isNegative=true;}decimal=abs(decimal);stringbin="";while(decimal!=0){bin.push_back(decim 3
datahasadirtybitset,andifso,weneedtoupdatethememoryif(removed_data[1]= 1
mand=="cache_simstats"){if 0
instruction.substr(0,pos);if(first_word.back()==':'){executed_instruction=executed_instruction.sub 3
thexadecimaltobinarystringhex_to_binary(stringhex){unordered_map<char,string>hex_to_bin;hex 2
aved_register_no="s";saved_register_no+=to_string(i-18+2);registers[saved_register_n 1
;if(val_rs1<val_rs2){PC=new_pc;}else{PC+=4;}}//Updatethestackoffunctionsandtheirlastex 2
"]='R';format["or"] 1
ector<int>cache_bloc 1
);PC+=4;}instruction_file.close();//EnsurethatthePCvalueis0PC=0;if(cache_enabled){if(fope 2
ster_values[rd]=register_values[rs1]&register_values[rs2];}elseif(inst=="or"){r 4
che;//Valid,dirty,tag,datainthits=0,misses=0;stringcurrent_opened_file=""; 0
{//Initializealltherequiredfieldsinitialize_re 0
}else{trim=false;trimmed_in 0
register_values[rs1],val_rs2=register_values[rs2];if(va 2
lseif(command=="cache_simstatus"){if(cache_enabled){ 2
e>>cache_size>>block_size>>associativity>>replacement_policy>>write_back_ 0
n.substr(0,pos);if(first_word.back()==':'){executed_instructi 3
er_no+=to_str 0
x,forUtypeformat,youmustenter3operands"<<endl;exit(0);}elseif(regist 1
f_register_hex<<endl;}}elseif(command=="exit"){//Exitthesimulatorco 1
Policy:"<<replacement_policy<<endl;cout<<"WriteBa 0
(inti=0;i<=31;i++){stringregister_no="x";r 0
cement_policy=="FIFO" 0
"0000000";funct7["xor"]="0000000";funct7["sll"]="0000000";funct7["srl"]="0000000";funct7["sra" 3
unt);//Printingthelocationsofthememoryasspecifiedusingalooopfor(inti= 0
){returnbin;}//Take1'scomplementfor(inti=0;i<bin.size();i++){if(bin[i]=='0'){bin[i]='1'; 5
mber=rand()%associativity;vector<int>removed_data(cache[0][0].size());vector<int>new_d 7
ng>funct3;unordered_map<string,string>funct7;unordere 1
=0;i<cache.size();i++){for(intj=0;j<cache[i].size();j++){if(ca 3
e:"<<instruction_no+1<<endl<<"Incorrectvalueofrd";exit(0);}elseif(registers.find(assembly_code[ 1
1]==1){intoffset_size=log2(block_size);//Thesemanybitsareforoffsetintindex_size=log2(cache_size/( 1
+){for(intj=0;j<cache[i].size();j++){for(intk=0;k<cache[i][j].size();k++){cache[i][j][k]=0;}}}assem 9
oc,20,0);stringhex_add 0
>>imm;}//Updatethestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=sta 0
dl;exit(0);}if(labels.find(assembly_code[instruction_no][3])==labels.end()){cout<<"Errorinline:"< 6
step_R(cur_instr);}elseif(form 1
se);registers[register_no]=this_register;if(i==0){registers["zero" 2
m_loc|=(removed_data[2]<<(offset_size+index_size));to_store_mem_loc|=(i<<offset_size);for(in 2
[PC]=cur;cur 1
tedlineaccordinglystringtop_of_stack=stack_of_ 0
elseif(command=="run"){//Runt 1
;dummyi/=10;charnum2= 0
ers[temporary_register_no]=thi 1
ionif(inst=="sb"){uint8_tbyte=store_va 1
'1';break;}bin[i]='0';}returnbin;}//Functiontoconvertbinarystringtodecimalintbinary_to_decimal(con 1
].size()!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<< 1
f(cur!=""){to_store.push_back(cur);}if(to_store[0]==".dword"){data_b 5
inthememoryif(!found){if(!accessed_once){m 2
_mask=offset_mask-1;//Wecannowgettheactualvalueoftagbitsinthememorylocationtha 0
C],-1});stringexecuted_instruction=all_instructions[old_PC/4];intpos=executed_instruc 1
andprintthefortheuservector<pair<string,int>>dummy_stack;stac 2
ringrs1=registers[assembly_code[instruction_no][2]];stringrs2=regist 3
struction[3]);stringrs1=aliasRemover(instruction[1]);stringrs2=aliasRemover(instructi 3
t_word=executed_instruction.substr(0,pos);if(first_wor 1
g_mask=tag_mask<<20;tag_mask=tag_mask-1;//Thismakesthemask20onesinttemp 0
ainsat0register_values 0
incethisahit,weneedtoupdatetheorderofaccessvectorupdate_queue(index,tag,false,mem_loc,"write",false, 0
<<"Errorinline 0
yte;}if(inst=="sh"){vector<uint8_t>byte(2);byte[0]=store_value;byte[1]=store_value>>8;write_access 5
t<<"BlockSize:"<<block_si 0
/Jformatformat["jal"]='J';//Uformatformat["lui"]=' 2
back()==': 1
eueif(!to_replace){//Donothing}else{intrandom_number=rand()%a 3
ed_instruction=all_instructions[PC/4];intpos=executed_instruction.f 1
ereweshowthec 0
eintoffset_mask=1;offset_mask=offset_mask<<(offset_size);offset_mask=offset_mask-1;//Wecannowgett 1
";}elseif(r=="s1"||r=="x9" 0
es=0;}elseif(command=="cache_simstatus"){if(cache_enabled){cout< 2
tringbin_instr=hex_to_ 0
ommand.find("cache 0
store,data_base_address);}elseif(to_store[0]==".word"){data_base_address=store_word(to_store,data_ba 2
ands"<<endl;exit 0
on_no].size()!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forBtypeformat,youmuste 1
lues[rs1]^register_values 1
f(i==4){registers["tp"]=this_register;}elseif(i>=5&&i<=7){stringtemporary_register_no="t";tempor 3
onfig_file.close();hits=0;miss 1
_instruction=all_instructions[PC/4];intpos=executed_ins 1
;//Settingittodirtyif(write_back_policy=="WT"){memory[mem_loc]=val;cache[index][i 3
inline:"<<instruction_no+1<<endl<<"Labelnotdefined";exit(0);}else{assembly_code[instruction_no 1
sRemover(instruction[2]);intmem_loc=imm+register_ 2
inary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<< 1
CodefortheRformat 0
struction_no+1<<endl<<"Wrongsyntax,forItypeformat,youm 0
nstr);}elseif(format[cur_instr[0]]=='S'){step_S(cur_instr 3
ginstr=imm.sub 0
binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=bina 4
_set<<","<<hit_or_miss<<",Tag:"<<he 0
tahasadirtybitset,andifso,weneedtoupdatethememoryif(removed_data[1]==1){is_dirty=true;intto_sto 2
thestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=stack_of_functions.top(). 1
softheinstrutionstringf3=funct3[assembly_code[instruction_no][0]]; 3
skip);cout<<"Insertedbreakpointatline:"<<break_point<<endl;}e 0
on_no+1<<endl<<"Wrongsyntax,forRtypeformat,you 0
s1]|imm;}elseif(inst=="andi"){r 1
}elseif(inst=="srli"){ 1
"";for(inti=0;i<hex.size();i++){bin+=hex_to_bin[hex[i]]; 3
J';//Uformatformat["lui"]='U'; 1
op_line});stringexecuted_instruction=all_instructions[PC/4];intpos=executed_instruction 1
y_stack[i].second+count_h 1
;}returnbin;}//Functiontoconvertbinarystringtodecimalintbinary_to_decimal(conststring&bin){int 1
){cout<<"Executionstoppedatbreakpoint\n";break;}}//Iflastlineexecuted,then 0
ethememory//intmemory[0x50001];vec 1
omthebeginningofan 0
roffsetintindex_size=log2(cache_size/(associativity*block_size));//Thesem 2
st_word.back()==':'){executed_instruction=ex 1
hesemanyareforindexinttag_size=20-offset_size-index_size;//Andtheseman 0
read_or_write="R";}stringbin_address=decim 0
inst=="slli"){register_values[rd]=register_values[rs1]<<imm;}elseif(inst=="srli"){uint32_tshi 3
binary(i,5,false);registers[register_no 1
=binary_to_hex(value_of_register_bin,true,16);cout<<this_register<<"=0x"<<value_of_register_ 1
ary_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti 4
et:"<<hex_set<<","<<hit_or_miss<<",Tag:"<<hex_tag<<","<<clean_or_dirty<<"fromupdate 0
ers[assembly_code[instruct 0
;}elseif(to_store[0]==".word"){data_base_address=stor 2
i(assembly_co 0
ne:"<<instruction_no+1<<endl<<"Incorrect 0
tr(0,pos);if(first_word.back()==':' 2
e-1);for(intj=start_storage,k=3;j<=end_storage;j++,k++){cache_block[k]=memory[j];}cache 3
8)|(byte[0]);register_values[rd]=res;}elseif(inst=="ld"){vector<int64_t>byte(8); 6
_no*4+i]=byte[i];}}//CodeforUformatinstructionsvoidexecute_U(vector<vector<string>>&asse 3
.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_bytes[i]) 5
str(0,pos);if(first_word.back()==':'){executed_instruction=executed_instruct 3
truction_no][2])==labels.end()){cout<<"Errorinline:" 2
stack;stack<pair<string,int>>dummy_stack_function=stack_of_functions;while(!dummy_stack_function.em 2
inst=instruction[0];if(inst=="jal"){register_values[rd]=PC+4;PC=new_pc;}//Updatethestackoffunct 4
eisoutofrange";ex 0
s1";exit(0);}elseif(registers.find(assembly_code[instruction 1
code;stringhex_instruction=binary_to_hex(instr) 1
ctor<uint8_t>byte(2);byte[0]=store_value;byte[1]=store_value>>8;w 4
in[i]=='0'){bin[i]='1';}else{bin[i]='0';}}//Add1tofind2's 5
clude<sstream>#include<stack>#include<queue>#include<r 3
ngbin_set= 0
tion_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_ 1
!isNegative){returnbin;}//Take1'scompl 1
);}}instruction=trimmed_instr;//Gothroughthecurren 0
ruction_no][1]] 1
,k=3;j<=end_storage;j++,k++){cache_block[k]=memory[j];}found_ 3
bly_code[instruction_no][0]]=='J'){execute_J(assembly_code,instruction 2
y_to_skip);cout<<"Insertedbreakpointa 0
:"<<executed_instruction<<" 0
ngthevalueofindexbitsofmemorylocation 0
asRemover(ins 0
line:"<<instruction 0
1<<endl<<"Wrongsyntax,forBtypeformat,youmustenter4operands 0
yntax";exit(0);}}}elseif(command==" 1
ointif(break_lines.find(break_point-count_h 0
ed_instruction=all_instructions[PC/4];intpos=e 1
yaddressaredivided.intoffset_s 0
che_enabled){cout<<"CacheEnabled" 0
"]="000";funct3["xori"]="100 1
ut_name);}//Converttheassemblycodetomachinecodehexadecimalandstoreintextmemoryfor(intinstruction 0
thevalueofx0is0regi 0
){byte[7-i]=store_value>>(7-i)*8;}for(inti=0;i<8;i++){memory[mem_loc+i]=byt 4
oftheinstrctionstringopcode="0110111";stringrd=registers[assembly_code[instruction 0
1100111";}else{opcode="0010011";}//Notingthevaiourspartsoftheinstrutionstringf3=funct3[as 1
executed_instruction.substr(0,pos);if(first_word.back() 2
}removed_data=cache[index][random_number];cache[index][random_number]=ne 4
isters.end()){cout<<"Errorinline:"<<instruction_no+1<<endl 1
PC=0;while(getline(instruction_file,instruction)){//Iftheinstructionisdata,thenensure 2
,rs1,andimmediaterd=aliasRemover(instruction[1]);rs1=aliasRemover(instruction 2
unt))-1;if(shifting_amount==0){for(inti=0;i<=63;i+ 1
functions.top().second;top_line=old_PC/4+1; 1
nabled){//Letusfirstfigureouthowour20bitsofmemoryaddressaredivided.intoffset_size=log2(b 0
rd]=PC+4;PC=imm+register_values[rs1];}//Ensurethatx0valuesremainsat0register_val 1
o_label[PC]=cur;cur="";continue;}if(cur[cur.si 1
;funct7["sra"]="0100000";}//Definingtheformatofva 1
ount1'suint64_tmask=(1U<<(64-shiftin 0
wgettheactualvalueoftagbitsint 0
ed_instruction<<";PC="<<hex_PC<<endl;//Ensurethatthex0valueremainsat0register_v 0
uted_instruction=all_instructions[PC/4];intpos=e 1
f(!command.find("load")){//Firstresetalltheregis 2
(command=="step"){//Gostepbystepintno_of_instruction=assembl 1
rrorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}imm= 1
struction,intmem_loc) 0
_point-count_how_many_to_skip);cout<<"Insertedbreakpointatline:"<<break_po 0
no][1])==registers.end()){cout<<"Errorinline:" 2
tringrs2=aliasRemover(instruction[2]);stringinst=instruction[0 2
;}//Concatinatingthevaluesstringinstr=i 0
truction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=bin 2
nitiallynotdirtynew_data[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++){n 1
stack_of_functions.pop();} 1
ter_values[rs1]<<imm;}elseif(inst=="srli") 2
ddress:"<<hex_address<<",Set:"<<hex_set<<","<<"Miss"<<",Tag:"<<hex_tag<<","<<"Clean"<<"From 0
op().first;i 1
nd=="regs"){//Pr 0
ary(old_PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<e 2
ory[to_store_mem_loc+i]=removed_data[3+i]; 2
teisoutofrange";exit(0);}imm=decimal_to_binary(stoi 1
instruction=binary_to_hex(instr);ve 1
ccessed_once);accessed_once=true;}int32_tres=(byte[3]<<24)|(byte[2]<<16)|(byte[1]<<8)|(byte[0]) 5
:"<<instruction_no+1 0
[1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs2";exit(0 2
ache[0][0].size());int 3
t;inttop_line=stack_of_functions.top().second;top_line=PC/4+1;stack_of_functions.pop();s 2
or<string>instruction,intmem_loc){//Gothroughallthevaluesthattheuserhasspecifiedandstoreth 1
store_mem_loc=0;to_store_mem_loc|=(t 0
rrorsif(assembly_code[instruction_no].size()!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wron 3
ache_size/(associativity*block_size));//Thesemanyareforindexinttag_size=20-offset_size-i 1
){intcur=q.front();q.pop();if(cur!=tag){dummy_q.push(cur);}}wh 6
tr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_P 3
e_out_name);//Gothrou 0
inary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){ 3
,'){if(cur!=""){to_store.push_back(cur);}cur= 3
tring>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]= 2
ecache,weloadthewholeblockfromthememoryboolfou 0
i<4;i++){memo 0
d=true;cache[index][i][3+offset]= 3
ruction==".text"){data=false;}else{//Storethe 1
embly_code[instruction_no][1]];stringimm=decimal_to_binary(stoi(assembly_code[ins 2
tringrs2=registers[assembly_code[instruction_no][2]] 3
turnmem_loc;}//Functiontostorewordintstore_ 0
s[index];queue<int>dummy_q;intoffset_size=log2(block_size);//Thesemanybitsar 3
ted_instructi 0
inglyregister_values[rd]=PC+4;PC=imm+register_values[rs1];}/ 2
heif(write_back_policy=="WT"){memory[mem_loc]=val;//Incaseofwritethroughandmiss,w 2
t32_tres=byte[3]<<24|by 1
;//Wetakeintoacco 0
ess);}elseif(to_store[0]==".word"){data_base_addre 2
{binary_bytes[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(in 5
[i]=cache_block;return;}} 1
eremoveddatahasadirtyb 0
ano?to_store_mem_loc|=(removed_data 0
ssvectorif 0
tatistics:Accesses="<<hits+misses<<",Hit="<<hits<<",Miss="<<misses<<",HitRate="<<fixed< 0
ewhichisreplacedq.push(tag);//Pushthenewtagvaluevector<int>removed_data(cac 2
eif(inst=="and"){register_values[rd]=register_values[rs1]&register_val 3
7ofhex_instruction}for(inti=0;i<4; 0
m=false;trimmed_instr.push 0
nctions.push({top_of 0
<",Tag:"<<hex_tag<<","<<"Clean"<<"Fromwriteaccess"<<endl;}}//I 0
mat,youmustenter4operands"<<endl;exit(0);}elseif(registers.find(assembly_code[instruction_ 1
lse;intbreak_point_line_to_remove;if(PC/ 0
0]=store_value;byte[1]=store_value>>8;memor 1
}if(is_dirty){clean_or_dirty="Dirty";}if(is_read){read_or_write="R";}stringbin_add 4
ction.substr(0,pos);if(first_w 1
cutedlineaccordinglystringtop_of_stack=stack_of_functions.top().first; 1
[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++){new_data[k]=memory[j];}if(operat 4
essaryspacefromthebeginningofanylinebooltrim=true;stringtrimmed_instr="";for(inti=0;i<instruction 0
1";hex_to_bin['8']="1000";hex_to_bin['9']="1001";hex_to_bin['a' 2
Nowletuswriteintothetextsegmentofthememory://Wehavetheinstructionnumb 0
=val;cache[index][i][1]=0;//Setitton 3
R';format["or"]='R'; 1
s:"<<hex_address<<",Set:"<<hex_set<<","<<"Miss"<<",Tag:"<<hex_tag<<","<<"Clean" 0
hesemanyareforindexinttag_size=2 0
Initiallynotdirtynew_data[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++ 1
rage=(mem_loc/block_size)*block_size;intend_storage=(mem_loc/block_size)*block_size+(bl 2
=decimal_to_binary(PC,32,0);st 1
ngtheinstructionstringinstr=imm.substr(0,1)+imm.substr(10,10)+imm.substr(9,1)+i 3
_bin['7']="0111";hex_to_bin[ 1
;tag_mask=tag_mask^temp_mask;//Makesthepositionsofindexb 0
Firstcheckifwehaveaninvalidframe,andifwedo,thenwecandirect 0
nt64_tres=(byte[7]<<56)|(byt 1
e_back_policy;}else{cout<<"CacheDisabled";}}elseif(com 0
ed}else{//Firstcheckifwehaveaninvalidframe,andifwedo,thenwecandirectlyaddourvaluetoitboolfound_in 0
=(index<<offset_size);for(inti=0;i<block_size 0
='5';bin_to_hex["0110"]='6';bin_to_hex["0111"]='7';bin_to_hex["1000"]='8';bin_to_hex["1001 3
ringinst=instruction[0];//KeeptrackofoldPCifbranchnottaken 1
ero}}}elseif(!comm 0
ew_pc;}else{PC+=4;}}//Updatethestackoffunctionsand 1
<endl<<"Incorrectvalueofrd";exit(0); 1
_mask=index_mask<<(index_size+offset_size);index_mask=i 1
ruction_no][0]];stringrs 1
d(break_point-count_how_many_to_skip)! 1
nary_to_decimal(bin_s_addr);intcount=stoi(s_count);//Printingthelocationsofthememor 2
ingfirst_word=executed_instruction.substr(0,p 0
0);}elseif(stoi(assembly_code[instruction_no][2])<-1*pow(2,20)||stoi(a 4
['9']="1001";hex_to_bin['a']= 2
inary_to_h 0
=false;vector<vector<vector<int>>>cache;//Valid,dirty,tag,datainthits=0,miss 3
emory(0x50001,0);//InitializethevalueofPCintPC;//Herewedeclareallvariablesrelatedtocacheintca 1
ctions.push({offset_to_label[PC],-1});stringexecuted_instruction=all_instructions[o 3
no][2]];stringrs2=register 1
0]=="srai"){if(stoi(assembly_code[instruction_no][3])<0||stoi(assem 3
assembly_code,instruction_no);}elseif(format[assembly_code[instruction_no][0]]=='B'){exe 4
op_line=stack_of_functions.top().second;top_line=PC/4+1 1
articularmemorylocation.//Ifwedonotfindthisblockinthecache,weloadthewholeblockfromthememoryboolf 0
exit(0);}elseif(stoi(assembly_code[instruction_no][2])<-1*pow(2,20)||stoi(assembly_code[in 5
r;if(i==0){registers["zero"]=this_register;}elseif(i==1){reg 4
find('');stringfirst_word=executed_instruction.substr(0,pos);if(first_wo 2
r(2,6)+rs2+rs1+f3+imm.sub 1
ion=all_instructions[PC/4];i 1
ftagbitsinthememoryl 0
tingforlocationspecifiedbythemem_locfor(inti=1;i<instruction.size();i++){uint64_tst 1
k_function=stack_of 0
instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Notingthevariouspartsoftheinstruc 1
hex.push_bac 0
hememoryif(removed_data[1]==1){is_dirty=true;intto_store_mem_loc=0;to_store_mem_loc|=(tag<<of 2
oceedwithfindingtherealdatainthatlocation//Ifwefindthisblockinthecache,w 0
s1=registers[assembly_code[instruction_no][1]];stringrs2=registers[assembly_code[instructio 3
_mem_loc|=(index<<offset_size);for(inti=0;i<block_size;i++){memory[to_store_mem_loc+i]=removed_dat 1
inghex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Exec 1
t[cur_instr[0]]=='B'){step_B(cur_instr);}elseif(format[cur_instr[0 4
nstruction_no][2])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<<endl<<" 2
values[rs1],val_rs2=register_valu 1
svoidexecute_I(vector<vector<string>>&assembly_code,inti 2
rmat[assembly_code[instruction_no][0]]=='S'){execute_S 3
[rd]=register_values[rs1]>>imm;}//Updatethesta 2
word"){data_base_address=store_word(to_store,data_base_address);}elseif(to_store[0]==" 3
r="x10";}elseif(r=="a1"||r== 0
in){intdecimal=0;intlength=bin.size();//Iterateoverthebinarystringfor(inti=0;i<length; 1
orinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs2";exit(0);}elseif(registe 1
elseif(r=="s3"||r=="x19"){r="x19";}elseif(r=="s4"||r=="x20"){r="x20";}elseif(r=="s5"||r=="x2 4
stringbinary_to_hex(stringbinary,booltrim=false,intlength=8){unordered_map<string,char>bin_to_hex;bi 2
+=hex_to_bin[hex[i]];}returnbin;}//Codetoconvertdecimaltobinarystringdecimal_to_binary(in 2
values[rd]=register_values[rs1]&imm; 2
s2+rs1+f3+rd+opcode;//Nowletuswriteintothetextsegmentofthememory://Wehavetheinstru 0
bled){cout<<"CacheEnabled"<<endl;cou 0
it(0);}//Notingthevariouspartsoftheinstrcutionstringopcode="1101111";stringrd=regi 1
rofmemorybytesstartingfrommemorylocationspecifiedbytheuserstrings_addr="";// 0
c;//Wenowhavethe 0
);intcount=stoi(s_count);//Printingthelocationsofthememoryasspecif 1
_mem_loc=0;to_store_mem_loc|=(tag<<offset_size+index_size);to_store 0
sk=index_mask^temp_mask;//Makesthepositionsofoffseybitszero//Weneedtodothisfortheoff 0
t<<"Executed:"<<executed_in 0
({offset_to_label[PC],-1});stringexecuted_instruction=all_instructions[old_PC/4];intpos=execute 4
000000";funct7["sub"]="0100000";funct7["and"]="0000000 2
[cur_instr[0]]=='S') 2
tion_file,instruction)){//Iftheinstructionisdata,thenensurethatuntilwesee.te 0
ister_values[rs2];}elseif(inst=="xor"){re 2
te[i]=binary_to_decimal(binary_bytes[i]);//characters67ofhex_in 3
or"]="0000000";funct7["sll"]=" 1
){//Extractrd,rs1,rs2stringi 0
";exit(0);}imm=decimal_to 1
r(i);returntrimmed_hex;}}return"0";}returnhex;}//Codetoconverthexadecim 1
code[instruction_no][0]]=='B'){execu 2
offset_size);offset_mask=offset_mask-1;//Wecannowgettheactualvalueoftagbitsint 0
ckofoldPCifbranchnottaken 0
rtsoftheinstructionstringopcode="1100011";stringf3=funct3[assemb 0
"]='B';format["bne"]='B';format["bltu" 1
;//Loadthenextfileintoaqueueofstrings,suchthatafterexecutionofe 0
ninvalidframe,ignorecontinue;}if(cache_block[2]==tag) 2
toi(instruction[3]);//Updatethestackoffunctionsandtheirl 2
2dmatrixofstringsvector<string>cur_ 1
he_block[0]==0){//Thisisaninvalidframe,ignorecontinue;}if(cache_block[2]==tag){is_hit=true;fo 4
wewerenota 0
register_values[rd]&=mask;}}elseif( 1
struction.substr(0,pos);if(first_word.back()== 2
ommand=="run"){//Runtheentirecodetillthebreakpointintno_of_ 0
=="t3"||r=="x28"){r="x28"; 0
dexshouldbeoftheremoveddatano?to_store_mem_loc|=(removed_data[2]<<(offset_siz 1
ing,int>>dummy_stack;stack<pair<string,int>>dum 2
tendstillblocksize//brea 0
00000";funct7["or"]="0000000";funct7[" 1
];memory[mem_loc+1]=byt 1
cur[cur.size()-1]==':'){cur.pop_back();labels[ 3
size+offset_size);index_mask=index_mask-1;temp_mask=1;tem 0
op_line});stringexecuted_instruction=all_instructions[PC/4];intpos=executed_instruction.find(' 1
e"<<endl;}order_of_access[index]=q; 1
bottomtotopcout<<dummy_stack[i].first<<":"<<dum 1
);stringexecuted_instruction=all_instructions[PC/4];intpos=executed_instruction.fin 1
t3["andi"]="111";funct3["slli" 1
^temp_mask;//Makesthepositionsofoffseybitszero//Wen 0
ary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Execute 1
accessed_once=false;for(inti=0;i<4;i++){byte[i]=read_access(start_ 1
t_size-index_size;//Andthesemanyaretagbitsboolis_dirty=false;if(replacement_policy=="FI 0
valueofindexbitsofmemorylocationbeingrequestedbyprogramintindex=index_mask&mem_loc;index>> 0
if(inst=="srl"){uint64_tshifting_amount=register_values[rs2 1
gallfunct3valuesvoidinitialize_funct3(){funct3["add"]="000 2
if(PC/4==no_of_instruction){cout<<"Nothingtostep\n";}elseif(break_lines.find(PC/4+1)!=break_lines.en 2
hememoryif(!found){if(!accessed_once){misses++;if(writ 2
efortheuservector<pair<string,int>>dummy_st 2
Errorinline:"<<instruction_n 0
"101";funct3["lb"]="000";funct3["lh"]="001";funct3["lw"]="010";funct3["ld"]="011";funct3["lbu"]="10 5
xit(0);}elseif(registers.find(assemb 1
_t>register_values;unordered_map<string,string>registers_alis;vector<string>all_in 2
_no="s";saved_register_no+=to_string(i-18+2);registers[saved_register_no]=this_register;}elseif(i>= 2
//Valid,Dirty,tag,dataif(cache_block[0]==0){//memory[mem_loc]=val;//Getthevalueandthenstore 3
e>>cache_size>>block_size>>associativity 0
at["blt"]='B';format["bne"]='B';format["bltu 2
eration,boolis_read,boolis_hit,intval=-1,intoffset=-1){queue<int>q=order_of_access[index];queue< 2
oolis_read,boolis_hit,intval=-1,intoffset 0
inary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<execu 1
1)){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}//Noting 1
first_word=executed_instruction.substr(0,pos);if(first_word.back()==': 2
in['f']="1111";stringbin="";for(inti=0;i<hex.size();i++){bin+=hex_to_bin[hex[i]];}returnbin;}//Code 5
hex["1011"]='b';bin_to_hex["1100"]='c';bin_to_hex["1101"]='d';bin_to_hex["1110"]='e'; 4
inst=="bgeu"){uint64_tval_rs1=register_values[rs1],val_rs2=register_values[rs2];if(val_rs1>=val_ 2
lseif(command=="exit"){//Exitthesimulatorcout<<"Exitedthesimulator";break;}els 1
recodetillthebreakpointintno_of_instruction=assembly_code.size();boolto_break=false;i 1
size-index_size;//Andthesemanyaretagbits//Letu 0
yassociativeif(associativity==0){//Thismeansthatthereisonly1index,everyonei 1
red_map<string,string>registers;unordered_map<string,string>funct3;unordered_map<string,stri 2
C=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<< 1
",true,fal 0
ingtostep\n" 0
bstr(0,pos);if(first_word.back()==':'){executed_instruction=executed_in 3
++){byte[i]=binary_to_decimal(binary_byt 1
);current_opened_file=command.substr(5);//This 1
else{cout<<"Nobreakpointspresent\n";}}elseif(!command.find("break")){//We 2
oumustenter3operands"<<endl;exit(0);}if(labels.find(assembly_code[instruction_no][2])==labels.end( 4
imatelythisfunctionhastoreturnonly1byteintoffset_mask=1;offset_ 0
s[rs1];uint64_tstore_value=register_values[rs2];//Performstoreaspertheinstructionif(inst=="sb 2
removed_data[1]==1){is_d 1
ck_function.empty()){dummy_stack.push_back(dummy_stack_func 1
orary_register_no="t";temporary_register_no+= 0
ringmem_loc_bin=decimal_to_binary(i,20,0);stringmem_loc_hex="0x"+binar 1
theIformatstepinstructionsvoidstep_I(vector<string>instruction){string 2
ntnew_pc=PC+stoi(instruction[2]);//Extracttherdvaluestringrd=aliasRemo 2
tag_mask=tag_mas 0
ngsyntax,forBtypeformat,youmustenter4operands"<<endl;exit(0);}if(labels.find(assembly_code[instru 1
}//Notingthevaiourspartsoftheinstrutionstringf3=f 0
instruction){//Ext 0
<<endl;}}}myfile_out.close();}elseif(command=="cache_simstat 1
f(inst=="srl"){uint64_tshifting_amount=register_values[rs2];if(shiftin 2
,pos);if(first_word.back()== 1
rmat["or"]='R';format["and"]='R';format["sll"]='R';format["srl"]='R';format 4
tethemaskrequiredtofindoutthetagbitslaterin 0
ofoffseybitszero//Weneedtodothisfortheoffsetaswell,because,ultimatelythisfunctionhastoreturnonly1 0
ative=true;} 0
1";}elseif(r 0
t>memory(0x50001,0);//InitializethevalueofPCintPC;//Herewedeclareallvari 1
executed,thenensuretopopmainfromthestackif(PC/4==no_of_instructi 0
un,wecandequeuethetopstringinstruction;instruction_file.open(command.substr(5));c 2
ion.size();i++){if(trim&&instruction[i]==''){continue 3
,byte[i],accessed_once);accessed_once=true;}}//Updatethestackoffunctionsandtheirlastexecuted 1
ry_to_hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){b 3
tualvalueoftag 0
)*block_size+(block_size-1 0
nghex_instruction=binary_to_hex(instr);vector<string>binar 2
]);}assemb 0
y_code[instruction_no][0]]=='S'){execute_S(assembly_code,instruction_no);}elseif(format[assembly_ 4
t7["srl"]="0000000";funct7["sra"]="0100000";}//De 2
reakpointif(break_lines.find(break_point-count_how_many_to_skip)!=break_line 1
tion=executed_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC= 2
ecimaltobinarystringdecimal_to_binary(intdecimal,intno_of_bits, 0
d_instruction.find('');s 1
>&assembly_code,intinstruction_no){//Handlingerrorif(assembly_code[instruction_no].size()!=4){c 3
k_of_funct 0
_code[instruction_no][3]=to_string(l 2
ringbin="";for(inti=0;i<hex.size();i++){bin+=hex_to_bin[hex[i]];}ret 4
findthisblockinthecache,wereadonlythispart 0
f(stoi(assembly_code[instruction_no][3])<0||stoi(assembly_code[ 3
tringsvector<string>cur_instruction;all_instructions.push_b 1
;i<4;i++){byte[i]=binary_to_decimal(binary_by 1
harevalidfor(inti=0;i<cache.size();i++){for(intj=0;j< 1
['a']="1010";hex_to_bin['b']="1011";hex_to_bin[ 2
ext)count_how_many_to_skip++;if(instruction==".text"){data=false;}else{//Storethereq 2
truction[i]);v 1
"lh"]="001";funct3["lw"]="010";funct3["ld"]="011";funct3["lb 2
'R';format["sra"]='R';//Iformatformat["addi"]='I';format["xori"]='I';forma 3
ode.assign(0,vector<string>(0));//Checkiftheuserisspecif 3
rstresetalltheregisters/memory/PCbeforeloadingthenextfileini 0
n_PC);hex_PC="0x"+hex_PC; 0
}}elseif(inst=="bgeu"){uint64_tval_rs1=register_values[r 1
"sd"){boolaccessed_once=false;v 0
on.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal( 3
"||r=="x12"){r="x12";}elseif(r=="a3"||r=="x13"){r="x13";}elseif(r=="a4"|| 3
ealltherequiredfieldsinitialize_registers();initialize_funct3();ini 2
storebytwintstore_b 0
file_out;myfile_out.open(m 0
ry[instruction_no*4+i]=byte[i];}}//CodeforUformatinstructionsvoidex 2
Btypeformat,youmusten 0
);cache_block=cache[index][i];//Valid,Dirty,tag,dataif(cache_bloc 2
=true;}vector<string>cur_instr=assembly_code[PC/4];if(format[cur_instr[0]] 4
or"]="0000000";funct7["xor"]="0000000";funct7["sll"]="0000000";funct7["srl"]="0000000";fun 3
al(bin_instr);dec_imm=decimal;}else{dec_imm=stoi(assembly_code[instruction_no 1
bstr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC 2
mand[i]);}}s_addr=s_addr.subs 1
lse;intbreak_point_line_to_remove;if( 0
rd=aliasRemover(instruction[1]);rs1=aliasRemover(instr 2
][0]]=='U'){execute_U(assembly_code,inst 1
="t5"||r=="x30"){r="x30";}elseif(r=="t6"||r=="x31"){r="x31";}returnr;}voidu 3
datano?to_store_mem_loc|=(removed_da 0
ream>#include<st 0
eforSformatinstructionsvoidexecute_S(vector<vector<string>>&ass 2
e(index,tag,true,mem_loc,"write",false,false,val,offset);}}}}els 1
sizeifblocksiz 0
ew_pc=PC+stoi(instruction[3]);str 2
ccessed_once=true;}}//Updatethes 0
ream>#includ 0
nst=="srai"){register_values[rd]=regis 1
rd"){data_base_address=sto 0
parsethestringtogetthelinenumberwherewehavetoinsertabreakpoin 0
str(5));current_opened_file=comman 1
4;i++){binary_bytes[i]=hex_to_binary(hex_instr 1
<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_to_binary(stoi(assembly_code[instr 1
isistoremove.scurrent_opened_file.pop_back();current_opened_file.pop_back();PC=0;while(getline(inst 2
truction[0];stringrd=aliasRemover(instruction[1]);stringrs1=alia 3
ex_tag="0x"+binary_to_hex(bin_tag,true,5);myfile_out<<"Set:"<<hex 1
endl<<"Incorrectvalueofrs1";exit(0);}elseif(registers.find(assembly_code[instruction_ 1
line.clear();break_lines.clear();count_ho 2
block_size;i++){memory[to_store_mem_loc+i]=removed_data[3+i];}}}}}//Hereweneedtoensur 3
convertdecimaltobinarystringdecimal_to_binary(intdecimal,intno_of_bits,boolisSigned){boolisNegat 1
registers/memory/PCbeforeloadingthenext 0
che[0][0].size());intstart_storage=(mem_loc/block_size)*block_size;intend_storage=(mem_loc/blo 4
//Take1'scomplementfor(inti=0;i<bin.size();i++){if(bin[i]=='0'){bin[i]='1';}e 5
read_or_write<<":Address:"<<hex_address<<",Set:"<<hex_set<<","<<hit_or_mi 0
assemblycodetomac 0
(2,11)){cout<<"E 1
ingtherealdatainthatlocation//Ifwefindthisblockin 0
lesthatthepreviousfilemighthaveusedvoidinitialize(){for(inti=0;i 1
tion){//Extractthers1,rs2andimmediatevaluesstringrs1,rs2,inst;intimm;in 0
r_no="a";argument_register_ 0
he_output<<"W"<< 0
data[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++){new_data[k]=memory[j];}i 4
i=0;i<block_size;i++){memory[to_store_mem 0
edtodothisfortheoffsetaswell,because,ultimatelythisfunctionhastoreturnonly1byteintoffset_mask=1;of 0
ressfromwhichwehavetodisplaythememorystrings_count="";//Countofthenumberofmemorylocationsw 0
p_U(cur_instr);} 1
stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0 2
);}intdec_imm;//Weacceptbothdecimalandhexadecimalvaluesif(assembly_code[instruction_ 0
k<<(index_size+offset_si 0
e_block[3+offset];//Sincethisahit,weneedtoupdatetheorderofaccessvectorif(!accessed 1
index][i]=new_data;br 1
hereyoucanwritetonextreturnmem_loc;}//Fun 0
y_code[instruction_no][3])<-pow(2,12)||stoi(assembly_code[instruction_no][3])>=pow(2,12 7
ctor<string>to_store;stringcur="";for(charc:instruction){if(c==''||c==','){if(cur!=""){to_store.push 4
r(instruction[1]);intold_PC=PC;stringinst=instruction[0];if(inst== 3
valueofoffsetbitsintoffset=offset_mask&mem_loc;//Wenowhavetheindexandt 0
values[rs1]>=register_values[rs2] 2
]=0;}//CodefortheUformatstepinstructionsvoidstep 0
].size()!=4){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsy 1
e});stringexecuted_instruction=all_instructions[PC/4];intpos=execute 1
ar,string>hex_to_bin;hex_to_bin['0']="0000";hex_to_bin['1']="0001";hex_to_bin['2']="0010";hex_ 3
_data[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++){new_data[k]=memory[j];}if( 4
x_tag<<","<<clean_or_dirty<<"fromupdatequeue"<<endl;}order_of_access[index]=q;}voidwrite_acces 1
ryif(removed_data[1]==1){is_dirty=true;intto_sto 2
nctions.to 0
=='J'){step_J(cur_instr);}elseif(format[cur_instr[0]]=='U'){step_U(cur_instr);}else{exit(0);}//Iflas 9
ctions;unordered_set<int>break_lines;intcount 1
semanyaretagbitsvector<int>removed_data=cache[i][j];intto_store_mem_loc=0; 3
functionsandtheirlastex 0
e=read_access(start_location,false);int8_tres=byte;regist 1
}else{PC+=4;}}elseif(inst=="bgeu"){uint64_tval_rs1=register_val 2
stack_of_functions.push({top_of_s 0
tringopcode="0110011";stringf3=funct3[assembly_code[instruction_no][0]];stringf7=funct7[assembly 3
rrectvalueofrs2";exit(0);} 1
{val=memory[mem_loc];update_queue(index 1
eif(inst=="sra 0
lseif(inst=="sll"){register_value 1
lock_size+(block_size-1);new_data[0]=1;//Thebitisnowvalidnew_data[1]=0;//Initiall 3
){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Wrongsyntax,forBtypeformat,youmust 0
e,intinstruction_no){//Handlingerrorif(assembly_code[instruction_ 0
thatourprogramisrequestingtoreadinttag=tag_mask&mem_l 0
//Printingthelocationsofthememoryasspecifiedusingalooopfo 0
ly1byteintoffset_mask=1;offset_mask=offset_mask<<(offset_size);offset_mask=offset_mask-1; 1
functions.top().se 1
//Thesemanyareforindexinttag_size=20-offset_size-index_size;//Andthesemanyaretagbits//Letusnowcalcu 0
FIFO"){if(!to_replace){boolis_present=false;while(!q.empty()){intcur=q.front(); 4
tline:"<<break_point<<endl;}else{cout<<"Nobreakpointspresent 0
tor<string>>&assem 1
or<vector<int>>(associativity,vector<int>(block_size+3 3
(assembly_code[instructi 0
once=true;}}//Updatethestackoffunctionsandtheirlastexecutedlineaccordinglystri 0
rage;j++,k++){new_data[k]=memory[j];}if(operation=="write"){new_data[3+offset]=val;new_data[1] 6
mover(instruction[2]);stringinst=instruction[0];//Keeptrack 3
p=0;}stringaliasRemover(stringr){if(r=="zero"||r=="x0"){r="x0";}elseif(r=="ra"||r=="x1 3
rd]=register_values[rd]&mask;}}else 1
ues["x0"]=0;}//CodefortheBformatstepinstructionsvoidstep_B(vector<string>instruction){//K 3
uction.substr(6-2*i,2)) 1
PC+stoi(instruction[2]);//Extracttherdvaluest 2
ty*block_size));//Thesemanyareforindexinttag_size=20-offset_size-index_size 0
inary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Exe 1
["sh"]="001";funct3["sw"]="010";funct3["sd"]="011";funct3["beq"]="00 4
ell,because,ultimatelythisfunct 0
="Clean";if(cache[i][j][1]==1){is_clean= 4
atorcout<<"Exitedthesimulator";break;}el 0
y(s_addr);intaddr=binary_to_decimal(bin_s_addr);intcount=stoi(s_count);//P 3
]);}}s_addr=s_addr.substr(2);//Weremovetheleading0xinthestring//Wenowwantt 1
ssembly_code[instruction 0
e+(block_size-1);n 1
m_loc];}//Thiswillneverreachreturn-1;}//CodefortheRformatste 0
101";funct3["addi"]="000";funct3[" 1
ble")){cache_enabled=true;strin 0
ed_once){hits++;}found=true;cache[index][i][ 3
);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction 0
hex(instr);vector<string>binary_bytes(4);for(inti=0;i<4;i++){binary_bytes[i]=hex_to_bi 4
/Initiallynotdirtynew_data[2]=tag;for(intj=start_storage,k=3;j<=e 1
>>=(index_size+offset_size);//Gettingthevalueofinde 1
tsofmemoryaddressaredivided.intoffset_size=log2(block_size);//Thesemanybitsaref 1
on_no][2]);}if(dec_imm<0||dec_imm>4294963200){cout<<"Er 3
';format["lwu"]='I';format["jalr"]='I';//Sformatformat[" 2
sthepositionsofoffseybitszero 0
rs["gp"]=this_register;}elseif(i==4){regist 2
ormat[cur_instr[0]]=='S'){step_S(cur_instr);}elseif(f 4
t<<"Executed:" 0
(cache[i][j][1]==1){is_clean="Dirty";}stringbin_set=decimal_to_binary(i,20,0 5
yte(2);byte[0]=store_value;byte[1]=store_value 3
cimalintbinary_to_decimal(conststring&bin){intdecimal=0; 1
f_register_bin=dec 0
ctions[PC/4];intpos=executed_instruction.find('');stringfirst_word=executed_instruct 2
s7"||r=="x23"){r="x23";}elseif(r=="s8"||r=="x24"){r="x24";} 3
ers();initialize_funct3();initialize_funct7();initialize_ 3
ekeepstoringdataif( 0
k=1;temp_mask=temp_mask<<(index_size+offset_size);temp_mask=temp_mask-1;tag_mask=tag_mask^temp_ma 1
alues[rd]=register_values[rd]&mask;}}elseif(inst=="sra") 3
y(i,20,0);string 1
or_write<<":Address:"<<hex_address 0
s1];uint64_tstore_value=register_values[rs2];//Performstoreaspertheinstructio 1
r_values[rd]=register_values[rs1]|register_values[rs2];}elseif(inst=="xor"){register_v 4
"x28";}elseif(r=="t4"||r=="x29"){r="x29";}elseif(r=="t5"||r==" 2
t["bgeu"]='B';//Jformatformat["jal"] 2
themem_locfor(inti=1;i<instruction.size();i++){uint64_tstore_value 1
;i<4;i++){memory[instruction_no*4+i]=byte[i];}}//CodeforIformatinstructionsvoidexecute_I(v 3
294963200){cout<<"Errorinl 0
r_values[rd]=register_values[rs1]+register_values[rs2];}el 3
_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);he 2
values[rs1],val_rs2=re 1
ex_to_binary(assembly_code[instruction_no][2].substr(2));intdecimal=b 4
mat[cur_instr[ 0
perands.find(cur_instruction[0])!=load_operands.end()||format[cur_instr 3
instructionisdata,thenensurethatuntilwesee.text,wekeepstoringdataif(instruct 0
o){//Handlingerrorif( 0
_pc;}else{PC+ 0
false,mem_loc,"write",false,true,val);break;}}//Ifwedidnotfindthev 0
store,data_base_address);}}continue;}//removeunneces 0
rmat["sd"]='S';//Bformatformat["beq"]='B';format["bge"]='B';format[" 3
x(bin_PC);hex_PC="0x"+hex_PC;cout 1
_hex["0101"]='5';bin_to_hex["0110"]='6';bin_to_he 2
diateisoutofrange";exit(0);}//Notingthevariousp 1
boolaccessed_once){if(cache_enabled){boolis_hit=false;//Letusfirstfigureouthowour20bitsofmemo 1
<endl;}}}myfile_out.close();}elseif(command=="cache_simstats"){if(c 2
stackoffunctionsandtheirlastexecutedlineaccordinglystr 0
o){//Handlingerrorif(assembly_code[instruction_no].size()!=3){cout<<" 3
n}for(inti=0;i 0
_mask=1;tag_ma 0
value>>8;memory[mem_loc]=byte[0];memory[mem_l 2
_mask&mem_loc;//Wenowhavetheindexandtagwewant.Wecanproceedwithfindingtherealdata 0
l"]='R';format["sra"]='R';//I 1
[j];}if(operation=="write"){new_data[3+offset]=val;n 3
gister_values[rd]=register_values[rs1]&register_values 2
tionsofindexbitsandoffsetbitszero//Letusdothesameforindexmakintindex_mask=1;index_mask=index 0
8)|(byte[5]<<40)|(byte[4]<<32)|(byte[3]<<24)|(byte[2]<<16)|(byte[1] 5
tag){if(!accessed_once){hits++;}found=true;cache[index] 3
xecutedlineaccordinglystringtop_of_stack=stack_o 0
ound_invalid=false;for(inti=0;i<associativity;i++){vector<int>cache_block(block_size+3);cache_block= 2
aluesrd=aliasRemover(instruction[1]);rs1=aliasRem 2
embly_code[instruction_no][2]];stringimm=decimal_to_binary(stoi(assembly_code[instruction_no][3] 4
hestringtogetthelinenumberwherewehavetoinsertabreakpointintbreak_point=stoi(comma 0
es[i]=hex_to_binary(hex_instruction.substr(6-2* 1
ti=0;i<4;i++){byte[i] 1
2(cache_size/(associa 0
,"<<hit_or_miss<<",Tag:"<<hex_tag<<","<<clean_or_dirty<<"fromupdatequeue"<<endl;}ord 0
ogramintbreak_point=stoi(command.substr(10));//Wedeletethebreakpo 2
lseif(r=="t1"||r=="x6"){r="x6";}elseif(r= 2
['a']="1010";hex_to_bin['b']="1011";h 2
str);}elseif(format[cur_instr[0]]=='S'){step_S(cur_inst 3
_values[rd]=register_values[rs1]<<register_values[rs2];}elseif(inst=="srl"){uint64_ 4
ateisoutofrange";exit(0);}//Notingthevaiouspa 1
'){executed_inst 0
ariousinstructionsvoidinitialize_format(){//Rformatformat["add"]='R';format[" 2
,0);stringhex_set="0x"+binary_to_hex(bin_set,true,5);stringbin_tag=decimal_to_bin 1
p();}stack_ 1
,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_by 2
_no][0]];stringrd=registers[assembly_code[instruction_no][1]];stringrs1=registers[assembly_cod 4
;exit(0);}elseif(stoi(assembly_code[instruction_no][3])<-pow(2,12 4
f(first_word.back()==':'){executed_instructio 2
+offset_size);//Gettingthevalueofindexbitsofmemorylo 0
mbly_code,intinstruction_no){//Handlingerr 0
ePCvaluePC+=4;}elseif(inst=="jalr"){//Extracttherd,rs1andimmediatevaluerd=aliasRem 1
;intstart_storage=(me 0
;stringcache_config_file_name=command.substr(17);ifstreamcac 1
sembly_code[instruction_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_n 3
ng>registers 0
ction_no);}elseif(format[assembly_code[instruc 0
_mask=temp_mask-1;tag_mask=tag_mask^temp_mask;//Makestheposi 0
cheEnabled"<<endl;cout<<"CacheSize:"<<cache_size<<endl;co 0
ecifiedusingalooopfor(inti=addr 0
nif(load_operands.find(assembly_code[instruction_no][0])!=lo 3
itsinthememorylocationthatourprogramisrequesti 0
[cur.size()-1]==','||cur[cur.size()-1]==')'){cur.pop_b 4
policyif(!found_invalid){update_queue(index,tag,true,mem_loc,"write",false,false,val,offset);}}}}el 3
]="1010";hex_to_bin['b']="1011";hex_to 1
ssembly_code[instruction_no][3]),12,true);//Concatinatingt 2
Signed||!isNegative){returnbin;}//Take1'scomplementfor(inti=0;i<bin.size();i++ 2
000";funct3["and"]="111" 1
e=20-offset_size-index_size;/ 0
110011";stringf3=funct3[assembly_code[instruction_ 0
x3"){r="x3";}elsei 1
ethatrs1alwaysstoresaddressesinformofintegerintstart_location 0
ediatealongwithchecking 0
='R';//Iforma 0
;dummyi/=10;charnum2=dummyi%10+'0';this_register 0
x25"){r="x25";}elseif(r=="s1 1
mloadaspertheins 0
;}else{cout<<"Nobreakpoi 0
register_hex=binary_to_h 0
sthepositionsofindexbitsandoffsetbitszero//Letusdothesameforindexm 0
ueswhicharestoredinthemapcout<<"Registers:\n";for(inti=0;i<32;i++){stringthis_re 0
ruction){//Extracttherdandimmediatevaluesstringinst,rd 0
ng>>&assembly_code,intinstruction_no){//Handlingerrorif(assembly_code[instructio 0
"ori"]='I';format["andi"]='I';format["slli"]='I';format["srli"]='I';format["srai"]='I'; 4
te[5]<<40)|(byte[4]<<32)|(byte[3]<<24)|(byte[2]<<16)|(byte[1]<<8)|byte[0];register_v 6
ti=0;i<8;i++){write_access(mem_loc+i,byte[i],accesse 1
ndl<<"Wrongsyntax,forRt 0
pair<string,int>>dummy_stack;stack<pair<string,int>>dummy_stack_function= 3
eshow-stackcommandcout<<"Call 0
="";for(inti=0;i<hex.size();i++){bin+=hex_to_bin[hex[i]];}returnb 4
letedbreakpointatline:"<<bre 0
x4";}elseif(r=="t0"||r=="x5"){r="x5";}elseif(r=="t1"||r=="x6"){r="x6";}elseif(r=="t2"||r= 4
e();i++){for(intj=0;j<cache[i].size() 3
(bin_set,true,5);strin 1
ngthelinefor(inti=4;i<command.size();i++){if( 1
o_store[0]==".half"){data_base_address=store_half(to_s 1
block[1]=1;//Thecacheblockisnowdirtycache_block[2]=tag;found_invalid=true;update_queue( 2
o][2]];stringimm=decimal_to_binary(stoi(assembly_code[instruction 1
valid=true;update_queue(index,tag,fal 0
=63;i++){mask+=pow(2,i);}}register 2
ion_no+1<<endl<<"Incorrectvalueofrs2";exit(0);}//Notingthevaiourspartsoftheinstrutionstr 1
][i];//Valid,Dirty,tag,dataif(cache_block[0]==0){//Thisisaninvalidframe,ignorecont 3
egisters.find(assembly_code[instruction_no][2])==registers.end()){cout<<"Erro 4
nyinvalidblock,weneedtoapplyreplacementpolicyif(!found_invalid){val=memory[mem_loc];updat 2
nstruction_no][3]),13,true);//Concatinatingthepartstoformthein 1
nordered_map<string,string>funct3;unordered_map<string,string>funct7;unord 2
{if(cur[cur.size()-1]==':'){cur.pop_back();labels[cur]=PC;offset_to_l 5
edtolookinthememoryif(!found){if(! 1
functions.pop();}}}elseif(command=="regs"){//Printtheregistervalueswhicharestoredinthemapcout<< 2
01";hex_to_bin['a']="1010";hex_to_bin['b']="1011";hex_to_bin['c']="1100";hex_to 3
mm=stoi(instruction 0
size());vector<int>new_data(cache[0][0].size());intstart_storage=(mem_loc/block_ 6
told_PC=PC;//Executethebranchifconditionsatisfiedasperthegiveninstructionif(inst=="beq"){if 1
mat["sd"]='S';//Bformatformat["beq"]='B';fo 2
=0;i<binary.size();i+=4){stringb=binary.substr(i,4);hex.push_back(bin_to_hex[b]);}if(le 5
on_no][2])==registers 1
sd"]='S';//Bformatformat["beq"]='B';format["bge"]='B';format["blt"]='B';format["bne 3
";funct3["sw"]="010";funct3["sd"]="011";funct3["beq"]="000";funct3["b 3
e.clear();assembly_code.assign(0,vector<string>(0));//Checkiftheuseri 4
x0;i<0x50001;i++){memory[i]=0x00;}labels.clear();register_values.clear();all_inst 4
on_no*4+i]=byte[i];}}//CodeforJformatinstructionsvoidexecut 1
}}}assembly_code.clear 0
for(inti=0;i<hex.size();i++){if(hex[i]=='0' 2
l<<"Labelnotdefined";exit(0);}else{assembly_code[instruction_no][3]=to_ 3
ter;}elseif(i==1){registers["ra"]=this_register;}elseif( 3
+){memory[instruction 0
();offset_to_label.clear();while(!stac 2
32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_inst 1
to_bin['8']="1000";hex_to_bin['9']="1001";hex_to_bin['a']="1010";hex_to_bin['b']="1011 4
x][i][1]=0;//Setittonon-dirty}//Sincethisahit,weneedtoupdatetheorderofaccessvectoru 2
pop();q.push(cur);}//Notethatheretagwillalwaysbeatthetopq.push(tag);}else{i 3
n.substr(pos+1);}stringbin_PC=decimal_to_bi 1
ringhex_tag="0x"+binary_to_hex(bin_tag,true,5);cache_output<<"W"<<":Address:"<<hex_a 1
][2])==registers.end( 1
ta=cache[index][i];cache[index][i]=new_d 4
_no="x";register_no+=to_string(i);strin 1
=='U'){exe 0
on.size();i++){uint64_tst 1
lues[rd]=res;}elseif(inst=="ld"){vector<int64_t>byte(8);boolacce 4
on[i]!=''&&instruction[i]!='('){cur.push_back(instruction 3
[i][j][0]==1){stringis_clean="Clean";if(cache[i][j][1]==1){is_clean="Dirty";}stringb 8
\etagandindexshouldbeoftheremoved 0
f(first_word.back()==':'){executed_instruction=exec 2
thfindingtherealdataint 0
n_no+1<<endl<<" 0
stoi(instruction[3]);//Updatethe 2
ut_name);//GothroughallthevaluesintheD-cacheandwriteonlytheonceswhicharevalidfor(inti=0;i<cache 0
ed_once=false;vecto 0
intdecimal=binary_to_decimal(bin_instr);dec_imm=decimal;}else{dec_imm=stoi( 1
ns.top().second;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_o 2
_once=true;}int32_tres=(byte[3]<<24)|(byte[2]<<16)|(byte[1]<<8)|(byte[0]);register_values[rd 5
p().second;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,top_li 2
or(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_byte 1
tructionstrin 0
o][1])==registers.end()){cout<<"Errorinline:"<<ins 2
ory[instruction_no*4+i]=byte[i];}}//CodeforUformatinstructionsvoidexecute_U(vector 2
ter_values[rd]=register_values[rs1]>>register_values[rs2];}//Updatethestackoff 3
bstr(17);ifstreamcache_config 1
ction_no].size()!=4){cout< 1
_no+1<<endl<<"Valueofimmediateisoutofrang 0
ine:"<<instruction_no+1<<endl<<"Incorrectvalueofrs1";ex 0
ativity=0,thenweneedtomakeitfullyassociativeif(associativity==0){//Thismeanstha 1
nyinvalidblock,weneedtoapplyreplacementpolicyif(!found_invalid) 1
ecuted_instruction=executed_instruction.substr(pos 0
string,int64_t>register_values;unordered_map<string,string>registe 1
oc=0;//Hereth\etagandin 0
tothecorrespondinginstructionif(load_operand 0
er_values[rs1]>>register_values[rs2];}//Updatethestackoffunctionsandtheirlastex 2
i=0;i<32;i++){stringthis_register="x";if(i<10){charnum='0'+i;this_register+=num;}els 1
uevector<int>removed_data(cache[0][0] 3
oolaccessed_once=false;vector<u 0
sblockdeletesabeakpointin 0
=0){register_values[rd]=register_values[rs1]>>register_values[rs2];//Ourmaskisshifting_amount0' 3
_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed_instruction<<";PC="<<hex_PC<<endl;//Upd 1
push_back(c 0
+".output";cache_output.open(cache_output_n 0
+1<<endl<<"Valueofimmediateisoutofrange";exit(0);}imm=decimal_to_binary(stoi(assembly_code[inst 1
ement_policy, 0
0";funct3["sll"]="001";funct3["srl"]="101";funct3["sra"]="10 3
ow(2,11)){c 1
cutionstoppedatbreakpoint\n";brea 0
mainstackandprintthe 0
binarystringfor( 0
]=store_value;byte[1]=store_value>>8;memory[mem_loc]=byte[0];memory[mem_loc+1]=byte[1]; 5
(2));intdecimal=binary_to_decimal(bin_instr) 2
ileisloaded,thiswillhandleinitializinganyusedvariablesthatthepreviousfilemighthaveusedvoidiniti 0
ow(2,11)||stoi(assembly_co 1
ex][i][1]=0;//Setittonon-dirty}//Sincethisahit,weneedtoupdatetheor 2
alue=stoi(instruction[i]);v 2
{//Extracttherdandimmediatevaluesstringinst,rd;inst=in 0
lue>>8;write_access(mem_loc,byte[0] 1
lue,weneedtolookinthememoryif(!found){if(!accessed_once){mis 2
e_mem_loc|=(tag<<offset_size+index_size);to_store_mem_loc|=(index<<offset_size);for(inti=0;i<block_s 0
ion[i]!=''&&instruction[i]!='('){cur.push_ba 3
e:"<<break_point<<endl;}else{cout<<"Nobreakpointspresent\n";}}elseif(!command.find("b 0
tr(),"a")!=NULL){cache_output.close();}cache_output_name=cur 3
displayboolche 0
uction[0])! 1
ity*block_size);cache.clear();//Notethatthesizeifblocksize+3because, 1
thers1andrs2valuesintnew_pc=PC+stoi(instruction[3] 1
sfirstfigureouthowour20bitsofmemoryaddressaredivided. 0
sters.find(assembly_code[instruction_no][2])==registers.end()){cout<<"Errorinl 4
writetonextreturn 0
ions.top().second;top_line=PC/4+1;stack_of_funct 1
gtherealdataintha 0
x_address<<",Set:"<<hex_set<<","<<"Miss"<<",Tag:"<<hex_tag<<","<<"Clean"<<"Fromwriteacce 0
"lb"]='I';format[ 0
ata[0]=1;//Thebitisnowvalidnew_data[1]=0;//Init 2
datethePCvalueandensurethatx0willalwaysrem 0
p_U(vector<string>i 1
areforindexinttag_size=20-offset_size-index_size;//Andthesem 0
bel.clear();while( 1
ed_set<string>load_o 1
n[2]);}imm=imm<<12;regi 1
elseif(inst=="sra"){register_values[rd]=register_values[rs1]>>register_values 3
dummy_stack_function.top());dummy_stack_function.pop();}for(inti=dummy_stack. 2
//Thesemanyareforindexinttag_size=20-offs 0
rty="Clean"; 0
isters(){for(inti=0;i<=31;i++){stringregister_no="x";register_no+=to_ 1
32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_P 1
str=hex_to_binary(assembly_code[instruction_no][2].substr( 2
<<20;tag_mask=tag_mask-1;//Thismakesthemask20onesinttemp_mask=1;temp_mask=te 0
ter_values[rd]&mask;registe 1
truction.substr(6-2*i,2 0
>=register_values[rs2]){PC=new_pc;}else{PC+=4;}}elseif(inst=="bgeu" 3
sremainatvalueof0PC+=4;register_values["x0"]=0;}//CodefortheIformatstepinstructionsvoidste 1
x12"){r="x12";}elseif(r=="a3"||r=="x13"){r="x13";}el 3
k_of_functions.top().first;inttop_line=stack_of_functions.top( 1
int8_tbyte[4];for(inti=0;i<4;i++){byte[i]=binary_to_decimal(binary_b 2
fiedandstorethemstartingforlocationspecifiedbythemem_locfor(inti=1;i<instruction.size();i++ 1
tag;for(intj=start_storage,k=3;j<=end 0
fs+hex;}}if(length*4<binary.size()){hex=he 1
inti=0;i<associativity;i++){vect 0
PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,top_line});stringexecut 3
ed_data[1]==1){is_dirty=true;i 1
{memory[i]=0x00;}labels.clear();register_values.clear();all_instructions.clear();offset_to_label.c 5
ormat[assembly_code[instruction_no][0]]= 3
ep_R(cur_instr);}elseif(format[cur_instr[0]]=='I'){step_I(cur_instr);}elseif(format[cur_ins 6
ccess[index];queue 1
32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_PC;cout<<"Executed:"<<executed 1
int64_tstore_value=stoi(instruction[i] 1
f(registers.find(assembly_co 0
rorinline:"<<instruction_no+1<<endl<<"Wrongsynt 0
e_byte(to_store,data_base_address);}}continue;}//removeunnecessaryspacefromthebeginningofanylinebool 1
ld_PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x" 1
<(offset_size+index_size) 1
of_stack=stack_of_functions.top(). 1
toi(instruction[i] 1
r<int32_t>byte(4);boolaccessed_once=false;for(inti= 2
_policy;}el 0
et_mask=offset_mask<<(offset_size);offset_mask=offset_mask-1;//Wecannowgettheactualvalueoftagb 1
,true);imm="000000"+imm;}elseif(assembly_code[instruction_no][0]=="sra 2
){cout<<"EmptyCallStack:Executioncomplete\n";}}elseif(!command.fi 0
ction<<";PC="<<hex_PC<<endl;//Ensuretoremovethecalledfunctionfromthestac 0
fortheoffsetaswell,because,ultimatelythisfunctionh 0
tetheorderofaccessvectorupdate_q 0
ex_mask^te 0
[cur_instr[0]]=='B'){step_B(cur_instr);}elseif(format[cur_ins 4
uction<<";PC="<<hex_PC<<endl;//Ensurethatthe 0
8;write_access(mem_loc,byte[0],false);write_access(mem_loc+1,byte[1],t 3
o_of_index 0
s.find(assembly_code[instruction_no][1])= 3
3])==register 0
;//Thesemanyareforindexinttag_size=20-offset_size-index_size;//Andthesemanyaretag 0
"write",false,false,val,offset);}}}}e 0
[i];//Valid,Dirty,tag,dataif(cache_block[0]==0){val=memory[mem_loc];//Getthevalueand 4
));//Wedeletethebre 0
ecimal(binary_bytes[i]);//characters67ofhex_instruction}for(inti=0;i<4;i++){memory[ 2
&&cache[i][j][1]==1){intoffset_size=log2(block_size);//Thesemanybitsareforoffse 4
s[rd]=res;}elseif(inst=="l 1
}}else{memory[mem_loc]=val;}}intread_access(intmem_loc,boolaccessed_once){if(cache_enabl 3
struction[2]);}imm=imm<<12;register_values[rd]=imm;//Updatethestackoffunctio 2
for(inti=addr;i<addr+count;i++){intmem_val=memory[i];strin 1
ary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x 2
tinue;}if(cache_block[2]==tag 1
unct3["addi"]="000";funct 1
o*4+i]=byte[i];}}//CodeforIformatinstructionsvoidexecute_I(vector<vector<string>>&assem 3
o_decimal(bin_instr);imm=decimal;} 1
>(3-i)*8;}for(inti=0;i<4;i++){memory[mem 1
sk=offset_mask-1;//Wecannowgettheactualvalueoftagbitsinthememoryloc 0
]='4';bin_to_hex["0101"]='5';bin_to_hex["0110"]='6';bin_to_hex["0111"]='7';bin_to_hex["1000"]=' 4
tationstringbin_s_addr=hex_to_binary(s_addr);intaddr=binary_to_decimal(bin_s_addr);int 2
sters[argument_register_n 0
sk;}}elseif(inst=="srai"){register_values[rd]=register_values[rs1]>>imm;}//Updatethestackoffunctions 4
int16_tbyte1=read_access(start_location+1,true);int16_tres=byte1<<8|byte0;register_values[ 1
neaccordinglystringtop_of_stack=stack_of_functions.top().first;inttop_li 1
g=decimal_to_binary(tag,20,0);stringhex_tag="0x"+binary_to_hex(bin_ 1
,instruction_no);}elseif(format[assembly_code[instruction_no][0]]=='S'){execute 4
ex_instruction.substr(6 0
ta[0]=1;//Thebitisnowvalidnew_data[1]=0;//Initial 2
ze);//Thesemanybitsareforoffsetintindex_size=log2(cache_size/(associativity*b 0
_amount==0){for(inti=0;i<=63;i++){mask+=pow(2,i);}}register_ 2
e[0][0].size());intstart_storage=(mem_loc/b 3
[0]==0){//Thisisaninvalidframe,ignorecontinue;}if(cache_block[2]==tag){if(!acc 4
mat["bltu"]='B';format["bgeu"]='B';//Jformatformat["jal"]='J';//Uformatformat["lui"]='U';}//Keep 4
moryif(removed_data[1]==1){is_dirty=true;intto_store_mem_loc=0;//Hereth 2
ize());vector<int>new_data(cache[0][0].size());intstart_storage=(mem_lo 6
recontinue;}if(cache_block[2]==tag){if(!acce 2
elseif(r=="a6"||r== 0
//Iterateoverthebinarystringfor(inti=0;i<len 0
c_imm=decimal;}else{dec_imm=stoi(assembly_code[instru 0
egister_values.clear();all_instructions.clear();offset_to_label.clear();while(!stack_of_functions 3
ache_enabled){stringhit_or_miss="Miss";stringclean_or_ 0
ted_instruction<<";PC="<<hex_PC<<endl;//UpdatetheP 0
()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Incorrectvalueofrs 1
ck_size);//Thesemany 0
val_rs1>=val_rs2){PC=new_pc;}else{PC+=4;}}elseif(inst=="bltu"){uint64_tval 3
ute_J(assembly_code,instruction_no);}elseif(for 1
t16_tbyte0=read_access(start_location,false);int16_tbyte1=read_acce 1
x12"){r="x12";}elseif(r=="a3"|| 1
CodeforUfo 0
no][1])==registers.end()){cout<<"Errorinl 2
(dec_imm<0||dec_imm>4294963200){cout<<"Errorinline: 2
[instruction_no][ 1
/Notingthevariouspartsofth 0
elseif(registers.find(assembly_code[instruction_no][1])==registers.end()){cout<<"Errorinline:"< 5
old_PC,32,0);stringhex_PC=binary_to_hex(bin_PC);hex_PC="0x"+hex_P 1
stack_of_functions.push({top_of_stack,top_line});stringexec 2
lseif(registers.find(assembly_code[instruction_no][1])==registers.end()){cout<<"Errorinline:" 5
ss:"<<hex_address<<",Set:"<<hex_se 0
licy;//Iftheassociativity=0,thenwene 0
thestackif(PC/4==no_of_instruction){//Alsoensuretoprintthecache 1
j<=end_storage;j++,k++){new_d 0
,0);//InitializethevalueofPCintPC;//Herewedeclareallvariablesrelatedtocacheintcache_s 0
theuserhasspecifiedandstorethemstartingf 0
_to_binary(stoi(assembly_code[instruction_no][3]),6,true);imm="000000" 4
ut<<"Errorinline:"<<instr 0
nttemp_mask=1;temp_mask=temp_ 0
"<<misses<<",HitRate="<<fix 0
replace){boolis_present=false;while(!q.empty()){intcur=q.front();q.pop();d 4
.push(tag);//Pushthenewtagvaluevector<int>removed_data(cache[0][0].size 4
if(!command.find("delbreak")){//Thisblockdeletesabeakpointintheprogramintbrea 2
{if(stoi(assembly_code[instruction_no][3])<0||stoi(assembly_code[instruction_n 3
erands.ins 0
ex.size();i++) 1
ues[rs2];if(shifting_amount!=0){r 2
_mask^temp_mask;//Makesthepositionsofindexbi 0
misses=0;//memory.clear();//cache. 1
nabled){cout<<"D-c 0
_loc=0;to_store_mem_loc|=(tag<<offset_size+index_size);to_store_mem_loc|=(index<< 0
ngbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary_to_hex(bin_PC 1
C/4];intpos=execute 0
ction[1]);stringrs1=ali 1
decimalandstoreintextmemoryfor(intinstruction_no=0;instruction_no<assembly_code.size();ins 1
tructionif 0
ofimmediateisoutofrange";exit(0);}imm=decimal_to_binary(stoi(ass 1
-igivesthepositionfromtheright}}returndecimal;}//De 0
ask<<(index_size+offset_size);temp_mask=temp_mask-1;tag_mask=tag_mask^t 1
ip;//Codetoconvertbinarytohexadecimalstringbinary_to_hex(stringbi 0
em_val,true,2);intmem_loc=i;stringmem_loc_bin=decimal_to_binary(i,20,0);stringmem_loc_hex="0x"+bina 1
uction[1]);intimm;//Weacceptbot 1
bin_tag=decimal_to_binary(tag,20,0);stringhex_tag=" 1
d_map<string,string>funct3;uno 1
0;register_values[rd]=res;}e 1
ize/(associativity*block_si 0
rutionstringf3=funct3[assembly_code[instruction_no][0]]; 3
tethestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_ 0
de,instruction_no);}else{cout<<"Erroronlin 0
r_values[rd]=res;}elseif(inst=="lhu"){uint16_tbyte0=read_access(start_location,fals 2
sethestringtogetthelinenumberwherewehavetoinsertabreakpointintbreak_p 0
ary_to_hex( 0
lues[rd]=res;rd=res;}elseif(inst=="lh"){int16_tbyte0=r 2
;funct3["sd"]="011";funct3["beq"]="000";funct3["bne"]="001";f 3
{top_of_stack,top_line});stringexecuted_instruction=all_instructions[PC/4];i 2
(!accessed_once){misses++;if(write_b 1
substr(2,6)+rs2+rs1+f3+imm.substr(8,4)+imm.substr(1,1)+opcode;stringhex_instruction=binary_ 3
ordered_map>#include<unordered_set>#include<vector>#include<array>#inclu 3
{cur.pop_back();labels[cur]=PC;offset_to_label[PC]=cur;cur="";cont 3
_to_binary(tag,20,0);stringhex_tag="0x"+binary_to_hex(bin_ 1
maltobinarystringhex_to_binary(stringhex){unordered_map<char,string>hex_to_bin;hex_to_bin 2
+){memory[instruction_no*4+i]=byte[i];}}//CodeforIformatinstruc 3
ta[2]=tag;for(intj=start_storage,k=3;j<= 1
w_data[k]=memory[j];}if(operation=="write"){new_data[3+offset]=val;new_data[1]=1;//Setthebitto 5
of_instruction){cout<<"Nothingtostep\n";}else{vector<string>cur_instr=assembly_code[PC/4];if(forma 2
_size);//Thesemanybitsareforoffsetintindex_size=log2(cache_size/(associativity*block_size)); 2
="x24";}elseif(r=="s9"| 0
cur_instr[0]]=='S'){step_S(cur_instr);}elseif(f 3
on_no+1<<endl<<"Incorrectvalueofrs1";exit(0);}stringopcode;/ 1
ringtop_of_stack=stack_of_functions.top().first;inttop_line=stack_of_f 1
struction_no][1])==registers.end()){cout<<"Errorinli 2
ss"<<",Tag:"<<hex_tag<<","<<"Clean"<<"Fromwriteaccess"<<endl;}}//Inthe 0
onif(load_operands.find(assembly_code[instruction_no][0])!=load_oper 3
lseif(inst=="slli"){register_values[rd]=register_values[rs1]<<imm;}elseif(inst=="srli"){uint32_tshi 4
alue=stoi(instruction[i]); 2
,20,0);stringhex_set="0x"+binary_to_hex(bin_set,true,5);stringbin_tag=decimal_to_binary(cache[i][ 2
<endl;exit(0);}elseif(registers.find(assembl 1
tr(10,10)+imm.substr(9,1)+imm.substr(1,8)+rd+o 3
y[j];}if(operation=="write"){new_data[3+offset]=val;new_data[1]=1;//Setthebittodirt 4
ction_no*4); 0
_R(cur_instr);}elseif(forma 1
++){if(cache[index][i][2]==top_tag){removed_data=cache[index][i];cach 6
atedtocacheintcache_size,block_size,associativity;stringreplacement 0
";}returnr;}voidupdate_queue(intindex,inttag,boolto_replace,intmem_loc,stringoperation,bo 0
es[i]=hex_to_binary(hex_instruction.substr(6-2*i,2));}uint8_tbyte[4];for(inti=0;i<4;i++){byte 4
nary(i,20,0);strin 1
="Miss";stringclean_or_dirty="Clean";stringrea 0
ormatstepinstructionsvoidstep_I(vector<string>instruction){stringrd,rs1,inst;inst=instruction 2
inglystringtop_of_stack=stack_of_functions.top().first;inttop_line=stack_of_functions.top() 2
findexbitsandoffsetbitszero//Letusdothesamefori 0
ntoffset_size=log2(block_size);//Thesemanybitsareforoffsetintindex_size=log2(cache_size/(associati 1
xecute_S(assembly_code,instruction_no);}elseif(fo 1
m.substr(0,1)+imm.su 1
old_PC/4+1;stack_of_functions.pop();stack_of_functions.pu 1
;top_line=PC/4+1;stack_of_functions.pop();stack_of_functions.push({top_of_stack,to 1
dl<<"Wrongsyntax,forItypeformat,youmustenter 0
ary(index,20,0);stringhex_set="0x"+binary_to_hex(bin_set,true,5);stringbin_tag=decimal_to_binar 2
ocationthatourprogramisrequestingtoreadinttag=tag_mask&mem_loc;tag>>=(index_s 0
hestackoffunctionsandtheirlastexecutedlineaccordinglystringtop_of_stack=stack_of 0
ction}for(inti=0;i<4;i++){memory[in 0
anttoconvertittodecimalrepresenttion,viabinaryrepresentationstringbin_s_addr=hex_to_b 0
sk=tag_mask 0
rite",false,false,val);cache[index][i]=cache_block;r 2
xit(0);}elseif(stoi(assembly_code[inst 1
dindexshouldbeoftheremoveddatano?to_store_mem_loc|=(removed_data[2]<<(offset_size+i 1
_block[2]=tag;for(intj=start_storage,k=3;j<=end_storage;j++,k++){cac 1
=break_lines.end()){break;//to_break=true;}vector<string>cur_instr 3
_size);//Let'sgetthevalueofoffsetbitsintoffset=offset_mask 0
>>8;memory[mem_loc]=byte[0];memory[mem_loc+1]=byte[1];mem_loc+=2;}//R 4
x21"){r="x21";}elseif(r=="s6"||r=="x22"){r="x22"; 2
binary_to_hex(bin_address,false,5);stringbin_s 1
terinttag_mask=1;tag_mas 0
'sgetthevalueofoffsetbitsintoffset=offset_mask&mem_loc;//Wenowhavethei 0
rmatinstructionsvoidexecute_B(vector<vector<string>>&assembly_code,i 2
ingmem_loc_bin=decimal_to_binary(i,20 0
uted_instruction.substr(pos+1);}stringbin_PC=decimal_to_binary(PC,32,0);stringhex_PC=binary 2
ut<<"CallStack:\n";//Weuseadummystacktopopthelabelsfromthe 0
r_values[rs2];}elseif(inst=="xor"){register_values[rd]=reg 3
";stringbin="";for(inti=0;i<hex.size();i++){bin+=hex_to_bin[hex[i]];}returnbin;}//Codetoconv 4
unct7["add"]="0000000";funct7["sub"]="0100000";funct7["and" 2
rylocationthatourprogramisrequestingtoreadin 0
Bformatformat["beq"]='B';format["bge"]='B';format["blt"]='B';format["bne"] 4
lock(block_size+3); 1
tingthevariouspartsoftheinstru 0
cyintstart_storage=(mem_loc/block_ 0
=='S'){step_S(cur_instr);}elseif(format[cur_instr[0]]=='B'){step_B(cur_instr);}els 7
+1,true);uint16_tres=byte1<<8|byte0;register_values[rd]=res;}elseif(inst=="lw 1
nd()){cout<<"Errorinline:"<<instruction_no+1<<endl<<"Labelnotdefined";exit(0);}el 2
ubstr(pos+1);}string 1
grs2=registers[assembly_code[instruction_no][1]];stringimm=decimal_to_binary(stoi(assembl 3
retopopmainfromthestackif(PC/4==no_of_instruction){stack_of_functions.pop();}}}els 3
(cache_size/(associativity*block_size));//Thesemanyareforindexinttag_size=20-offse 2
bly_code[instruction_no][1])==registers.end()){cout<<"Errorinline:"<<instruction_no+1<< 3
g>instruction,intmem_loc) 0
alueofrs1";exit(0);}elseif(stoi(assembly_code[instruction_no][3])<-pow(2,11)||st 5
if(cur!=""){to_store.push_back(cur);}cur="";}else{cur.push_back(c 3
ctthembreak_lines.insert(bre 0
of_stack=stack_of_functions.top().first; 1
ns.top().second;top_line=PC/4+1;stack_of_functions.pop();stack_of_fu 2
owcheckiftheremoveddatah 0
<<"Errorinlin 0
ctions.pop( 0
thatthepreviousfilemighthaveusedvoidinitialize(){for(inti=0;i<32;i++){stri 1
;for(inti=0;i<block 0
]='5';bin_to_hex["0110"]='6';bin_to_hex["0111"]='7';bin_ 2
register;}elseif(i==1){registers["ra"]=this_register;}elseif(i==2){registers["sp"]=this_register 5
nst=instruction[0];rd=ali 1
);accessed_once=true;}uint 0
_code[PC/4];if(format[cur_instr[0]]=='R'){step_R(cur_ 4
ter_int,64,1);stringvalue_of_register_hex=binary_to_hex(value_of_register_bin,tru 0
nhastoreturnonly1byteintoffset_mask=1;offset_mask=offset_mask<<(offset_size);offset_mas 1
o+1<<endl<<"Incorrectvalueofrs1";exit(0);}elseif(registers.find(assembly_code[instru 1
"0110"]='6';bin_to_hex["0111"]= 1
e"]="001";funct3["blt"]="100";funct3["bge"]="101";funct3[" 2
tions.push({offset_to_label[PC],-1});stringexecuted_instruction=all_instructions[old_PC/4] 4
nstruction[0];stringrd=aliasRemover(instruction[1]);stringrs1=aliasRemover(instruction[2]);stri 5
abels.find(assembly_code[instruction_no][2])= 3
<<20;tag_mask=tag_mask-1;//Thismakesthemask20onesinttemp_mask=1;temp_mask=temp_mask<<(i 0
oi(assembly_co 0
push(tag);}else{inttop_tag=q.front();//Getthetagwhichweneedtoreplaceq.pop();//Popth 3
operands.insert("lh");load_operands.insert("lw" 1
f_stack=stack_of_functions.top().f 1
temp_mask=temp_mask-1;tag_mask=tag_ 0
sert("lh");load_operands.insert("lw");load_opera 2
=0;i<32;i++){st 0
mem_loc,"read",true,true);}returnval;//Thedatastartsfromindex3andextendstillblocksize//break;}}// 0
cess"<<endl;}}//Inthecase 0
in[i]='1';break;}bin[i]='0';}returnbin;}//Functiontoconvertbinarystringtode 2
te[0],false);write_access(mem_loc+1,byte[1],true);}if(inst=="sw"){boolaccess 4
